[{"content":"VIM Keyboard Shortcuts    Cursor movement      h move left   j move down   k move up   l move right   w jump by start of words (punctuation considered words)   W jump by words (spaces separate words)   e jump to end of words (punctuation considered words)   E jump to end of words (no punctuation)   b jump backward by words (punctuation considered words)   B jump backward by words (no punctuation)   0 (zero) start of line   ^ first non-blank character of line   $ end of line   G Go To command (prefix with number   Note: Prefix a cursor movement command with a number to repeat it. For example, 4j moves down 4 lines.   Insert Mode Inserting/Appending text   i start insert mode at cursor   I insert at the beginning of the line   a append after the cursor   A append at the end of the line   o open (append) blank line below current line (no need to press return)   O open blank line above current line   ea append at end of word   Esc exit insert mode       Editing    r replace a single character (does not use insert mode)   J join line below to the current one   cc change (replace) an entire line   cw change (replace) to the end of word   c$ change (replace) to the end of line   s delete character at cursor and subsitute text   S delete line at cursor and substitute text (same as cc)   xp transpose two letters (delete and paste, technically)   u undo   . repeat last command       Marking text (visual mode)    v start visual mode, mark lines, then do command (such as y-yank)   V start Linewise visual mode   o move to other end of marked area   Ctrl+v start visual block mode   O move to Other corner of block   aw mark a word   ab a () block (with braces)   aB a {} block (with brackets)   ib inner () block   iB inner {} block   Esc exit visual mode       Visual commands    \u0026gt; shift right   \u0026lt; shift left   y yank (copy) marked text   d delete marked text   ~ switch case       Cut and Paste    yy yank (copy) a line   2yy yank 2 lines   yw yank word   y$ yank to end of line   p put (paste) the clipboard after cursor   P put (paste) before cursor   dd delete (cut) a line   dw delete (cut) the current word   x delete (cut) current character       Exiting    :w write (save) the file, but don\u0026rsquo;t exit   :wq write (save) and quit   :q quit (fails if anything has changed)   :q! quit and throw away changes       Search/Replace    /pattern search for pattern   ?pattern search backward for pattern   n repeat search in same direction   N repeat search in opposite direction   :%s/old/new/g replace all old with new throughout file   :%s/old/new/gc replace all old with new throughout file with confirmations       Working with multiple files    :e filename Edit a file in a new buffer   :bnext (or :bn) go to next buffer   :bprev (of :bp) go to previous buffer   :bd delete a buffer (close a file)   :sp filename Open a file in a new buffer and split window   ctrl+ws Split windows   ctrl+ww switch between windows   ctrl+wq Quit a window   ctrl+wv Split windows vertically        ","permalink":"https://sunhao1256.github.io/posts/vim-keyboard-shortcuts/","summary":"VIM Keyboard Shortcuts    Cursor movement      h move left   j move down   k move up   l move right   w jump by start of words (punctuation considered words)   W jump by words (spaces separate words)   e jump to end of words (punctuation considered words)   E jump to end of words (no punctuation)   b jump backward by words (punctuation considered words)   B jump backward by words (no punctuation)   0 (zero) start of line   ^ first non-blank character of line   $ end of line   G Go To command (prefix with number   Note: Prefix a cursor movement command with a number to repeat it.","title":"VIM Keyboard Shortcuts"},{"content":"","permalink":"https://sunhao1256.github.io/posts/%E6%9F%A5%E6%89%BE%E7%AE%97%E6%B3%95/","summary":"","title":"æŸ¥æ‰¾ç®—æ³•"},{"content":"","permalink":"https://sunhao1256.github.io/posts/%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95/","summary":"","title":"æ’åºç®—æ³•"},{"content":"åœ¨nginxä¸­é…ç½®proxy_passæ—¶ï¼Œå½“åœ¨åé¢çš„urlåŠ ä¸Šäº†/ï¼Œç›¸å½“äºæ˜¯ç»å¯¹æ ¹è·¯å¾„ï¼Œåˆ™nginxä¸ä¼šæŠŠlocationä¸­åŒ¹é…çš„è·¯å¾„éƒ¨åˆ†ä»£ç†èµ°;å¦‚æœæ²¡æœ‰/ï¼Œåˆ™ä¼šæŠŠåŒ¹é…çš„è·¯å¾„éƒ¨åˆ†ä¹Ÿç»™ä»£ç†èµ°ã€‚ é¦–å…ˆæ˜¯locationè¿›è¡Œçš„æ˜¯æ¨¡ç³ŠåŒ¹é… 1ï¼‰æ²¡æœ‰â€œ/â€æ—¶ï¼Œlocation /abc/defå¯ä»¥åŒ¹é…/abc/defghiè¯·æ±‚ï¼Œä¹Ÿå¯ä»¥åŒ¹é…/abc/def/ghiç­‰ 2ï¼‰è€Œæœ‰â€œ/â€æ—¶ï¼Œlocation /abc/def/ä¸èƒ½åŒ¹é…/abc/defghiè¯·æ±‚ï¼Œåªèƒ½åŒ¹é…/abc/def/anythingè¿™æ ·çš„è¯·æ±‚ ä¸‹é¢å››ç§æƒ…å†µåˆ†åˆ«ç”¨http://192.168.1.4/proxy/test.html è¿›è¡Œè®¿é—®ã€‚ ç¬¬ä¸€ç§ï¼š location /proxy/ { proxy_pass http://127.0.0.1:81/; } ç»“è®ºï¼šä¼šè¢«ä»£ç†åˆ°http://127.0.0.1:81/test.html è¿™ä¸ªurl ç¬¬äºŒç§(ç›¸å¯¹äºç¬¬ä¸€ç§ï¼Œæœ€åå°‘ä¸€ä¸ª /) location /proxy/ { proxy_pass http://127.0.0.1:81; } ç»“è®ºï¼šä¼šè¢«ä»£ç†åˆ°http://127.0.0.1:81/proxy/test.html è¿™ä¸ªurl ç¬¬ä¸‰ç§ï¼š location /proxy/ { proxy_pass http://127.0.0.1:81/ftlynx/; } ç»“è®ºï¼šä¼šè¢«ä»£ç†åˆ°http://127.0.0.1:81/ftlynx/test.html è¿™ä¸ªurlã€‚ ç¬¬å››ç§(ç›¸å¯¹äºç¬¬ä¸‰ç§ï¼Œæœ€åå°‘ä¸€ä¸ª / )ï¼š location /proxy/ { proxy_pass http://127.0.0.1:81/ftlynx; } ç»“è®ºï¼šä¼šè¢«ä»£ç†åˆ°http://127.0.0.1:81/ftlynxtest.html è¿™ä¸ªurl ","permalink":"https://sunhao1256.github.io/posts/nginx/","summary":"åœ¨nginxä¸­é…ç½®proxy_passæ—¶ï¼Œå½“åœ¨åé¢çš„urlåŠ ä¸Šäº†/ï¼Œç›¸å½“äºæ˜¯ç»å¯¹æ ¹è·¯å¾„ï¼Œåˆ™nginxä¸ä¼šæŠŠlocationä¸­åŒ¹é…çš„è·¯å¾„éƒ¨åˆ†ä»£ç†èµ°;å¦‚æœæ²¡æœ‰/ï¼Œåˆ™ä¼šæŠŠåŒ¹é…çš„è·¯å¾„éƒ¨åˆ†ä¹Ÿç»™ä»£ç†èµ°ã€‚ é¦–å…ˆæ˜¯locationè¿›è¡Œçš„æ˜¯æ¨¡ç³ŠåŒ¹é… 1ï¼‰æ²¡æœ‰â€œ/â€æ—¶ï¼Œlocation /abc/defå¯ä»¥åŒ¹é…/abc/defghiè¯·æ±‚ï¼Œä¹Ÿå¯ä»¥åŒ¹é…/abc/def/ghiç­‰ 2ï¼‰è€Œæœ‰â€œ/â€æ—¶ï¼Œlocation /abc/def/ä¸èƒ½åŒ¹é…/abc/defghiè¯·æ±‚ï¼Œåªèƒ½åŒ¹é…/abc/def/anythingè¿™æ ·çš„è¯·æ±‚ ä¸‹é¢å››ç§æƒ…å†µåˆ†åˆ«ç”¨http://192.168.1.4/proxy/test.html è¿›è¡Œè®¿é—®ã€‚ ç¬¬ä¸€ç§ï¼š location /proxy/ { proxy_pass http://127.0.0.1:81/; } ç»“è®ºï¼šä¼šè¢«ä»£ç†åˆ°http://127.0.0.1:81/test.html è¿™ä¸ªurl ç¬¬äºŒç§(ç›¸å¯¹äºç¬¬ä¸€ç§ï¼Œæœ€åå°‘ä¸€ä¸ª /) location /proxy/ { proxy_pass http://127.0.0.1:81; } ç»“è®ºï¼šä¼šè¢«ä»£ç†åˆ°http://127.0.0.1:81/proxy/test.html è¿™ä¸ªurl ç¬¬ä¸‰ç§ï¼š location /proxy/ { proxy_pass http://127.0.0.1:81/ftlynx/; } ç»“è®ºï¼šä¼šè¢«ä»£ç†åˆ°http://127.0.0.1:81/ftlynx/test.html è¿™ä¸ªurlã€‚ ç¬¬å››ç§(ç›¸å¯¹äºç¬¬ä¸‰ç§ï¼Œæœ€åå°‘ä¸€ä¸ª / )ï¼š location /proxy/ { proxy_pass http://127.0.0.1:81/ftlynx; } ç»“è®ºï¼šä¼šè¢«ä»£ç†åˆ°http://127.0.0.1:81/ftlynxtest.html è¿™ä¸ªurl ","title":"Nginx"},{"content":"WireShark ä¸‰æ¬¡æ¡æ‰‹å››æ¬¡æŒ¥æ‰‹ TCP é¦–éƒ¨åŒ…å«ä»¥ä¸‹å†…å®¹ï¼Œè¯·ç•™æ„å…¶ä¸­çš„æ§åˆ¶ä½ï¼Œåœ¨ä¸‰æ¬¡æ¡æ‰‹å’Œå››æ¬¡æŒ¥æ‰‹è¿‡ç¨‹ä¸­ä¼šé¢‘ç¹å‡ºç°ï¼š\n ç«¯å£å· (Source Port and Destination Port)ï¼šæ¯ä¸ª TCP æŠ¥æ–‡æ®µéƒ½åŒ…å«æºç«¯å’Œç›®çš„ç«¯çš„ç«¯å£å·ï¼Œç”¨äºå¯»æ‰¾å‘é€ç«¯å’Œæ¥æ”¶ç«¯åº”ç”¨è¿›ç¨‹ã€‚è¿™ä¸¤ä¸ªå€¼åŠ ä¸Š IP é¦–éƒ¨ä¸­çš„æºç«¯ IP åœ°å€å’Œç›®çš„ç«¯ IP åœ°å€å°±å¯ä»¥ç¡®å®šä¸€ä¸ªå”¯ä¸€çš„ TCP è¿æ¥ã€‚ åºå· (Sequence Number)ï¼šè¿™ä¸ªå­—æ®µçš„ä¸»è¦ä½œç”¨æ˜¯ç”¨äºå°†å¤±åºçš„æ•°æ®é‡æ–°æ’åˆ—ã€‚TCP ä¼šéšå¼åœ°å¯¹å­—èŠ‚æµä¸­çš„æ¯ä¸ªå­—èŠ‚è¿›è¡Œç¼–å·ï¼Œè€Œ TCP æŠ¥æ–‡æ®µçš„åºå·è¢«è®¾ç½®ä¸ºå…¶æ•°æ®éƒ¨åˆ†çš„ç¬¬ä¸€ä¸ªå­—èŠ‚çš„ç¼–å·ã€‚åºå·æ˜¯ 32 bit çš„æ— ç¬¦å·æ•°ï¼Œå–å€¼èŒƒå›´æ˜¯0åˆ° 232 - 1ã€‚ ç¡®è®¤åºå· (Acknowledgment Number)ï¼šæ¥æ”¶æ–¹åœ¨æ¥å—åˆ°æ•°æ®åï¼Œä¼šå›å¤ç¡®è®¤æŠ¥æ–‡ï¼Œå…¶ä¸­åŒ…å«ç¡®è®¤åºå·ï¼Œä½œç”¨å°±æ˜¯å‘Šè¯‰å‘é€æ–¹è‡ªå·±æ¥æ”¶åˆ°äº†å“ªäº›æ•°æ®ï¼Œä¸‹ä¸€æ¬¡æ•°æ®ä»å“ªé‡Œå¼€å§‹å‘ï¼Œå› æ­¤ï¼Œç¡®è®¤åºå·åº”å½“æ˜¯ä¸Šæ¬¡å·²æˆåŠŸæ”¶åˆ°æ•°æ®å­—èŠ‚åºå·åŠ  1ã€‚åªæœ‰ ACK æ ‡å¿—ä¸º 1 æ—¶ç¡®è®¤åºå·å­—æ®µæ‰æœ‰æ•ˆã€‚ é¦–éƒ¨é•¿åº¦ (Header Length)ï¼šé¦–éƒ¨ä¸­çš„é€‰é¡¹éƒ¨åˆ†çš„é•¿åº¦æ˜¯å¯å˜çš„ï¼Œå› æ­¤é¦–éƒ¨çš„é•¿åº¦ä¹Ÿæ˜¯å¯å˜çš„ï¼Œæ‰€ä»¥éœ€è¦è¿™ä¸ªå­—æ®µæ¥æ˜ç¡®è¡¨ç¤ºé¦–éƒ¨çš„é•¿åº¦ï¼Œè¿™ä¸ªå­—æ®µå  4 bitï¼Œ4 ä½çš„äºŒè¿›åˆ¶æ•°æœ€å¤§å¯ä»¥è¡¨ç¤º 15ï¼Œè€Œé¦–éƒ¨é•¿åº¦æ˜¯ä»¥ 4 ä¸ªå­—èŠ‚ä¸ºä¸€ä¸ªå•ä½çš„ï¼Œå› æ­¤é¦–éƒ¨æœ€å¤§é•¿åº¦æ˜¯ 15 * 4 = 60 å­—èŠ‚ã€‚ ä¿ç•™å­—æ®µ (Reserved)ï¼šå  6 ä½ï¼Œæœªæ¥å¯èƒ½æœ‰å…·ä½“ç”¨é€”ï¼Œç›®å‰é»˜è®¤å€¼ä¸º0. æ§åˆ¶ä½ (Control Bits)ï¼šåœ¨ä¸‰æ¬¡æ¡æ‰‹å’Œå››æ¬¡æŒ¥æ‰‹ä¸­ä¼šç»å¸¸çœ‹åˆ° SYNã€ACK å’Œ FIN çš„èº«å½±ï¼Œä¸€å…±æœ‰ 6 ä¸ªæ ‡å¿—ä½ï¼Œå®ƒä»¬è¡¨ç¤ºçš„æ„ä¹‰å¦‚ä¸‹ï¼š  URG (Urgent Bit)ï¼šå€¼ä¸º 1 æ—¶ï¼Œç´§æ€¥æŒ‡é’ˆç”Ÿæ•ˆ ACK (Acknowledgment Bit)ï¼šå€¼ä¸º 1 æ—¶ï¼Œç¡®è®¤åºå·ç”Ÿæ•ˆ PSH (Push Bit)ï¼šæ¥æ”¶æ–¹åº”å°½å¿«å°†è¿™ä¸ªæŠ¥æ–‡æ®µäº¤ç»™åº”ç”¨å±‚ RST (Reset Bit)ï¼šå‘é€ç«¯é‡åˆ°é—®é¢˜ï¼Œæƒ³è¦é‡å»ºè¿æ¥ SYN (Synchronize Bit)ï¼šåŒæ­¥åºå·ï¼Œç”¨äºå‘èµ·ä¸€ä¸ªè¿æ¥ FIN (Finish Bit)ï¼šå‘é€ç«¯è¦æ±‚å…³é—­è¿æ¥   çª—å£å¤§å° (Window)ï¼š TCPçš„æµé‡æ§åˆ¶ç”±è¿æ¥çš„æ¯ä¸€ç«¯é€šè¿‡å£°æ˜çš„çª—å£å¤§å°æ¥æä¾›ã€‚çª—å£å¤§å°ä¸ºå­—èŠ‚æ•°ï¼Œèµ·å§‹äºç¡®è®¤åºå·å­—æ®µæŒ‡æ˜çš„å€¼ï¼Œè¿™ä¸ªå€¼æ˜¯æ¥æ”¶ç«¯æ­£æœŸæœ›æ¥æ”¶çš„å­—èŠ‚ã€‚çª—å£å¤§å°æ˜¯ä¸€ä¸ª 16 bit å­—æ®µï¼Œå•ä½æ˜¯å­—èŠ‚ï¼Œ å› è€Œçª—å£å¤§å°æœ€å¤§ä¸º 65535 å­—èŠ‚ã€‚ æ£€éªŒå’Œ (Checksum)ï¼šåŠŸèƒ½ç±»ä¼¼äºæ•°å­—ç­¾åï¼Œç”¨äºéªŒè¯æ•°æ®å®Œæ•´æ€§ï¼Œä¹Ÿå°±æ˜¯ç¡®ä¿æ•°æ®æœªè¢«ä¿®æ”¹ã€‚æ£€éªŒå’Œè¦†ç›–äº†æ•´ä¸ª TCP æŠ¥æ–‡æ®µï¼ŒåŒ…æ‹¬ TCP é¦–éƒ¨å’Œ TCP æ•°æ®ï¼Œå‘é€ç«¯æ ¹æ®ç‰¹å®šç®—æ³•å¯¹æ•´ä¸ªæŠ¥æ–‡æ®µè®¡ç®—å‡ºä¸€ä¸ªæ£€éªŒå’Œï¼Œæ¥æ”¶ç«¯ä¼šè¿›è¡Œè®¡ç®—å¹¶éªŒè¯ã€‚ ç´§æ€¥æŒ‡é’ˆ (Urgent Pointer)ï¼šå½“ URG æ§åˆ¶ä½å€¼ä¸º 1 æ—¶ï¼Œæ­¤å­—æ®µç”Ÿæ•ˆï¼Œç´§æ€¥æŒ‡é’ˆæ˜¯ä¸€ä¸ªæ­£çš„åç§»é‡ï¼Œå’Œåºå·å­—æ®µä¸­çš„å€¼ç›¸åŠ è¡¨ç¤ºç´§æ€¥æ•°æ®æœ€åä¸€ä¸ªå­—èŠ‚çš„åºå·ã€‚ TCP çš„ç´§æ€¥æ–¹å¼æ˜¯å‘é€ç«¯å‘å¦ä¸€ç«¯å‘é€ç´§æ€¥æ•°æ®çš„ä¸€ç§æ–¹å¼ã€‚ é€‰é¡¹ (Options)ï¼šè¿™ä¸€éƒ¨åˆ†æ˜¯å¯é€‰å­—æ®µï¼Œä¹Ÿå°±æ˜¯éå¿…é¡»å­—æ®µï¼Œæœ€å¸¸è§çš„å¯é€‰å­—æ®µæ˜¯â€œæœ€é•¿æŠ¥æ–‡å¤§å° (MSSï¼ŒMaximum Segment Size)â€ã€‚ æœ‰æ•ˆæ•°æ®éƒ¨åˆ† (Data)ï¼šè¿™éƒ¨åˆ†ä¹Ÿä¸æ˜¯å¿…é¡»çš„ï¼Œæ¯”å¦‚åœ¨å»ºç«‹å’Œå…³é—­ TCP è¿æ¥çš„é˜¶æ®µï¼ŒåŒæ–¹äº¤æ¢çš„æŠ¥æ–‡æ®µå°±åªåŒ…å« TCP é¦–éƒ¨ã€‚  ","permalink":"https://sunhao1256.github.io/posts/wireshark/","summary":"WireShark ä¸‰æ¬¡æ¡æ‰‹å››æ¬¡æŒ¥æ‰‹ TCP é¦–éƒ¨åŒ…å«ä»¥ä¸‹å†…å®¹ï¼Œè¯·ç•™æ„å…¶ä¸­çš„æ§åˆ¶ä½ï¼Œåœ¨ä¸‰æ¬¡æ¡æ‰‹å’Œå››æ¬¡æŒ¥æ‰‹è¿‡ç¨‹ä¸­ä¼šé¢‘ç¹å‡ºç°ï¼š\n ç«¯å£å· (Source Port and Destination Port)ï¼šæ¯ä¸ª TCP æŠ¥æ–‡æ®µéƒ½åŒ…å«æºç«¯å’Œç›®çš„ç«¯çš„ç«¯å£å·ï¼Œç”¨äºå¯»æ‰¾å‘é€ç«¯å’Œæ¥æ”¶ç«¯åº”ç”¨è¿›ç¨‹ã€‚è¿™ä¸¤ä¸ªå€¼åŠ ä¸Š IP é¦–éƒ¨ä¸­çš„æºç«¯ IP åœ°å€å’Œç›®çš„ç«¯ IP åœ°å€å°±å¯ä»¥ç¡®å®šä¸€ä¸ªå”¯ä¸€çš„ TCP è¿æ¥ã€‚ åºå· (Sequence Number)ï¼šè¿™ä¸ªå­—æ®µçš„ä¸»è¦ä½œç”¨æ˜¯ç”¨äºå°†å¤±åºçš„æ•°æ®é‡æ–°æ’åˆ—ã€‚TCP ä¼šéšå¼åœ°å¯¹å­—èŠ‚æµä¸­çš„æ¯ä¸ªå­—èŠ‚è¿›è¡Œç¼–å·ï¼Œè€Œ TCP æŠ¥æ–‡æ®µçš„åºå·è¢«è®¾ç½®ä¸ºå…¶æ•°æ®éƒ¨åˆ†çš„ç¬¬ä¸€ä¸ªå­—èŠ‚çš„ç¼–å·ã€‚åºå·æ˜¯ 32 bit çš„æ— ç¬¦å·æ•°ï¼Œå–å€¼èŒƒå›´æ˜¯0åˆ° 232 - 1ã€‚ ç¡®è®¤åºå· (Acknowledgment Number)ï¼šæ¥æ”¶æ–¹åœ¨æ¥å—åˆ°æ•°æ®åï¼Œä¼šå›å¤ç¡®è®¤æŠ¥æ–‡ï¼Œå…¶ä¸­åŒ…å«ç¡®è®¤åºå·ï¼Œä½œç”¨å°±æ˜¯å‘Šè¯‰å‘é€æ–¹è‡ªå·±æ¥æ”¶åˆ°äº†å“ªäº›æ•°æ®ï¼Œä¸‹ä¸€æ¬¡æ•°æ®ä»å“ªé‡Œå¼€å§‹å‘ï¼Œå› æ­¤ï¼Œç¡®è®¤åºå·åº”å½“æ˜¯ä¸Šæ¬¡å·²æˆåŠŸæ”¶åˆ°æ•°æ®å­—èŠ‚åºå·åŠ  1ã€‚åªæœ‰ ACK æ ‡å¿—ä¸º 1 æ—¶ç¡®è®¤åºå·å­—æ®µæ‰æœ‰æ•ˆã€‚ é¦–éƒ¨é•¿åº¦ (Header Length)ï¼šé¦–éƒ¨ä¸­çš„é€‰é¡¹éƒ¨åˆ†çš„é•¿åº¦æ˜¯å¯å˜çš„ï¼Œå› æ­¤é¦–éƒ¨çš„é•¿åº¦ä¹Ÿæ˜¯å¯å˜çš„ï¼Œæ‰€ä»¥éœ€è¦è¿™ä¸ªå­—æ®µæ¥æ˜ç¡®è¡¨ç¤ºé¦–éƒ¨çš„é•¿åº¦ï¼Œè¿™ä¸ªå­—æ®µå  4 bitï¼Œ4 ä½çš„äºŒè¿›åˆ¶æ•°æœ€å¤§å¯ä»¥è¡¨ç¤º 15ï¼Œè€Œé¦–éƒ¨é•¿åº¦æ˜¯ä»¥ 4 ä¸ªå­—èŠ‚ä¸ºä¸€ä¸ªå•ä½çš„ï¼Œå› æ­¤é¦–éƒ¨æœ€å¤§é•¿åº¦æ˜¯ 15 * 4 = 60 å­—èŠ‚ã€‚ ä¿ç•™å­—æ®µ (Reserved)ï¼šå  6 ä½ï¼Œæœªæ¥å¯èƒ½æœ‰å…·ä½“ç”¨é€”ï¼Œç›®å‰é»˜è®¤å€¼ä¸º0. æ§åˆ¶ä½ (Control Bits)ï¼šåœ¨ä¸‰æ¬¡æ¡æ‰‹å’Œå››æ¬¡æŒ¥æ‰‹ä¸­ä¼šç»å¸¸çœ‹åˆ° SYNã€ACK å’Œ FIN çš„èº«å½±ï¼Œä¸€å…±æœ‰ 6 ä¸ªæ ‡å¿—ä½ï¼Œå®ƒä»¬è¡¨ç¤ºçš„æ„ä¹‰å¦‚ä¸‹ï¼š  URG (Urgent Bit)ï¼šå€¼ä¸º 1 æ—¶ï¼Œç´§æ€¥æŒ‡é’ˆç”Ÿæ•ˆ ACK (Acknowledgment Bit)ï¼šå€¼ä¸º 1 æ—¶ï¼Œç¡®è®¤åºå·ç”Ÿæ•ˆ PSH (Push Bit)ï¼šæ¥æ”¶æ–¹åº”å°½å¿«å°†è¿™ä¸ªæŠ¥æ–‡æ®µäº¤ç»™åº”ç”¨å±‚ RST (Reset Bit)ï¼šå‘é€ç«¯é‡åˆ°é—®é¢˜ï¼Œæƒ³è¦é‡å»ºè¿æ¥ SYN (Synchronize Bit)ï¼šåŒæ­¥åºå·ï¼Œç”¨äºå‘èµ·ä¸€ä¸ªè¿æ¥ FIN (Finish Bit)ï¼šå‘é€ç«¯è¦æ±‚å…³é—­è¿æ¥   çª—å£å¤§å° (Window)ï¼š TCPçš„æµé‡æ§åˆ¶ç”±è¿æ¥çš„æ¯ä¸€ç«¯é€šè¿‡å£°æ˜çš„çª—å£å¤§å°æ¥æä¾›ã€‚çª—å£å¤§å°ä¸ºå­—èŠ‚æ•°ï¼Œèµ·å§‹äºç¡®è®¤åºå·å­—æ®µæŒ‡æ˜çš„å€¼ï¼Œè¿™ä¸ªå€¼æ˜¯æ¥æ”¶ç«¯æ­£æœŸæœ›æ¥æ”¶çš„å­—èŠ‚ã€‚çª—å£å¤§å°æ˜¯ä¸€ä¸ª 16 bit å­—æ®µï¼Œå•ä½æ˜¯å­—èŠ‚ï¼Œ å› è€Œçª—å£å¤§å°æœ€å¤§ä¸º 65535 å­—èŠ‚ã€‚ æ£€éªŒå’Œ (Checksum)ï¼šåŠŸèƒ½ç±»ä¼¼äºæ•°å­—ç­¾åï¼Œç”¨äºéªŒè¯æ•°æ®å®Œæ•´æ€§ï¼Œä¹Ÿå°±æ˜¯ç¡®ä¿æ•°æ®æœªè¢«ä¿®æ”¹ã€‚æ£€éªŒå’Œè¦†ç›–äº†æ•´ä¸ª TCP æŠ¥æ–‡æ®µï¼ŒåŒ…æ‹¬ TCP é¦–éƒ¨å’Œ TCP æ•°æ®ï¼Œå‘é€ç«¯æ ¹æ®ç‰¹å®šç®—æ³•å¯¹æ•´ä¸ªæŠ¥æ–‡æ®µè®¡ç®—å‡ºä¸€ä¸ªæ£€éªŒå’Œï¼Œæ¥æ”¶ç«¯ä¼šè¿›è¡Œè®¡ç®—å¹¶éªŒè¯ã€‚ ç´§æ€¥æŒ‡é’ˆ (Urgent Pointer)ï¼šå½“ URG æ§åˆ¶ä½å€¼ä¸º 1 æ—¶ï¼Œæ­¤å­—æ®µç”Ÿæ•ˆï¼Œç´§æ€¥æŒ‡é’ˆæ˜¯ä¸€ä¸ªæ­£çš„åç§»é‡ï¼Œå’Œåºå·å­—æ®µä¸­çš„å€¼ç›¸åŠ è¡¨ç¤ºç´§æ€¥æ•°æ®æœ€åä¸€ä¸ªå­—èŠ‚çš„åºå·ã€‚ TCP çš„ç´§æ€¥æ–¹å¼æ˜¯å‘é€ç«¯å‘å¦ä¸€ç«¯å‘é€ç´§æ€¥æ•°æ®çš„ä¸€ç§æ–¹å¼ã€‚ é€‰é¡¹ (Options)ï¼šè¿™ä¸€éƒ¨åˆ†æ˜¯å¯é€‰å­—æ®µï¼Œä¹Ÿå°±æ˜¯éå¿…é¡»å­—æ®µï¼Œæœ€å¸¸è§çš„å¯é€‰å­—æ®µæ˜¯â€œæœ€é•¿æŠ¥æ–‡å¤§å° (MSSï¼ŒMaximum Segment Size)â€ã€‚ æœ‰æ•ˆæ•°æ®éƒ¨åˆ† (Data)ï¼šè¿™éƒ¨åˆ†ä¹Ÿä¸æ˜¯å¿…é¡»çš„ï¼Œæ¯”å¦‚åœ¨å»ºç«‹å’Œå…³é—­ TCP è¿æ¥çš„é˜¶æ®µï¼ŒåŒæ–¹äº¤æ¢çš„æŠ¥æ–‡æ®µå°±åªåŒ…å« TCP é¦–éƒ¨ã€‚  ","title":"Wireshark"},{"content":"","permalink":"https://sunhao1256.github.io/posts/%E6%97%B6%E9%97%B4%E8%BD%AE/","summary":"","title":"æ—¶é—´è½®"},{"content":"ğŸ’½å®‰è£… Kubernetes é›†ç¾¤ å®‰è£…æ–¹å¼ä»‹ç»  minikube åªæ˜¯ä¸€ä¸ª K8S é›†ç¾¤æ¨¡æ‹Ÿå™¨ï¼Œåªæœ‰ä¸€ä¸ªèŠ‚ç‚¹çš„é›†ç¾¤ï¼Œåªä¸ºæµ‹è¯•ç”¨ï¼Œmaster å’Œ worker éƒ½åœ¨ä¸€èµ· ç›´æ¥ç”¨äº‘å¹³å° Kubernetes å¯è§†åŒ–æ­å»ºï¼Œåªéœ€ç®€å•å‡ æ­¥å°±å¯ä»¥åˆ›å»ºå¥½ä¸€ä¸ªé›†ç¾¤ã€‚ ä¼˜ç‚¹ï¼šå®‰è£…ç®€å•ï¼Œç”Ÿæ€é½å…¨ï¼Œè´Ÿè½½å‡è¡¡å™¨ã€å­˜å‚¨ç­‰éƒ½ç»™ä½ é…å¥—å¥½ï¼Œç®€å•æ“ä½œå°±æå®š è£¸æœºå®‰è£…ï¼ˆBare Metalï¼‰ è‡³å°‘éœ€è¦ä¸¤å°æœºå™¨ï¼ˆä¸»èŠ‚ç‚¹ã€å·¥ä½œèŠ‚ç‚¹ä¸ªä¸€å°ï¼‰ï¼Œéœ€è¦è‡ªå·±å®‰è£… Kubernetes ç»„ä»¶ï¼Œé…ç½®ä¼šç¨å¾®éº»çƒ¦ç‚¹ã€‚ å¯ä»¥åˆ°å„äº‘å‚å•†æŒ‰æ—¶ç§Ÿç”¨æœåŠ¡å™¨ï¼Œè´¹ç”¨ä½ï¼Œç”¨å®Œå°±é”€æ¯ã€‚ ç¼ºç‚¹ï¼šé…ç½®éº»çƒ¦ï¼Œç¼ºå°‘ç”Ÿæ€æ”¯æŒï¼Œä¾‹å¦‚è´Ÿè½½å‡è¡¡å™¨ã€äº‘å­˜å‚¨ã€‚   æœ¬æ–‡æ¡£è¯¾ä»¶éœ€é…å¥— è§†é¢‘ ä¸€èµ·å­¦ä¹ \n minikube å®‰è£…éå¸¸ç®€å•ï¼Œæ”¯æŒå„ç§å¹³å°ï¼Œå®‰è£…æ–¹æ³•\n éœ€è¦æå‰å®‰è£…å¥½ Docker\n # å¯åŠ¨é›†ç¾¤ minikube start # æŸ¥çœ‹èŠ‚ç‚¹ã€‚kubectl æ˜¯ä¸€ä¸ªç”¨æ¥è·Ÿ K8S é›†ç¾¤è¿›è¡Œäº¤äº’çš„å‘½ä»¤è¡Œå·¥å…· kubectl get node # åœæ­¢é›†ç¾¤ minikube stop # æ¸…ç©ºé›†ç¾¤ minikube delete --all # å®‰è£…é›†ç¾¤å¯è§†åŒ– Web UI æ§åˆ¶å° minikube dashboard äº‘å¹³å°æ­å»º  è…¾è®¯äº‘ TKEï¼ˆæ§åˆ¶å°æœç´¢å®¹å™¨ï¼‰ ç™»å½•é˜¿é‡Œäº‘æ§åˆ¶å° - äº§å“æœç´¢ Kubernetes  è£¸æœºæ­å»ºï¼ˆBare Metalï¼‰ ä¸»èŠ‚ç‚¹éœ€è¦ç»„ä»¶  dockerï¼ˆä¹Ÿå¯ä»¥æ˜¯å…¶ä»–å®¹å™¨è¿è¡Œæ—¶ï¼‰ kubectl é›†ç¾¤å‘½ä»¤è¡Œäº¤äº’å·¥å…· kubeadm é›†ç¾¤åˆå§‹åŒ–å·¥å…·  å·¥ä½œèŠ‚ç‚¹éœ€è¦ç»„ä»¶ æ–‡æ¡£  dockerï¼ˆä¹Ÿå¯ä»¥æ˜¯å…¶ä»–å®¹å™¨è¿è¡Œæ—¶ï¼‰ kubelet ç®¡ç† Pod å’Œå®¹å™¨ï¼Œç¡®ä¿ä»–ä»¬å¥åº·ç¨³å®šè¿è¡Œã€‚ kube-proxy ç½‘ç»œä»£ç†ï¼Œè´Ÿè´£ç½‘ç»œç›¸å…³çš„å·¥ä½œ  å¼€å§‹å®‰è£…  ä½ ä¹Ÿå¯ä»¥è¯•ä¸‹ è¿™ä¸ªé¡¹ç›®ï¼Œç”¨è„šæœ¬å¿«é€Ÿæ­å»º K8S è£¸æœºé›†ç¾¤ å½“ç„¶ï¼Œä¸ºäº†æ›´å¥½çš„ç†è§£ï¼Œä½ åº”è¯¥å…ˆæ‰‹åŠ¨æ­å»ºä¸€æ¬¡\n # æ¯ä¸ªèŠ‚ç‚¹åˆ†åˆ«è®¾ç½®å¯¹åº”ä¸»æœºå hostnamectl set-hostname master hostnamectl set-hostname node1 hostnamectl set-hostname node2 # æ‰€æœ‰èŠ‚ç‚¹éƒ½ä¿®æ”¹ hosts vim /etc/hosts 172.16.32.2 node1 172.16.32.6 node2 172.16.0.4 master # æ‰€æœ‰èŠ‚ç‚¹å…³é—­ SELinux setenforce 0 sed -i --follow-symlinks 's/SELINUX=enforcing/SELINUX=disabled/g' /etc/sysconfig/selinux  æ‰€æœ‰èŠ‚ç‚¹ç¡®ä¿é˜²ç«å¢™å…³é—­ systemctl stop firewalld systemctl disable firewalld\n æ·»åŠ å®‰è£…æºï¼ˆæ‰€æœ‰èŠ‚ç‚¹ï¼‰\n# æ·»åŠ  k8s å®‰è£…æº cat \u0026lt;\u0026lt;EOF \u0026gt; kubernetes.repo [kubernetes] name=Kubernetes baseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64 enabled=1 gpgcheck=0 repo_gpgcheck=0 gpgkey=https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg https://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg EOF mv kubernetes.repo /etc/yum.repos.d/ # æ·»åŠ  Docker å®‰è£…æº yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo å®‰è£…æ‰€éœ€ç»„ä»¶ï¼ˆæ‰€æœ‰èŠ‚ç‚¹ï¼‰ yum install -y kubelet-1.22.4 kubectl-1.22.4 kubeadm-1.22.4 docker-ce\n æ³¨æ„ï¼Œæ®å­¦å‘˜åé¦ˆï¼Œ1.24 ä»¥ä¸Šçš„ç‰ˆæœ¬ä¼šæŠ¥é”™ï¼Œè·Ÿæ•™ç¨‹æœ‰å·®å¼‚ï¼Œæ‰€ä»¥å»ºè®®å¤§å®¶æŒ‡å®šç‰ˆæœ¬å·å®‰è£…ï¼Œç‰ˆæœ¬å·ç¡®ä¿è·Ÿè€å¸ˆçš„ä¸€æ ·\n å¯åŠ¨ kubeletã€dockerï¼Œå¹¶è®¾ç½®å¼€æœºå¯åŠ¨ï¼ˆæ‰€æœ‰èŠ‚ç‚¹ï¼‰\nsystemctl enable kubelet systemctl start kubelet systemctl enable docker systemctl start docker ä¿®æ”¹ docker é…ç½®ï¼ˆæ‰€æœ‰èŠ‚ç‚¹ï¼‰\n# kubernetes å®˜æ–¹æ¨è docker ç­‰ä½¿ç”¨ systemd ä½œä¸º cgroupdriverï¼Œå¦åˆ™ kubelet å¯åŠ¨ä¸äº† cat \u0026lt;\u0026lt;EOF \u0026gt; daemon.json { \u0026quot;exec-opts\u0026quot;: [\u0026quot;native.cgroupdriver=systemd\u0026quot;], \u0026quot;registry-mirrors\u0026quot;: [\u0026quot;https://ud6340vz.mirror.aliyuncs.com\u0026quot;] } EOF mv daemon.json /etc/docker/ # é‡å¯ç”Ÿæ•ˆ systemctl daemon-reload systemctl restart docker ç”¨ kubeadm åˆå§‹åŒ–é›†ç¾¤ï¼ˆä»…åœ¨ä¸»èŠ‚ç‚¹è·‘ï¼‰ï¼Œ\n# åˆå§‹åŒ–é›†ç¾¤æ§åˆ¶å° Control plane # å¤±è´¥äº†å¯ä»¥ç”¨ kubeadm reset é‡ç½® kubeadm init --image-repository=registry.aliyuncs.com/google_containers # è®°å¾—æŠŠ kubeadm join xxx ä¿å­˜èµ·æ¥ # å¿˜è®°äº†é‡æ–°è·å–ï¼škubeadm token create --print-join-command # å¤åˆ¶æˆæƒæ–‡ä»¶ï¼Œä»¥ä¾¿ kubectl å¯ä»¥æœ‰æƒé™è®¿é—®é›†ç¾¤ # å¦‚æœä½ å…¶ä»–èŠ‚ç‚¹éœ€è¦è®¿é—®é›†ç¾¤ï¼Œéœ€è¦ä»ä¸»èŠ‚ç‚¹å¤åˆ¶è¿™ä¸ªæ–‡ä»¶è¿‡å»å…¶ä»–èŠ‚ç‚¹ mkdir -p $HOME/.kube cp -i /etc/kubernetes/admin.conf $HOME/.kube/config chown $(id -u):$(id -g) $HOME/.kube/config # åœ¨å…¶ä»–æœºå™¨ä¸Šåˆ›å»º ~/.kube/config æ–‡ä»¶ä¹Ÿèƒ½é€šè¿‡ kubectl è®¿é—®åˆ°é›†ç¾¤  æœ‰å…´è¶£äº†è§£ kubeadm init å…·ä½“åšäº†ä»€ä¹ˆçš„ï¼Œå¯ä»¥ æŸ¥çœ‹æ–‡æ¡£\n æŠŠå·¥ä½œèŠ‚ç‚¹åŠ å…¥é›†ç¾¤ï¼ˆåªåœ¨å·¥ä½œèŠ‚ç‚¹è·‘ï¼‰\nkubeadm join 172.16.32.10:6443 --token xxx --discovery-token-ca-cert-hash xxx å®‰è£…ç½‘ç»œæ’ä»¶ï¼Œå¦åˆ™ node æ˜¯ NotReady çŠ¶æ€ï¼ˆä¸»èŠ‚ç‚¹è·‘ï¼‰\n# å¾ˆæœ‰å¯èƒ½å›½å†…ç½‘ç»œè®¿é—®ä¸åˆ°è¿™ä¸ªèµ„æºï¼Œä½ å¯ä»¥ç½‘ä¸Šæ‰¾æ‰¾å›½å†…çš„æºå®‰è£… flannel kubectl apply -f https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml æŸ¥çœ‹èŠ‚ç‚¹ï¼Œè¦åœ¨ä¸»èŠ‚ç‚¹æŸ¥çœ‹ï¼ˆå…¶ä»–èŠ‚ç‚¹æœ‰å®‰è£… kubectl ä¹Ÿå¯ä»¥æŸ¥çœ‹ï¼‰ æ›´æ–°configmap kubectl create configmap foo --from-file foo.properties -o yaml --dry-run | kubectl apply -f - NodePort ä»masterèŠ‚ç‚¹è®¿é—®ä¼šè¶…æ—¶ ","permalink":"https://sunhao1256.github.io/posts/k8s/","summary":"ğŸ’½å®‰è£… Kubernetes é›†ç¾¤ å®‰è£…æ–¹å¼ä»‹ç»  minikube åªæ˜¯ä¸€ä¸ª K8S é›†ç¾¤æ¨¡æ‹Ÿå™¨ï¼Œåªæœ‰ä¸€ä¸ªèŠ‚ç‚¹çš„é›†ç¾¤ï¼Œåªä¸ºæµ‹è¯•ç”¨ï¼Œmaster å’Œ worker éƒ½åœ¨ä¸€èµ· ç›´æ¥ç”¨äº‘å¹³å° Kubernetes å¯è§†åŒ–æ­å»ºï¼Œåªéœ€ç®€å•å‡ æ­¥å°±å¯ä»¥åˆ›å»ºå¥½ä¸€ä¸ªé›†ç¾¤ã€‚ ä¼˜ç‚¹ï¼šå®‰è£…ç®€å•ï¼Œç”Ÿæ€é½å…¨ï¼Œè´Ÿè½½å‡è¡¡å™¨ã€å­˜å‚¨ç­‰éƒ½ç»™ä½ é…å¥—å¥½ï¼Œç®€å•æ“ä½œå°±æå®š è£¸æœºå®‰è£…ï¼ˆBare Metalï¼‰ è‡³å°‘éœ€è¦ä¸¤å°æœºå™¨ï¼ˆä¸»èŠ‚ç‚¹ã€å·¥ä½œèŠ‚ç‚¹ä¸ªä¸€å°ï¼‰ï¼Œéœ€è¦è‡ªå·±å®‰è£… Kubernetes ç»„ä»¶ï¼Œé…ç½®ä¼šç¨å¾®éº»çƒ¦ç‚¹ã€‚ å¯ä»¥åˆ°å„äº‘å‚å•†æŒ‰æ—¶ç§Ÿç”¨æœåŠ¡å™¨ï¼Œè´¹ç”¨ä½ï¼Œç”¨å®Œå°±é”€æ¯ã€‚ ç¼ºç‚¹ï¼šé…ç½®éº»çƒ¦ï¼Œç¼ºå°‘ç”Ÿæ€æ”¯æŒï¼Œä¾‹å¦‚è´Ÿè½½å‡è¡¡å™¨ã€äº‘å­˜å‚¨ã€‚   æœ¬æ–‡æ¡£è¯¾ä»¶éœ€é…å¥— è§†é¢‘ ä¸€èµ·å­¦ä¹ \n minikube å®‰è£…éå¸¸ç®€å•ï¼Œæ”¯æŒå„ç§å¹³å°ï¼Œå®‰è£…æ–¹æ³•\n éœ€è¦æå‰å®‰è£…å¥½ Docker\n # å¯åŠ¨é›†ç¾¤ minikube start # æŸ¥çœ‹èŠ‚ç‚¹ã€‚kubectl æ˜¯ä¸€ä¸ªç”¨æ¥è·Ÿ K8S é›†ç¾¤è¿›è¡Œäº¤äº’çš„å‘½ä»¤è¡Œå·¥å…· kubectl get node # åœæ­¢é›†ç¾¤ minikube stop # æ¸…ç©ºé›†ç¾¤ minikube delete --all # å®‰è£…é›†ç¾¤å¯è§†åŒ– Web UI æ§åˆ¶å° minikube dashboard äº‘å¹³å°æ­å»º  è…¾è®¯äº‘ TKEï¼ˆæ§åˆ¶å°æœç´¢å®¹å™¨ï¼‰ ç™»å½•é˜¿é‡Œäº‘æ§åˆ¶å° - äº§å“æœç´¢ Kubernetes  è£¸æœºæ­å»ºï¼ˆBare Metalï¼‰ ä¸»èŠ‚ç‚¹éœ€è¦ç»„ä»¶  dockerï¼ˆä¹Ÿå¯ä»¥æ˜¯å…¶ä»–å®¹å™¨è¿è¡Œæ—¶ï¼‰ kubectl é›†ç¾¤å‘½ä»¤è¡Œäº¤äº’å·¥å…· kubeadm é›†ç¾¤åˆå§‹åŒ–å·¥å…·  å·¥ä½œèŠ‚ç‚¹éœ€è¦ç»„ä»¶ æ–‡æ¡£  dockerï¼ˆä¹Ÿå¯ä»¥æ˜¯å…¶ä»–å®¹å™¨è¿è¡Œæ—¶ï¼‰ kubelet ç®¡ç† Pod å’Œå®¹å™¨ï¼Œç¡®ä¿ä»–ä»¬å¥åº·ç¨³å®šè¿è¡Œã€‚ kube-proxy ç½‘ç»œä»£ç†ï¼Œè´Ÿè´£ç½‘ç»œç›¸å…³çš„å·¥ä½œ  å¼€å§‹å®‰è£…  ä½ ä¹Ÿå¯ä»¥è¯•ä¸‹ è¿™ä¸ªé¡¹ç›®ï¼Œç”¨è„šæœ¬å¿«é€Ÿæ­å»º K8S è£¸æœºé›†ç¾¤ å½“ç„¶ï¼Œä¸ºäº†æ›´å¥½çš„ç†è§£ï¼Œä½ åº”è¯¥å…ˆæ‰‹åŠ¨æ­å»ºä¸€æ¬¡","title":"K8s"},{"content":"éœ€æ±‚  è™šæ‹Ÿæœº æˆ‘å’Œå¯¹è±¡éƒ½æ˜¯ç¨‹åºå‘˜ï¼Œå­¦æ–°æŠ€æœ¯çš„æ—¶å€™å¾—æœ‰ç¯å¢ƒ åŒæ—¶ä¸¤å° win ç”¨äºå¨±ä¹ ç›®æ ‡æ˜¯ 2 å° win è¾¾åˆ° 2k ä¸‹ä¸­é…åƒé¸¡æµç•…ï¼Œç‹¬ç«‹é”®é¼ æ˜¾ç¤ºå™¨ å¸¦ nas æœ€å¥½ å¯¹æˆ‘ç”¨å¤„ä¸æ˜¯å¾ˆå¤§ï¼Œæœ‰çš„è¯æ›´å¥½ï¼Œå½“ç½‘ç›˜ç”¨ç”¨ã€‚  é…ç½®å¦‚ä¸‹ å®ç°ç»†èŠ‚  çœ‹ B ç«™å¸æ³¢å›¾çš„æ•™ç¨‹ æ˜¾ç¤ºå™¨å¾—å¸¦éŸ³å“ï¼Œå› ä¸ºåœ¨å®¶ç©ï¼Œä¸å–œæ¬¢å¸¦è€³æœºï¼ŒéŸ³è´¨å¬ä¸ªå“ å¼€æœºéº»çƒ¦ï¼Œå› ä¸ºè¦å…ˆå¼€ unraid ï¼Œç„¶åå†å¼€ vm ï¼Œæœ‰çš„æ—¶å€™åªæ˜¯æƒ³å¼€ä¸ª centos vm ï¼Œè¿›è¡Œå¼€å‘ã€‚æ‡’å¾—å»æˆ¿é—´å¼€ä¸»æœºï¼Œä¹°äº†ä¸ªå°ç±³è“ç‰™å¼€å…³ï¼Œé…åˆä¸»æ¿çš„ ac recovery å¯ä»¥å®ç°è¿œç¨‹å¼€æœºã€‚(å¥½åƒå¯ä»¥ç”¨ä»£ç å®ç°ï¼Œä¸€ç›´æ²¡æ•´å‡ºæ¥) usb è®¾å¤‡ï¼Œå°± unraid å¸¦çš„ hot usb æ’ä»¶å°±å¯ä»¥ ç›´é€šç¡¬ç›˜ï¼Œå¼€å‘ç¯å¢ƒ centos çš„æ— æ‰€è°“ï¼Œä¸¢äº†å°±ç®—ï¼Œæˆ‘æ”¾åœ¨äº† nas çš„ 2t æœºæ¢°ç›˜é‡Œã€‚ä½†æ˜¯æˆ‘çš„ win ï¼Œæœ‰çš„æ—¶å€™è¿˜è¦æ‹¿æ¥å·¥ä½œï¼ŒåŒ…æ‹¬æ¸¸æˆï¼Œä¸¢äº†è¦ä¸‹è€åŠå¤©ã€‚æ‰€ä»¥æˆ‘åŸæœ¬ç¬”è®°æœ¬ä¸Šæœ‰ä¸€å— 500g çš„å›ºæ€ï¼Œåˆä¹°äº†ä¸€å—ä¸‰æ˜Ÿ 980 pro ã€‚ç”¨äº win çš„ç¡¬ç›˜ï¼Œä½¿ç”¨çš„æ˜¯ pcie ç›´é€šã€‚å’Œç‰©ç†æœºä¸€æ ·ï¼Œéƒ½åœ¨ç¡¬ç›˜é‡Œã€‚è™šæ‹Ÿæœºåˆ äº†ï¼Œä¸œè¥¿ä¹Ÿéƒ½åœ¨ç¡¬ç›˜ã€‚æ€§èƒ½è¾¾åˆ°æ»¡ æ˜¾å¡ç›´é€šï¼Œæ‰“æ¸¸æˆè‚¯å®šè¦æ˜¾å¡ç›´é€šçš„ï¼Œæˆ‘ä¹°çš„ä¸¤ä¸ªåŒä»·ä½åŒæ€§èƒ½çš„ n å¡å’Œ a å¡ï¼Œéƒ½èƒ½ç›´é€šï¼Œé™¤äº† a å¡åœ¨ LOL ç¯å¢ƒä¸‹ä¼šè¢«æ£€æµ‹æ˜¯è™šæ‹Ÿæœºç¯å¢ƒï¼Œéœ€è¦æ”¹ä¸€ä¸ªé…ç½®ã€‚ä¸¤ä¸ªå‘æŒ¥çš„æ€§èƒ½æ²¡ä»€ä¹ˆåŒºåˆ«ï¼Œéƒ½è¾¾åˆ°äº†ç‰©ç†æœºçš„ 90%æ€§èƒ½ï¼Œä¸»è¦æ˜¯å› ä¸º CPU çš„å¯¼è‡´æ²¡è·‘æ»¡æ€§èƒ½ ä¸»æ¿å’Œæœºç®±æœ‰å‘ï¼å› ä¸º b660m æ˜¯ matx çš„ï¼Œè™½ç„¶å¯ä»¥æ’ 2 ä¸ªæ˜¾å¡ï¼Œä½†æ˜¯ä½ å¦‚æœé…ç½®çš„æ˜¯ matx çš„æœºç®±ï¼Œç¬¬äºŒå¼ æ˜¾å¡å°±å¡åœ¨äº†ç”µæºé‚£é‡Œï¼Œæ‰€ä»¥æœºç®±ä¸€å®šè¦æ˜¯ atx çš„ã€‚ä¸ç„¶è£…ä¸ä¸‹ï¼Œå®³æˆ‘ç™½èŠ±äº† 170 å¿«ï¼Œé—²é±¼ 89 æŒ‚ç€å‘¢ã€‚å½“ç„¶å¯ä»¥ä¹° atx ä¸»æ¿ï¼Œè´µå•Šï¼ CPU ç›´é€šï¼Œ æ‰“æ¸¸æˆçš„æ—¶å€™ï¼Œæ ¸å¿ƒè¦åˆ†ç¦»å¼€çš„ã€‚ä¸€ç¢—ç²‰çš„é’±æ€»ä¼šæœ‰ç‚¹å½±å“ï¼Œ12600k æ˜¯ 16 çº¿ç¨‹ï¼Œæ‰€ä»¥æˆ‘ç»™ 2 ä¸ª win å„ç”¨äº† 8 çº¿ç¨‹ï¼ŒCPU å¾—ä¹°å¸¦æ ¸æ˜¾çš„ï¼Œå› ä¸º unraid è‡ªå·±è¦å ä¸€ä¸ªè¾“å‡ºï¼Œä¸‡ä¸€ web æŒ‚äº†ï¼Œè¿˜æœ‰åœ°æ–¹å¯ä»¥æŸ¥ã€‚ ç”µæºï¼Œä¸ç”¨æƒ³ä½ éƒ½ä¸€ç¢—ç²‰çš„é’±äº†ï¼Œç”µæºåŠŸç‡æ•´å¤§ç‚¹åˆ«å´©äº†ï¼Œæˆ‘çš„ 750w ï¼Œç”¨èµ·æ¥è¿˜è¡Œã€‚å»ºè®®ä¸Š 1000w unraid ç³»ç»Ÿï¼Œæˆ‘åªæ˜¯ä¸»è¦æ˜¯æƒ³ç”¨è™šæ‹ŸæœºåŠŸèƒ½ï¼Œnas ä¸æ˜¯ä¸»è¦ç›®çš„ï¼Œæ‰€ä»¥å°±ä¹°äº† basic ç‰ˆæœ¬ï¼Œb ç«™ä¹Ÿæœ‰åŠä»·æŠ˜æ‰£æ•™ç¨‹ã€‚ä¸ç”¨ pve ï¼Œå½“ç„¶æ˜¯å› ä¸ºæˆ‘ä»£ç çœ‹ä¸æ‡‚ï¼Œunraid å¯è§†åŒ–åšçš„å¤ªå¥½äº†ã€‚ä¸ç”¨å¼€å¿ƒç‰ˆï¼Œæ˜¯å› ä¸ºæˆ‘è¦åšä¸»åŠ›æœºå™¨çš„ï¼Œæœªæ¥ä¹Ÿæœ‰å¯èƒ½åœ¨ nas ä¸Šåšä¸€äº›äº‹æƒ…ï¼Œæ”¯æŒä¸‹æ­£ç‰ˆï¼ˆç¬¬ä¸€æ¬¡ä¹°æ­£ç‰ˆç³»ç»Ÿï¼‰ ä¸çŸ¥é“ä¸ºä»€ä¹ˆï¼Œæˆ‘ bios é‡Œå·²ç»è°ƒæ•´ä¸ºé¦–é€‰è§†é¢‘è¾“å‡ºæ˜¯æ¿è½½æ˜¾å¡äº†ï¼Œä½†æ˜¯å½“æˆ‘çš„ hdmi æ’åœ¨ç‹¬ç«‹æ˜¾å¡çš„æ—¶å€™ï¼Œunraid å¯åŠ¨çš„æ—¶å€™è¿˜æ˜¯ä¼šå ç”¨ç‹¬ç«‹æ˜¾å¡ï¼Œå¯¼è‡´æ˜¾å¡ç›´é€šçš„æ—¶å€™ä¼šæç¤º busy ã€‚æ‰€ä»¥æˆ‘èŠ±äº†å‡ å—é’±ä¹°äº†ä¸ª hdmi æ¬ºéª—å™¨ï¼Œä¸€ç›´æ’åœ¨æ ¸æ˜¾ä¸Šã€‚ å¾®æ˜Ÿçš„ä¸»æ¿éœ€è¦å…³é—­ fast boot ï¼Œå¾®æ˜Ÿè‡ªå·±æœ‰ä¸€ä¸ªå« msi fast boot ï¼Œä¸¤ä¸ªéƒ½å…³äº†ï¼Œå¦åˆ™ unraid é‡å¯ä¼šé»‘å±  æ•ˆæœ  nas 2t åŒå¼€ win è™šæ‹Ÿæœºï¼Œ2k 100 æ¸²æŸ“ ä¸­é…åƒé¸¡ï¼Œ70fps ï¼ŒLOL å›¢æˆ˜ 150fps ï¼Œèµ°è·¯ 200+ è¿œç¨‹å¼€æœºï¼Œé…åˆ unraid web è¿œç¨‹å¼€è™šæ‹Ÿæœºï¼Œè¿›è¡Œå¼€å‘  æ€»ç»“ æœ€è¿‘çœ‹äº† B ç«™å¸æ³¢å›¾çš„ä¸¤ç”·ä¸€æœºã€‚çªç„¶æƒ³ç”¨ä¸€ç¢—ç²‰çš„é’±åƒä¸¤ç¢—ç²‰ã€‚åŸºäºä¸Šé¢çš„éœ€æ±‚ï¼Œå°±åŠ¨æ‰‹åšäº†ã€‚ä¸»æ¿åº”è¯¥é€‰å¸¦ wifi çš„ï¼Œä¸ç”¨ä¸€ç›´æ‹–ç½‘çº¿ï¼Œæœ‰ç‚¹å¤±è¯¯ã€‚éƒ½æ˜¯ 618 äº¬ä¸œä¹°çš„ï¼Œåé¢ä»·æ ¼é™ä»·äº†ï¼Œå¯æ¶çš„ç‹—ä¸œã€‚ä½†æ˜¯æœ‰å¤§éƒ¨åˆ† 30 å¤©ä¿ä»·ï¼Œåé¢åˆå°‘äº†å‡ ç™¾å—ã€‚é…ç½®å›¾æ˜¯æ²¡ä¿ä»·ä¹‹å‰çš„ä»·æ ¼ã€‚æ€»ä½“è¿˜ç®—æ»¡æ„ã€‚è¾¾åˆ°äº†ä¸€å¼€å§‹çš„éœ€æ±‚ï¼Œå®¶é‡Œæ•´ä¸ªå…¬ç½‘ ip å•¥çš„ï¼Œä¹Ÿèƒ½åœ¨å…¬å¸å°±èƒ½ç”¨å®¶é‡Œçš„è™šæ‹Ÿæœºäº†ã€‚å› ä¸ºè‡ªå·±æ¢äº† M1 pro ï¼Œpd è™šæ‹Ÿæœºæ€»è§‰å¾—ç”¨çš„ä¸èˆ’æœã€‚è¿˜ä¸èƒ½è£… centos7 ã€‚ä¹Ÿæ»¡è¶³äº†è‡ªå·±ç¬¬ä¸€æ¬¡è£…æœºï¼Œçœé’±çš„è¯ï¼Œå°±æ˜¯çœäº†ä¸€ä»½ cpu ï¼Œä¸»æ¿ï¼Œç”µæºï¼Œæœºç®±ã€‚2000+ã€‚è£…æœºå¤§ä½¬ä»¬å¯ä»¥å¤šå¤šè¯„ä»·ã€‚æ€»è§‰å¾—ç¡¬ä»¶ä¹°è´µäº†ï¼Œåˆä¸æ•¢å»å’¸é±¼ï½ï½ğŸ™„\n","permalink":"https://sunhao1256.github.io/posts/all-in-one/","summary":"éœ€æ±‚  è™šæ‹Ÿæœº æˆ‘å’Œå¯¹è±¡éƒ½æ˜¯ç¨‹åºå‘˜ï¼Œå­¦æ–°æŠ€æœ¯çš„æ—¶å€™å¾—æœ‰ç¯å¢ƒ åŒæ—¶ä¸¤å° win ç”¨äºå¨±ä¹ ç›®æ ‡æ˜¯ 2 å° win è¾¾åˆ° 2k ä¸‹ä¸­é…åƒé¸¡æµç•…ï¼Œç‹¬ç«‹é”®é¼ æ˜¾ç¤ºå™¨ å¸¦ nas æœ€å¥½ å¯¹æˆ‘ç”¨å¤„ä¸æ˜¯å¾ˆå¤§ï¼Œæœ‰çš„è¯æ›´å¥½ï¼Œå½“ç½‘ç›˜ç”¨ç”¨ã€‚  é…ç½®å¦‚ä¸‹ å®ç°ç»†èŠ‚  çœ‹ B ç«™å¸æ³¢å›¾çš„æ•™ç¨‹ æ˜¾ç¤ºå™¨å¾—å¸¦éŸ³å“ï¼Œå› ä¸ºåœ¨å®¶ç©ï¼Œä¸å–œæ¬¢å¸¦è€³æœºï¼ŒéŸ³è´¨å¬ä¸ªå“ å¼€æœºéº»çƒ¦ï¼Œå› ä¸ºè¦å…ˆå¼€ unraid ï¼Œç„¶åå†å¼€ vm ï¼Œæœ‰çš„æ—¶å€™åªæ˜¯æƒ³å¼€ä¸ª centos vm ï¼Œè¿›è¡Œå¼€å‘ã€‚æ‡’å¾—å»æˆ¿é—´å¼€ä¸»æœºï¼Œä¹°äº†ä¸ªå°ç±³è“ç‰™å¼€å…³ï¼Œé…åˆä¸»æ¿çš„ ac recovery å¯ä»¥å®ç°è¿œç¨‹å¼€æœºã€‚(å¥½åƒå¯ä»¥ç”¨ä»£ç å®ç°ï¼Œä¸€ç›´æ²¡æ•´å‡ºæ¥) usb è®¾å¤‡ï¼Œå°± unraid å¸¦çš„ hot usb æ’ä»¶å°±å¯ä»¥ ç›´é€šç¡¬ç›˜ï¼Œå¼€å‘ç¯å¢ƒ centos çš„æ— æ‰€è°“ï¼Œä¸¢äº†å°±ç®—ï¼Œæˆ‘æ”¾åœ¨äº† nas çš„ 2t æœºæ¢°ç›˜é‡Œã€‚ä½†æ˜¯æˆ‘çš„ win ï¼Œæœ‰çš„æ—¶å€™è¿˜è¦æ‹¿æ¥å·¥ä½œï¼ŒåŒ…æ‹¬æ¸¸æˆï¼Œä¸¢äº†è¦ä¸‹è€åŠå¤©ã€‚æ‰€ä»¥æˆ‘åŸæœ¬ç¬”è®°æœ¬ä¸Šæœ‰ä¸€å— 500g çš„å›ºæ€ï¼Œåˆä¹°äº†ä¸€å—ä¸‰æ˜Ÿ 980 pro ã€‚ç”¨äº win çš„ç¡¬ç›˜ï¼Œä½¿ç”¨çš„æ˜¯ pcie ç›´é€šã€‚å’Œç‰©ç†æœºä¸€æ ·ï¼Œéƒ½åœ¨ç¡¬ç›˜é‡Œã€‚è™šæ‹Ÿæœºåˆ äº†ï¼Œä¸œè¥¿ä¹Ÿéƒ½åœ¨ç¡¬ç›˜ã€‚æ€§èƒ½è¾¾åˆ°æ»¡ æ˜¾å¡ç›´é€šï¼Œæ‰“æ¸¸æˆè‚¯å®šè¦æ˜¾å¡ç›´é€šçš„ï¼Œæˆ‘ä¹°çš„ä¸¤ä¸ªåŒä»·ä½åŒæ€§èƒ½çš„ n å¡å’Œ a å¡ï¼Œéƒ½èƒ½ç›´é€šï¼Œé™¤äº† a å¡åœ¨ LOL ç¯å¢ƒä¸‹ä¼šè¢«æ£€æµ‹æ˜¯è™šæ‹Ÿæœºç¯å¢ƒï¼Œéœ€è¦æ”¹ä¸€ä¸ªé…ç½®ã€‚ä¸¤ä¸ªå‘æŒ¥çš„æ€§èƒ½æ²¡ä»€ä¹ˆåŒºåˆ«ï¼Œéƒ½è¾¾åˆ°äº†ç‰©ç†æœºçš„ 90%æ€§èƒ½ï¼Œä¸»è¦æ˜¯å› ä¸º CPU çš„å¯¼è‡´æ²¡è·‘æ»¡æ€§èƒ½ ä¸»æ¿å’Œæœºç®±æœ‰å‘ï¼å› ä¸º b660m æ˜¯ matx çš„ï¼Œè™½ç„¶å¯ä»¥æ’ 2 ä¸ªæ˜¾å¡ï¼Œä½†æ˜¯ä½ å¦‚æœé…ç½®çš„æ˜¯ matx çš„æœºç®±ï¼Œç¬¬äºŒå¼ æ˜¾å¡å°±å¡åœ¨äº†ç”µæºé‚£é‡Œï¼Œæ‰€ä»¥æœºç®±ä¸€å®šè¦æ˜¯ atx çš„ã€‚ä¸ç„¶è£…ä¸ä¸‹ï¼Œå®³æˆ‘ç™½èŠ±äº† 170 å¿«ï¼Œé—²é±¼ 89 æŒ‚ç€å‘¢ã€‚å½“ç„¶å¯ä»¥ä¹° atx ä¸»æ¿ï¼Œè´µå•Šï¼ CPU ç›´é€šï¼Œ æ‰“æ¸¸æˆçš„æ—¶å€™ï¼Œæ ¸å¿ƒè¦åˆ†ç¦»å¼€çš„ã€‚ä¸€ç¢—ç²‰çš„é’±æ€»ä¼šæœ‰ç‚¹å½±å“ï¼Œ12600k æ˜¯ 16 çº¿ç¨‹ï¼Œæ‰€ä»¥æˆ‘ç»™ 2 ä¸ª win å„ç”¨äº† 8 çº¿ç¨‹ï¼ŒCPU å¾—ä¹°å¸¦æ ¸æ˜¾çš„ï¼Œå› ä¸º unraid è‡ªå·±è¦å ä¸€ä¸ªè¾“å‡ºï¼Œä¸‡ä¸€ web æŒ‚äº†ï¼Œè¿˜æœ‰åœ°æ–¹å¯ä»¥æŸ¥ã€‚ ç”µæºï¼Œä¸ç”¨æƒ³ä½ éƒ½ä¸€ç¢—ç²‰çš„é’±äº†ï¼Œç”µæºåŠŸç‡æ•´å¤§ç‚¹åˆ«å´©äº†ï¼Œæˆ‘çš„ 750w ï¼Œç”¨èµ·æ¥è¿˜è¡Œã€‚å»ºè®®ä¸Š 1000w unraid ç³»ç»Ÿï¼Œæˆ‘åªæ˜¯ä¸»è¦æ˜¯æƒ³ç”¨è™šæ‹ŸæœºåŠŸèƒ½ï¼Œnas ä¸æ˜¯ä¸»è¦ç›®çš„ï¼Œæ‰€ä»¥å°±ä¹°äº† basic ç‰ˆæœ¬ï¼Œb ç«™ä¹Ÿæœ‰åŠä»·æŠ˜æ‰£æ•™ç¨‹ã€‚ä¸ç”¨ pve ï¼Œå½“ç„¶æ˜¯å› ä¸ºæˆ‘ä»£ç çœ‹ä¸æ‡‚ï¼Œunraid å¯è§†åŒ–åšçš„å¤ªå¥½äº†ã€‚ä¸ç”¨å¼€å¿ƒç‰ˆï¼Œæ˜¯å› ä¸ºæˆ‘è¦åšä¸»åŠ›æœºå™¨çš„ï¼Œæœªæ¥ä¹Ÿæœ‰å¯èƒ½åœ¨ nas ä¸Šåšä¸€äº›äº‹æƒ…ï¼Œæ”¯æŒä¸‹æ­£ç‰ˆï¼ˆç¬¬ä¸€æ¬¡ä¹°æ­£ç‰ˆç³»ç»Ÿï¼‰ ä¸çŸ¥é“ä¸ºä»€ä¹ˆï¼Œæˆ‘ bios é‡Œå·²ç»è°ƒæ•´ä¸ºé¦–é€‰è§†é¢‘è¾“å‡ºæ˜¯æ¿è½½æ˜¾å¡äº†ï¼Œä½†æ˜¯å½“æˆ‘çš„ hdmi æ’åœ¨ç‹¬ç«‹æ˜¾å¡çš„æ—¶å€™ï¼Œunraid å¯åŠ¨çš„æ—¶å€™è¿˜æ˜¯ä¼šå ç”¨ç‹¬ç«‹æ˜¾å¡ï¼Œå¯¼è‡´æ˜¾å¡ç›´é€šçš„æ—¶å€™ä¼šæç¤º busy ã€‚æ‰€ä»¥æˆ‘èŠ±äº†å‡ å—é’±ä¹°äº†ä¸ª hdmi æ¬ºéª—å™¨ï¼Œä¸€ç›´æ’åœ¨æ ¸æ˜¾ä¸Šã€‚ å¾®æ˜Ÿçš„ä¸»æ¿éœ€è¦å…³é—­ fast boot ï¼Œå¾®æ˜Ÿè‡ªå·±æœ‰ä¸€ä¸ªå« msi fast boot ï¼Œä¸¤ä¸ªéƒ½å…³äº†ï¼Œå¦åˆ™ unraid é‡å¯ä¼šé»‘å±  æ•ˆæœ  nas 2t åŒå¼€ win è™šæ‹Ÿæœºï¼Œ2k 100 æ¸²æŸ“ ä¸­é…åƒé¸¡ï¼Œ70fps ï¼ŒLOL å›¢æˆ˜ 150fps ï¼Œèµ°è·¯ 200+ è¿œç¨‹å¼€æœºï¼Œé…åˆ unraid web è¿œç¨‹å¼€è™šæ‹Ÿæœºï¼Œè¿›è¡Œå¼€å‘  æ€»ç»“ æœ€è¿‘çœ‹äº† B ç«™å¸æ³¢å›¾çš„ä¸¤ç”·ä¸€æœºã€‚çªç„¶æƒ³ç”¨ä¸€ç¢—ç²‰çš„é’±åƒä¸¤ç¢—ç²‰ã€‚åŸºäºä¸Šé¢çš„éœ€æ±‚ï¼Œå°±åŠ¨æ‰‹åšäº†ã€‚ä¸»æ¿åº”è¯¥é€‰å¸¦ wifi çš„ï¼Œä¸ç”¨ä¸€ç›´æ‹–ç½‘çº¿ï¼Œæœ‰ç‚¹å¤±è¯¯ã€‚éƒ½æ˜¯ 618 äº¬ä¸œä¹°çš„ï¼Œåé¢ä»·æ ¼é™ä»·äº†ï¼Œå¯æ¶çš„ç‹—ä¸œã€‚ä½†æ˜¯æœ‰å¤§éƒ¨åˆ† 30 å¤©ä¿ä»·ï¼Œåé¢åˆå°‘äº†å‡ ç™¾å—ã€‚é…ç½®å›¾æ˜¯æ²¡ä¿ä»·ä¹‹å‰çš„ä»·æ ¼ã€‚æ€»ä½“è¿˜ç®—æ»¡æ„ã€‚è¾¾åˆ°äº†ä¸€å¼€å§‹çš„éœ€æ±‚ï¼Œå®¶é‡Œæ•´ä¸ªå…¬ç½‘ ip å•¥çš„ï¼Œä¹Ÿèƒ½åœ¨å…¬å¸å°±èƒ½ç”¨å®¶é‡Œçš„è™šæ‹Ÿæœºäº†ã€‚å› ä¸ºè‡ªå·±æ¢äº† M1 pro ï¼Œpd è™šæ‹Ÿæœºæ€»è§‰å¾—ç”¨çš„ä¸èˆ’æœã€‚è¿˜ä¸èƒ½è£… centos7 ã€‚ä¹Ÿæ»¡è¶³äº†è‡ªå·±ç¬¬ä¸€æ¬¡è£…æœºï¼Œçœé’±çš„è¯ï¼Œå°±æ˜¯çœäº†ä¸€ä»½ cpu ï¼Œä¸»æ¿ï¼Œç”µæºï¼Œæœºç®±ã€‚2000+ã€‚è£…æœºå¤§ä½¬ä»¬å¯ä»¥å¤šå¤šè¯„ä»·ã€‚æ€»è§‰å¾—ç¡¬ä»¶ä¹°è´µäº†ï¼Œåˆä¸æ•¢å»å’¸é±¼ï½ï½ğŸ™„","title":"all in oneé…ç½®"},{"content":"å¿«æ·é”®   Finderç»å¯¹è·¯å¾„è·³è½¬\ncommand+shift+G\n  Finderç»å¯¹è·¯å¾„å¤åˆ¶\ncommand+option+C\n  è¡¨æƒ…\ncontrol+cmmand+space\n  å½•å±\nShift-Command-5\n  æˆªå›¾\ncommand shift 4å±€éƒ¨ï¼Œ3å…¨å±\n  åªæ˜¾ç¤ºæ¡Œé¢\ncommand f3\n  finder\noption+command+ç©ºæ ¼\n  space+command\næ‰“å¼€èšç„¦æœç´¢ï¼ŒæŒ‰ä½commandå†ç‚¹å‡»ç»“æœï¼Œæ˜¯è¿›å…¥æ–‡ä»¶å¤¹\n   ç¯å¢ƒå˜é‡ åŠ è½½é¡ºåº\n/etc/profile /etc/paths ~/.zprofile ~/.zshrc /etc/profileå’Œ/etc/pathsæ˜¯ç³»ç»Ÿçº§åˆ«çš„ï¼Œç³»ç»Ÿå¯åŠ¨å°±ä¼šåŠ è½½ï¼Œzprofileæ˜¯ç”¨æˆ·çº§åˆ«çš„ ~/.zshrcæ²¡æœ‰ä¸Šè¿°è§„åˆ™ï¼Œå®ƒæ˜¯zsh shellæ‰“å¼€çš„æ—¶å€™è½½å…¥çš„ã€‚\n# System-wide .profile for sh(1) if [ -x /usr/libexec/path_helper ]; then eval `/usr/libexec/path_helper -s` fi if [ \u0026#34;${BASH-no}\u0026#34; != \u0026#34;no\u0026#34; ]; then [ -r /etc/bashrc ] \u0026amp;\u0026amp; . /etc/bashrc fi path_helperæ˜¯å°†/etc/pathså’Œ/etc/paths.dä¸­å®šä¹‰çš„è·¯å¾„,åŠ å…¥ç¯å¢ƒå˜é‡. è‹¹æœæ¨èä½¿ç”¨è¿™ä¸ª\nMacä¸‹çš„Java,é»˜è®¤ä¼šç›´æ¥è£…å¥½Javaå‘½ä»¤.æ˜¯é€šè¿‡**/usr/libexec/java_home**å‘½ä»¤æ‰¾ç¯å¢ƒå˜é‡ä¸­çš„JAVA_HOMEå˜é‡,ç”¨äºè¾“å‡ºJava\nIterm2 commandå¿«æ·é”®\n  ctrl+a\nè¡Œé¦–\n  ctrl+e\nè¡Œå°¾\n  option+b\nå‰ä¸€ä¸ªå•è¯\n  option+f\nåä¸€ä¸ªå•è¯\n  Chrome ctrl+shift+næ‰“å¼€ä¸€ä¸ªæ— ç—•\nKarabiner æ”¹é”®ç¥å™¨\n","permalink":"https://sunhao1256.github.io/posts/mac%E4%BD%BF%E7%94%A8/","summary":"å¿«æ·é”®   Finderç»å¯¹è·¯å¾„è·³è½¬\ncommand+shift+G\n  Finderç»å¯¹è·¯å¾„å¤åˆ¶\ncommand+option+C\n  è¡¨æƒ…\ncontrol+cmmand+space\n  å½•å±\nShift-Command-5\n  æˆªå›¾\ncommand shift 4å±€éƒ¨ï¼Œ3å…¨å±\n  åªæ˜¾ç¤ºæ¡Œé¢\ncommand f3\n  finder\noption+command+ç©ºæ ¼\n  space+command\næ‰“å¼€èšç„¦æœç´¢ï¼ŒæŒ‰ä½commandå†ç‚¹å‡»ç»“æœï¼Œæ˜¯è¿›å…¥æ–‡ä»¶å¤¹\n   ç¯å¢ƒå˜é‡ åŠ è½½é¡ºåº\n/etc/profile /etc/paths ~/.zprofile ~/.zshrc /etc/profileå’Œ/etc/pathsæ˜¯ç³»ç»Ÿçº§åˆ«çš„ï¼Œç³»ç»Ÿå¯åŠ¨å°±ä¼šåŠ è½½ï¼Œzprofileæ˜¯ç”¨æˆ·çº§åˆ«çš„ ~/.zshrcæ²¡æœ‰ä¸Šè¿°è§„åˆ™ï¼Œå®ƒæ˜¯zsh shellæ‰“å¼€çš„æ—¶å€™è½½å…¥çš„ã€‚\n# System-wide .profile for sh(1) if [ -x /usr/libexec/path_helper ]; then eval `/usr/libexec/path_helper -s` fi if [ \u0026#34;${BASH-no}\u0026#34; != \u0026#34;no\u0026#34; ]; then [ -r /etc/bashrc ] \u0026amp;\u0026amp; .","title":"macä½¿ç”¨"},{"content":"Gitå¸¸ç”¨å‘½ä»¤ git init # åˆå§‹åŒ–æœ¬åœ°gitä»“åº“ï¼ˆåˆ›å»ºæ–°ä»“åº“ï¼‰ git config --global user.name \u0026quot;xxx\u0026quot; # é…ç½®ç”¨æˆ·å git config --global user.email \u0026quot;xxx@xxx.com\u0026quot; # é…ç½®é‚®ä»¶ git config --global color.ui true # git statusç­‰å‘½ä»¤è‡ªåŠ¨ç€è‰² git config --global color.status auto git config --global color.diff auto git config --global color.branch auto git config --global color.interactive auto git config --global --unset http.proxy # remove proxy configuration on git git clone git+ssh://git@192.168.53.168/VT.git # cloneè¿œç¨‹ä»“åº“ git status # æŸ¥çœ‹å½“å‰ç‰ˆæœ¬çŠ¶æ€ï¼ˆæ˜¯å¦ä¿®æ”¹ï¼‰ git add xyz # æ·»åŠ xyzæ–‡ä»¶è‡³index git add . # å¢åŠ å½“å‰å­ç›®å½•ä¸‹æ‰€æœ‰æ›´æ”¹è¿‡çš„æ–‡ä»¶è‡³index git commit -m 'xxx' # æäº¤ git commit --amend -m 'xxx' # åˆå¹¶ä¸Šä¸€æ¬¡æäº¤ï¼ˆç”¨äºåå¤ä¿®æ”¹ï¼‰ git commit -am 'xxx' # å°†addå’Œcommitåˆä¸ºä¸€æ­¥ git rm xxx # åˆ é™¤indexä¸­çš„æ–‡ä»¶ git rm -r * # é€’å½’åˆ é™¤ git log # æ˜¾ç¤ºæäº¤æ—¥å¿— git log -1 # æ˜¾ç¤º1è¡Œæ—¥å¿— -nä¸ºnè¡Œ git log -5 git log --stat # æ˜¾ç¤ºæäº¤æ—¥å¿—åŠç›¸å…³å˜åŠ¨æ–‡ä»¶ git log -p -m git show dfb02e6e4f2f7b573337763e5c0013802e392818 # æ˜¾ç¤ºæŸä¸ªæäº¤çš„è¯¦ç»†å†…å®¹ git show dfb02 # å¯åªç”¨commitidçš„å‰å‡ ä½ git show HEAD # æ˜¾ç¤ºHEADæäº¤æ—¥å¿— git show HEAD^ # æ˜¾ç¤ºHEADçš„çˆ¶ï¼ˆä¸Šä¸€ä¸ªç‰ˆæœ¬ï¼‰çš„æäº¤æ—¥å¿— ^^ä¸ºä¸Šä¸¤ä¸ªç‰ˆæœ¬ ^5ä¸ºä¸Š5ä¸ªç‰ˆæœ¬ git tag # æ˜¾ç¤ºå·²å­˜åœ¨çš„tag git tag -a v2.0 -m 'xxx' # å¢åŠ v2.0çš„tag git show v2.0 # æ˜¾ç¤ºv2.0çš„æ—¥å¿—åŠè¯¦ç»†å†…å®¹ git log v2.0 # æ˜¾ç¤ºv2.0çš„æ—¥å¿— git diff # æ˜¾ç¤ºæ‰€æœ‰æœªæ·»åŠ è‡³indexçš„å˜æ›´ git diff --cached # æ˜¾ç¤ºæ‰€æœ‰å·²æ·»åŠ indexä½†è¿˜æœªcommitçš„å˜æ›´ git diff HEAD^ # æ¯”è¾ƒä¸ä¸Šä¸€ä¸ªç‰ˆæœ¬çš„å·®å¼‚ git diff HEAD -- ./lib # æ¯”è¾ƒä¸HEADç‰ˆæœ¬libç›®å½•çš„å·®å¼‚ git diff origin/master..master # æ¯”è¾ƒè¿œç¨‹åˆ†æ”¯masterä¸Šæœ‰æœ¬åœ°åˆ†æ”¯masterä¸Šæ²¡æœ‰çš„ git diff origin/master..master --stat # åªæ˜¾ç¤ºå·®å¼‚çš„æ–‡ä»¶ï¼Œä¸æ˜¾ç¤ºå…·ä½“å†…å®¹ git remote add origin git+ssh://git@192.168.53.168/VT.git # å¢åŠ è¿œç¨‹å®šä¹‰ï¼ˆç”¨äºpush/pull/fetchï¼‰ git branch # æ˜¾ç¤ºæœ¬åœ°åˆ†æ”¯ git branch --contains 50089 # æ˜¾ç¤ºåŒ…å«æäº¤50089çš„åˆ†æ”¯ git branch -a # æ˜¾ç¤ºæ‰€æœ‰åˆ†æ”¯ git branch -r # æ˜¾ç¤ºæ‰€æœ‰åŸåˆ›åˆ†æ”¯ git branch --merged # æ˜¾ç¤ºæ‰€æœ‰å·²åˆå¹¶åˆ°å½“å‰åˆ†æ”¯çš„åˆ†æ”¯ git branch --no-merged # æ˜¾ç¤ºæ‰€æœ‰æœªåˆå¹¶åˆ°å½“å‰åˆ†æ”¯çš„åˆ†æ”¯ git branch -m master master_copy # æœ¬åœ°åˆ†æ”¯æ”¹å git checkout -b master_copy # ä»å½“å‰åˆ†æ”¯åˆ›å»ºæ–°åˆ†æ”¯master_copyå¹¶æ£€å‡º git checkout -b master master_copy # ä¸Šé¢çš„å®Œæ•´ç‰ˆ git checkout features/performance # æ£€å‡ºå·²å­˜åœ¨çš„features/performanceåˆ†æ”¯ git checkout --track hotfixes/BJVEP933 # æ£€å‡ºè¿œç¨‹åˆ†æ”¯hotfixes/BJVEP933å¹¶åˆ›å»ºæœ¬åœ°è·Ÿè¸ªåˆ†æ”¯ git checkout v2.0 # æ£€å‡ºç‰ˆæœ¬v2.0 git checkout -b devel origin/develop # ä»è¿œç¨‹åˆ†æ”¯developåˆ›å»ºæ–°æœ¬åœ°åˆ†æ”¯develå¹¶æ£€å‡º git checkout -- README # æ£€å‡ºheadç‰ˆæœ¬çš„READMEæ–‡ä»¶ï¼ˆå¯ç”¨äºä¿®æ”¹é”™è¯¯å›é€€ï¼‰ git merge origin/master # åˆå¹¶è¿œç¨‹masteråˆ†æ”¯è‡³å½“å‰åˆ†æ”¯ git cherry-pick ff44785404a8e # åˆå¹¶æäº¤ff44785404a8eçš„ä¿®æ”¹ git push origin master # å°†å½“å‰åˆ†æ”¯pushåˆ°è¿œç¨‹masteråˆ†æ”¯ git push origin :hotfixes/BJVEP933 # åˆ é™¤è¿œç¨‹ä»“åº“çš„hotfixes/BJVEP933åˆ†æ”¯ git push --tags # æŠŠæ‰€æœ‰tagæ¨é€åˆ°è¿œç¨‹ä»“åº“ git fetch # è·å–æ‰€æœ‰è¿œç¨‹åˆ†æ”¯ï¼ˆä¸æ›´æ–°æœ¬åœ°åˆ†æ”¯ï¼Œå¦éœ€mergeï¼‰ git fetch --prune # è·å–æ‰€æœ‰åŸåˆ›åˆ†æ”¯å¹¶æ¸…é™¤æœåŠ¡å™¨ä¸Šå·²åˆ æ‰çš„åˆ†æ”¯ git pull origin master # è·å–è¿œç¨‹åˆ†æ”¯masterå¹¶mergeåˆ°å½“å‰åˆ†æ”¯ git mv README README2 # é‡å‘½åæ–‡ä»¶READMEä¸ºREADME2 git reset --hard HEAD # å°†å½“å‰ç‰ˆæœ¬é‡ç½®ä¸ºHEADï¼ˆé€šå¸¸ç”¨äºmergeå¤±è´¥å›é€€ï¼‰ git rebase git branch -d hotfixes/BJVEP933 # åˆ é™¤åˆ†æ”¯hotfixes/BJVEP933ï¼ˆæœ¬åˆ†æ”¯ä¿®æ”¹å·²åˆå¹¶åˆ°å…¶ä»–åˆ†æ”¯ï¼‰ git branch -D hotfixes/BJVEP933 # å¼ºåˆ¶åˆ é™¤åˆ†æ”¯hotfixes/BJVEP933 git ls-files # åˆ—å‡ºgit indexåŒ…å«çš„æ–‡ä»¶ git show-branch # å›¾ç¤ºå½“å‰åˆ†æ”¯å†å² git show-branch --all # å›¾ç¤ºæ‰€æœ‰åˆ†æ”¯å†å² git whatchanged # æ˜¾ç¤ºæäº¤å†å²å¯¹åº”çš„æ–‡ä»¶ä¿®æ”¹ git revert dfb02e6e4f2f7b573337763e5c0013802e392818 # æ’¤é”€æäº¤dfb02e6e4f2f7b573337763e5c0013802e392818 git ls-tree HEAD # å†…éƒ¨å‘½ä»¤ï¼šæ˜¾ç¤ºæŸä¸ªgitå¯¹è±¡ git rev-parse v2.0 # å†…éƒ¨å‘½ä»¤ï¼šæ˜¾ç¤ºæŸä¸ªrefå¯¹äºçš„SHA1 HASH git reflog # æ˜¾ç¤ºæ‰€æœ‰æäº¤ï¼ŒåŒ…æ‹¬å­¤ç«‹èŠ‚ç‚¹ git show HEAD@{5} git show master@{yesterday} # æ˜¾ç¤ºmasteråˆ†æ”¯æ˜¨å¤©çš„çŠ¶æ€ git log --pretty=format:'%h %s' --graph # å›¾ç¤ºæäº¤æ—¥å¿— git show HEAD~3 git show -s --pretty=raw 2be7fcb476 git stash # æš‚å­˜å½“å‰ä¿®æ”¹ï¼Œå°†æ‰€æœ‰è‡³ä¸ºHEADçŠ¶æ€ git stash list # æŸ¥çœ‹æ‰€æœ‰æš‚å­˜ git stash show -p stash@{0} # å‚è€ƒç¬¬ä¸€æ¬¡æš‚å­˜ git stash apply stash@{0} # åº”ç”¨ç¬¬ä¸€æ¬¡æš‚å­˜ git grep \u0026quot;delete from\u0026quot; # æ–‡ä»¶ä¸­æœç´¢æ–‡æœ¬â€œdelete fromâ€ git grep -e '#define' --and -e SORT_DIRENT git gc git fsck Gitå¤šä¸ªè´¦æˆ·   é€šè¿‡sshå‘½ä»¤ç”Ÿæˆå¤šä¸ªå…¬ç§é’¥\nssh-keygen -t rsa -f ~/.ssh/demo.pub   åœ¨.sshä¸‹åˆ›å»ºconfigé…ç½®\n# githubä¸»è´¦å· Host sunhao1256 HostName github.com User git IdentityFile ~/.ssh/sunhao1256_github_rsa # github frank1256è´¦å· Host frank1256 HostName github.com User git IdentityFile ~/.ssh/frank1256_github_rsa # giteeä¸»è´¦å· Host sunhao1256 HostName gitee.com User git IdentityFile ~/.ssh/sunhao1256_gitee_rsa   æ·»åŠ keyåˆ°sshä¸­\nssh-add huayun_rsa   å‘½ä»¤æµ‹è¯•\nssh -T user@host ssh -T git@frank1256 Hi frank1256! You've successfully authenticated, but GitHub does not provide shell access.   é”™è¯¯\nå¦‚æœå‡ºç°too many failure timesï¼Œå¯èƒ½æ˜¯ä½ é…ç½®çš„ssh å¤ªå¤šäº†ã€‚\néœ€è¦æ·»åŠ IdentityFileOnly yes\nIdentitiesOnly yes   æ³¨æ„ï¼ï¼ä½¿ç”¨ä»“åº“çš„æ—¶å€™ï¼Œéœ€è¦æ›´æ¢HostNameä¸ºHostï¼Œä¾‹å¦‚\ngit@github.com:sunhao1256/test-git-pr.git æ›´æ¢ä¸º git@sunhao1256:sunhao1256/test-git-pr.git å¦‚æœä¸è¿›è¡Œæ›´æ¢ï¼Œé»˜è®¤ä½¿ç”¨å½“å‰ç¼“å­˜ä¸­çš„è´¦å·ï¼Œé»˜è®¤ç¬¬ä¸€ä¸ª\n  ","permalink":"https://sunhao1256.github.io/posts/git%E5%91%BD%E4%BB%A4/","summary":"Gitå¸¸ç”¨å‘½ä»¤ git init # åˆå§‹åŒ–æœ¬åœ°gitä»“åº“ï¼ˆåˆ›å»ºæ–°ä»“åº“ï¼‰ git config --global user.name \u0026quot;xxx\u0026quot; # é…ç½®ç”¨æˆ·å git config --global user.email \u0026quot;xxx@xxx.com\u0026quot; # é…ç½®é‚®ä»¶ git config --global color.ui true # git statusç­‰å‘½ä»¤è‡ªåŠ¨ç€è‰² git config --global color.status auto git config --global color.diff auto git config --global color.branch auto git config --global color.interactive auto git config --global --unset http.proxy # remove proxy configuration on git git clone git+ssh://git@192.168.53.168/VT.git # cloneè¿œç¨‹ä»“åº“ git status # æŸ¥çœ‹å½“å‰ç‰ˆæœ¬çŠ¶æ€ï¼ˆæ˜¯å¦ä¿®æ”¹ï¼‰ git add xyz # æ·»åŠ xyzæ–‡ä»¶è‡³index git add .","title":"Gitå‘½ä»¤"},{"content":"Go åŒ…ç®¡ç† go mod init:åˆå§‹åŒ–modules go mod download:ä¸‹è½½modulesåˆ°æœ¬åœ°cache go mod edit:ç¼–è¾‘go.modæ–‡ä»¶ï¼Œé€‰é¡¹æœ‰-jsonã€-requireå’Œ-excludeï¼Œå¯ä»¥ä½¿ç”¨å¸®åŠ©go help mod edit go mod graph:ä»¥æ–‡æœ¬æ¨¡å¼æ‰“å°æ¨¡å—éœ€æ±‚å›¾ go mod tidy:æ£€æŸ¥ï¼Œåˆ é™¤é”™è¯¯æˆ–è€…ä¸ä½¿ç”¨çš„modulesï¼Œä¸‹è½½æ²¡downloadçš„package go mod vendor:ç”Ÿæˆvendorç›®å½• go mod verify:éªŒè¯ä¾èµ–æ˜¯å¦æ­£ç¡® go mod whyï¼šæŸ¥æ‰¾ä¾èµ– â€‹ go test æ‰§è¡Œä¸€ä¸‹ï¼Œè‡ªåŠ¨å¯¼åŒ… â€‹ go list -m ä¸»æ¨¡å—çš„æ‰“å°è·¯å¾„ go list -m -f={{.Dir}} printä¸»æ¨¡å—çš„æ ¹ç›®å½• go list -m all æŸ¥çœ‹å½“å‰çš„ä¾èµ–å’Œç‰ˆæœ¬ä¿¡æ¯ ","permalink":"https://sunhao1256.github.io/posts/go/","summary":"Go åŒ…ç®¡ç† go mod init:åˆå§‹åŒ–modules go mod download:ä¸‹è½½modulesåˆ°æœ¬åœ°cache go mod edit:ç¼–è¾‘go.modæ–‡ä»¶ï¼Œé€‰é¡¹æœ‰-jsonã€-requireå’Œ-excludeï¼Œå¯ä»¥ä½¿ç”¨å¸®åŠ©go help mod edit go mod graph:ä»¥æ–‡æœ¬æ¨¡å¼æ‰“å°æ¨¡å—éœ€æ±‚å›¾ go mod tidy:æ£€æŸ¥ï¼Œåˆ é™¤é”™è¯¯æˆ–è€…ä¸ä½¿ç”¨çš„modulesï¼Œä¸‹è½½æ²¡downloadçš„package go mod vendor:ç”Ÿæˆvendorç›®å½• go mod verify:éªŒè¯ä¾èµ–æ˜¯å¦æ­£ç¡® go mod whyï¼šæŸ¥æ‰¾ä¾èµ– â€‹ go test æ‰§è¡Œä¸€ä¸‹ï¼Œè‡ªåŠ¨å¯¼åŒ… â€‹ go list -m ä¸»æ¨¡å—çš„æ‰“å°è·¯å¾„ go list -m -f={{.Dir}} printä¸»æ¨¡å—çš„æ ¹ç›®å½• go list -m all æŸ¥çœ‹å½“å‰çš„ä¾èµ–å’Œç‰ˆæœ¬ä¿¡æ¯ ","title":"GoåŒ…ç®¡ç†"},{"content":"nettyæ˜¯åœ¨ä»€ä¹ˆåœ°æ–¹åˆ›å»ºSeverChannelçš„ åœ¨BootStrapè°ƒç”¨bindæ–¹æ³•æ—¶åˆ›å»º\nprivate ChannelFuture doBind(final SocketAddress localAddress) { final ChannelFuture regFuture = this.initAndRegister(); } initAndRegisteræ–¹æ³•\nfinal ChannelFuture initAndRegister() { Channel channel = null; try { channel = this.channelFactory.newChannel(); channelFactoryæ˜¯åœ¨bootstrapé…ç½®classæ—¶å®ä¾‹åŒ–çš„\nåœ¨AbstractBootstrapä¸­\npublic B channel(Class\u0026lt;? extends C\u0026gt; channelClass) { return this.channelFactory((io.netty.channel.ChannelFactory)(new ReflectiveChannelFactory((Class)ObjectUtil.checkNotNull(channelClass, \u0026#34;channelClass\u0026#34;)))); } å› æ­¤æ˜¯ç›´æ¥é€šè¿‡åå°„ï¼Œåˆ›å»ºäº†NioServerSocketChannel.class\npublic class NioServerSocketChannel extends AbstractNioMessageChannel implements ServerSocketChannel { private static final ChannelMetadata METADATA = new ChannelMetadata(false, 16); private static final SelectorProvider DEFAULT_SELECTOR_PROVIDER = SelectorProvider.provider(); private static final InternalLogger logger = InternalLoggerFactory.getInstance(NioServerSocketChannel.class); private final ServerSocketChannelConfig config; private static java.nio.channels.ServerSocketChannel newSocket(SelectorProvider provider) { try { //å®é™…ä¸Šå°±æ˜¯è°ƒç”¨äº†javaçš„æ–¹æ³•  return provider.openServerSocketChannel(); } catch (IOException var2) { throw new ChannelException(\u0026#34;Failed to open a server socket.\u0026#34;, var2); } } public NioServerSocketChannel() { this(newSocket(DEFAULT_SELECTOR_PROVIDER)); } public NioServerSocketChannel(SelectorProvider provider) { this(newSocket(provider)); } //superæ–¹æ³•ä¸­é…ç½®äº†é˜»å¡  public NioServerSocketChannel(java.nio.channels.ServerSocketChannel channel) { super((Channel)null, channel, 16); this.config = new NioServerSocketChannel.NioServerSocketChannelConfig(this, this.javaChannel().socket()); } protected AbstractNioChannel(Channel parent, SelectableChannel ch, int readInterestOp) { super(parent); this.ch = ch; this.readInterestOp = readInterestOp; try { //è®¾ç½®é˜»å¡  ch.configureBlocking(false); } catch (IOException var7) { try { ch.close(); } catch (IOException var6) { logger.warn(\u0026#34;Failed to close a partially initialized socket.\u0026#34;, var6); } throw new ChannelException(\u0026#34;Failed to enter non-blocking mode.\u0026#34;, var7); } } protected AbstractChannel(Channel parent) { this.parent = parent; this.id = this.newId(); this.unsafe = this.newUnsafe(); this.pipeline = this.newChannelPipeline();//åˆ›å»ºäº†ç®¡é“ } ServerBootstrapAcceptor æœåŠ¡ç«¯ä¸ç®¡ä¹‹å‰å¢åŠ äº†å¤šå°‘handlerï¼Œæœ€åéƒ½ä¼šå¢åŠ ServerBootstrapAcceptor\nåœ¨ServerBootstrap.classä¸­\nvoid init(Channel channel) { setChannelOptions(channel, this.newOptionsArray(), logger); setAttributes(channel, (Entry[])this.attrs0().entrySet().toArray(EMPTY_ATTRIBUTE_ARRAY)); ChannelPipeline p = channel.pipeline(); final EventLoopGroup currentChildGroup = this.childGroup; final ChannelHandler currentChildHandler = this.childHandler; final Entry[] currentChildOptions; synchronized(this.childOptions) { currentChildOptions = (Entry[])this.childOptions.entrySet().toArray(EMPTY_OPTION_ARRAY); } final Entry\u0026lt;AttributeKey\u0026lt;?\u0026gt;, Object\u0026gt;[] currentChildAttrs = (Entry[])this.childAttrs.entrySet().toArray(EMPTY_ATTRIBUTE_ARRAY); p.addLast(new ChannelHandler[]{new ChannelInitializer\u0026lt;Channel\u0026gt;() { public void initChannel(final Channel ch) { final ChannelPipeline pipeline = ch.pipeline(); ChannelHandler handler = ServerBootstrap.this.config.handler(); if (handler != null) { pipeline.addLast(new ChannelHandler[]{handler}); } ch.eventLoop().execute(new Runnable() { public void run() { //åœ¨è¿™é‡ŒåŠ å…¥äº†é»˜è®¤çš„  //ä»¥åæ–°çš„è¯·æ±‚çš„éƒ½é€šè¿‡è¿™ä¸ªè¿æ¥å™¨å¤„ç†ï¼Œç»™æ–°çš„è¿æ¥åˆ†é…ä¸€ä¸ªnioçº¿ç¨‹  pipeline.addLast(new ChannelHandler[]{new ServerBootstrap.ServerBootstrapAcceptor(ch, currentChildGroup, currentChildHandler, currentChildOptions, currentChildAttrs)}); } }); } }}); } nettyæœåŠ¡ç«¯å¯åŠ¨çš„å‡ ä¸ªè¿‡ç¨‹ï¼šåˆ›å»ºchannelï¼ˆåˆ›å»ºjdkåº•å±‚channelï¼‰ã€initåˆå§‹åŒ–ï¼ˆæœ€ä¸»è¦æ˜¯æ·»åŠ è¿æ¥å™¨serverBootstrapAcceptorï¼‰ã€registerï¼ˆæŠŠç¬¬ä¸€æ­¥jdkåº•å±‚åˆ›å»ºchannelæ³¨å†Œåˆ°selectorä¸Šé¢ï¼Œå¹¶ä¸”æŠŠè¿™ä¸ªNioServerSocketChannelä½œä¸ºattachmentæ·»åŠ è¿›å»ï¼‰ï¼ŒdoBindï¼ˆç»‘å®šç«¯å£ï¼Œå®ç°ç›‘å¬acceptäº‹ä»¶ï¼‰\n  1ã€æœåŠ¡ç«¯çš„socketåœ¨å“ªé‡Œåˆå§‹åŒ–ï¼Ÿ\nåœ¨bindæ–¹æ³•ä¸­ï¼ŒinitAndRegisterä¸­ï¼Œå®ä¾‹åŒ–SocketChannelï¼Œä½¿ç”¨çš„æ˜¯åå°„æ–¹å¼ï¼Œä¼ å…¥çš„å°±æ˜¯bootstrapé…ç½®çš„channel.classã€‚åº•å±‚è¿˜æ˜¯jdkçš„ServerSocketChannelå¯¹åº”æ™®é€šæ–¹å¼çš„\nserverSocketChannel = ServerSocketChannel.open(); //è®¾ç½®ä¸ºéé˜»å¡æ¨¡å¼ serverSocketChannel.configureBlocking(false); registeræ˜¯æŠŠåˆ›å»ºå¥½çš„æ³¨å†Œåˆ°selectorä¸Šï¼Œä½†æ²¡æœ‰ç›‘å¬äº‹ä»¶ï¼Œå¯¹åº”çš„æ˜¯\n//ç›‘å¬å®¢æˆ·ç«¯è¯·æ±‚ //0è¡¨ç¤ºåªæ³¨å†Œï¼Œä¸ç›‘å¬äº‹ä»¶ serverSocketChannel.register(selector, 0); private static java.nio.channels.ServerSocketChannel newSocket(SelectorProvider provider) { try { return provider.openServerSocketChannel();//åˆ›å»ºjdkçš„ServerSocketChannel  } catch (IOException var2) { throw new ChannelException(\u0026#34;Failed to open a server socket.\u0026#34;, var2); } }   2ã€åœ¨å“ªé‡Œè¿›è¡Œacceptè¿æ¥ï¼Ÿ\nè¿˜æ˜¯åœ¨bindæ–¹æ³•ä¸­ï¼ŒdoBindæœ€ç»ˆåº•å±‚è°ƒç”¨äº†jdkçš„ç«¯å£ç»‘å®šå’Œç›‘å¬accpetäº‹ä»¶\npublic NioServerSocketChannel(java.nio.channels.ServerSocketChannel channel) { super((Channel)null, channel, 16);//16å°±æ˜¯SelectionKey.OP_ACCEPT 1\u0026lt;\u0026lt;4  this.config = new NioServerSocketChannel.NioServerSocketChannelConfig(this, this.javaChannel().socket()); } å¯¹åº”æ™®é€šçš„å°±æ˜¯\nserverSocketChannel.socket().bind(new InetSocketAddress(port),1024); //ç›‘å¬å®¢æˆ·ç«¯è¯·æ±‚ serverSocketChannel.register(selector, SelectionKey.OP_ACCEPT); bindæœ€ç»ˆæ˜¯åœ¨NioServerSocketChannelæ‰§è¡Œçš„\nprotected void doBind(SocketAddress localAddress) throws Exception { if (PlatformDependent.javaVersion() \u0026gt;= 7) { this.javaChannel().bind(localAddress, this.config.getBacklog()); } else { this.javaChannel().socket().bind(localAddress, this.config.getBacklog()); } } accpetæœ€ç»ˆæ˜¯åœ¨AbstractNioChannelçš„doBeginReadæ–¹æ³•ä¸­ï¼Œæ³¨å†Œäº†æ„é€ æ–¹æ³•ä¼ æ¥çš„16ï¼Œå³accpetäº‹ä»¶\nprotected void doBeginRead() throws Exception { SelectionKey selectionKey = this.selectionKey; if (selectionKey.isValid()) { this.readPending = true; int interestOps = selectionKey.interestOps(); if ((interestOps \u0026amp; this.readInterestOp) == 0) { selectionKey.interestOps(interestOps | this.readInterestOp); } } }   NioEventLoopGroupã€NioEventLoopçš„å…³ç³» åœ¨NioEventLoopGroupå®ä¾‹åŒ–çš„æ—¶å€™ï¼Œä¼šåšå¦‚ä¸‹åŠ¨ä½œ\n  åˆ›å»ºçº¿ç¨‹åˆ›å»º(æ‰§è¡Œ)å™¨ï¼šnew ThreadPerTaskExecutor()\nprotected MultithreadEventExecutorGroup(int nThreads, Executor executor, EventExecutorChooserFactory chooserFactory, Object... args) { this.terminatedChildren = new AtomicInteger(); this.terminationFuture = new DefaultPromise(GlobalEventExecutor.INSTANCE); if (nThreads \u0026lt;= 0) { throw new IllegalArgumentException(String.format(\u0026#34;nThreads: %d (expected: \u0026gt; 0)\u0026#34;, nThreads)); } else { if (executor == null) { //åˆ›å»ºçº¿ç¨‹æ‰§è¡Œå™¨  executor = new ThreadPerTaskExecutor(this.newDefaultThreadFactory()); } this.children = new EventExecutor[nThreads]; int j; for(int i = 0; i \u0026lt; nThreads; ++i) { boolean success = false; boolean var18 = false; try { var18 = true; //å¡«å……child  this.children[i] = this.newChild((Executor)executor, args); success = true; var18 = false; } catch (Exception var19) {   æ„é€ NioEventLoopï¼šfor{newChild()}\nprotected EventLoop newChild(Executor executor, Object... args) throws Exception { //å¡«å……çš„å°±æ˜¯nioEventLoop  return new NioEventLoop(this, executor, (SelectorProvider)args[0], ((SelectStrategyFactory)args[1]).newSelectStrategy(), (RejectedExecutionHandler)args[2]); }   åˆ›å»ºçº¿ç¨‹é€‰æ‹©å™¨ï¼šchooserFactory.newChooser()\nprivate static final class PowerOfTowEventExecutorChooser implements EventExecutorChooser { private final AtomicInteger idx = new AtomicInteger(); private final EventExecutor[] executors; PowerOfTowEventExecutorChooser(EventExecutor[] executors) { this.executors = executors; } @Override public EventExecutor next() { return executors[idx.getAndIncrement() \u0026amp; executors.length - 1]; } } private static final class GenericEventExecutorChooser implements EventExecutorChooser { private final AtomicInteger idx = new AtomicInteger(); private final EventExecutor[] executors; GenericEventExecutorChooser(EventExecutor[] executors) { this.executors = executors; } @Override public EventExecutor next() { return executors[Math.abs(idx.getAndIncrement() % executors.length)]; } } æ¨¡å–è¿ç®—é™¤äº†%ï¼Œè¿˜å¯ä»¥ç”¨\u0026amp;ï¼ˆlength-1ï¼‰\n  çº¿ç¨‹åˆ›å»ºä¸è¿è¡Œçš„æµç¨‹\n  NioEventLoopGroupé¡¾åæ€ä¹‰ï¼Œå°±æ˜¯NioEventLoopGroupçš„é›†åˆï¼Œå†…éƒ¨ç»´æŠ¤äº†childrenæ•°ç»„ï¼Œæ•°ç»„çš„å†…å®¹å°±æ˜¯NioEventLoop\n  å½“è°ƒç”¨Loopå»executeçš„æ—¶å€™ï¼Œå®é™…ä¸Šæ˜¯è°ƒç”¨çº¿ç¨‹æ‰§è¡Œå™¨ThreadPerTaskExecutorå»æ‰§è¡Œï¼Œå†…éƒ¨DefaultThreadFactoryå°±æ˜¯åˆ›å»ºäº†FastThreadLocalThreadçº¿ç¨‹ã€‚\n  Loopçš„executeæ–¹æ³•ï¼Œé™¤äº†ç”¨DefaultThreadFactoryåˆ›å»ºå¹¶è¿è¡ŒFastThreadLocalThreadçº¿ç¨‹å¤–ï¼Œè¿˜ä¼šå°†ä»»åŠ¡æ”¾å…¥Loopè‡ªèº«ç»´æŠ¤çš„ä¸€ä¸ªæ— é”é˜Ÿåˆ—ã€‚å¹¶ä¸”è¿è¡Œè‡ªèº«çš„runæ–¹æ³•\nprivate void doStartThread() { assert thread == null; executor.execute(new Runnable() { @Override public void run() { thread = Thread.currentThread(); if (interrupted) { thread.interrupt(); } boolean success = false; updateLastExecutionTime(); try { SingleThreadEventExecutor.this.run();//è°ƒç”¨runæ–¹æ³•  // nioEventLoopçš„runæ–¹æ³•,æ— çº¿å¾ªç¯å»æ¶ˆè´¹é˜Ÿåˆ—  for(;;) ..... .... .... final int ioRatio = this.ioRatio; boolean ranTasks; if (ioRatio == 100) { try { if (strategy \u0026gt; 0) { processSelectedKeys(); } } finally { // Ensure we always run tasks.  ranTasks = runAllTasks(); } } else if (strategy \u0026gt; 0) { final long ioStartTime = System.nanoTime(); try { processSelectedKeys(); } finally { // Ensure we always run tasks.  final long ioTime = System.nanoTime() - ioStartTime; ranTasks = runAllTasks(ioTime * (100 - ioRatio) / ioRatio);//é€šè¿‡ioRatioæ§åˆ¶æ¶ˆè´¹ä»»åŠ¡çš„é€Ÿåº¦ï¼Œè¿™é‡Œå°±æ˜¯ä¸æ–­çš„å¾ªç¯å»æ¶ˆè´¹  } } else { ranTasks = runAllTasks(0); // This will run the minimum number of tasks  }     æ€»ç»“\nåœ¨åˆ›å»ºNioEventLoopGroupåï¼Œå†…éƒ¨ä¼šç»´æŠ¤äº†ä¸€ä¸ªchildrenï¼Œchildrençš„å†…å®¹å°±æ˜¯nioEventLoopï¼Œå¹¶ä¸”åˆ›å»ºloopçš„æ—¶å€™ä¸ºæ¯ä¸ªloopåˆ›å»ºäº†å†…éƒ¨çš„æ— é”é˜Ÿåˆ—ï¼Œé»˜è®¤é•¿åº¦æ˜¯ç³»ç»Ÿæ ¸å¿ƒçš„2å€ï¼Œç„¶åè°ƒç”¨groupçš„registeræˆ–è€…executeæ–¹æ³•ï¼Œéƒ½ä¼šæ‰§è¡Œnextå»å–ä¸€ä¸ªloopï¼Œnextæ–¹æ³•å°±æ˜¯æ¨¡å–å¾ªç¯ä¸‹ä¸€ä¸ªçº¿ç¨‹ã€‚\nloopä¼šæ‰§è¡Œexecuteæ–¹æ³•ï¼Œå®ç°ä¼šå°†ä»»åŠ¡Runnableæ”¾å…¥é˜Ÿåˆ—ã€‚ç„¶åç¬¬ä¸€æ¬¡è¿è¡Œæ—¶è°ƒç”¨äº†ThreadFactoryå»åˆ›å»ºäº†æ–°çº¿ç¨‹ï¼Œè¿™ä¸ªæ–°çº¿ç¨‹å¹¶ä¸æ˜¯ç›´æ¥å°±å¼€å§‹æ‰§è¡Œä»»åŠ¡ï¼Œè€Œæ˜¯æ— é™å¾ªç¯æ¶ˆè´¹loopå†…éƒ¨ç»´æŠ¤çš„æ— é”é˜Ÿåˆ—ã€‚è¾¾åˆ°äº†ï¼Œä¸€ä¸ªloopä¸€ä¸ªçº¿ç¨‹ã€‚\n  NioEventLoopå¯åŠ¨ åœ¨ç»‘å®šç«¯å£çš„æ—¶å€™åšäº†å¯åŠ¨çº¿ç¨‹çš„åŠ¨ä½œ\nchannel.eventLoop().execute(new Runnable() { @Override public void run() { if (regFuture.isSuccess()) { channel.bind(localAddress, promise).addListener(ChannelFutureListener.CLOSE_ON_FAILURE); } else { promise.setFailure(regFuture.cause()); } } }); è¿™é‡Œçš„channelçš„eventLoopæ˜¯é€šè¿‡registeræ–¹æ³•å»ç»‘å®šçš„ï¼Œæ˜¯åœ¨ä¸€å¼€å§‹Bootstrapçš„intAndRegisteræ–¹æ³•ä¸­æ‰§è¡Œ\nfinal ChannelFuture initAndRegister() { Channel channel = null; try { channel = this.channelFactory.newChannel(); this.init(channel); } catch (Throwable var3) { if (channel != null) { channel.unsafe().closeForcibly(); return (new DefaultChannelPromise(channel, GlobalEventExecutor.INSTANCE)).setFailure(var3); } return (new DefaultChannelPromise(new FailedChannel(), GlobalEventExecutor.INSTANCE)).setFailure(var3); } //ä»groupå–ä¸€ä¸ªloopç»‘å®šåˆ°channelä¸Š  ChannelFuture regFuture = this.config().group().register(channel); if (regFuture.cause() != null) { if (channel.isRegistered()) { channel.close(); } else { channel.unsafe().closeForcibly(); } } return regFuture; } NioEventLoopçš„runæ–¹æ³•   select()æ£€æŸ¥æ˜¯å¦æœ‰ioäº‹ä»¶\nnettyåœ¨è¿™é‡Œæ£€æŸ¥æ˜¯å¦éœ€è¦selectï¼Œéœ€è¦çš„è¯ï¼Œç›´æ¥è°ƒç”¨jdkçš„selectæ–¹æ³•ï¼Œè¿›è¡Œé˜»å¡ã€‚\njdkçš„selectæ–¹æ³•ï¼Œåœ¨linuxä¸‹ï¼Œä¼šå‘ç”Ÿæ²¡æœ‰äº‹ä»¶ï¼Œä½†æ˜¯selectæ–¹æ³•è¢«è§¦å‘å¯¼è‡´çš„ç©ºè½®è®­bug\nnettyçš„è§£å†³æ–¹å¼\nlong time = System.nanoTime(); //æ£€æŸ¥å½“å‰æ—¶é—´-æœ¬åº”è¯¥é˜»å¡çš„æ—¶é—´\u0026gt;=é˜»å¡ä¹‹å‰çš„æ—¶é—´ï¼Œå³å‘ç”Ÿé˜»å¡äº†ã€‚æ²¡æœ‰ç©ºè½®è®­ if (time - TimeUnit.MILLISECONDS.toNanos(timeoutMillis) \u0026gt;= currentTimeNanos) { selectCnt = 1; //å¦åˆ™ï¼Œç©ºè½®è®­è¶…è¿‡é»˜è®¤çš„512æ¬¡ï¼Œé‡å»ºselector } else if (SELECTOR_AUTO_REBUILD_THRESHOLD \u0026gt; 0 \u0026amp;\u0026amp; selectCnt \u0026gt;= SELECTOR_AUTO_REBUILD_THRESHOLD) { logger.warn(\u0026#34;Selector.select() returned prematurely {} times in a row; rebuilding Selector {}.\u0026#34;, selectCnt, selector); this.rebuildSelector(); selector = this.selector; selector.selectNow(); selectCnt = 1; break; }  rebuildSelector()æ–¹æ³•å°±æ˜¯å°†åŸæ¥selectorä¸Šçš„æ‰€æœ‰keysï¼Œç»‘å®šåˆ°æ–°çš„selectorä¸Š\n   processSelectedKeys()ï¼šå¤„ç†ioä»»åŠ¡ï¼Œå³selectionKeyä¸­readyçš„äº‹ä»¶ï¼Œå¦‚acceptã€connectã€readã€writeç­‰\nåº•å±‚å–è½®è¯¢ioäº‹ä»¶ï¼Œéƒ½æ˜¯é€šè¿‡NioUnsafeå»å¤„ç†çš„\nprivate void processSelectedKey(SelectionKey k, AbstractNioChannel ch) { final AbstractNioChannel.NioUnsafe unsafe = ch.unsafe(); if (!k.isValid()) { final EventLoop eventLoop; try { eventLoop = ch.eventLoop(); } catch (Throwable ignored) { // If the channel implementation throws an exception because there is no event loop, we ignore this  // because we are only trying to determine if ch is registered to this event loop and thus has authority  // to close ch.  return; } // Only close ch if ch is still registered to this EventLoop. ch could have deregistered from the event loop  // and thus the SelectionKey could be cancelled as part of the deregistration process, but the channel is  // still healthy and should not be closed.  // See https://github.com/netty/netty/issues/5125  if (eventLoop == this) { // close the channel if the key is not valid anymore  unsafe.close(unsafe.voidPromise()); } return; } try { //å¤„ç†å„ç§äº‹ä»¶  int readyOps = k.readyOps(); // We first need to call finishConnect() before try to trigger a read(...) or write(...) as otherwise  // the NIO JDK channel implementation may throw a NotYetConnectedException.  if ((readyOps \u0026amp; SelectionKey.OP_CONNECT) != 0) { // remove OP_CONNECT as otherwise Selector.select(..) will always return without blocking  // See https://github.com/netty/netty/issues/924  int ops = k.interestOps(); ops \u0026amp;= ~SelectionKey.OP_CONNECT; k.interestOps(ops); unsafe.finishConnect(); } // Process OP_WRITE first as we may be able to write some queued buffers and so free memory.  if ((readyOps \u0026amp; SelectionKey.OP_WRITE) != 0) { // Call forceFlush which will also take care of clear the OP_WRITE once there is nothing left to write  ch.unsafe().forceFlush(); } // Also check for readOps of 0 to workaround possible JDK bug which may otherwise lead  // to a spin loop  if ((readyOps \u0026amp; (SelectionKey.OP_READ | SelectionKey.OP_ACCEPT)) != 0 || readyOps == 0) { unsafe.read(); } } catch (CancelledKeyException ignored) { unsafe.close(unsafe.voidPromise()); } }   runAllTasks()ï¼šå¤„ç†å¼‚æ­¥ä»»åŠ¡é˜Ÿåˆ—é‡Œé¢çš„ä»»åŠ¡ï¼Œä¹Ÿå°±æ˜¯æ·»åŠ åˆ°taskQueueä¸­çš„ä»»åŠ¡ï¼Œå¦‚bindã€channelActiveç­‰\nè¿™é‡Œæœ‰ä¸ªioRatioï¼Œå°±æ˜¯æ‰§è¡Œioä»»åŠ¡å’Œéioä»»åŠ¡çš„æ—¶é—´æ¯”ã€‚ç”¨æˆ·å¯ä»¥è‡ªè¡Œè®¾ç½®ã€‚é»˜è®¤ä¸º50ï¼Œå¯ä»¥çœ‹æºç ã€‚å¦‚æœæ˜¯100çš„è¯ï¼Œå…ˆæ‰§è¡Œå®Œioä»»åŠ¡ï¼Œæ‰§è¡Œå®Œä¹‹åæ‰æ‰§è¡Œéioä»»åŠ¡\nselectCnt++; cancelledKeys = 0; needsToSelectAgain = false; final int ioRatio = this.ioRatio; boolean ranTasks; if (ioRatio == 100) { try { if (strategy \u0026gt; 0) { processSelectedKeys(); } } finally { // Ensure we always run tasks.  ranTasks = runAllTasks(); } } else if (strategy \u0026gt; 0) { final long ioStartTime = System.nanoTime(); try { processSelectedKeys(); } finally { // Ensure we always run tasks.  final long ioTime = System.nanoTime() - ioStartTime; ranTasks = runAllTasks(ioTime * (100 - ioRatio) / ioRatio); } } else { ranTasks = runAllTasks(0); // This will run the minimum number of tasks  } if (ranTasks || strategy \u0026gt; 0) { if (selectCnt \u0026gt; MIN_PREMATURE_SELECTOR_RETURNS \u0026amp;\u0026amp; logger.isDebugEnabled()) { logger.debug(\u0026#34;Selector.select() returned prematurely {} times in a row for Selector {}.\u0026#34;, selectCnt - 1, selector); } selectCnt = 0; } else if (unexpectedSelectorWakeup(selectCnt)) { // Unexpected wakeup (unusual case)  selectCnt = 0; } protected boolean runAllTasks(long timeoutNanos) { fetchFromScheduledTaskQueue();//å°†å®šæ—¶ä»»åŠ¡é˜Ÿåˆ—é‡Œçš„åˆ°æœŸä»»åŠ¡æ”¾å…¥é˜Ÿåˆ—ä¸­ï¼Œå¦‚æœé˜Ÿåˆ—æ»¡äº†ï¼Œè¿˜æ”¾åœ¨å®šæ—¶ä»»åŠ¡é˜Ÿåˆ—é‡Œ  Runnable task = pollTask();//å–ä¸€ä¸ªä»»åŠ¡å‡ºæ¥  if (task == null) { afterRunningAllTasks(); return false; } final long deadline = timeoutNanos \u0026gt; 0 ? ScheduledFutureTask.nanoTime() + timeoutNanos : 0; long runTasks = 0; long lastExecutionTime; for (;;) { safeExecute(task); runTasks ++; // Check timeout every 64 tasks because nanoTime() is relatively expensive.  // XXX: Hard-coded value - will make it configurable if it is really a problem.  if ((runTasks \u0026amp; 0x3F) == 0) { lastExecutionTime = ScheduledFutureTask.nanoTime(); if (lastExecutionTime \u0026gt;= deadline) { break; } } //ä¸æ–­å¤„ç†ä»»åŠ¡  task = pollTask(); if (task == null) { lastExecutionTime = ScheduledFutureTask.nanoTime(); break; } } afterRunningAllTasks(); this.lastExecutionTime = lastExecutionTime; return true; }  å®šæ—¶ä»»åŠ¡çš„åœºæ™¯ï¼Œä¾‹å¦‚å¿ƒè·³å¤„ç†\n   æœåŠ¡ç«¯åˆ›å»ºå®¢æˆ·ç«¯è¿æ¥æµç¨‹ processSelectedKeysæ–¹æ³•å¤„ç†å®¢æˆ·ç«¯è¿æ¥ï¼Œæœ€åæ˜¯è½åœ¨åº•å±‚çš„unsafeä¸Šã€‚\nreadæ–¹æ³•æœ€åä¼šé€šçŸ¥åˆ°ç®¡é“ä¸Šï¼Œé€šçŸ¥æ‰€æœ‰çš„handlerï¼Œ\npublic void read() { assert eventLoop().inEventLoop(); final ChannelConfig config = config(); final ChannelPipeline pipeline = pipeline(); final RecvByteBufAllocator.Handle allocHandle = unsafe().recvBufAllocHandle(); allocHandle.reset(config); boolean closed = false; Throwable exception = null; try { try { do { //åˆ›å»ºNioSocketChannel  int localRead = doReadMessages(readBuf); if (localRead == 0) { break; } if (localRead \u0026lt; 0) { closed = true; break; } allocHandle.incMessagesRead(localRead); } while (continueReading(allocHandle)); } catch (Throwable t) { exception = t; } int size = readBuf.size(); for (int i = 0; i \u0026lt; size; i ++) { readPending = false; //ç®¡é“ä¼ å…¥NioSocketChannel  pipeline.fireChannelRead(readBuf.get(i)); } è€Œæˆ‘ä»¬çŸ¥é“åœ¨ä¸€å¼€å§‹åˆ›å»ºNioServerSocketChannelçš„æ—¶å€™ï¼Œåœ¨initä¸­æœ€ååŠ å…¥äº†ServerBootstrapAcceptorã€‚è€ŒServerBootstrapAcceptorå°±æ˜¯å¤„ç†å®¢æˆ·ç«¯è¿æ¥çš„\n@Override @SuppressWarnings(\u0026#34;unchecked\u0026#34;) public void channelRead(ChannelHandlerContext ctx, Object msg) { final Channel child = (Channel) msg; //å¾—åˆ°ä¸Šé¢çš„NioSocketChannel  //å°†ä¸€å¼€å§‹ä»£ç ä¸­çš„childHandler(new ChannelInitializer\u0026lt;SocketChannel\u0026gt;() {}ä¼ è¿›æ¥  child.pipeline().addLast(childHandler); //è®¾ç½®é€šé“é…ç½®  setChannelOptions(child, childOptions, logger); //è®¾ç½®å±æ€§  setAttributes(child, childAttrs); try { //workerçº¿ç¨‹ç»„æ³¨å†Œchannel  childGroup.register(child).addListener(new ChannelFutureListener() { @Override public void operationComplete(ChannelFuture future) throws Exception { if (!future.isSuccess()) { forceClose(child, future.cause()); } } }); } catch (Throwable t) { forceClose(child, t); } }\t  å°ç»“\nServeråœ¨è·å–åˆ°è¯»äº‹ä»¶åï¼Œåˆ›å»ºäº†å®¢æˆ·ç«¯çš„SocketChannelï¼Œå¹¶ä¸”é€šè¿‡pipelineé€šçŸ¥åˆ°æœåŠ¡ç«¯åˆå§‹åŒ–æ—¶åˆ›å»ºçš„ServerBootstrapAcceptorï¼Œé€šè¿‡ServerBootstrapAcceptoråˆå§‹åŒ–childHandlerï¼Œä½¿ç”¨workerç»„è¿›è¡Œæ³¨å†ŒSocketChannelï¼Œå¹¶ä¸”åˆ›å»ºå®¢æˆ·ç«¯Channelé»˜è®¤çš„ç›‘å¬äº‹ä»¶æ—¶readï¼Œç„¶åå°±å’ŒæœåŠ¡ç«¯ä¸€æ ·ï¼Œé€šè¿‡é»˜è®¤çš„HeadContextè¿›è¡Œreadæ–¹æ³•ï¼Œé»˜è®¤éƒ½æ˜¯è‡ªåŠ¨è¯»çš„ã€‚ç„¶åå°±æ˜¯é€šè¿‡groupåˆ›å»ºæ–°çº¿ç¨‹å»å·¥ä½œã€‚å¾ªç¯è°ƒåº•å±‚çš„jdkæ–¹æ³•ã€‚å†é€šè¿‡pipelineé€šçŸ¥åˆ°å„ä¸ªhandler\n  Pipeline   nettyæ˜¯å¦‚ä½•åˆ¤æ–­ChannelHandlerç±»å‹çš„\nç­”ï¼šé€šè¿‡ä¼ å…¥æ˜¯inboundè¿˜æ˜¯outbound\n  å¯¹äºChannelHandlerçš„æ·»åŠ åº”è¯¥éµå¾ªä»€ä¹ˆæ ·çš„é¡ºåº\nç­”ï¼šinboundä¼ æ’­æ˜¯ä»Headç»“ç‚¹å¼€å§‹çš„ï¼Œoutboundä¼ æ’­æ˜¯ä»TailèŠ‚ç‚¹å¼€å§‹çš„ï¼Œæ‰€ä»¥éœ€è¦æ ¹æ®éœ€è¦ä»è¿™ä¸¤ä¸ªæ–¹é¢é€‰æ‹©\n  ç”¨æˆ·æ‰‹åŠ¨è§¦å‘äº‹ä»¶ä¼ æ’­ï¼Œä¸åŒçš„è§¦å‘æ–¹å¼æœ‰ä»€ä¹ˆæ ·çš„åŒºåˆ«ï¼Ÿ\nå¯ä»¥è¿™é‡Œå›ç­”ï¼šctx.channel().write()å’Œctx.write()çš„åŒºåˆ«ï¼Œctx.channel().write()ä»tailèŠ‚ç‚¹å¼€å§‹ä¼ æ’­ï¼ˆå¯¹äºoutBoundäº‹ä»¶ï¼‰ï¼Œctx.write()ä»å½“å‰èŠ‚ç‚¹å¼€å§‹ä¼ æ’­ã€‚\n  åˆå§‹åŒ– Pipelineæ˜¯åœ¨channelåˆ›å»ºçš„æ—¶å€™è¿›è¡Œåˆå§‹åŒ–çš„ï¼Œå¹¶ä¸”ç»´æŠ¤äº†åŒå‘é“¾è¡¨ï¼Œé»˜è®¤çš„æ·»åŠ HeadContextå’ŒTailContextï¼ŒèŠ‚ç‚¹æ˜¯AbstractChannelHandlerContext\nprotected AbstractChannel(Channel parent) { this.parent = parent; id = newId(); unsafe = newUnsafe(); pipeline = newChannelPipeline(); } protected DefaultChannelPipeline(Channel channel) { this.channel = ObjectUtil.checkNotNull(channel, \u0026#34;channel\u0026#34;); succeededFuture = new SucceededChannelFuture(channel, null); voidPromise = new VoidChannelPromise(channel, true); tail = new TailContext(this); head = new HeadContext(this); head.next = tail; tail.prev = head; } ChannelHandlerContext public interface ChannelHandlerContext extends AttributeMap, ChannelInboundInvoker, ChannelOutboundInvoker { /** * Return the {@link Channel} which is bound to the {@link ChannelHandlerContext}. */ //æ‰€åœ¨çš„channel  Channel channel(); /** * Returns the {@link EventExecutor} which is used to execute an arbitrary task. */ //å“ªä¸€ä¸ªloopæ‰§è¡Œçš„  EventExecutor executor(); /** * The unique name of the {@link ChannelHandlerContext}.The name was used when then {@link ChannelHandler} * was added to the {@link ChannelPipeline}. This name can also be used to access the registered * {@link ChannelHandler} from the {@link ChannelPipeline}. */ String name(); /** * The {@link ChannelHandler} that is bound this {@link ChannelHandlerContext}. */ //å¹²æ´»çš„ä¸šåŠ¡handler  ChannelHandler handler(); /** * Return {@code true} if the {@link ChannelHandler} which belongs to this context was removed * from the {@link ChannelPipeline}. Note that this method is only meant to be called from with in the * {@link EventLoop}. */ boolean isRemoved(); ... /** * Return the assigned {@link ByteBufAllocator} which will be used to allocate {@link ByteBuf}s. */ // å†…å­˜åˆ†é…å™¨  ByteBufAllocator alloc(); ... } ChannelHandlerçš„æ·»åŠ  DefaultChannelPipelineçš„addLastæ–¹æ³•\n@Override public final ChannelPipeline addLast(EventExecutorGroup group, String name, ChannelHandler handler) { final AbstractChannelHandlerContext newCtx; synchronized (this) { //æ£€æŸ¥handleræ˜¯å¦é‡å¤ï¼Œå¦‚æœæ²¡@Shareableçš„è¯ï¼Œä¸å¯ä»¥å†æ·»åŠ äº†  checkMultiplicity(handler); //ä½¿ç”¨DefaultChannelHandlerContextï¼Œå†…éƒ¨å°è£…äº†å…·ä½“çš„ä¸šåŠ¡handler  newCtx = newContext(group, filterName(name, handler), handler); //è¿æ¥åˆ°é“¾è¡¨ä¸Šå»  addLast0(newCtx); // If the registered is false it means that the channel was not registered on an eventLoop yet.  // In this case we add the context to the pipeline and add a task that will call  // ChannelHandler.handlerAdded(...) once the channel is registered.  if (!registered) { newCtx.setAddPending(); callHandlerCallbackLater(newCtx, true); return this; } EventExecutor executor = newCtx.executor(); if (!executor.inEventLoop()) { callHandlerAddedInEventLoop(newCtx, executor); return this; } } callHandlerAdded0(newCtx); return this; } ChannelHandleråˆ é™¤ private AbstractChannelHandlerContext getContextOrDie(ChannelHandler handler) { AbstractChannelHandlerContext ctx = (AbstractChannelHandlerContext) context(handler); if (ctx == null) { throw new NoSuchElementException(handler.getClass().getName()); } else { return ctx; } } //ä»å¤´åˆ°å°¾æ‰¾  @Override public final ChannelHandlerContext context(ChannelHandler handler) { if (handler == null) { throw new NullPointerException(\u0026#34;handler\u0026#34;); } AbstractChannelHandlerContext ctx = head.next; for (;;) { if (ctx == null) { return null; } if (ctx.handler() == handler) { return ctx; } ctx = ctx.next; } } //ä¸åˆ é™¤headå’Œtail  private AbstractChannelHandlerContext remove(final AbstractChannelHandlerContext ctx) { assert ctx != head \u0026amp;\u0026amp; ctx != tail; synchronized (this) { remove0(ctx); // If the registered is false it means that the channel was not registered on an eventloop yet.  // In this case we remove the context from the pipeline and add a task that will call  // ChannelHandler.handlerRemoved(...) once the channel is registered.  if (!registered) { callHandlerCallbackLater(ctx, false); return ctx; } EventExecutor executor = ctx.executor(); if (!executor.inEventLoop()) { executor.execute(new Runnable() { @Override public void run() { callHandlerRemoved0(ctx); } }); return ctx; } } callHandlerRemoved0(ctx); return ctx; } //çœŸæ­£çš„åˆ é™¤  private static void remove0(AbstractChannelHandlerContext ctx) { AbstractChannelHandlerContext prev = ctx.prev; AbstractChannelHandlerContext next = ctx.next; prev.next = next; next.prev = prev; } //é€šçŸ¥åˆ é™¤  final void callHandlerRemoved() throws Exception { try { // Only call handlerRemoved(...) if we called handlerAdded(...) before.  if (handlerState == ADD_COMPLETE) { handler().handlerRemoved(this); } } finally { // Mark the handler as removed in any case.  //æ ‡è®°handleråˆ é™¤äº†  setRemoved(); } } Inboudäº‹ä»¶ æ ¹æ®ä¸Šé¢çš„æè¿°ï¼Œæœ€ç»ˆloopä¼šç»‘å®šåˆ°pipelineä¸­ï¼Œå½“processSelectedKeysè§¦å‘åï¼Œæœ€åä¼šè°ƒç”¨åˆ°pipelineçš„fireChannelReadæ–¹æ³•ï¼Œæ‰¾åˆ°ä¸‹ä¸€ä¸ªinboundHandlerContext\npublic ChannelHandlerContext fireChannelRead(Object msg) { invokeChannelRead(this.findContextInbound(), msg); return this; } //æ‰¾åˆ°ä¸‹ä¸€ä¸ªInboundçš„handler  private AbstractChannelHandlerContext findContextInbound() { AbstractChannelHandlerContext ctx = this; do { ctx = ctx.next; } while(!ctx.inbound); return ctx; } //åˆ›å»ºhandlerContext  DefaultChannelHandlerContext(DefaultChannelPipeline pipeline, EventExecutor executor, String name, ChannelHandler handler) { //åˆ¤æ–­æ˜¯å¦æ˜¯inbound  super(pipeline, executor, name, isInbound(handler), isOutbound(handler)); if (handler == null) { throw new NullPointerException(\u0026#34;handler\u0026#34;); } else { this.handler = handler; } } private static boolean isInbound(ChannelHandler handler) { return handler instanceof ChannelInboundHandler; } //å‡ºå‘handlerçš„æ–¹æ³•ï¼Œç›´æ¥åˆ°ç”¨æˆ·çš„ä¸šåŠ¡ä»£ç äº†  private void invokeChannelRead(Object msg) { if (this.invokeHandler()) { try { ((ChannelInboundHandler)this.handler()).channelRead(this, msg); } catch (Throwable var3) { this.notifyHandlerException(var3); } } else { this.fireChannelRead(msg); } } outBoundäº‹ä»¶ åŒ…å«bindã€connectã€disconnectæ–¹æ³•ã€closeã€deregisterã€readã€writeã€flushç­‰æ–¹æ³•ï¼Œè¿™äº›æ–¹æ³•æ›´å¤šçš„æ˜¯ä¸»åŠ¨å‘ç”¨æˆ·å‘èµ·çš„æ“ä½œã€‚\nï¼ˆè€ŒinBoundäº‹ä»¶æ›´å¤šçš„æ˜¯äº‹ä»¶çš„è§¦å‘ï¼Œå¦‚registerã€readCompleteã€activeï¼Œæ¯”è¾ƒè¢«åŠ¨çš„ï¼‰\noutBoundæ˜¯ä»tailåè¿‡æ¥åœ¨é“¾è¡¨ä¸Šä¼ è¾“çš„\nctx.channel().write()å’Œctx.write()çš„åŒºåˆ« ctx.channel().write()ä»tailèŠ‚ç‚¹å¼€å§‹ä¼ æ’­ï¼Œctx.write()ä»å½“å‰èŠ‚ç‚¹å¼€å§‹ä¼ æ’­ï¼ˆä¸åŒ…æ‹¬å½“å‰èŠ‚ç‚¹ï¼Œå› ä¸ºå®ƒé¦–å…ˆä¼šæ‰¾åˆ°å½“å‰èŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹åœ¨æ‰§è¡Œwriteæ“ä½œï¼‰ã€‚\nByteBuf   Pooledå’ŒUnpooled\næ± åŒ–å’Œä¸æ± åŒ–\n  Unsafeå’ŒéUnsafe\nunsafeé€šè¿‡æ“ä½œåº•å±‚unsafeçš„offset+indexçš„æ–¹å¼å»æ“ä½œæ•°æ®ï¼Œéunsafeç›´æ¥é€šè¿‡ä¸€ä¸ªæ•°ç»„çš„ä¸‹æ ‡ï¼ˆæˆ–è€…jdkåº•å±‚çš„bufferï¼‰å»æ“ä½œæ•°æ®ã€‚\n  Heapå’ŒDirect\nheapæ˜¯ä¾èµ–ä¸€ä¸ªæ•°ç»„ï¼Œdirectæ˜¯ä¾èµ–jdkåº•å±‚çš„ByteBufferã€‚\n  ByteBuffAllocator UnpooledByteBufAllocator åˆ†é…å †å†…å†…å­˜ //å¦‚æœjdkç¯å¢ƒæ”¯æŒunsafeï¼Œåˆ™ç”¨unsafeæ“ä½œå†…å­˜ç©ºé—´ //heap å†…å­˜ç©ºé—´ï¼Œåº•å±‚å°±æ˜¯ä¸€ä¸ªæ•°ç»„ protected ByteBuf newHeapBuffer(int initialCapacity, int maxCapacity) { return PlatformDependent.hasUnsafe() ? new InstrumentedUnpooledUnsafeHeapByteBuf(this, initialCapacity, maxCapacity) : new InstrumentedUnpooledHeapByteBuf(this, initialCapacity, maxCapacity); } public UnpooledHeapByteBuf(ByteBufAllocator alloc, int initialCapacity, int maxCapacity) { super(maxCapacity); if (initialCapacity \u0026gt; maxCapacity) { throw new IllegalArgumentException(String.format( \u0026#34;initialCapacity(%d) \u0026gt; maxCapacity(%d)\u0026#34;, initialCapacity, maxCapacity)); } this.alloc = checkNotNull(alloc, \u0026#34;alloc\u0026#34;); //å£°æ˜æ•°ç»„  setArray(allocateArray(initialCapacity)); setIndex(0, 0); } //åˆ›å»ºæ•°ç»„  protected byte[] allocateArray(int initialCapacity) { return new byte[initialCapacity]; } åˆ†é…å †å¤–å†…å­˜ åº•å±‚è°ƒç”¨jdkçš„DirectBuffer\n@Override protected ByteBuf newDirectBuffer(int initialCapacity, int maxCapacity) { final ByteBuf buf; if (PlatformDependent.hasUnsafe()) { buf = noCleaner ? new InstrumentedUnpooledUnsafeNoCleanerDirectByteBuf(this, initialCapacity, maxCapacity) : new InstrumentedUnpooledUnsafeDirectByteBuf(this, initialCapacity, maxCapacity); } else { buf = new InstrumentedUnpooledDirectByteBuf(this, initialCapacity, maxCapacity); } return disableLeakDetector ? buf : toLeakAwareBuffer(buf); } public UnpooledDirectByteBuf(ByteBufAllocator alloc, int initialCapacity, int maxCapacity) { super(maxCapacity); ObjectUtil.checkNotNull(alloc, \u0026#34;alloc\u0026#34;); checkPositiveOrZero(initialCapacity, \u0026#34;initialCapacity\u0026#34;); checkPositiveOrZero(maxCapacity, \u0026#34;maxCapacity\u0026#34;); if (initialCapacity \u0026gt; maxCapacity) { throw new IllegalArgumentException(String.format( \u0026#34;initialCapacity(%d) \u0026gt; maxCapacity(%d)\u0026#34;, initialCapacity, maxCapacity)); } this.alloc = alloc; setByteBuffer(allocateDirect(initialCapacity), false); } protected ByteBuffer allocateDirect(int initialCapacity) { return ByteBuffer.allocateDirect(initialCapacity); } public static ByteBuffer allocateDirect(int capacity) { return new DirectByteBuffer(capacity); } void setByteBuffer(ByteBuffer buffer, boolean tryFree) { if (tryFree) { ByteBuffer oldBuffer = this.buffer; if (oldBuffer != null) { if (doNotFree) { doNotFree = false; } else { freeDirect(oldBuffer); } } } this.buffer = buffer; tmpNioBuf = null; capacity = buffer.remaining(); } final void setByteBuffer(ByteBuffer buffer, boolean tryFree) { super.setByteBuffer(buffer, tryFree); //è®¡ç®—å†…å­˜åœ°å€ï¼Œä½¿ç”¨Unsafeå»æ“ä½œ  memoryAddress = PlatformDependent.directBufferAddress(buffer); } //é unsafeï¼Œç›´æ¥è°ƒç”¨jdkæ–¹æ³•  protected byte _getByte(int index) { return buffer.get(index); } //è·å–å†…å­˜åœ°å€ï¼Œåœ¨ç”¨unsafeå»è°ƒç”¨  @Override protected byte _getByte(int index) { return UnsafeByteBufUtil.getByte(addr(index)); } //è®¡ç®—åœ°å€  final long addr(int index) { return memoryAddress + index; } PooledByteBufAllocator åˆ†é…å †å†…å†…å­˜ @Override protected ByteBuf newHeapBuffer(int initialCapacity, int maxCapacity) { PoolThreadCache cache = threadCache.get();//å–å‡ºå½“å‰çº¿ç¨‹çš„ç¼“å­˜ï¼Œå¤šçº¿ç¨‹æƒ…å†µä¸‹çš„å¤„ç†  PoolArena\u0026lt;byte[]\u0026gt; heapArena = cache.heapArena; //å–å‡ºå½“å‰ç¼“å­˜é‡Œçš„arena  final ByteBuf buf; if (heapArena != null) { buf = heapArena.allocate(cache, initialCapacity, maxCapacity); } else { buf = PlatformDependent.hasUnsafe() ? new UnpooledUnsafeHeapByteBuf(this, initialCapacity, maxCapacity) : new UnpooledHeapByteBuf(this, initialCapacity, maxCapacity); } return toLeakAwareBuffer(buf); } final class PoolThreadLocalCache extends FastThreadLocal\u0026lt;PoolThreadCache\u0026gt; { @Override protected synchronized PoolThreadCache initialValue() { final PoolArena\u0026lt;byte[]\u0026gt; heapArena = leastUsedArena(heapArenas); final PoolArena\u0026lt;ByteBuffer\u0026gt; directArena = leastUsedArena(directArenas); //FastThreadLocalå°±æ˜¯ThreacLocalçš„å¿«é€Ÿç‰ˆæœ¬ï¼Œé¦–æ¬¡æ²¡æœ‰å–åˆ°ç¼“å­˜çš„æ—¶å€™ï¼Œä¼šè¿›è¡Œåˆå§‹åŒ–åŠ¨ä½œ  return new PoolThreadCache( heapArena, directArena, tinyCacheSize, smallCacheSize, normalCacheSize, DEFAULT_MAX_CACHED_BUFFER_CAPACITY, DEFAULT_CACHE_TRIM_INTERVAL); } ... } ByteToMessageDecoder æŠ½è±¡çš„å­—èŠ‚è§£ç å™¨\n@Override public void channelRead(ChannelHandlerContext ctx, Object msg) throws Exception { if (msg instanceof ByteBuf) { CodecOutputList out = CodecOutputList.newInstance(); try { first = cumulation == null; //æ£€æŸ¥æ˜¯å¦è¦æ‰©å®¹ï¼Œé»˜è®¤nettyå®ç°æ˜¯åˆå¹¶åˆ°ä¸€ä¸ªByteBufä¸Šï¼Œéœ€è¦å†…å­˜å¤åˆ¶ï¼Œå¦ä¸€ç§æ˜¯ç›´æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„compositeByteBuf  cumulation = cumulator.cumulate(ctx.alloc(), first ? Unpooled.EMPTY_BUFFER : cumulation, (ByteBuf) msg); callDecode(ctx, cumulation, out); } catch (DecoderException e) { throw e; } catch (Exception e) { throw new DecoderException(e); } finally { try { if (cumulation != null \u0026amp;\u0026amp; !cumulation.isReadable()) { numReads = 0; cumulation.release(); cumulation = null; } else if (++numReads \u0026gt;= discardAfterReads) { // We did enough reads already try to discard some bytes so we not risk to see a OOME.  // See https://github.com/netty/netty/issues/4275  numReads = 0; discardSomeReadBytes(); } int size = out.size(); firedChannelRead |= out.insertSinceRecycled(); fireChannelRead(ctx, out, size); } finally { out.recycle(); } } } else { ctx.fireChannelRead(msg); } } //é»˜è®¤Cumulatorå®ç°ï¼Œå†…å­˜å¤åˆ¶åˆ°ä¸€ä¸ªByteBufä¸Š  public static final Cumulator MERGE_CUMULATOR = new Cumulator() { @Override public ByteBuf cumulate(ByteBufAllocator alloc, ByteBuf cumulation, ByteBuf in) { if (!cumulation.isReadable() \u0026amp;\u0026amp; in.isContiguous()) { // If cumulation is empty and input buffer is contiguous, use it directly  cumulation.release(); return in; } try { final int required = in.readableBytes(); if (required \u0026gt; cumulation.maxWritableBytes() || (required \u0026gt; cumulation.maxFastWritableBytes() \u0026amp;\u0026amp; cumulation.refCnt() \u0026gt; 1) || cumulation.isReadOnly()) { // Expand cumulation (by replacing it) under the following conditions:  // - cumulation cannot be resized to accommodate the additional data  // - cumulation can be expanded with a reallocation operation to accommodate but the buffer is  // assumed to be shared (e.g. refCnt() \u0026gt; 1) and the reallocation may not be safe.  return expandCumulation(alloc, cumulation, in); } cumulation.writeBytes(in, in.readerIndex(), required); in.readerIndex(in.writerIndex()); return cumulation; } finally { // We must release in in all cases as otherwise it may produce a leak if writeBytes(...) throw  // for whatever release (for example because of OutOfMemoryError)  in.release(); } } }; protected void callDecode(ChannelHandlerContext ctx, ByteBuf in, List\u0026lt;Object\u0026gt; out) { try { while (in.isReadable()) { final int outSize = out.size(); //è§£æåˆ°äº†æ•°æ®  if (outSize \u0026gt; 0) { //é€šçŸ¥åˆ°ä¸‹ä¸€ä¸ªhandler  fireChannelRead(ctx, out, outSize); out.clear(); // Check if this handler was removed before continuing with decoding.  // If it was removed, it is not safe to continue to operate on the buffer.  //  // See:  // - https://github.com/netty/netty/issues/4635  if (ctx.isRemoved()) { break; } } int oldInputLength = in.readableBytes(); //å­ç±»å®ç°decode  decodeRemovalReentryProtection(ctx, in, out); // Check if this handler was removed before continuing the loop.  // If it was removed, it is not safe to continue to operate on the buffer.  //  // See https://github.com/netty/netty/issues/1664  if (ctx.isRemoved()) { break; } //å¦‚æœå­ç±»æ²¡æœ‰è§£æåˆ°å¯¹è±¡  // 1 æ•°æ®ä¸å¤Ÿè§£æé“å¯¹è±¡çš„  // 2  if (out.isEmpty()) { //æ•°æ®ä¸å¤Ÿè§£æçš„ï¼Œè·³å‡ºwhileï¼Œç­‰ä¸‹ä¸€æ¬¡ç»§ç»­  if (oldInputLength == in.readableBytes()) { break; } else { // è§£æå‡ºæ¥çš„ä¸œè¥¿ï¼Œä¸å¤Ÿåˆæˆä¸€ä¸ªå¯¹è±¡çš„ï¼Œç»§ç»­è§£æ  continue; } } // è§£æå‡ºå¯¹è±¡äº†ï¼Œä½†æ˜¯æ•°æ®æ²¡æœ‰å‡å°‘ï¼Œæœ‰é—®é¢˜å•Šï¼Œæ˜æ˜¾å¯¹è±¡ä½ è‡ªå·±æå‡ºæ¥çš„ï¼Œä¸æ˜¯ä»æ•°æ®é‡Œæ‹¿çš„ï¼Œä½ æœ‰é—®é¢˜  if (oldInputLength == in.readableBytes()) { throw new DecoderException( StringUtil.simpleClassName(getClass()) + \u0026#34;.decode() did not read anything but decoded a message.\u0026#34;); } // å¦‚æœåªè¦è§£æä¸€ä¸ªï¼Œç›´æ¥è·³å‡º  if (isSingleDecode()) { break; } } } catch (DecoderException e) { throw e; } catch (Exception cause) { throw new DecoderException(cause); } } ","permalink":"https://sunhao1256.github.io/posts/netty/","summary":"nettyæ˜¯åœ¨ä»€ä¹ˆåœ°æ–¹åˆ›å»ºSeverChannelçš„ åœ¨BootStrapè°ƒç”¨bindæ–¹æ³•æ—¶åˆ›å»º\nprivate ChannelFuture doBind(final SocketAddress localAddress) { final ChannelFuture regFuture = this.initAndRegister(); } initAndRegisteræ–¹æ³•\nfinal ChannelFuture initAndRegister() { Channel channel = null; try { channel = this.channelFactory.newChannel(); channelFactoryæ˜¯åœ¨bootstrapé…ç½®classæ—¶å®ä¾‹åŒ–çš„\nåœ¨AbstractBootstrapä¸­\npublic B channel(Class\u0026lt;? extends C\u0026gt; channelClass) { return this.channelFactory((io.netty.channel.ChannelFactory)(new ReflectiveChannelFactory((Class)ObjectUtil.checkNotNull(channelClass, \u0026#34;channelClass\u0026#34;)))); } å› æ­¤æ˜¯ç›´æ¥é€šè¿‡åå°„ï¼Œåˆ›å»ºäº†NioServerSocketChannel.class\npublic class NioServerSocketChannel extends AbstractNioMessageChannel implements ServerSocketChannel { private static final ChannelMetadata METADATA = new ChannelMetadata(false, 16); private static final SelectorProvider DEFAULT_SELECTOR_PROVIDER = SelectorProvider.provider(); private static final InternalLogger logger = InternalLoggerFactory.","title":"Netty"},{"content":"Reactive Programming å“åº”å¼ç¼–ç¨‹ ä¸ºä»€ä¹ˆè¦å“åº”å¼ç¼–ç¨‹ ä¼ ç»Ÿçš„ç¼–ç¨‹æ¨¡å¼åº”å¯¹å¦‚ä»Šé«˜å¹¶å‘ï¼Œé«˜å“åº”çš„éœ€æ±‚æœ‰å¾ˆå¤šé™åˆ¶ã€‚ç°åœ¨çš„webåº”ç”¨ï¼Œè¶Šæ¥è¶Šéœ€è¦æ›´é«˜çš„å¹¶å‘ï¼Œæ›´å¿«çš„å“åº”ã€‚\næ¯ä¸ªè¯·æ±‚éƒ½éœ€è¦ä¸€ä¸ªçº¿ç¨‹ ä¼ ç»Ÿçš„webè¯·æ±‚ï¼Œæ¯ä¸ªè¯·æ±‚éƒ½æ˜¯ä½¿ç”¨å•ä¸ªçº¿ç¨‹è´¯ç©¿æ•´ä¸ªæµç¨‹ã€‚å¦‚æœæˆ‘ä»¬ç”¨Springçš„ç”Ÿæ€ï¼Œå¯¹äºçš„å°±æ˜¯SpringMvcæ¡†æ¶ã€‚åŸºäºservletå®¹å™¨ï¼Œä¾‹å¦‚tomcatã€‚è€Œtomcatå†…éƒ¨ä¼šç»´æŠ¤ä¸€ä¸ªçº¿ç¨‹æ± å»ï¼Œæ¯å½“è¯·æ±‚æ¥çš„æ—¶å€™ï¼Œä¾¿ä¼šä»æ± ä¸­åˆ†é…ä¸€ä¸ªthreadæ¥å¤„ç†è¯·æ±‚ã€‚è¿™æ„å‘³ç€ï¼Œè¿™ä¸ªwebç¨‹åºçš„å¹¶å‘èƒ½åŠ›åªèƒ½è¾¾åˆ°çº¿ç¨‹æ± çš„å¤§å°ã€‚å½“ç„¶ä¸ºäº†æé«˜å¹¶å‘èƒ½åŠ›ï¼Œå¯ä»¥å¢åŠ çº¿ç¨‹æ± çš„å¤§å°ã€‚ä½†æ˜¯åœ¨Javaä¸­ä¸€ä¸ªçº¿ç¨‹çš„å¼€é”€æ˜¯æ˜‚è´µçš„ï¼Œé€šå¸¸æ˜¯1MBçš„å†…å­˜æ¶ˆè€—ã€‚æ›´å¤§çš„çº¿ç¨‹æ± å¤§å°ï¼Œåˆ™æ„å‘³ç€æ›´å¤§çš„å†…å­˜ã€‚\né˜»å¡IOæ“ä½œ IOæ“ä½œï¼Œå¦‚æœä¸åšä»»ä½•å¤„ç†ï¼ŒåŠ¿å¿…ä¼šé˜»å¡ï¼Œä¾‹å¦‚æŸ¥è¯¢æ•°æ®åº“ã€RPCè°ƒç”¨å…¶ä»–æœåŠ¡ç­‰ã€‚ä¸€æ—¦å‘èµ·äº†ä¸€ä¸ªIOè¯·æ±‚ï¼ŒæŒç»­ç­‰å¾…ï¼Œç›´åˆ°IOç»“æŸï¼Œè¿™å°±æ˜¯æœ€åŸºç¡€çš„é˜»å¡IO\nå“åº”æ—¶é—´ åœ¨å®é™…çš„åœºæ™¯ä¸­ï¼Œä¸€æ¬¡è¯·æ±‚ä¸­å¯èƒ½æœ‰ä¸æ­¢ä¸€ä¸ªæœåŠ¡è°ƒç”¨é“¾ã€‚ä¾‹å¦‚AæœåŠ¡é™¤äº†è¦è°ƒç”¨Bã€CæœåŠ¡ï¼Œè¿˜éœ€è¦æ“ä½œä¸€æ¬¡æ•°æ®åº“ã€‚å¦‚æœä»€ä¹ˆéƒ½ä¸åšçš„è¯ï¼Œæ„å‘³ç€è¿™æ¬¡è¯·æ±‚èŠ±è´¹çš„æ—¶é—´æ˜¯ä¸‹é¢èŠ±è´¹æ—¶é—´ä¹‹å’Œ\n BæœåŠ¡çš„å“åº”æ—¶é—´ï¼ˆç½‘ç»œå»¶è¿Ÿ+BæœåŠ¡çš„å¤„ç†æ—¶é—´ï¼‰ CæœåŠ¡çš„å“åº”æ—¶é—´ï¼ˆç½‘ç»œå»¶è¿Ÿ+CæœåŠ¡çš„å¤„ç†æ—¶é—´ï¼‰ æ•°æ®çš„å¤„ç†æ—¶é—´ï¼ˆç½‘ç»œå»¶è¿Ÿ+å¤„ç†æ—¶é—´ï¼‰  å¦‚æœæ²¡æœ‰ä¸šåŠ¡é€»è¾‘ä¸Šçš„é¡ºåºï¼Œå¦‚æœæˆ‘ä»¬åœ¨ä»£ç ä¸­å¹¶å‘æ“ä½œçš„è¯ï¼Œé‚£ä¹ˆæ¶ˆè€—çš„æ—¶é—´è‚¯å®šæœ‰æ‰€å‡å°‘ã€‚è™½ç„¶Javaæä¾›å¾ˆå¤šæ–¹ä¾¿çš„å¼‚æ­¥å›è°ƒæ–¹æ³•ï¼Œä¾‹å¦‚CompletableFuturesï¼Œä½†æ˜¯è¿™æå¤§çš„å¢åŠ äº†ä»£ç çš„å¤æ‚æ€§ã€‚æ²¡äººæ„¿æ„æ¯æ¬¡éƒ½è¿™ä¹ˆå¤æ‚ï¼Œå¹¶ä¸”å¹¶ä¸æ˜¯æ¯ä¸ªäººéƒ½ä¼šæƒ³åˆ°ç”¨å¼‚æ­¥çš„ã€‚\nå‹å€’å®¢æˆ·ç«¯ å¾®æœåŠ¡ä¸­å¯èƒ½ä¼šå‡ºç°è¿™æ ·çš„åœºæ™¯ï¼ŒAæœåŠ¡éœ€è¦è°ƒç”¨Bä¸€äº›ä¿¡æ¯ï¼Œä¾‹å¦‚æŸ¥ä¸€ä¸ªæœˆçš„è®¢å•ï¼Œä½†æ˜¯è¿™ä¸ªæ•°æ®éå¸¸åºå¤§ï¼Œå¯¹äºAæœåŠ¡æ¥è¯´ï¼Œä¸€æ¬¡æ€§æ— æ³•å¤„ç†ï¼Œç”šè‡³å¯èƒ½å‡ºç°OOMå¯¼è‡´æœåŠ¡Aç›´æ¥æŒ‚äº†ã€‚\nå°ç»“ æ€»ç»“ä¸Šé¢çš„ä¸€äº›é—®é¢˜èƒ½å‘ç°å“åº”å¼ç¼–ç¨‹èƒ½å¸¦æ¥çš„å¥½å¤„ï¼š\n ä¸ä½¿ç”¨ä¸€ä¸ªçº¿ç¨‹å¤„ç†ä¸€ä¸ªè¯·æ±‚çš„æ¨¡å¼ï¼Œå¯ä»¥ä½¿ç”¨éœ€è¦æ›´å°‘çš„çº¿ç¨‹å¤„ç†æ›´å¤šçš„è¯·æ±‚ é˜²æ­¢çº¿ç¨‹åœ¨è¿›è¡ŒIOæ“ä½œçš„æ—¶å€™è¢«é˜»å¡ èƒ½æœ‰ç®€æ´çš„å¹¶å‘æ“ä½œAPI æä¾›èƒŒå‹æœºåˆ¶ï¼Œbackpressï¼Œé˜²æ­¢å®¢æˆ·ç«¯ç›´æ¥è¢«å‹å®  ä»€ä¹ˆæ˜¯å“åº”å¼ç¼–ç¨‹  â€œIn plain terms reactive programming is about non-blocking applications that are asynchronous and event-driven and require a small number of threads to scale. A key aspect of that definition is the concept of backpressure which is a mechanism to ensure producers donâ€™t overwhelm consumers.â€\n \u0026ldquo;å“åº”å¼\u0026quot;æ˜¯æŒ‡å“åº”å›´ç»•ç€å˜åŒ–çš„ä¸€ç§ç¼–ç¨‹æ¨¡å‹â€”â€”ä¾‹å¦‚ç½‘ç»œç»„ä»¶éšç€IOäº‹ä»¶å˜åŒ–ã€UIæ˜¾ç¤ºéšç€ç”¨æˆ·çš„é¼ æ ‡ç‚¹å‡»è€Œå˜åŒ–ã€‚ä»è¿™ä¸€ç‚¹ä¸Šçœ‹ï¼Œéé˜»å¡å°±æ˜¯å“åº”å¼ã€‚å› ä¸ºä¸åŒäºé˜»å¡å¼ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æ•°æ®å‡†å¤‡å¥½ä¹‹åå¯¹é€šçŸ¥è¿›è¡Œå“åº”ï¼Œè€Œéç­‰å¾…ã€‚\nå¦‚ä½•å®ç° ç®€å•ç‚¹è¯´å°±æ˜¯ï¼Œé€šè¿‡ä½¿ç”¨å¼‚æ­¥æ•°æ®è¿›è¡Œç¼–ç¨‹ã€‚è¿˜æ˜¯AæœåŠ¡æƒ³è¦ä»BæœåŠ¡è·å–æ•°æ®ï¼Œç”¨å“åº”å¼ç¼–ç¨‹çš„æ–¹å¼ï¼ŒæœåŠ¡Aå‘è¯·æ±‚åˆ°Båï¼Œç«‹åˆ»è¿”å›ï¼ˆå³éé˜»å¡å’Œå¼‚æ­¥ï¼‰ã€‚è€Œè¯·æ±‚çš„æ•°æ®å°†ä½œä¸ºAçš„å¼‚æ­¥æ•°æ®æµæä¾›ç»™Aï¼ŒBæœåŠ¡ä¸ºæ¯ä¸ªæ•°æ®éƒ½å‘é€onNext äº‹ä»¶ã€‚å½“æ‰€æœ‰çš„æ•°æ®éƒ½å‘é€å®Œæ¯•çš„æ—¶å€™ï¼Œåˆ™å‘é€ä¸€ä¸ªCompletedäº‹ä»¶ã€‚ä¸€æ—¦æœ‰é”™è¯¯å‘ç”Ÿï¼Œåˆ™å‘é€ä¸€ä¸ªerroräº‹ä»¶ï¼Œå¹¶ä¸”ä¸ä¼šå†ç»§ç»­å‘é€æ•°æ®äº†\nå“åº”å¼ç¼–ç¨‹ä½¿ç”¨å‡½æ•°å¼ç¼–ç¨‹çš„æ ¼å¼ï¼Œå°±è¡ŒStreamAPIï¼Œè¿™ç§æ–¹å¼å¯ä»¥åœ¨æ•°æ®ä¼ è¾“çš„è¿‡ç¨‹ä¸­å°±è¡Œä¿®æ”¹ï¼Œä¸€ä¸ªæ•°æ®æµå¯ä»¥ä½œä¸ºå¦ä¸€ä¸ªçš„è¾“å…¥ï¼Œæ•°æ®æµå¯ä»¥è¢«åˆå¹¶ã€ä¿®æ”¹ã€å’Œè¿‡æ»¤ã€‚\nå“åº”å¼ç³»ç»Ÿ ä¸€ä¸ªå“åº”å¼ç³»ç»Ÿçš„åŸºç¡€å°±æ˜¯å“åº”å¼ç¼–ç¨‹ï¼ŒåŸºäºå“åº”å¼ç¼–ç¨‹çš„ç‰¹æ€§ï¼Œå“åº”å¼ç³»ç»Ÿå¾—å…·å¤‡ä»¥ä¸‹ç‰¹ç‚¹\n åŠæ—¶å“åº” åœ¨å¤±è´¥çš„åœºæ™¯ä¾ç„¶å¯ä»¥å“åº” åœ¨ä¸åŒçš„è´Ÿè½½ä¸‹ï¼Œä¾ç„¶ä¿æŒå“åº” ä¾èµ–å¼‚æ­¥æ¶ˆæ¯ä¼ é€’  èƒŒæ™¯ ReactiveX  2011å¹´å¾®è½¯ä¸º.Netå¼€å‘äº†Reactive Extension libraryã€‚æä¾›äº†ä¸€ä¸ªå¯ä»¥åˆ›å»ºå¼‚æ­¥ã€äº‹ä»¶é©±åŠ¨çš„ç¼–ç¨‹ã€‚å¾ˆå¿«Reactive Extensionåœ¨å…¶ä»–è¯­è¨€å¹³å°ä¹Ÿéƒ½å®Œæˆäº†å®ç°ã€‚Javaã€JavaScriptã€Pythonã€C++ã€Goã€‚è€ŒJavaçš„å®ç°ï¼Œæ˜¯ç”±Nefixåœ¨2014å¹´çš„æ—¶å€™å‘å¸ƒçš„1.0ç‰ˆæœ¬ï¼Œè¿™ä¸ªå®ç°è¢«ç§°ä¸ºReactiveX\n å“åº”å¼æ•°æ®æµçš„å®šä¹‰ éšç€å“åº”å¼çš„å½±å“ï¼ŒJavaå›¢é˜Ÿæå‡ºäº†å“åº”å¼çš„è§„èŒƒã€‚è§„èŒƒå®šä¹‰äº†å¸¦æœ‰èƒŒå‹åŠŸèƒ½çš„ç»„ä»¶ä¹‹é—´å¦‚ä½•äº¤äº’çš„ã€‚Java9é€šè¿‡Flow API.é‡‡ç”¨äº†å“åº”å¼æ•°æ®æµï¼ŒFlowAPiçš„ç›®çš„æ˜¯æä¾›Javaçš„å®ç°æ ‡å‡†ï¼Œè€Œä¸æ˜¯åƒRxJavaè¿™æ ·ï¼Œå®Œå…¨è‡ªå·±å®ç°ã€‚\nå…¶ä¸­å®šä¹‰äº†2ä¸ªæ¥å£\nå‘å¸ƒè€…Publisherï¼š\næ•°æ®çš„æºå¤´æä¾›ä¸€ä¸ªæ–¹æ³•ä¾›è®¢é˜…è€…å»æ³¨å†Œã€‚\npublic interface Publisher\u0026lt;T\u0026gt; { public void subscribe(Subscriber\u0026lt;? super T\u0026gt; s); } è®¢é˜…è€…Subcriberï¼š\npublic interface Subscriber\u0026lt;T\u0026gt; { public void onSubscribe(Subscription s); public void onNext(T t); public void onError(Throwable t); public void onComplete(); }  onSubscribeè¡¨ç¤ºï¼ŒPublisherä¼šå°†è®¢é˜…Subcriptionä¼ ç»™Subcriber onNextè¡¨ç¤ºæ•°æ®æµä¸­æœ‰ä¸€ä¸ªæ–°æ•°æ®ä¼ è¿‡æ¥äº† onErrorè¡¨ç¤ºPublisherå‡ºå¼‚å¸¸äº†ï¼Œå¹¶ä¸”ä¸ä¼šå†ç»§ç»­å‘é€æ•°æ® onCompleteæ„å‘³ç€æ•°æ®å…¨éƒ¨å‘å®Œäº†  è®¢é˜…Subscriptionï¼š\nè®¢é˜…æä¾›äº†æ–¹æ³•å¯ä»¥æ§åˆ¶Publisherä¼ æ•°æ®ï¼Œï¼ˆå³æä¾›äº†èƒŒå‹åŠŸèƒ½ï¼‰\npublic interface Subscription { public void request(long n); public void cancel(); }  requestå…è®¸subscriberæ§åˆ¶æœ‰å¤šå°‘æ•°æ®å°†è¦è¢«å‘é€ cancelå…è®¸subcriberå–æ¶ˆpublisherç»§ç»­å‘é€çš„æ•°æ®  è¿‡ç¨‹Processorï¼š\nå¦‚æœä¸€ä¸ªå®ä½“ï¼ŒæŠŠæ•°æ®æ¥æ”¶äº†ï¼Œå†ä¼ ç»™å¦ä¸€ä¸ªå®ä½“ã€‚é‚£ä¹ˆè¿™å®ä½“æ—¢æ˜¯subcriberä¹Ÿæ˜¯Publisher\npublic interface Processor\u0026lt;T, R\u0026gt; extends Subscriber\u0026lt;T\u0026gt;, Publisher\u0026lt;R\u0026gt; { } Project Reactor Springåœ¨5.0å‘å¸ƒåï¼Œé›†æˆäº†Project Reactoräº†ã€‚\nProject Reactoræ˜¯ä¸€ä¸ªåŸºäºJavaå®šä¹‰çš„å“åº”æ•°æ®æµçš„éé˜»å¡ç¨‹åºã€‚ä»–æ˜¯Springå“åº”å¼ç”Ÿæ€çš„åŸºç¡€ã€‚Webfluxä¾¿æ˜¯åŸºäºä»–è€Œå®ç°çš„ã€‚\nProject ReactoråŒ…å«äº†ä¸€ç³»åˆ—çš„moduleï¼Œæœ€æ ¸å¿ƒçš„module Reactor Coreé‡Œæä¾›äº†Fluxå’ŒMonoï¼Œåˆ†åˆ«å®ç°äº†ä¹‹å‰è¯´çš„JVMå®šä¹‰å“åº”å¼æ•°æ®æµä¸­çš„Publisheræ¥å£ã€‚\nFluxå’ŒMono Fluxå’ŒMonoéƒ½æ˜¯Publisherï¼ŒFluxå®šä¹‰äº†ä¸€ä¸ªä¼šå‘é€0æˆ–Nä¸ªæ•°æ®çš„Publisherï¼Œè€ŒMonoå®šä¹‰äº†ä¼šå‘é€0æˆ–1ä¸ªæ•°æ®çš„Publisherã€‚ä»–ä»¬éƒ½ä¼šè¢«completeå’Œerrorç»ˆæ­¢ï¼Œå¹¶ä¸”ä»–ä»¬éƒ½ä¼šè°ƒç”¨ä¸‹æ¸¸çš„è®¢é˜…è€…çš„onNextã€onCompleteã€onErroræ–¹æ³•ï¼Œé™¤äº†å®ç°JVMå®šä¹‰ä¸ªæ•°æ®æµè§„èŒƒï¼Œä»–ä»¬è¿˜æä¾›äº†ä¸€ç»„å¯ä»¥ä¿®æ”¹æ•°æ®çš„æ“ä½œç¬¦ï¼Œä¾‹å¦‚filterã€mapã€‚\nç®€å•ä½¿ç”¨\n@Test public void test(){ Flux\u0026lt;String\u0026gt; fluxNumber = Flux.just(\u0026#34;1\u0026#34;, \u0026#34;2\u0026#34;, \u0026#34;3\u0026#34;); fluxNumber.subscribe(System.out::println); } justæ–¹æ³•åˆ›å»ºäº†ä¸€ä¸ªFluxä¼šå‘é€æ•°æ®1ï¼Œ2ï¼Œ3 ç›´åˆ°æœ‰äººè®¢é˜…äº†ä»–ï¼Œæˆ‘ä»¬è§¦å‘äº†subscribeæ–¹æ³•ï¼Œç„¶åæ‰ä¼šæ‰“å°æ¯ä¸€ä¸ªè¢«å‘é€çš„æ•°æ®ã€‚Monoä¹Ÿæ˜¯ä¸€æ ·ï¼ŒåŒºåˆ«æ˜¯Monoçš„justæ–¹æ³•åªå…è®¸ä¼ ä¸€ä¸ªå‚æ•°\næ“ä½œç¬¦\næŸ¥çœ‹ä¸€ä¸‹ Flux API ï¼Œå‘ç°å‡ ä¹æ‰€æœ‰çš„æ–¹æ³•è¿”å›å€¼éƒ½æ˜¯Fluxæˆ–è€…Monoï¼Œè¿™æ„å‘³ç€æ“ä½œç¬¦æ˜¯å¯ä»¥é“¾å¼è°ƒç”¨çš„ã€‚æ¯ä¸ªæ“ä½œç¬¦éƒ½æ˜¯å‘fluxæˆ–è€…monoä¸­æ–°å»ºä¸€ä¸ªoperateï¼Œå¹¶å°†ä¸Šä¸€ä¸ªPublisherä½œä¸ºå‚æ•°ä»è€Œç”Ÿæˆçš„æ–°å®ä¾‹ã€‚æ•°æ®ä»æœ€åŸå§‹çš„Publisherä¸æ–­çš„å¾€ä¸‹ä¼ é€ï¼Œé€æ­¥ç»è¿‡æ¯ä¸ªoperateï¼Œæœ€ç»ˆä¸€ä¸ªsubscirberç»“æŸäº†æ•´ä¸ªæµç¨‹ã€‚å¦‚æœæ²¡æœ‰è®¢é˜…è€…è®¢é˜…ï¼Œåˆ™ä¸ä¼šå‘ç”Ÿä»»ä½•äº‹æƒ…ã€‚\npublic void log(){ Flux\u0026lt;String\u0026gt; fluxNumber = Flux.just(\u0026#34;1\u0026#34;, \u0026#34;2\u0026#34;, \u0026#34;3\u0026#34;); fluxNumber.log().subscribe(System.out::println); } logæ“ä½œç¬¦ï¼Œä¼šæ‰“å°å“åº”å¼æ•°æ®æµèƒŒåçš„æ“ä½œç»†èŠ‚\n15:59:42.580 [main] INFO reactor.Flux.Array.1 - | onSubscribe([Synchronous Fuseable] FluxArray.ArraySubscription) 15:59:42.581 [main] INFO reactor.Flux.Array.1 - | request(unbounded) 15:59:42.582 [main] INFO reactor.Flux.Array.1 - | onNext(1) 1 15:59:42.582 [main] INFO reactor.Flux.Array.1 - | onNext(2) 2 15:59:42.582 [main] INFO reactor.Flux.Array.1 - | onNext(3) 3 15:59:42.582 [main] INFO reactor.Flux.Array.1 - | onComplete()   å¸¸è§çš„æ“ä½œç¬¦\n   OPERATOR CATEGORY EXAMPLES     Creating a new sequence just, fromArray, fromIterable, fromStream   Transforming an existing sequence map, flatMap, startWith, concatWith   Peeking into a sequence doOnNext, doOnComplete, doOnError, doOnCancel   Filtering a sequence filter, ignoreElements, distinct, elementAt, takeLast   Handling errors onErrorReturn, onErrorResume, retry   Working with time elapsed, interval, timestamp, timeout   Splitting a Flux buffer, groupBy, window   Going back to the synchronous world block, blockFirst, blockLast, toIterable, toStream   Multicasting a Flux to several Subscribers publish, cache, replay      map\n@Test void mapExample() { Flux\u0026lt;String\u0026gt; fluxColors = Flux.just(\u0026#34;red\u0026#34;, \u0026#34;green\u0026#34;, \u0026#34;blue\u0026#34;); fluxColors.map(color -\u0026gt; color.charAt(0)).subscribe(System.out::println); }   zip\n@Test void zipExample() { Flux\u0026lt;String\u0026gt; fluxFruits = Flux.just(\u0026#34;apple\u0026#34;, \u0026#34;pear\u0026#34;, \u0026#34;plum\u0026#34;); Flux\u0026lt;String\u0026gt; fluxColors = Flux.just(\u0026#34;red\u0026#34;, \u0026#34;green\u0026#34;, \u0026#34;blue\u0026#34;); Flux\u0026lt;Integer\u0026gt; fluxAmounts = Flux.just(10, 20, 30); Flux.zip(fluxFruits, fluxColors, fluxAmounts).subscribe(System.out::println); }   errorå¤„ç†\n@Test public void onErrorExample() { Flux\u0026lt;String\u0026gt; fluxCalc = Flux.just(-1, 0, 1) .map(i -\u0026gt; \u0026#34;10 / \u0026#34; + i + \u0026#34; = \u0026#34; + (10 / i)); fluxCalc.subscribe(value -\u0026gt; System.out.println(\u0026#34;Next: \u0026#34; + value), error -\u0026gt; System.err.println(\u0026#34;Error: \u0026#34; + error)); } Next: 10 / -1 = -10 Error: java.lang.ArithmeticException: / by zero   onErrorReturnå¯ä»¥ç”¨æ¥å¤„ç†ï¼Œoperateä¸­é—´å‘ç”Ÿçš„å¼‚å¸¸\n@Test public void onErrorReturnExample() { Flux\u0026lt;String\u0026gt; fluxCalc = Flux.just(-1, 0, 1) .map(i -\u0026gt; \u0026#34;10 / \u0026#34; + i + \u0026#34; = \u0026#34; + (10 / i)) .onErrorReturn(ArithmeticException.class, \u0026#34;Division by 0 not allowed\u0026#34;); fluxCalc.subscribe(value -\u0026gt; System.out.println(\u0026#34;Next: \u0026#34; + value), error -\u0026gt; System.err.println(\u0026#34;Error: \u0026#34; + error)); } é€šå¸¸å¯ä»¥ä½¿ç”¨onErrorReturnæ¥å¤„ç†å¼‚å¸¸ï¼Œä½†æ˜¯å¦‚æœä½ æƒ³å†å‘ç”Ÿå¼‚å¸¸æ—¶ï¼Œå†å‘é€å…¶ä»–çš„æ•°æ®è€Œéæ˜¯é»˜è®¤çš„æ•°æ®ã€‚åˆ™å¯ä»¥ä½¿ç”¨onErrorResumeæ–¹æ³•\n@Test public void onErrorResumeExample() { Flux\u0026lt;String\u0026gt; fluxCalc = Flux.just(-1, 0, 1) .map(i -\u0026gt; \u0026#34;10 / \u0026#34; + i + \u0026#34; = \u0026#34; + (10 / i)) .onErrorResume((err-\u0026gt;{ if (err instanceof ArithmeticException){ return Flux.just(\u0026#34;110\u0026#34;,\u0026#34;112\u0026#34;); } return Mono.just(\u0026#34;119\u0026#34;); })); fluxCalc.subscribe(value -\u0026gt; System.out.println(\u0026#34;Next: \u0026#34; + value), error -\u0026gt; System.err.println(\u0026#34;Error: \u0026#34; + error)); } Next: 10 / -1 = -10 Next: 110 Next: 112   æµ‹è¯•\nProject Reactoræä¾›äº†testçš„module\n@Test public void stepVerifierTest() { Flux\u0026lt;String\u0026gt; fluxCalc = Flux.just(-1, 0, 1) .map(i -\u0026gt; \u0026#34;10 / \u0026#34; + i + \u0026#34; = \u0026#34; + (10 / i)); StepVerifier.create(fluxCalc) .expectNextCount(1) .expectError(ArithmeticException.class) .verify(); }   ","permalink":"https://sunhao1256.github.io/posts/reactor/","summary":"Reactive Programming å“åº”å¼ç¼–ç¨‹ ä¸ºä»€ä¹ˆè¦å“åº”å¼ç¼–ç¨‹ ä¼ ç»Ÿçš„ç¼–ç¨‹æ¨¡å¼åº”å¯¹å¦‚ä»Šé«˜å¹¶å‘ï¼Œé«˜å“åº”çš„éœ€æ±‚æœ‰å¾ˆå¤šé™åˆ¶ã€‚ç°åœ¨çš„webåº”ç”¨ï¼Œè¶Šæ¥è¶Šéœ€è¦æ›´é«˜çš„å¹¶å‘ï¼Œæ›´å¿«çš„å“åº”ã€‚\næ¯ä¸ªè¯·æ±‚éƒ½éœ€è¦ä¸€ä¸ªçº¿ç¨‹ ä¼ ç»Ÿçš„webè¯·æ±‚ï¼Œæ¯ä¸ªè¯·æ±‚éƒ½æ˜¯ä½¿ç”¨å•ä¸ªçº¿ç¨‹è´¯ç©¿æ•´ä¸ªæµç¨‹ã€‚å¦‚æœæˆ‘ä»¬ç”¨Springçš„ç”Ÿæ€ï¼Œå¯¹äºçš„å°±æ˜¯SpringMvcæ¡†æ¶ã€‚åŸºäºservletå®¹å™¨ï¼Œä¾‹å¦‚tomcatã€‚è€Œtomcatå†…éƒ¨ä¼šç»´æŠ¤ä¸€ä¸ªçº¿ç¨‹æ± å»ï¼Œæ¯å½“è¯·æ±‚æ¥çš„æ—¶å€™ï¼Œä¾¿ä¼šä»æ± ä¸­åˆ†é…ä¸€ä¸ªthreadæ¥å¤„ç†è¯·æ±‚ã€‚è¿™æ„å‘³ç€ï¼Œè¿™ä¸ªwebç¨‹åºçš„å¹¶å‘èƒ½åŠ›åªèƒ½è¾¾åˆ°çº¿ç¨‹æ± çš„å¤§å°ã€‚å½“ç„¶ä¸ºäº†æé«˜å¹¶å‘èƒ½åŠ›ï¼Œå¯ä»¥å¢åŠ çº¿ç¨‹æ± çš„å¤§å°ã€‚ä½†æ˜¯åœ¨Javaä¸­ä¸€ä¸ªçº¿ç¨‹çš„å¼€é”€æ˜¯æ˜‚è´µçš„ï¼Œé€šå¸¸æ˜¯1MBçš„å†…å­˜æ¶ˆè€—ã€‚æ›´å¤§çš„çº¿ç¨‹æ± å¤§å°ï¼Œåˆ™æ„å‘³ç€æ›´å¤§çš„å†…å­˜ã€‚\né˜»å¡IOæ“ä½œ IOæ“ä½œï¼Œå¦‚æœä¸åšä»»ä½•å¤„ç†ï¼ŒåŠ¿å¿…ä¼šé˜»å¡ï¼Œä¾‹å¦‚æŸ¥è¯¢æ•°æ®åº“ã€RPCè°ƒç”¨å…¶ä»–æœåŠ¡ç­‰ã€‚ä¸€æ—¦å‘èµ·äº†ä¸€ä¸ªIOè¯·æ±‚ï¼ŒæŒç»­ç­‰å¾…ï¼Œç›´åˆ°IOç»“æŸï¼Œè¿™å°±æ˜¯æœ€åŸºç¡€çš„é˜»å¡IO\nå“åº”æ—¶é—´ åœ¨å®é™…çš„åœºæ™¯ä¸­ï¼Œä¸€æ¬¡è¯·æ±‚ä¸­å¯èƒ½æœ‰ä¸æ­¢ä¸€ä¸ªæœåŠ¡è°ƒç”¨é“¾ã€‚ä¾‹å¦‚AæœåŠ¡é™¤äº†è¦è°ƒç”¨Bã€CæœåŠ¡ï¼Œè¿˜éœ€è¦æ“ä½œä¸€æ¬¡æ•°æ®åº“ã€‚å¦‚æœä»€ä¹ˆéƒ½ä¸åšçš„è¯ï¼Œæ„å‘³ç€è¿™æ¬¡è¯·æ±‚èŠ±è´¹çš„æ—¶é—´æ˜¯ä¸‹é¢èŠ±è´¹æ—¶é—´ä¹‹å’Œ\n BæœåŠ¡çš„å“åº”æ—¶é—´ï¼ˆç½‘ç»œå»¶è¿Ÿ+BæœåŠ¡çš„å¤„ç†æ—¶é—´ï¼‰ CæœåŠ¡çš„å“åº”æ—¶é—´ï¼ˆç½‘ç»œå»¶è¿Ÿ+CæœåŠ¡çš„å¤„ç†æ—¶é—´ï¼‰ æ•°æ®çš„å¤„ç†æ—¶é—´ï¼ˆç½‘ç»œå»¶è¿Ÿ+å¤„ç†æ—¶é—´ï¼‰  å¦‚æœæ²¡æœ‰ä¸šåŠ¡é€»è¾‘ä¸Šçš„é¡ºåºï¼Œå¦‚æœæˆ‘ä»¬åœ¨ä»£ç ä¸­å¹¶å‘æ“ä½œçš„è¯ï¼Œé‚£ä¹ˆæ¶ˆè€—çš„æ—¶é—´è‚¯å®šæœ‰æ‰€å‡å°‘ã€‚è™½ç„¶Javaæä¾›å¾ˆå¤šæ–¹ä¾¿çš„å¼‚æ­¥å›è°ƒæ–¹æ³•ï¼Œä¾‹å¦‚CompletableFuturesï¼Œä½†æ˜¯è¿™æå¤§çš„å¢åŠ äº†ä»£ç çš„å¤æ‚æ€§ã€‚æ²¡äººæ„¿æ„æ¯æ¬¡éƒ½è¿™ä¹ˆå¤æ‚ï¼Œå¹¶ä¸”å¹¶ä¸æ˜¯æ¯ä¸ªäººéƒ½ä¼šæƒ³åˆ°ç”¨å¼‚æ­¥çš„ã€‚\nå‹å€’å®¢æˆ·ç«¯ å¾®æœåŠ¡ä¸­å¯èƒ½ä¼šå‡ºç°è¿™æ ·çš„åœºæ™¯ï¼ŒAæœåŠ¡éœ€è¦è°ƒç”¨Bä¸€äº›ä¿¡æ¯ï¼Œä¾‹å¦‚æŸ¥ä¸€ä¸ªæœˆçš„è®¢å•ï¼Œä½†æ˜¯è¿™ä¸ªæ•°æ®éå¸¸åºå¤§ï¼Œå¯¹äºAæœåŠ¡æ¥è¯´ï¼Œä¸€æ¬¡æ€§æ— æ³•å¤„ç†ï¼Œç”šè‡³å¯èƒ½å‡ºç°OOMå¯¼è‡´æœåŠ¡Aç›´æ¥æŒ‚äº†ã€‚\nå°ç»“ æ€»ç»“ä¸Šé¢çš„ä¸€äº›é—®é¢˜èƒ½å‘ç°å“åº”å¼ç¼–ç¨‹èƒ½å¸¦æ¥çš„å¥½å¤„ï¼š\n ä¸ä½¿ç”¨ä¸€ä¸ªçº¿ç¨‹å¤„ç†ä¸€ä¸ªè¯·æ±‚çš„æ¨¡å¼ï¼Œå¯ä»¥ä½¿ç”¨éœ€è¦æ›´å°‘çš„çº¿ç¨‹å¤„ç†æ›´å¤šçš„è¯·æ±‚ é˜²æ­¢çº¿ç¨‹åœ¨è¿›è¡ŒIOæ“ä½œçš„æ—¶å€™è¢«é˜»å¡ èƒ½æœ‰ç®€æ´çš„å¹¶å‘æ“ä½œAPI æä¾›èƒŒå‹æœºåˆ¶ï¼Œbackpressï¼Œé˜²æ­¢å®¢æˆ·ç«¯ç›´æ¥è¢«å‹å®  ä»€ä¹ˆæ˜¯å“åº”å¼ç¼–ç¨‹  â€œIn plain terms reactive programming is about non-blocking applications that are asynchronous and event-driven and require a small number of threads to scale. A key aspect of that definition is the concept of backpressure which is a mechanism to ensure producers donâ€™t overwhelm consumers.","title":"Reactorå“åº”å¼ç¼–ç¨‹"},{"content":"@Override\r@Nullable\rpublic Object invoke(MethodInvocation mi) throws Throwable {\rif (!(mi instanceof ProxyMethodInvocation)) {\rthrow new IllegalStateException(\u0026quot;MethodInvocation is not a Spring ProxyMethodInvocation: \u0026quot; + mi);\r}\rProxyMethodInvocation pmi = (ProxyMethodInvocation) mi;\rProceedingJoinPoint pjp = lazyGetProceedingJoinPoint(pmi);\rJoinPointMatch jpm = getJoinPointMatch(pmi);\rreturn invokeAdviceMethod(pjp, jpm, null, null);\r}\rå½“åœ¨Spingä¸­é…ç½®çš„Beanå­˜åœ¨ç›¸äº’ä¾èµ–ï¼ŒSpringæ˜¯æ€ä¹ˆå¤„ç†çš„ é’ˆå¯¹åŸå‹Beanç›´æ¥æŠ›å‡ºå¼‚å¸¸ï¼Œä¸æ”¯æŒã€‚\nå•ä¾‹Beanï¼ŒSpringä½¿ç”¨3ä¸ªMapåšç¼“å­˜ï¼Œæ¥å¤„ç†ã€‚\nåˆ†åˆ«æ˜¯ï¼šä¸€çº§ç¼“å­˜Springæœ€ç»ˆä¿å­˜çš„å•ä¾‹å¯¹è±¡Mapï¼ŒäºŒçº§ç¼“å­˜å»ºé€ Springå•ä¾‹å¯¹è±¡çš„åŒ¿åå·¥å‚å¯¹è±¡è¿”å›çš„å°±æ˜¯ä¸‰çº§ç¼“å­˜éœ€è¦çš„ï¼Œä¸‰çº§ç¼“å­˜æ˜¯å…è®¸æå‰è¢«ä¾èµ–çš„å•ä¾‹å¯¹è±¡ã€‚\né˜è¿°ä¸€ä¸ªBeanè·å–çš„æµç¨‹  å°è¯•è·å–å•ä¾‹Bean æ£€æŸ¥ä¸€çº§ç¼“å­˜æ˜¯å¦æœ‰ï¼Œæ²¡æœ‰çš„è¯ï¼Œæ£€æŸ¥å½“å‰è·å–çš„Beanæ˜¯å¦æ­£åœ¨åˆ›å»ºï¼Œå¦‚æœæ­£åœ¨åˆ›å»ºå³å‡ºç°äº†Beanäº’ç›¸ä¾èµ–æƒ…å†µï¼Œæ£€æŸ¥ä¸‰çº§ç¼“å­˜æ˜¯å¦å·²ç»æœ‰æå‰å¯è¢«ä¾èµ–çš„å¯¹è±¡ï¼Œå¦‚æœæ²¡æœ‰çš„è¯ï¼Œæ£€æŸ¥äºŒçº§ç¼“å­˜æ˜¯å¦æœ‰å…¶å·¥å‚ï¼Œæœ‰çš„è¯ï¼Œä½¿ç”¨å·¥å‚ï¼Œå®ä¾‹åŒ–è¿™ä¸ªBeanï¼Œæ”¾å…¥ä¸‰çº§ç¼“å­˜é‡Œã€‚ä¾›å…¶ä»–Beanä¾èµ–ä½¿ç”¨ æ²¡è·å–åˆ°ï¼Œå¯èƒ½æ˜¯åŸå‹Beanï¼Œä¹Ÿå¯èƒ½æ˜¯å•ä¾‹Beanæ²¡æœ‰å®ä¾‹åŒ– æ£€æŸ¥å¦‚æœæ˜¯åŸå‹Beanï¼Œè€Œä¸”æ­£åœ¨åˆ›å»ºä¸­ï¼Œå³å‡ºç°äº†åŸå‹Beanè¢«ä¾èµ–çš„æƒ…å†µï¼Œç›´æ¥æŠ›å‡ºå¼‚å¸¸ å‡†å¤‡BeanDefinitionï¼Œå¦‚æœæ¡£æœŸå·¥å‚æ²¡æœ‰ç›¸åº”çš„BDï¼Œè€Œä¸”çˆ¶å·¥å‚åˆå­˜åœ¨BDï¼Œä½¿ç”¨çˆ¶å·¥å‚çš„getBeanæ–¹æ³•å»è·å–Bean æ ‡è®°Beanåˆ›å»ºè¿‡äº† ä»å½“å‰å·¥å‚è¯»å–BD,å¹¶ä¸”è½¬ä¸ºRootBeanDefinitionï¼Œè·å–æœŸé—´ï¼Œè¿˜è¦æ£€æŸ¥çˆ¶å·¥å‚æ˜¯å¦ä¹Ÿæœ‰è¯¥Beançš„BDï¼Œæœ‰çš„è¯ï¼Œä»¥çˆ¶å·¥å‚å¾—BDä¸ºåŸºç¡€ï¼Œå­å·¥å‚å¾—BDè¦†ç›–æ‰å…¶å±æ€§ æ£€æŸ¥BDæ˜¯ä¸æ˜¯æŠ½è±¡çš„ï¼Œæ— æ³•å®ä¾‹åŒ–çš„ç±»ï¼ŒæŠ›å‡ºå¼‚å¸¸ æ£€æŸ¥BDä¸­å¾—DependsOnå±æ€§ï¼Œé’ˆå¯¹æ‰€æœ‰Dependï¼Œå¾ªç¯å®ä¾‹åŒ–ï¼Œå¦‚æœæ£€æŸ¥åˆ°æœ‰Dependå¾—Beanåˆä¾èµ–äºå½“å‰ç›®æ ‡Beanï¼ŒæŠ›å‡ºå¼‚å¸¸ï¼Œäº’ç›¸æå‰ä¾èµ–äº†ã€‚å¹¶ä¸”å»ºç«‹ç›¸å…³å…³ç³»ï¼Œæ‰€ä»¥DependOnæ„ä¹‰æ˜¯ï¼Œä¾èµ–äºä¸€ä¸ªå®Œå…¨å®ä¾‹åŒ–å®Œæˆåçš„Bean å¦‚æœæ˜¯å•ä¾‹çš„è¯ï¼Œå¼€å§‹åˆ›å»ºå•ä¾‹Beanï¼Œåˆ›å»ºåŒ¿åå·¥å‚å¯¹è±¡ æ ‡è®°å•ä¾‹Beanæ­£åœ¨è¢«åˆ›å»º ä½¿ç”¨å·¥å‚å¯¹è±¡å»è°ƒç”¨getObjectæ–¹æ³• å®é™…ä¸Šæ‰§è¡Œäº†createBeanæ–¹æ³• æ ¹æ®ä¹‹å‰çš„RootBDï¼Œè§£æå‡ºéœ€è¦å®ä¾‹åŒ–çš„Classå¯¹è±¡ æ£€æŸ¥MethodOverridesç›®æ ‡æ–¹æ³•æ˜¯å¦å­˜åœ¨Classå¯¹è±¡ä¸­ åœ¨å®ä¾‹åŒ–å¯¹è±¡ä¹‹å‰ï¼Œç»™InstantiationAwareBeanPostProcessoræœºä¼šå»æ”¹å˜å®ä¾‹ï¼Œè°ƒç”¨å…¶postProcessBeforeInstantiationï¼ŒAOPå°±æ˜¯åœ¨è¿™é‡Œå®ç°çš„ï¼Œæ­¤å¤–ï¼Œå¦‚æœè¿”å›äº†ï¼Œè¿˜ä¼šè°ƒç”¨BPPçš„postProcessAfterInitializationï¼Œä½†ä¸ä¼šè°ƒç”¨postProcessBeforeInitializationäº† å¦‚æœæ²¡æœ‰è¢«InstantiationAwareBeanPostProcessoræ”¹å˜äº†çš„è¯ï¼Œå¼€å§‹è¿›å…¥çœŸæ­£çš„å®ä¾‹åŒ–æ–¹æ³• å®ä¾‹åŒ–ä¸€ä¸ªBeanWrapperImplå»å°è£…å®ä¾‹ è§£æClasså¯¹è±¡ï¼Œç¡®å®šClasså¯¹è±¡æœ‰Publicä¿®é¥°ç¬¦ å¦‚æœæœ‰FactoryMethodçš„è¯ï¼Œç›´æ¥è°ƒç”¨FactoryMethodè¿”å›å®ä¾‹ï¼Œå°è£…åœ¨BeanWrapperImplï¼Œè¿™é‡Œé¢ä¹Ÿä¼šåˆå§‹åŒ–initBeanWrapperï¼Œå°†å±æ€§ç¼–è¾‘å™¨æ³¨å…¥åˆ°BeanWrapperImplèº«ä¸Šï¼Œç”¨äºåç»­çš„å±æ€§æ³¨å…¥ å¼€å§‹è§£ææ„é€ å‡½æ•°æˆ–è€…æ˜¯FactoryMethodï¼Œå¦‚æœè§£æè¿‡äº†ï¼Œç›´æ¥å»å®ä¾‹åŒ– å¦åˆ™è¿›å…¥æ„é€ å‡½æ•°è§£æ è§£æä¹‹å‰ï¼Œçœ‹BPPæœ‰æ²¡æœ‰æä¾›äº†æ„é€ å‡½æ•°ï¼Œå³SmartInstantiationAwareBeanPostProcessorçš„determineCandidateConstructorsæ–¹æ³•æ‰§è¡Œï¼Œå¦‚æœè¿”å›äº†æ„é€ å‡½æ•°ï¼Œå°±ç”¨BPPçš„äº†ã€‚ æ²¡æœ‰çš„è¯ï¼Œè¿›å…¥é»˜è®¤çš„è§£æï¼Œä¾èµ–å…ˆçœ‹ç¼“å­˜é‡Œæœ‰æ²¡æœ‰è§£æè¿‡çš„å‚æ•°ï¼Œå› ä¸ºæ„é€ æ–¹æ³•æ³¨å…¥çš„è¯ï¼Œå¾ˆæ¶ˆè€—æ€§èƒ½ï¼Œæ²¡æœ‰ç¼“å­˜çš„è¯ï¼Œå…ˆçœ‹ç”¨æˆ·è·å–beanæ—¶æœ‰æ²¡æœ‰ä¼ å…¥argsï¼Œå³æ„é€ å‡½æ•°çš„å‚æ•°ã€‚æ²¡æœ‰çš„è¯ï¼Œè€Œä¸”åªæœ‰ä¸€ä¸ªå€™é€‰çš„æ„é€ å‡½æ•°ï¼Œå°±ç›´æ¥ç”¨ä½¿ç”¨æ— å‚çš„äº†ï¼Œæ²¡æœ‰çš„è¯ï¼Œå…ˆå»è§£æå‚æ•°ï¼Œconstruct-argï¼Œæ—¢å¯ä»¥æ—¶Indexï¼Œä¹Ÿå¯ä»¥æ˜¯nameã€‚æ ¹æ®ç”¨æˆ·ä¼ å…¥çš„argé•¿åº¦ï¼Œå»è§£æã€‚ æœ€åè§£æå®Œæˆåï¼Œä½¿ç”¨å®ä¾‹åŒ–ç­–ç•¥å»å®ä¾‹åŒ–å³å¯ï¼Œè¿™é‡Œä¹Ÿå¯ä½¿ç”¨cglibå»å¤„ç†ï¼Œç„¶åå°è£…åœ¨BeanWrapperImplä¸­ è‡³æ­¤ï¼ŒBeanWapperé‡Œå·²ç»åŒ…å«äº†æˆ‘ä»¬çš„ç›®æ ‡å¯¹è±¡çš„å®ä¾‹äº† ç„¶ååˆ›å»ºäºŒçº§ç¼“å­˜ï¼Œå°†ä¸Šä¸€æ­¥BeanWapperé‡Œçš„å®ä¾‹ï¼Œä½œä¸ºäºŒçº§ç¼“å­˜è¿”å›çš„å¯¹è±¡ï¼ŒåŠ è½½ç¼“å­˜é‡Œ è‡³æ­¤ï¼ŒäºŒçº§ç¼“å­˜çš„å·¥å‚åŠ å…¥ äº†ã€‚å½“åœ¨ä¸€å¼€å§‹è·beanï¼Œä¸€çº§è·å–ä¸åˆ°ï¼Œè·å–äºŒçº§æœ‰å·¥å‚çš„æ—¶å€™ï¼Œå°±ä¼šæŠŠBeanWapperçš„å®ä¾‹æš´éœ²å‡ºå»ï¼Œä¾›åç»­ä½¿ç”¨ ç„¶åå¼€å§‹åˆå§‹åŒ–å®ä¾‹ å°†ä¸Šé¢æš´éœ²å‡ºæ¥çš„ç¤ºä¾‹è¿›è¡Œå±æ€§æ³¨å…¥ ç»™InstantiationAwareBeanPostProcessorçš„postProcessAfterInstantiationåœ¨å±æ€§æ³¨å…¥ä¹‹å‰æœ€åä¸€æ¬¡æœºä¼šï¼Œå»æ”¹å˜Beanï¼Œå¹¶ä¸”é˜»æ­¢Beançš„å±æ€§æ³¨å…¥ åˆ¤æ–­å±æ€§æ³¨å…¥çš„æ˜¯byNameè¿˜æ˜¯byTypeï¼Œé’ˆå¯¹æ‰€æœ‰çš„éç®€å•çš„å±æ€§ï¼Œè¿˜æœ‰æ’é™¤æ‰€æœ‰çš„ignoredDependencyInterfacesä¸­çš„æ¥å£ã€‚è¿›è¡ŒgetBeanæ“ä½œï¼Œä¿å­˜åˆ°PropertyValuesä¸­ ä½¿ç”¨InstantiationAwareBeanPostProcessorçš„postProcessPropertiesï¼Œå¯ä»¥è¿›è¡Œä¿®æ”¹å±æ€§ã€‚ç»§ç»­ä½¿ç”¨postProcessPropertyValuesï¼Œç»§ç»­å¯ä»¥æ›´è¯¥å±æ€§ å¾—åˆ°æ‰€æœ‰å±æ€§åï¼Œåº”ç”¨å±æ€§åˆ°Beanå®ä¾‹èº«ä¸Šï¼Œåœ¨åº”ç”¨å±æ€§çš„æ—¶å€™ï¼Œä¼šæ‰¾åˆ°å‰å·¥å‚é‡Œçš„æ‰€æœ‰çš„TypeConverterå»å°†å±æ€§å˜ä¸ºéœ€è¦çš„å±æ€§ï¼Œå¦‚æœå˜ä¸æˆä¼šæŠ¥é”™ è‡³æ­¤ï¼Œå±æ€§èµ‹å€¼å®Œæ¯• å¤åˆ¶å®Œæ¯•åï¼Œå¼€å§‹åˆå§‹åŒ–Beanï¼Œå…ˆæ¿€æ´»æ‰€æœ‰çš„awareæ–¹æ³•ï¼Œ è°ƒç”¨BPPçš„postProcessBeforeInitializationåˆå§‹åŒ–ä¹‹å‰æ–¹æ³•ï¼Œè®°ä½ï¼Œè¿™é‡Œçš„åˆå§‹åŒ–ï¼Œæ˜¯Beanå·²ç»å®ä¾‹åŒ–ä¹‹åçš„äº‹æƒ…äº†ï¼Œæ˜¯æ‰§è¡Œå…¶ä»–äº‹æƒ…çš„åˆå§‹åŒ– æ‰§è¡ŒafterPropertiesSetæ–¹æ³•ï¼Œåœ¨æ‰§è¡Œinit-methodsæ–¹æ³• è°ƒç”¨BPPçš„postProcessAfterInitializationåˆå§‹åŒ–ä»¥åæ–¹æ³• è‡³æ­¤è¿”å›æš´éœ²çš„beanï¼Œå³getBeanç»“æŸ æœ€åå¤„ç†é”€æ¯çš„æ–¹æ³•ï¼Œå³å‡ºå‘destory-methodçš„æ–¹æ³•  Springæ˜¯å¦‚ä½•å¤„ç†æ‰å¾ªç¯ä¾èµ–çš„  é’ˆå¯¹éå•ä¾‹Beanå‡ºç°å¾ªç¯ä¾èµ–ç›´æ¥æŠ›å‡ºå¼‚å¸¸ å•ä¾‹Bean Springå­˜åœ¨3ä¸ªç¼“å­˜Map  Springå®Œå…¨ç”Ÿæˆå¥½çš„BeanMapï¼Œkeyæ˜¯Beançš„nameï¼ŒValueæ˜¯å®ä¾‹å¯¹è±¡ Springç”ŸæˆBeançš„å·¥å‚Mapï¼Œkeyæ˜¯Beançš„nameï¼Œvalueæ˜¯å®ç°äº†ObjectFactoryæ¥å£çš„å®ä¾‹å¯¹è±¡ Springå°šæœªåˆå§‹åŒ–ï¼Œå³èµ‹äºˆå±æ€§æˆ–è€…å…¶ä»–åˆå§‹åŒ–åŠ¨ä½œçš„Beanå®ä¾‹Mapï¼Œkeyæ˜¯Beançš„nameï¼Œvalueæ˜¯å·¥å‚mapçš„å·¥å‚çš„è¿”å›å€¼ï¼Œå³ObjectFactoryçš„getObjectæ–¹æ³•ç»“æœ   å‡è®¾å­˜åœ¨å¯¹è±¡Aä¾èµ–äºå¯¹è±¡Bï¼Œå¯¹è±¡Beanä¾èµ–äºå¯¹è±¡A  Springæ ¹æ®Açš„nameï¼Œé¦–å…ˆå–BeanMapé‡Œæ‰¾æ˜¯å¦æœ‰Açš„å®ä¾‹ï¼Œæ²¡æœ‰çš„è¯ï¼Œæ£€æŸ¥Aæ˜¯å¦æ­£åœ¨åˆ›å»ºï¼Œå¦‚æœæ­£åœ¨åˆ›å»ºï¼Œåˆ™è¯´æ˜å‡ºç°äº†å¾ªç¯ä¾èµ–ã€‚ï¼ˆéœ€è¦è·å–Aï¼Œå‘ç°Aåˆåœ¨åˆ›å»ºï¼Œè¡¨åæœ‰å…¶ä»–beanéœ€è¦Aï¼‰ï¼Œå°è¯•ä»å¯æå‰ä¾èµ–çš„BeanMapè·å–EarlyBeanReferenceï¼Œå¦‚æœæ²¡æœ‰ï¼Œåˆ™å°è¯•ä»å·¥å‚Mapé‡Œæ‰¾Aå¯¹åº”çš„å·¥å‚å¯¹è±¡ï¼Œå¦‚æœæœ‰å·¥å‚å¯¹è±¡ï¼Œåˆ™è°ƒç”¨å·¥å‚å¯¹è±¡è¿›è¡Œè¿”å›ï¼Œå¹¶ä¸”å°†å·¥å‚è¿”å›çš„Beanå®ä¾‹ä½œä¸ºEarlyBeanReferenceï¼Œæ”¾å…¥æœªå®Œå…¨å®ä¾‹åŒ–ç»“æŸBeanMapé‡Œï¼Œåˆ é™¤å·¥å‚Mapå¯¹åº”çš„valueã€‚æ­¤æ—¶å·¥å‚Mapä¸ºç©ºã€‚ æ­¤æ—¶ï¼ŒAæ²¡æœ‰æ­£åœ¨åˆ›å»ºï¼Œç»§ç»­ æ ‡è®°Aæ­£åœ¨åˆ›å»ºï¼Œæ ¹ç»BeanDefinitionç”ŸæˆBeanå®ä¾‹å¯¹è±¡ï¼Œï¼ˆæ­¤æ—¶å¯¹è±¡å®ä¾‹å·²ç»ç”Ÿæˆå®Œæ¯•ï¼Œä½†æ˜¯è¿˜æ²¡æœ‰åˆå§‹åŒ–ï¼‰ï¼Œå¹¶ä¸”æŠŠAçš„åˆ›å»ºå·¥å‚ï¼Œæ”¾å…¥å·¥å‚Mapï¼Œè€Œè¿™ä¸ªåˆ›å»ºå·¥å‚getObjectè¿”å›å€¼å°±æ˜¯åˆšæ‰ç”Ÿæˆçš„å®ä¾‹å¯¹è±¡ï¼Œå¹¶ä¸”ç»™SmartInstantiationAwareBeanPostProcessoræ¥å£æœºä¼šå–æ”¹å˜è¿™ä¸ªEarlyBeanReferenceå¯¹è±¡ã€‚ å¾—åˆ°å®ä¾‹åŒ–åçš„Aå¯¹è±¡ï¼Œå¼€å§‹æ³¨å…¥Açš„å±æ€§ï¼Œå‘ç°Açš„å±æ€§bï¼Œéœ€è¦Bå¯¹è±¡ã€‚ Bå¯¹è±¡å¼€å§‹è·å–ï¼ˆæ­¤æ—¶ï¼ŒAè¿˜æ²¡æœ‰ç»“æŸï¼Œå³ä¸€çº§ç¼“å­˜ä¸­æ²¡æœ‰Aï¼ŒäºŒçº§ç¼“å­˜ä¸­æœ‰Açš„å·¥å‚Mapï¼‰ Bçš„è·å–å¦‚ä¸Šè¿°ä¸€è‡´ï¼Œ ç›´è‡³Bå®ä¾‹åŒ–ç»“æŸï¼Œå¼€å§‹æ³¨å…¥Bçš„å±æ€§ï¼Œå‘ç°Bçš„å±æ€§aï¼Œéœ€è¦Aå¯¹è±¡ åˆåˆ°äº†Aå¯¹è±¡å¼€å§‹è·å– æ­¤æ—¶ï¼Œè¿›å…¥ç¬¬ä¸€ä¸ªæµç¨‹ï¼Œå‘ç°ä¸€çº§ç¼“å­˜é‡Œæ²¡æœ‰Aï¼Œè€ŒAåˆæ­£åœ¨åˆ›å»ºä¸­ï¼Œå‡ºç°å¾ªç¯ä¾èµ–ï¼Œå»äºŒçº§ç¼“å­˜é‡Œæ‰¾Açš„å·¥å‚Mapï¼Œè°ƒç”¨å·¥å‚Mapæ–¹æ³•å»ï¼Œå¾—åˆ°äº†EarlyBeanReferenceï¼Œæ”¾å…¥ä¸‰çº§ç¼“å­˜é‡Œï¼Œè¿”å›å›å» å³æ­¤æ—¶ï¼ŒBæ³¨å…¥å±æ€§æˆåŠŸï¼Œå¹¶ä¸”è¿”å›äº†ä¸€ä¸ªEarlyBeanReferenceï¼Œå³å½“å‰æ­£åœ¨åˆ›å»ºçš„Aå¯¹è±¡å®ä¾‹ã€‚ Bæ³¨å…¥æˆåŠŸå±æ€§åï¼ŒBå®ä¾‹åŒ–å®Œå…¨ç»“æŸï¼Œç»“æŸåï¼Œæ¸…é™¤Bçš„äºŒä¸‰çº§ç¼“å­˜ï¼ŒåŠ å…¥ä¸€çº§ç¼“å­˜å¹¶è¿”å› æ­¤æ—¶å›åˆ°äº†Açš„æ³¨å…¥Bå±æ€§é€»è¾‘ä¸­ï¼ŒAå¾—åˆ°äº†Bå®ä¾‹ã€‚è€Œè¿™ä¸ªå®ä¾‹é‡Œçš„Aå±æ€§å¯¹è±¡ï¼Œå’Œå½“å‰è·å–Açš„å¯¹è±¡æ˜¯ä¸€ä¸ª Aç»§ç»­å®Œæˆåˆå§‹åŒ–åŠ¨ä½œï¼Œæœ€åAå®ä¾‹åŒ–å®Œå…¨ç»“æŸï¼Œæ¸…æ¥šAçš„äºŒä¸‰çº§ç¼“å­˜ï¼ŒåŠ å…¥ä¸€çº§ç¼“å­˜å¹¶è¿”å›   åªæœ‰2ä¸ªç¼“å­˜è¡Œå—ï¼Ÿä¸ºä»€ä¹ˆä¸€å®šè¦3ä¸ª  BeanMapæ— ç”¨è´¨ç–‘æ˜¯éœ€è¦çš„ å¦‚æœåªæœ‰å·¥å‚Mapè€Œæ²¡æœ‰ï¼Œå¯æå‰ä¾èµ–çš„BeanMapçš„è¯ï¼Œé‚£ä¹ˆåœ¨ä¸€å¼€å§‹ä»ç¼“å­˜ä¸­è·å–Beanï¼Œä¸€çº§ç¼“å­˜æ— æ³•è·å–åˆ°ï¼Œç›´æ¥å°±æœ‰å·¥å‚Beanï¼Œä¸€æ—¦æœ‰å·¥å‚å°±è°ƒç”¨å·¥å‚è¿”å›çš„å€¼ï¼Œè¿™æ ·æ˜¯ä¸è¡Œçš„ï¼Œå› ä¸ºåœ¨å·¥å‚è°ƒç”¨Beançš„æ—¶å€™ï¼Œæœ‰å¾ˆå¤šåŠ¨ä½œå°±ä¼šè¿›è¡Œé‡å¤ï¼Œæ¯”å¦‚å·¥å‚è·å–çš„æ—¶å€™ï¼Œå¯ä»¥ç»™SmartInstantiationAwareBeanPostProcessoræœºä¼šå»æ›´æ”¹EarlyBeanReferenceå¯¹è±¡ï¼Œé‡å¤æ‰§è¡Œäº†ã€‚ç¬¬äºŒï¼Œä¸å·¥å‚æ¨¡å¼çš„æ€æƒ³è¿èƒŒï¼Œå·¥å‚åªéœ€è¦åˆ¶é€ ä¸€æ¬¡ï¼Œè€Œä¸æ˜¯æ¯æ¬¡éƒ½åˆ¶é€ ã€‚ å¦‚æœåªæœ‰å¯æå‰ä¾èµ–çš„BeanMapï¼Œè€Œæ²¡æœ‰å·¥å‚Mapã€‚å®é™…ä¸Šæ˜¯å¯ä»¥çš„ï¼Œåªä¸è¿‡æ²¡æœ‰å·¥å‚çš„è¯ï¼Œä¼šå°†å¤§éƒ¨åˆ†å·¥ä½œéƒ½æŠ›ç»™åˆ›å»ºBeançš„æµç¨‹é‡Œï¼Œä¾‹å¦‚SmartInstantiationAwareBeanPostProcessorç­‰å·¥å‚åº”è¯¥è´Ÿè´£çš„å·¥ä½œ    ApplicationContextçš„Refreshæ–¹æ³•  Enviromentï¼Œç¯å¢ƒå‚æ•°ï¼Œæ ¹æ®ä¸åŒçš„ç¯å¢ƒï¼Œå®ç°Environmentä¸åŒçš„å­ç±»ï¼Œä¾‹å¦‚Webç¯å¢ƒä¼šå®ç°ï¼ŒStandardServletEnvironmentï¼Œé»˜è®¤æ˜¯å®ç°StandardEnvironmentï¼ŒåŒ…å«å¾ˆå¤šç¯å¢ƒå˜é‡ï¼Œç³»ç»Ÿå˜é‡ï¼Œjavaç¯å¢ƒå˜é‡ï¼ŒServletç¯å¢ƒå˜é‡ åˆ›å»ºbeanFactoryä½œä¸ºæˆå‘˜å˜é‡ï¼ŒApplicationContextè‡ªèº«ä¹Ÿå®ç°äº†BeanFactoryæ¥å£ï¼Œåªä¸è¿‡å…·ä½“å®ç°çš„æ–¹æ³•æ˜¯æˆå‘˜å˜é‡çš„beanFactoryçš„æ–¹æ³•ã€ å¡«å……å·¥å‚  å¢åŠ SPELè¡¨è¾¾å¼è§£æå™¨ å±æ€§ç¼–è¾‘å™¨æ³¨å…¥ å¢åŠ ä¸€ä¸ªApplicationContextAwareProcessorçš„BPPï¼Œåœ¨Beanå®ä¾‹åŒ–ä¹‹åï¼Œæ¿€æ´»å®ç°äº†awareæ¥å£çš„æ–¹æ³•çš„ä¸€ä¸ªBPP é…ç½®å¿½ç•¥æŸäº›ç±»å‹çš„å±æ€§è‡ªåŠ¨æ³¨å…¥ï¼Œå¢åŠ æŸäº›ç±»å‹è‡ªåŠ¨æ³¨å…¥   postProcessBeanFactoryï¼šç•™ç»™å­ç±»å»å®ç° è®°å½•å¯åŠ¨è·¯å¾„ æ¿€æ´»BeanFactoryPostProcessorï¼ŒinvokeBeanFactoryPostProcessors æ³¨å†ŒBeanPostProcessor åˆå§‹åŒ–å›½é™…åŒ–æ–‡ä»¶ åˆå§‹åŒ–initApplicationEventMulticasterï¼Œäº‹ä»¶ä¼ é€å™¨ï¼Œç”¨äºå‘é€äº‹ä»¶ æ³¨å†Œäº‹ä»¶ç›‘å¬å™¨ è®¾ç½®ConversionService é”å®šæ‰€æœ‰BeanDefinitionsï¼Œé˜²æ­¢æ”¹å˜ å®ä¾‹åŒ–å‰©ä¸‹æ‰€æœ‰çš„no-lazyå®ä¾‹ è°ƒç”¨æ‰€æœ‰å®ç°LifeCycleæ¥å£çš„bean å‘é€ContextRefreshedEventäº‹ä»¶  BeanFactoryPostProcessorå’ŒBeanPostProcessoråŒºåˆ«   BeanFactoryPostProcessoræ˜¯å¯ä»¥ä¿®æ”¹Beançš„å…ƒæ•°æ®ï¼Œæ˜¯æ§åˆ¶BeanFactoryçš„ï¼Œè€ŒBeanPostProcessoræ˜¯Beanå®ä¾‹çš„å¤„ç†å™¨ï¼Œå¯ä»¥ä¿®æ”¹Beançš„å®ä¾‹\n  ä»¥PropertySourcesPlaceholderConfigurerä¸ºä¾‹\nå¾ˆæ˜æ˜¾ï¼Œä½œç”¨å°±æ˜¯å¯¹äºBeanfactoryçš„æ‰€æœ‰Beandefintionè¿›è¡Œå¤„ç†ï¼Œå³åœ¨xmlé‡Œä¸­é…ç½®çš„${}å±æ€§\n@Override public void postProcessBeanFactory(ConfigurableListableBeanFactory beanFactory) throws BeansException { try { Properties mergedProps = mergeProperties(); // Convert the merged properties, if necessary. \tconvertProperties(mergedProps); // Let the subclass process the properties. \tprocessProperties(beanFactory, mergedProps); } catch (IOException ex) { throw new BeanInitializationException(\u0026#34;Could not load properties\u0026#34;, ex); } } @Override protected void processProperties(ConfigurableListableBeanFactory beanFactoryToProcess, Properties props) throws BeansException { StringValueResolver valueResolver = new PlaceholderResolvingStringValueResolver(props); doProcessProperties(beanFactoryToProcess, valueResolver); } protected void doProcessProperties(ConfigurableListableBeanFactory beanFactoryToProcess, StringValueResolver valueResolver) { BeanDefinitionVisitor visitor = new BeanDefinitionVisitor(valueResolver); String[] beanNames = beanFactoryToProcess.getBeanDefinitionNames(); for (String curName : beanNames) { // Check that we\u0026#39;re not parsing our own bean definition, \t// to avoid failing on unresolvable placeholders in properties file locations. \tif (!(curName.equals(this.beanName) \u0026amp;\u0026amp; beanFactoryToProcess.equals(this.beanFactory))) { BeanDefinition bd = beanFactoryToProcess.getBeanDefinition(curName); try { visitor.visitBeanDefinition(bd); } catch (Exception ex) { throw new BeanDefinitionStoreException(bd.getResourceDescription(), curName, ex.getMessage(), ex); } } } // New in Spring 2.5: resolve placeholders in alias target names and aliases as well. \tbeanFactoryToProcess.resolveAliases(valueResolver); // New in Spring 3.0: resolve placeholders in embedded values such as annotation attributes. \tbeanFactoryToProcess.addEmbeddedValueResolver(valueResolver); } public void visitBeanDefinition(BeanDefinition beanDefinition) { visitParentName(beanDefinition); visitBeanClassName(beanDefinition); visitFactoryBeanName(beanDefinition); visitFactoryMethodName(beanDefinition); visitScope(beanDefinition); if (beanDefinition.hasPropertyValues()) { visitPropertyValues(beanDefinition.getPropertyValues()); } if (beanDefinition.hasConstructorArgumentValues()) { ConstructorArgumentValues cas = beanDefinition.getConstructorArgumentValues(); visitIndexedArgumentValues(cas.getIndexedArgumentValues()); visitGenericArgumentValues(cas.getGenericArgumentValues()); } }   ä¸Šé¢çš„ä¾‹å­å³å¯ä»¥çœ‹å‡ºBeanFactoryPostProcessoræ˜¯å¯¹BeanFactoryè¿›è¡Œæ“ä½œï¼Œæ˜¯Beanè¿˜æ²¡å®ä¾‹åŒ–ä¹‹å‰çš„åŠ¨ä½œ\n  åŸç†Spring AOP   Xmlæ–¹å¼ä¸­ï¼Œaspectj-autoproxyï¼Œæ ‡ç­¾é»˜è®¤åˆ›å»ºä¸€ä¸ªAnnotationAwareAspectJAutoProxyCreatorçš„BeanDefinitionï¼Œæ³¨å†Œåˆ°BeanDefinitionRegistryä¸­\n  é€šè¿‡äº‹ä»¶å‘é€ï¼Œé€šçŸ¥åˆ°æ³¨å†Œäº†\n  åœ¨Applicationçš„refreshä¸­çš„finishBeanFactoryInitializationï¼Œä¼šå®ä¾‹åŒ–è¯¥bean\n  AnnotationAwareAspectJAutoProxyCreatorå®ç°äº†Springçš„BPPæ¥å£\n  æ­£å¸¸æƒ…å†µä¸‹ï¼ŒAOPä¼šåœ¨postProcessAfterInitializationæ–¹æ³•æ‰§è¡Œåï¼ŒwrapIfNecessaryï¼Œä¼šå»æ‰¾å½“å‰å®¹å™¨é‡Œæ‰€æœ‰çš„å¢å¼ºå™¨ï¼Œä¸€ä¸ªå¢å¼ºå™¨é‡ŒåŒ…å«äº†ï¼Œåˆ‡å…¥ç‚¹ï¼Œåˆ‡å…¥æ–¹æ³•\n  é¦–å…ˆä¼šæ‰¾åˆ°å®¹å™¨é‡Œæ‰€æœ‰çš„å¢å¼ºå™¨ï¼Œåšç¼“å­˜å¤„ç†ï¼Œå¯¹äºæ¯ä¸€ä¸ªè¦è·å–çš„Beanéƒ½ä¼šèµ°è¿™ä¸ªæ–¹æ³•ã€‚å…·ä½“çš„å¯»æ‰¾æ–¹æ³•ï¼ŒåŒ…æ‹¬Springè€å¼çš„é…ç½®ï¼Œå³åœ¨XMLé‡Œé…ç½®Beanï¼Œä½¿ç”¨aop:configé‡Œçš„aop:refå’Œaop:point_cutï¼Œé…ç½®å‡ºæ¥çš„ï¼Œä»¥åŠç°åœ¨ååˆ†æ–¹ä¾¿çš„ä½¿ç”¨aspectJæ³¨è§£çš„@Aspecté…åˆ@PointCutï¼Œ@Aroundï¼Œ@Beforeï¼Œ@Afterï¼Œ@Throw\n  ç„¶åæ ¹æ®Beançš„å±æ€§ã€‚æ£€æŸ¥æ‰¾åˆ°çš„å¢å¼ºå…¶é‡Œé¢æ˜¯å¦æœ‰æ»¡è¶³æ¡ä»¶çš„ã€‚å³æŸ¥çœ‹æ˜¯å¦æ»¡è¶³AOPï¼Œè¡¨è¾¾å¼çš„ï¼Œæ–¹æ³•\n  å¦‚æœè¿™ä¸ªbeanæœ‰æ»¡è¶³çš„å¢å¼ºå™¨\n  åˆ™å–è·å–ä»£ç†å¯¹è±¡ï¼ŒSpringæœ‰2ä¸­å®ç°ä»£ç†çš„æ–¹å¼ï¼ŒJDKè‡ªå¸¦çš„Proxyç±»ï¼Œä»¥åŠCGlib\n  JDKå’ŒGClibåŒºåˆ«\n JDKåªèƒ½é’ˆå¯¹å®ç°äº†æ¥å£çš„ç±»ï¼Œç”Ÿæˆä»£ç†ï¼Œå®ç°åŒæ ·çš„æ¥å£æ–¹æ³•ï¼Œä½†é‡Œé¢è°ƒç”¨çš„è¿˜æ˜¯ç›®æ ‡å¯¹è±¡çš„æ–¹æ³• CGLIBæ˜¯é’ˆå¯¹ç±»å®ç°ä»£ç†ï¼Œé€šè¿‡ä¿®æ”¹å­—èŠ‚ç æ–¹å¼ï¼Œå¯¹ç›®æ ‡å¯¹è±¡ç”Ÿæˆä¸€ä¸ªå…¶å­ç±»ï¼Œè¦†å†™çˆ¶ç±»çš„æ–¹æ³•ï¼Œä»è€Œè¾¾åˆ°ä»£ç†ï¼Œæ‰€ä»¥ç±»ä¸èƒ½å£°æ˜ä¸ºfinal    Springå¯ä»¥å¼ºåˆ¶ä½¿ç”¨cglibï¼Œé…ç½®proxyTargetClasså±æ€§ä¸ºtrueå³å¯\n  æ ¹æ®ä¸Šè¿°æ‰¾åˆ°çš„å¢å¼ºå™¨ï¼ŒSpringæ ¹æ®é…ç½®ï¼Œåˆ›å»ºå¯¹åº”çš„AopProxyï¼ŒJdkDynamicAopProxyæˆ–è€…CglibAopProxy\n  è°ƒç”¨AopProxyçš„getProxyæ–¹æ³•\n  JdkDynamicAopProxy\n  ä½¿ç”¨JDKè‡ªå¸¦çš„Proxy.newProxyInstanceæ–¹å¼åˆ›å»ºä»£ç†å¯¹è±¡\nProxy.newProxyInstance(classLoader, this.proxiedInterfaces, this);   æœ€åä¸€ä¸ªå‚æ•°thisï¼Œè¯´æ˜JdkDynamicAopProxyè‚¯å®šå®ç°äº†InvocationHandlerï¼Œæœ€åæ‰§è¡Œçš„ç›®æ ‡æ–¹æ³•å°±æ˜¯invokeæ–¹æ³•\n  åœ¨è¿™é‡Œé¢å¤„ç†äº†expose-proxyå±æ€§\n//AopContext è‡ªèº«æ— æ³•è·å–ä»£ç†å¯¹è±¡çš„å¤„ç† exposeProxy if (this.advised.exposeProxy) { // Make invocation available if necessary.  oldProxy = AopContext.setCurrentProxy(proxy); setProxyContext = true; }   ç„¶åæ ¹æ®ä¼ å…¥çš„å¢å¼ºå™¨ï¼Œä½¿ç”¨ReflectiveMethodInvocationå°è£…ï¼Œæ–¹æ³•é“¾ï¼Œé€ä¸ªè°ƒç”¨ã€‚ä¸åŒçš„advistorä½¿ç”¨ä¸åŒçš„å®ç°ç±»å»å®ç°ï¼Œä¾‹å¦‚\n  AspectJAroundAdvice\r@Override @Nullable public Object invoke(MethodInvocation mi) throws Throwable { if (!(mi instanceof ProxyMethodInvocation)) { throw new IllegalStateException(\u0026#34;MethodInvocation is not a Spring ProxyMethodInvocation: \u0026#34; + mi); } ProxyMethodInvocation pmi = (ProxyMethodInvocation) mi; ProceedingJoinPoint pjp = lazyGetProceedingJoinPoint(pmi); JoinPointMatch jpm = getJoinPointMatch(pmi); return invokeAdviceMethod(pjp, jpm, null, null); } è¿™ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆ@Aroundçš„æ–¹æ³•ï¼Œå…¥å‚å¯ä»¥æ˜¯ProceedingJoinPoint\ninvokeAdviceMethodWithGivenArgs(argBinding(jp, jpMatch, returnValue, t));     ç›´è‡³æ‰€æœ‰çš„æ–¹æ³•é“¾è°ƒç”¨ç»“æŸ\n  æœ€åæ‰§è¡Œç›®æ ‡æ–¹æ³•\n  å¤„ç†è¿”å›å¯¹è±¡\n    SpringMVCæµç¨‹ SpringMvcä¼šä½¿ç”¨DispatcherServletä½œä¸ºè¯·æ±‚çš„å…¥å£ã€‚\nä½œä¸ºä¸€ä¸ªServletï¼Œinitæ–¹æ³•ï¼Œæ‰§è¡Œåï¼ŒDispatcherServletä¼šåˆ›å»ºè‡ªå·±çš„IOCå®¹å™¨ï¼Œå¹¶ä¸”æŠŠServletContextä¸­çš„IOCä½œä¸ºçˆ¶å®¹å™¨ï¼Œæ‰€ä»¥MVCçš„ç›¸å…³å†…å®¹ï¼Œä¾‹å¦‚Controllerå¯ä»¥æ”¾åœ¨MVCçš„IOCä¸­ï¼Œè€Œå…¶ä½™çš„ï¼Œdaoï¼Œserviceå¯ä»¥æ”¾åœ¨SevletContexté‡Œçš„IOCï¼Œå¥½å¤„å°±æ˜¯éš”ç¦»å¼€äº†Må±‚ï¼Œå¦‚æœè¦è¿˜Strutsï¼Œå¯ä»¥ç›´æ¥æ›´æ¢ï¼Œè€Œä¸ç”¨è€ƒè™‘daoå’Œserviceäº†ã€‚\ninitæ–¹æ³•ï¼Œé™¤äº†åˆ›å»ºMVCè‡ªå·±çš„å®¹å™¨ï¼Œè¿˜æ ¹æ®DispatchServlet.propertiesé‡Œçš„å†…å®¹ï¼Œè¿›è¡Œä¸€ç³»åˆ—çš„åˆå§‹åŒ–åŠ¨ä½œã€‚\nDispatcherServletç»§æ‰¿äºFrameworkServletã€‚é›†æˆHttpServletï¼Œæœ€åä»Servletä¼šæ‰§è¡Œåˆ°DispatchServletçš„processRequestæ–¹æ³•ã€‚processRequestä¸­ï¼ŒSpringä¼šå°†å½“å‰çš„è¯·æ±‚requestAttributesæ”¾åœ¨RequestContextHolderä¸­ç”¨ThreadLocalä¿å­˜ï¼Œæ‰€ä»¥åç»­çš„Controlleréƒ½å¯ä»¥ä½¿ç”¨ã€‚\néšåèµ°åˆ°doDispatchä¸­ï¼Œåšä¸€äº›å¿…è¦çš„æ£€æŸ¥ï¼Œç„¶åæ ¹æ®å®¹å™¨é‡Œçš„handerMappingæ‰¾åˆ°å¯¹åº”çš„hanlderï¼Œä½¿ç”¨HandlerExecutionChainå°†ç¬¦åˆè¯¥è¯·æ±‚çš„æ‹¦æˆªå™¨ï¼Œå°è£…åœ¨ä¸€èµ·ï¼Œè·¨åŸŸä¹Ÿæ˜¯åœ¨è¿™é‡Œå¢åŠ å¦ä¸€ä¸ªæ‹¦æˆªå™¨\nå‡†å¤‡å¥½HandlerExecutionChainä¹‹åï¼Œè¿›å…¥æµç¨‹ã€‚å…ˆè°ƒç”¨æ‰€æœ‰çš„æ‹¦æˆªå™¨preHandleræ–¹æ³•\nHandleræœ‰å¾ˆå¤šç§ï¼Œæœ€åä½¿ç”¨é€‚é…å™¨æ¨¡å¼ï¼Œåˆ›å»ºhandlerAdapterå»è°ƒç”¨ä¸åŒhandlerçš„å…·ä½“æ‰§è¡Œæ–¹æ³•ã€‚ä»è€Œå¾—åˆ°modelAndView\nç„¶åè°ƒç”¨æ‹¦æˆªå™¨çš„postHandleræ–¹æ³•\nå¾—åˆ°modelAndViewï¼Œä¹‹åä¼šä½¿ç”¨ViewRovlerè§£æviewï¼Œæœ€åè·å–requestDispatcherï¼Œforwardæˆ–è€…æ˜¯é‡å®šå‘åˆ°æ–°çš„è·¯å¾„ï¼Œå¹¶ä¸”æŠŠmodelï¼Œæ”¾å…¥requestçš„attributeé‡Œï¼Œä»è€Œè¿›å…¥ä¸‹ä¸€ä¸ªè¯·æ±‚äº†ï¼Œå¯ä»¥æ˜¯rewardä¹Ÿå¯ä»¥æ˜¯redirect\nä¸ºä»€ä¹ˆåœ¨Controllerçš„æ–¹æ³•å‚æ•°é‡Œï¼Œå†™HttpServletRequestå°±å¯ä»¥è·å¾—åˆ°è¯·æ±‚å¯¹è±¡ï¼Œä»¥åŠ@RequestBodyå’Œ@RequestParam ä¸ç®¡æ˜¯xmlä¸­é…ç½®mvc:annotation-driven/ï¼Œè¿˜æ˜¯ä½¿ç”¨æ³¨è§£@EnableWebMvcï¼Œæœ¬è´¨ä¸Šéƒ½æ˜¯åœ¨å®¹å™¨ä¸­æ³¨å…¥äº†RequestMappingHandlerMappingè¿™æ ·çš„å®ä¾‹ã€‚å®ä¾‹å®ç°äº†initalizingBeanæ¥å£ï¼Œåœ¨å®¹å™¨ä¸­å®ä¾‹åŒ–çš„æ—¶å€™ï¼Œä¼šå°†å®¹å™¨ä¸­æ‰€æœ‰çš„Beanæ‰¾å‡ºæ¥ï¼Œæ£€æŸ¥Classæ˜¯å¦è¢«@Controlleræˆ–è€…@RequestMappingä¿®é¥°ï¼Œæ‰¾åˆ°å³ä½œä¸ºä¸€ä¸ªhandlerã€‚\nç„¶åå»æ‰¾åˆ°Hanlderå¯¹åº”çš„adapterï¼ŒRequestMappingHandlerAdapterï¼ŒAdapterçš„handleræ–¹æ³•ã€‚\nhanlderæ–¹æ³•çš„æ ¸å¿ƒæ˜¯ï¼ŒinvokeHandlerMethodï¼Œé€šè¿‡åå°„è°ƒç”¨ç›®æ ‡æ–¹æ³•ï¼Œå¹¶ä¸”é€šè¿‡ä¸€äº›åˆ—é…ç½®ï¼Œå°†æ–¹æ³•éœ€è¦çš„é…ç½®ä¼ å…¥è¿›å»ï¼Œå…¶ä¸­è§£ææ–¹æ³•å‚æ•°çš„å°±æ˜¯ä¸€äº›åˆ—çš„argumentResolversã€‚\nSpringä¾ç„¶æ˜¯åœ¨RequestMappingHandlerAdapterçš„afterPropertiesSet()æ–¹æ³•ä¹‹åï¼Œã€‚åˆå§‹åŒ–äº†argumentResolvers\nå¦‚ä¸‹\nprivate List\u0026lt;HandlerMethodArgumentResolver\u0026gt; getDefaultArgumentResolvers() { List\u0026lt;HandlerMethodArgumentResolver\u0026gt; resolvers = new ArrayList\u0026lt;\u0026gt;(30); // Annotation-based argument resolution  resolvers.add(new RequestParamMethodArgumentResolver(getBeanFactory(), false)); resolvers.add(new RequestParamMapMethodArgumentResolver()); resolvers.add(new PathVariableMethodArgumentResolver()); resolvers.add(new PathVariableMapMethodArgumentResolver()); resolvers.add(new MatrixVariableMethodArgumentResolver()); resolvers.add(new MatrixVariableMapMethodArgumentResolver()); resolvers.add(new ServletModelAttributeMethodProcessor(false)); resolvers.add(new RequestResponseBodyMethodProcessor(getMessageConverters(), this.requestResponseBodyAdvice)); resolvers.add(new RequestPartMethodArgumentResolver(getMessageConverters(), this.requestResponseBodyAdvice)); resolvers.add(new RequestHeaderMethodArgumentResolver(getBeanFactory())); resolvers.add(new RequestHeaderMapMethodArgumentResolver()); resolvers.add(new ServletCookieValueMethodArgumentResolver(getBeanFactory())); resolvers.add(new ExpressionValueMethodArgumentResolver(getBeanFactory())); resolvers.add(new SessionAttributeMethodArgumentResolver()); resolvers.add(new RequestAttributeMethodArgumentResolver()); // Type-based argument resolution  resolvers.add(new ServletRequestMethodArgumentResolver()); resolvers.add(new ServletResponseMethodArgumentResolver()); resolvers.add(new HttpEntityMethodProcessor(getMessageConverters(), this.requestResponseBodyAdvice)); resolvers.add(new RedirectAttributesMethodArgumentResolver()); resolvers.add(new ModelMethodProcessor()); resolvers.add(new MapMethodProcessor()); resolvers.add(new ErrorsMethodArgumentResolver()); resolvers.add(new SessionStatusMethodArgumentResolver()); resolvers.add(new UriComponentsBuilderMethodArgumentResolver()); if (KotlinDetector.isKotlinPresent()) { resolvers.add(new ContinuationHandlerMethodArgumentResolver()); } // Custom arguments  if (getCustomArgumentResolvers() != null) { resolvers.addAll(getCustomArgumentResolvers()); } // Catch-all  resolvers.add(new PrincipalMethodArgumentResolver()); resolvers.add(new RequestParamMethodArgumentResolver(getBeanFactory(), true)); resolvers.add(new ServletModelAttributeMethodProcessor(true)); return resolvers; } é€šè¿‡ HandlerMethodArgumentResolverçš„supportsParameteræ–¹æ³•\nä»¥RequestParamä¸ºä¾‹\né¦–å…ˆRequestParamMethodArgumentResolverçš„çˆ¶ç±»AbstractNamedValueMethodArgumentResolverï¼Œè¿›è¡Œæ ¡éªŒï¼Œæ ¡éªŒHanlderçš„å‚æ•°æ˜¯å¦æ˜¯å¿…å¡«ï¼Œä¼šå°†@RequestParamsçš„requiredè¿›è¡Œæ ¡éªŒï¼Œä»HttpServletRequesté‡Œçš„parameterè¿›è¡Œæ ¡éªŒã€‚æ ¡éªŒæˆåŠŸï¼Œä¼šé€šè¿‡åå°„æ‰§è¡Œhandlerï¼Œå¹¶å°†å‚æ•°ä¼ å…¥Handlerä¸­ã€‚\n@RequestBodyä¹Ÿæ˜¯ä¸€æ ·ï¼Œä½¿ç”¨çš„RequestResponseBodyMethodProcessorå»å¤„ç†å‚æ•°çš„\nåœ¨å¤„ç†@RequestBodyçš„æ—¶å€™ï¼ŒRequestMappingHandlerAdapterçš„æ‰€æœ‰messageConvertersï¼Œæ‰¾åˆ°ç¬¦åˆçš„ï¼Œæˆ‘ä»¬å¸¸ç”¨çš„application/jsonå°±æ˜¯MappingJackson2HttpMessageConverterï¼Œéœ€è¦å¼•å…¥jacksonçš„æ ¸å¿ƒåŒ…\nè‡³äºå…¶ä»–çš„Httpservletéƒ½æ˜¯æ˜¯åŒå¯¹åº”çš„argumentResolveå¤„ç†çš„\nSpringBootçš„å·¥ä½œåŸç† Springåœ¨è¯ç”Ÿä¹‹åˆï¼Œé…ç½®ç±»ä¸€ç›´æ˜¯ä»¤å¼€å‘è€…åæ§½çš„æ¨¡å—ï¼Œå½“java5æ¨å‡ºæ³¨è§£åï¼Œå¯ä»¥ä½¿ç”¨javaç±»è¿›è¡Œé…ç½®äº†ï¼Œä½†ä¾ç„¶å¾ˆç¹çã€‚è€ŒSpringBootçš„æœ€å¤§çš„ä¸€ä¸ªç‰¹ç‚¹ï¼Œå°±æ˜¯è§£å†³å¤æ‚çš„é…ç½®ã€‚\nSpringBootæ¨å‡ºäº†ä¸€ç³»åˆ—æ³¨è§£ï¼Œä»–ä»¬å¯ä»¥å°†å„ç±»Spring boot starterï¼Œæ— æ„Ÿçš„æ³¨å…¥åˆ°å®¹å™¨ä¸­ã€‚\nSpringBootåœ¨SpringBootçš„runæ–¹æ³•é‡Œï¼Œå®Œæˆäº†ä¸€äº›åˆ—å·¥ä½œã€‚\né¦–å…ˆæ˜¯æ„é€ æ–¹æ³•ä¼šæ ¹æ®å½“å‰ç±»è·¯å¾„ä¸‹æ˜¯å¦åŒ…å«webfluxï¼Œæˆ–è€…servletç›¸å…³ç±»ï¼Œä»è€Œå†³å®šå®ä¾‹åŒ–çš„å®¹å™¨å¯¹è±¡ã€‚\nä»¥å¸¸è§çš„servletä¸ºä¾‹ï¼ŒSpringBootä¼šå®ä¾‹åŒ–AnnotationConfigServletWebServerApplicationContext\nè€Œåœ¨SpringBootæ„é€ å‡½æ•°è§¦å‘æ—¶ï¼Œä¼šå¯»æ‰¾ç±»è·¯å¾„ä¸‹META/Spring.factoriesæ–‡ä»¶ï¼Œä¸‹æ‰€æœ‰çš„ApplicationContextInitializerå®ä¾‹ï¼Œå’ŒApplicationListenerå®ä¾‹ï¼Œå¹¶ä¸”æ”¾å…¥å½“å‰å¯¹è±¡çš„å±æ€§ä¸­\n  æ ¸å¿ƒçš„runæ–¹æ³•ï¼Œé‡Œé¦–å…ˆè¿˜æ˜¯ä»spring.factoriesé‡Œæ‰¾åˆ°æ‰€æœ‰çš„SpringApplicationRunListenerï¼Œè°ƒç”¨å…¶startingæ–¹æ³•ï¼Œ\n  ç„¶åå°è£…mainæ–¹æ³•çš„argå‚æ•°ï¼Œæ ¡éªŒç¯å¢ƒï¼Œå³æˆ‘ä»¬å¯ä»¥åœ¨å¤–éƒ¨æŒ‡æ˜springçš„profile.active=prodå°±æ˜¯åœ¨è¿™é‡ŒæŒ‡æ˜çš„\n  å‡†å¤‡å¥½mainçš„argä»¥åŠsytemçš„ç›¸å…³å±æ€§åï¼Œä¼šè°ƒç”¨æ‰€æœ‰SpringApplicationRunListenerçš„environmentPreparedï¼Œä¹Ÿå°±æ˜¯åœ¨è¿™é‡Œé¢è¿›è¡Œäº†Springé…ç½®æ–‡ä»¶ï¼Œapplication.ymlæˆ–è€…æ˜¯application.propertiesçš„å¤„ç†\n  æ‰“å°Banner\n  æ ¹æ®ä¸Šè¿°å¾—åˆ°çš„å®ä¾‹åŒ–Classï¼Œå®ä¾‹åŒ–IOCå®¹å™¨\n  ä»spring.factoriesé‡Œæ‰¾åˆ°SpringBootExceptionReporterç”¨äºå¼‚å¸¸æ‰“å°\n  å‡†å¤‡åç§°ç”Ÿæˆå™¨ï¼Œèµ„æºåŠ è½½å™¨ï¼Œç±»åŠ è½½å™¨ç­‰ã€‚\n  è°ƒç”¨Spring.factoriesé‡Œçš„ApplicationContextInitializerçš„initializeæ–¹æ³•\n  è°ƒç”¨ApplicationContextInitializerçš„contextPreparedæ–¹æ³•\n  æ‰“å°å¯åŠ¨ç±»ä¿¡æ¯ï¼Œæ‰“å°profileä¿¡æ¯\n  åŠ è½½å¯åŠ¨ç±»çš„æ³¨è§£ä¿¡æ¯ï¼Œå³å¯åŠ¨ç±»ä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªç»„ä»¶ï¼Œæ³¨å…¥åˆ°å®¹å™¨ä¸­ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œ@SpringBootApplicationé‡Œçš„@SpringBootConfigurationé‡Œæœ‰@Componentæ³¨è§£ï¼ŒSpringä¼šé€šè¿‡æ³¨è§£æ–¹å¼å°†å…¶æ³¨å…¥åˆ°å®¹å™¨ä¸­ï¼Œç»†èŠ‚å°±ä¸è¯´äº†ï¼Œæ ¸å¿ƒæ˜¯@SpringBootConfigurationèº«ä¸Šæœ‰@Configurationï¼Œè€Œä¸”æœ‰@Importæ³¨è§£ï¼Œå¼•å…¥çš„æ˜¯AutoConfigurationImportSelector\nSpringBootåœ¨å¯åŠ¨çš„æ—¶å€™ï¼Œæ³¨å…¥äº†ConfigurationClassPostProcessorè¯¥ç±»å®ç°äº†BeanDefinitionRegistryPostProcessorä¼šåœ¨å®¹å™¨çš„refreshé‡Œçš„invokeBeanFactoryPostProcesserï¼Œé‡Œè§¦å‘\npostProcessBeanDefinitionRegistryæ–¹æ³•ï¼Œä¼šæ‰¾åˆ°å®¹å™¨é‡Œæ‰€æœ‰çš„@Configurationå®ä¾‹ï¼Œè¿™é‡Œæ­¤æ—¶å®¹å™¨é‡Œæœ‰çš„å°±æ˜¯å¯åŠ¨ç±»æœ¬èº«ï¼Œç„¶åä¼šå¤„ç†ï¼Œ@Configurationä¸Šçš„@Importï¼Œå¹¶ä¸”æ‰§è¡Œ@Importç±»çš„processæ–¹æ³•ï¼Œå³ï¼Œæœ€åä¾ç„¶è°ƒç”¨çš„æ˜¯selectImportsæ–¹æ³•ï¼Œå¾—åˆ°çš„å°±æ˜¯Spring.factoriesé‡Œé…ç½®çš„**org.springframework.boot.autoconfigure.EnableAutoConfiguration=**çš„å€¼ï¼Œç„¶åé€æ­¥è§£ææ‰€æœ‰çš„ç±»ï¼Œè¿™æ ·å®¹å™¨é‡Œå°±æœ‰ç¬¬ä¸‰æ–¹è°ƒç”¨çš„æ‰€æœ‰ä¿¡æ¯äº†\npublic void process(AnnotationMetadata annotationMetadata, DeferredImportSelector deferredImportSelector) { Assert.state( deferredImportSelector instanceof AutoConfigurationImportSelector, () -\u0026gt; String.format(\u0026#34;Only %s implementations are supported, got %s\u0026#34;, AutoConfigurationImportSelector.class.getSimpleName(), deferredImportSelector.getClass().getName())); AutoConfigurationEntry autoConfigurationEntry = ((AutoConfigurationImportSelector) deferredImportSelector) .getAutoConfigurationEntry(getAutoConfigurationMetadata(), annotationMetadata); this.autoConfigurationEntries.add(autoConfigurationEntry); for (String importClassName : autoConfigurationEntry.getConfigurations()) { this.entries.putIfAbsent(importClassName, annotationMetadata); } } protected AutoConfigurationEntry getAutoConfigurationEntry( AutoConfigurationMetadata autoConfigurationMetadata, AnnotationMetadata annotationMetadata) { if (!isEnabled(annotationMetadata)) { return EMPTY_ENTRY; } AnnotationAttributes attributes = getAttributes(annotationMetadata); List\u0026lt;String\u0026gt; configurations = getCandidateConfigurations(annotationMetadata,//è·å–åˆ°æ‰€æœ‰çš„/META-INF/spring-factoriesä¸­çš„configuration  attributes); configurations = removeDuplicates(configurations);//åˆ é™¤é‡å¤çš„  Set\u0026lt;String\u0026gt; exclusions = getExclusions(annotationMetadata, attributes); checkExcludedClasses(configurations, exclusions);//æ ¹æ®ä¸Šé¢çš„å±æ€§excclusion  configurations.removeAll(exclusions); configurations = filter(configurations, autoConfigurationMetadata); fireAutoConfigurationImportEvents(configurations, exclusions);//é€šçŸ¥å¯¼å…¥æˆåŠŸ  return new AutoConfigurationEntry(configurations, exclusions); }   Springäº‹åŠ¡   Springä½¿ç”¨æ³¨è§£@Transactionalæ”¾åœ¨æ–¹æ³•ï¼Œæˆ–è€…ç±»ä¸Š\n  @Transactionalå±æ€§æœ‰\n transactionManageræŒ‡æ˜äº‹åŠ¡ç®¡ç†å™¨ï¼Œåœ¨å¤šæ•°æ®æºçš„æ—¶å€™ï¼Œéœ€è¦æŒ‡æ˜ propagationä¼ æ’­è¡Œä¸ºé»˜è®¤æ˜¯Propagation.REQUIREDï¼Œå³å½“å‰å¦‚æœå­˜åœ¨äº‹åŠ¡ï¼Œåˆ™ç”¨åŒä¸€ä¸ªäº‹åŠ¡ï¼Œå¦åˆ™å¼€å¯ä¸€ä¸ªæ–°äº‹åŠ¡ isolationéš”ç¦»çº§åˆ«ï¼Œé»˜è®¤æ˜¯æ•°æ®åº“çš„éš”ç¦»çº§åˆ«ï¼Œmysqlé»˜è®¤æ—¶å¯é‡å¤åº¦ï¼Œå¹»è¯»æ˜¯é€šè¿‡MVCCå’Œé—´éš™é”è§£å†³çš„ timeoutè¶…æ—¶æ—¶é—´ readOnlyæ˜¯å¦åªè¯» rollbackForå‘ç”Ÿä»€ä¹ˆå¼‚å¸¸æ‰ä¼šä¼šæ»šï¼Œé»˜è®¤æ˜¯RuntimeException rollbackForClassName noRollbackFor noRollbackForClassName    åŸç†ï¼Œ@Transactionalæ³¨è§£æ˜¯åŸºäºAOPåŸç†ï¼Œå®¹å™¨åœ¨è·å–ç›¸åº”beançš„æ—¶å€™ï¼Œä¼šå»ä½¿ç”¨wrapifNecessaryåŒ…è£…beanï¼ŒSpringçš„æµç¨‹æ˜¯ï¼Œä»å®¹å™¨é‡Œæ‰¾åˆ°æ‰€æœ‰çš„adviserï¼Œè€Œ@Transactionalä¼šåœ¨å®¹å™¨é‡Œæ³¨å…¥BeanFactoryTransactionAttributeSourceAdvisorï¼Œä»è€Œæœ€åå¾—åˆ°çš„æ˜¯ä»£ç†å¯¹è±¡ï¼Œè€Œä»£ç†å¯¹è±¡é’ˆå¯¹äºæ»¡è¶³åˆ‡é¢æ¡ä»¶çš„beanï¼Œä¼šåšå¤„ç†ï¼Œ@Transactionalå°±æ˜¯åˆ‡é¢æ¡ä»¶ï¼Œä¼šåœ¨ç›®æ ‡æ–¹æ³•æ‰§è¡Œä¹‹å‰å¼€å¯ä¸€ä¸ªäº‹åŠ¡ï¼Œæ‰§è¡Œä¹‹åæäº¤æˆ–è€…å›æ»šä¸€ä¸ªäº‹åŠ¡ï¼Œæ“ä½œäº‹åŠ¡çš„éƒ½æ˜¯TransactionManager\n  æé—®\n  å¦‚æœåœ¨ä¸€ä¸ªæ–¹æ³•é‡Œå¼‚å¸¸è¢«try-catchäº†ï¼Œè¿˜ä¼šä¼šæ»šå—ï¼Ÿä¸ä¼šäº†ï¼Œå› ä¸ºSpingå¤„ç†æäº¤äº‹åŠ¡æ˜¯åœ¨åˆ‡é¢çš„AfterRunningä¹‹åæäº¤çš„ï¼Œåœ¨é‚£ä¹‹å‰ä¼šä½¿ç”¨try-catchæ•æ‰ï¼Œè€Œç›®æ ‡è‡ªå·±æ•æ‰è¿‡çš„è¯ï¼ŒSpringå°±æ•æ‰ä¸åˆ°äº†ï¼Œé™¤éåœ¨catché‡Œå†æŠ›å‡º\n  å¦‚æœè‡ªå·±ä½¿ç”¨TransactionManageré‡æ–°åœ¨è·å–ä¸€ä¸ªäº‹åŠ¡ï¼Œæ‰‹åŠ¨æäº¤ä¹‹å‰ï¼ŒæŠ›å‡ºå¼‚å¸¸çš„è¯ï¼Œä¼šä¼šæ»šå—ï¼Ÿä¸ä¼šï¼Œä¼šè¢«Springæ•æ‰åˆ°\n  å¦‚æœåœ¨æŠ›å‡ºå¼‚å¸¸ä¹‹å‰ï¼Œå°±æ‰‹åŠ¨æäº¤äº†ï¼ŒSpringä¼šå›æ»šå—ï¼Œå¯èƒ½ä¼š ä¹Ÿå¯èƒ½ä¸ä¼šï¼Œè¿™å’ŒSpringäº‹åŠ¡çš„ä¼ æ’­è¡Œä¸ºæœ‰å…³ï¼Œé»˜è®¤æƒ…å†µä¸‹ä¼ æ’­è¡Œä¸ºæ˜¯ï¼Œå¦‚æœå½“å‰æœ‰äº‹åŠ¡äº†ï¼Œå°±ç”¨å½“å‰äº‹åŠ¡ï¼Œå¦åˆ™å¼€å¯ä¸€ä¸ªæ–°äº‹åŠ¡ã€‚\nå¦‚æœæœ‰@Transactionalæ³¨è§£äº†ï¼Œæ„å‘³ç€Springå·²ç»å¼€å¯äº†ä¸€ä¸ªäº‹åŠ¡äº†ï¼Œåç»­è‡ªå·±æ‰‹åŠ¨å¼€å¯çš„äº‹åŠ¡ï¼Œå°±æ˜¯ä¹‹å‰çš„äº‹åŠ¡äº†ï¼Œå¹¶éä¸€ä¸ªæ–°äº‹åŠ¡ï¼ŒSpringåœ¨æäº¤äº‹åŠ¡ä¹‹å‰ï¼Œä¼šåˆ¤æ–­æ˜¯å¦ä¸ºä¸€ä¸ªæ–°äº‹åŠ¡ï¼Œæ˜¯çš„è¯ï¼Œæ‰ä¼šè¿›è¡Œæäº¤ï¼Œå¦åˆ™ä¸ä¼šæœ‰åŠ¨ä½œã€‚æ‰€æœ‰å¦‚æœä¼ æ’­è¡Œä¸ºä¸å˜çš„è¯ï¼Œä¼šå›æ»šçš„ï¼Œå¦‚æœæ˜¯å¼ºåˆ¶å¼€å¯æ–°çš„äº‹åŠ¡çš„ä¼ æ’­è¡Œä¸ºï¼Œåˆ™ä¸ä¼šä¼šæ»š\n    è®²è®²ä½ ä¼šçš„è®¾è®¡æ¨¡å¼ï¼ŒSpringé‡Œé¢ç”¨åˆ°äº†å“ªäº›è®¾è®¡æ¨¡å¼ Javaä¸­çš„Dateæ˜¯çº¿ç¨‹å®‰å…¨çš„å—ï¼Ÿä½ æ˜¯å¦‚ä½•ä¿è¯çº¿ç¨‹å®‰å…¨çš„ è®²è®²ThreadLocal å’Œjavaçš„å†…å­˜æ¨¡å‹å§ WebAsyncTask WebAsyncTaskï¼Œæ˜¯åŸºäºServlet3.0å¼‚æ­¥Servletçš„ç‰¹æ€§ï¼Œç”¨äºæé«˜å®¹å™¨çš„ååé‡ï¼Œå®¢æˆ·ç«¯è¯·æ±‚è¿›æ¥æ—¶ï¼Œå½“å‰çš„å®¹å™¨åˆ†é…çš„çº¿ç¨‹ä¼šç›´æ¥è¿”å›ï¼Œå¹¶ä¼šå¼€å¯ä¸€ä¸ªæ–°çº¿ç¨‹ç”¨äºå¤„ç†å®¢æˆ·ç«¯è¯·æ±‚ï¼Œå½“æ–°çº¿ç¨‹ç»“æŸæ—¶ï¼Œå®¢æˆ·ç«¯æ‰ä¼šæ”¶åˆ°è¯·æ±‚ã€‚è€Œå®¹å™¨çš„çº¿ç¨‹å°±å¯ä»¥å›æ”¶ç”¨äºæ–°çš„è¯·æ±‚ï¼Œæé«˜äº†ååé‡\næ‹¦æˆªå™¨å’Œè¿‡æ»¤å™¨çš„åŒºåˆ« é¦–å…ˆï¼Œæ‹¦æˆªå™¨ä¸è¿‡æ»¤å™¨ä¸æ˜¯ä¸€èµ·çš„ï¼Œæ‹¦æˆªå™¨æ˜¯Springçš„ï¼Œè€Œè¿‡æ»¤å™¨filteræ˜¯javaxæä¾›çš„ï¼Œfilterä¼šåœ¨æ‹¦æˆªå™¨ä¹‹å‰æ‰§è¡Œï¼Œæ‹¦æˆªå™¨å¯ä»¥è¾¾åˆ°æ›´ç»†ç²’æ§åˆ¶è¯·æ±‚ã€‚æ‹¦æˆªå™¨å¯ä»¥è·å¾—åˆ°å…·ä½“æ‰§è¡Œçš„handlerï¼Œå¯ä»¥å¯¹handleråšä¸ªæ€§åŒ–æ“ä½œã€‚è¿‡æ»¤å™¨å¯ä»¥åšçš„ï¼Œæ‹¦æˆªå™¨éƒ½å¯ä»¥åšåˆ°ï¼Œæ‹¦æˆªå™¨åšçš„ï¼Œè¿‡æ»¤å™¨åšä¸äº†ã€‚\nèŠä¸€ä¸‹mybatis ä»€ä¹ˆæ˜¯mybatisçš„æ‡’åŠ è½½ mybatisçš„mapperæ˜¯å¦‚ä½•ä¸æ•°æ®åº“è¿æ¥çš„ ä»€ä¹ˆæ˜¯ç´¢å¼•ï¼Œç´¢å¼•ä¸ºä»€ä¹ˆå¯ä»¥åŠ æŸ¥è¯¢ Innodbç´¢å¼•å®ç° Bæ ‘å’ŒB+æ ‘ Redisä½¿ç”¨ï¼Œéƒ¨ç½²ï¼Œå“¨å…µ TCPä¸‰æ¬¡æ¡æ‰‹ ä¹è§‚é”ï¼Œæ‚²è§‚é”ï¼Œä¸¾ä¾‹ è®¾è®¡æ¨¡å¼ Redisæ‰©å®¹ CASæ¦‚å¿µï¼ŒåŸå­ç±»çš„å®ç° Synchronize åº•å±‚åŸç† AQS ç½‘ç»œæ¨¡å‹ï¼Œä½ çŸ¥é“çš„ç½‘ç»œåè®® HTTPSçš„è¿æ¥è¿‡ç¨‹ï¼ŒSSL å•é“¾è¡¨ç®—æ³•ï¼Œåè½¬ï¼ŒæŸ¥æ‰¾ jvmåƒåœ¾å›æ”¶æœºåˆ¶ å·¥ä½œæµå¼•æ“ Spring MVC webFlux netty redisä¸ºä»€ä¹ˆè¿™ä¹ˆå¿« Mysqlçš„explain K8S è®²ä¸€è®²åå°„ï¼Œä»¥åŠä½ å·¥ä½œä¸­ç”¨åˆ°çš„åœ°æ–¹ javaåå°„ï¼Œæä¾›ç»™æˆ‘ä»¬æ–¹å¼å»åŠ¨æ€åˆ›å»ºç±»ï¼Œæˆ–è€…æ˜¯åŠ¨æ€æ‰§è¡Œæ–¹æ³•ï¼Œå½“æˆ‘ä»¬å› ä¸ºæŸäº›æ¡ä»¶ï¼Œä¸çŸ¥é“ç›®æ ‡åº”è¯¥æ‰§è¡Œä»€ä¹ˆæ–¹æ³•çš„æ—¶å€™ï¼Œå°±å¯ä»¥ä½¿ç”¨åå°„ã€‚\nä¾‹å¦‚ï¼Œè¯·å‡ï¼Œå¦‚æœè¶…è¿‡2å¤©ï¼Œå°±æ‰§è¡ŒæŸæ–¹æ³•ï¼Œå¦åˆ™æ‰§è¡Œå¦ä¸€ä¸ªæ–¹æ³•ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç”¨åå°„\nåå°„ä¹Ÿè¢«å¤§é‡åº”ç”¨äºmybatiså’Œspringä¹‹ä¸­ï¼Œspringä¸­aopï¼Œåˆ›å»ºbeançš„åŠ¨ä½œéƒ½æ˜¯åå°„ï¼Œå› ä¸ºä»–ä»¬æ— è®ºæ˜¯æ‰§è¡Œæ–¹æ³•è¿˜æ˜¯æ„å»ºå®ä¾‹éƒ½æ˜¯æœªçŸ¥çš„å‚æ•°å’Œæ¡ä»¶\n","permalink":"https://sunhao1256.github.io/posts/spring%E6%95%B4%E7%90%86/","summary":"@Override\r@Nullable\rpublic Object invoke(MethodInvocation mi) throws Throwable {\rif (!(mi instanceof ProxyMethodInvocation)) {\rthrow new IllegalStateException(\u0026quot;MethodInvocation is not a Spring ProxyMethodInvocation: \u0026quot; + mi);\r}\rProxyMethodInvocation pmi = (ProxyMethodInvocation) mi;\rProceedingJoinPoint pjp = lazyGetProceedingJoinPoint(pmi);\rJoinPointMatch jpm = getJoinPointMatch(pmi);\rreturn invokeAdviceMethod(pjp, jpm, null, null);\r}\rå½“åœ¨Spingä¸­é…ç½®çš„Beanå­˜åœ¨ç›¸äº’ä¾èµ–ï¼ŒSpringæ˜¯æ€ä¹ˆå¤„ç†çš„ é’ˆå¯¹åŸå‹Beanç›´æ¥æŠ›å‡ºå¼‚å¸¸ï¼Œä¸æ”¯æŒã€‚\nå•ä¾‹Beanï¼ŒSpringä½¿ç”¨3ä¸ªMapåšç¼“å­˜ï¼Œæ¥å¤„ç†ã€‚\nåˆ†åˆ«æ˜¯ï¼šä¸€çº§ç¼“å­˜Springæœ€ç»ˆä¿å­˜çš„å•ä¾‹å¯¹è±¡Mapï¼ŒäºŒçº§ç¼“å­˜å»ºé€ Springå•ä¾‹å¯¹è±¡çš„åŒ¿åå·¥å‚å¯¹è±¡è¿”å›çš„å°±æ˜¯ä¸‰çº§ç¼“å­˜éœ€è¦çš„ï¼Œä¸‰çº§ç¼“å­˜æ˜¯å…è®¸æå‰è¢«ä¾èµ–çš„å•ä¾‹å¯¹è±¡ã€‚\né˜è¿°ä¸€ä¸ªBeanè·å–çš„æµç¨‹  å°è¯•è·å–å•ä¾‹Bean æ£€æŸ¥ä¸€çº§ç¼“å­˜æ˜¯å¦æœ‰ï¼Œæ²¡æœ‰çš„è¯ï¼Œæ£€æŸ¥å½“å‰è·å–çš„Beanæ˜¯å¦æ­£åœ¨åˆ›å»ºï¼Œå¦‚æœæ­£åœ¨åˆ›å»ºå³å‡ºç°äº†Beanäº’ç›¸ä¾èµ–æƒ…å†µï¼Œæ£€æŸ¥ä¸‰çº§ç¼“å­˜æ˜¯å¦å·²ç»æœ‰æå‰å¯è¢«ä¾èµ–çš„å¯¹è±¡ï¼Œå¦‚æœæ²¡æœ‰çš„è¯ï¼Œæ£€æŸ¥äºŒçº§ç¼“å­˜æ˜¯å¦æœ‰å…¶å·¥å‚ï¼Œæœ‰çš„è¯ï¼Œä½¿ç”¨å·¥å‚ï¼Œå®ä¾‹åŒ–è¿™ä¸ªBeanï¼Œæ”¾å…¥ä¸‰çº§ç¼“å­˜é‡Œã€‚ä¾›å…¶ä»–Beanä¾èµ–ä½¿ç”¨ æ²¡è·å–åˆ°ï¼Œå¯èƒ½æ˜¯åŸå‹Beanï¼Œä¹Ÿå¯èƒ½æ˜¯å•ä¾‹Beanæ²¡æœ‰å®ä¾‹åŒ– æ£€æŸ¥å¦‚æœæ˜¯åŸå‹Beanï¼Œè€Œä¸”æ­£åœ¨åˆ›å»ºä¸­ï¼Œå³å‡ºç°äº†åŸå‹Beanè¢«ä¾èµ–çš„æƒ…å†µï¼Œç›´æ¥æŠ›å‡ºå¼‚å¸¸ å‡†å¤‡BeanDefinitionï¼Œå¦‚æœæ¡£æœŸå·¥å‚æ²¡æœ‰ç›¸åº”çš„BDï¼Œè€Œä¸”çˆ¶å·¥å‚åˆå­˜åœ¨BDï¼Œä½¿ç”¨çˆ¶å·¥å‚çš„getBeanæ–¹æ³•å»è·å–Bean æ ‡è®°Beanåˆ›å»ºè¿‡äº† ä»å½“å‰å·¥å‚è¯»å–BD,å¹¶ä¸”è½¬ä¸ºRootBeanDefinitionï¼Œè·å–æœŸé—´ï¼Œè¿˜è¦æ£€æŸ¥çˆ¶å·¥å‚æ˜¯å¦ä¹Ÿæœ‰è¯¥Beançš„BDï¼Œæœ‰çš„è¯ï¼Œä»¥çˆ¶å·¥å‚å¾—BDä¸ºåŸºç¡€ï¼Œå­å·¥å‚å¾—BDè¦†ç›–æ‰å…¶å±æ€§ æ£€æŸ¥BDæ˜¯ä¸æ˜¯æŠ½è±¡çš„ï¼Œæ— æ³•å®ä¾‹åŒ–çš„ç±»ï¼ŒæŠ›å‡ºå¼‚å¸¸ æ£€æŸ¥BDä¸­å¾—DependsOnå±æ€§ï¼Œé’ˆå¯¹æ‰€æœ‰Dependï¼Œå¾ªç¯å®ä¾‹åŒ–ï¼Œå¦‚æœæ£€æŸ¥åˆ°æœ‰Dependå¾—Beanåˆä¾èµ–äºå½“å‰ç›®æ ‡Beanï¼ŒæŠ›å‡ºå¼‚å¸¸ï¼Œäº’ç›¸æå‰ä¾èµ–äº†ã€‚å¹¶ä¸”å»ºç«‹ç›¸å…³å…³ç³»ï¼Œæ‰€ä»¥DependOnæ„ä¹‰æ˜¯ï¼Œä¾èµ–äºä¸€ä¸ªå®Œå…¨å®ä¾‹åŒ–å®Œæˆåçš„Bean å¦‚æœæ˜¯å•ä¾‹çš„è¯ï¼Œå¼€å§‹åˆ›å»ºå•ä¾‹Beanï¼Œåˆ›å»ºåŒ¿åå·¥å‚å¯¹è±¡ æ ‡è®°å•ä¾‹Beanæ­£åœ¨è¢«åˆ›å»º ä½¿ç”¨å·¥å‚å¯¹è±¡å»è°ƒç”¨getObjectæ–¹æ³• å®é™…ä¸Šæ‰§è¡Œäº†createBeanæ–¹æ³• æ ¹æ®ä¹‹å‰çš„RootBDï¼Œè§£æå‡ºéœ€è¦å®ä¾‹åŒ–çš„Classå¯¹è±¡ æ£€æŸ¥MethodOverridesç›®æ ‡æ–¹æ³•æ˜¯å¦å­˜åœ¨Classå¯¹è±¡ä¸­ åœ¨å®ä¾‹åŒ–å¯¹è±¡ä¹‹å‰ï¼Œç»™InstantiationAwareBeanPostProcessoræœºä¼šå»æ”¹å˜å®ä¾‹ï¼Œè°ƒç”¨å…¶postProcessBeforeInstantiationï¼ŒAOPå°±æ˜¯åœ¨è¿™é‡Œå®ç°çš„ï¼Œæ­¤å¤–ï¼Œå¦‚æœè¿”å›äº†ï¼Œè¿˜ä¼šè°ƒç”¨BPPçš„postProcessAfterInitializationï¼Œä½†ä¸ä¼šè°ƒç”¨postProcessBeforeInitializationäº† å¦‚æœæ²¡æœ‰è¢«InstantiationAwareBeanPostProcessoræ”¹å˜äº†çš„è¯ï¼Œå¼€å§‹è¿›å…¥çœŸæ­£çš„å®ä¾‹åŒ–æ–¹æ³• å®ä¾‹åŒ–ä¸€ä¸ªBeanWrapperImplå»å°è£…å®ä¾‹ è§£æClasså¯¹è±¡ï¼Œç¡®å®šClasså¯¹è±¡æœ‰Publicä¿®é¥°ç¬¦ å¦‚æœæœ‰FactoryMethodçš„è¯ï¼Œç›´æ¥è°ƒç”¨FactoryMethodè¿”å›å®ä¾‹ï¼Œå°è£…åœ¨BeanWrapperImplï¼Œè¿™é‡Œé¢ä¹Ÿä¼šåˆå§‹åŒ–initBeanWrapperï¼Œå°†å±æ€§ç¼–è¾‘å™¨æ³¨å…¥åˆ°BeanWrapperImplèº«ä¸Šï¼Œç”¨äºåç»­çš„å±æ€§æ³¨å…¥ å¼€å§‹è§£ææ„é€ å‡½æ•°æˆ–è€…æ˜¯FactoryMethodï¼Œå¦‚æœè§£æè¿‡äº†ï¼Œç›´æ¥å»å®ä¾‹åŒ– å¦åˆ™è¿›å…¥æ„é€ å‡½æ•°è§£æ è§£æä¹‹å‰ï¼Œçœ‹BPPæœ‰æ²¡æœ‰æä¾›äº†æ„é€ å‡½æ•°ï¼Œå³SmartInstantiationAwareBeanPostProcessorçš„determineCandidateConstructorsæ–¹æ³•æ‰§è¡Œï¼Œå¦‚æœè¿”å›äº†æ„é€ å‡½æ•°ï¼Œå°±ç”¨BPPçš„äº†ã€‚ æ²¡æœ‰çš„è¯ï¼Œè¿›å…¥é»˜è®¤çš„è§£æï¼Œä¾èµ–å…ˆçœ‹ç¼“å­˜é‡Œæœ‰æ²¡æœ‰è§£æè¿‡çš„å‚æ•°ï¼Œå› ä¸ºæ„é€ æ–¹æ³•æ³¨å…¥çš„è¯ï¼Œå¾ˆæ¶ˆè€—æ€§èƒ½ï¼Œæ²¡æœ‰ç¼“å­˜çš„è¯ï¼Œå…ˆçœ‹ç”¨æˆ·è·å–beanæ—¶æœ‰æ²¡æœ‰ä¼ å…¥argsï¼Œå³æ„é€ å‡½æ•°çš„å‚æ•°ã€‚æ²¡æœ‰çš„è¯ï¼Œè€Œä¸”åªæœ‰ä¸€ä¸ªå€™é€‰çš„æ„é€ å‡½æ•°ï¼Œå°±ç›´æ¥ç”¨ä½¿ç”¨æ— å‚çš„äº†ï¼Œæ²¡æœ‰çš„è¯ï¼Œå…ˆå»è§£æå‚æ•°ï¼Œconstruct-argï¼Œæ—¢å¯ä»¥æ—¶Indexï¼Œä¹Ÿå¯ä»¥æ˜¯nameã€‚æ ¹æ®ç”¨æˆ·ä¼ å…¥çš„argé•¿åº¦ï¼Œå»è§£æã€‚ æœ€åè§£æå®Œæˆåï¼Œä½¿ç”¨å®ä¾‹åŒ–ç­–ç•¥å»å®ä¾‹åŒ–å³å¯ï¼Œè¿™é‡Œä¹Ÿå¯ä½¿ç”¨cglibå»å¤„ç†ï¼Œç„¶åå°è£…åœ¨BeanWrapperImplä¸­ è‡³æ­¤ï¼ŒBeanWapperé‡Œå·²ç»åŒ…å«äº†æˆ‘ä»¬çš„ç›®æ ‡å¯¹è±¡çš„å®ä¾‹äº† ç„¶ååˆ›å»ºäºŒçº§ç¼“å­˜ï¼Œå°†ä¸Šä¸€æ­¥BeanWapperé‡Œçš„å®ä¾‹ï¼Œä½œä¸ºäºŒçº§ç¼“å­˜è¿”å›çš„å¯¹è±¡ï¼ŒåŠ è½½ç¼“å­˜é‡Œ è‡³æ­¤ï¼ŒäºŒçº§ç¼“å­˜çš„å·¥å‚åŠ å…¥ äº†ã€‚å½“åœ¨ä¸€å¼€å§‹è·beanï¼Œä¸€çº§è·å–ä¸åˆ°ï¼Œè·å–äºŒçº§æœ‰å·¥å‚çš„æ—¶å€™ï¼Œå°±ä¼šæŠŠBeanWapperçš„å®ä¾‹æš´éœ²å‡ºå»ï¼Œä¾›åç»­ä½¿ç”¨ ç„¶åå¼€å§‹åˆå§‹åŒ–å®ä¾‹ å°†ä¸Šé¢æš´éœ²å‡ºæ¥çš„ç¤ºä¾‹è¿›è¡Œå±æ€§æ³¨å…¥ ç»™InstantiationAwareBeanPostProcessorçš„postProcessAfterInstantiationåœ¨å±æ€§æ³¨å…¥ä¹‹å‰æœ€åä¸€æ¬¡æœºä¼šï¼Œå»æ”¹å˜Beanï¼Œå¹¶ä¸”é˜»æ­¢Beançš„å±æ€§æ³¨å…¥ åˆ¤æ–­å±æ€§æ³¨å…¥çš„æ˜¯byNameè¿˜æ˜¯byTypeï¼Œé’ˆå¯¹æ‰€æœ‰çš„éç®€å•çš„å±æ€§ï¼Œè¿˜æœ‰æ’é™¤æ‰€æœ‰çš„ignoredDependencyInterfacesä¸­çš„æ¥å£ã€‚è¿›è¡ŒgetBeanæ“ä½œï¼Œä¿å­˜åˆ°PropertyValuesä¸­ ä½¿ç”¨InstantiationAwareBeanPostProcessorçš„postProcessPropertiesï¼Œå¯ä»¥è¿›è¡Œä¿®æ”¹å±æ€§ã€‚ç»§ç»­ä½¿ç”¨postProcessPropertyValuesï¼Œç»§ç»­å¯ä»¥æ›´è¯¥å±æ€§ å¾—åˆ°æ‰€æœ‰å±æ€§åï¼Œåº”ç”¨å±æ€§åˆ°Beanå®ä¾‹èº«ä¸Šï¼Œåœ¨åº”ç”¨å±æ€§çš„æ—¶å€™ï¼Œä¼šæ‰¾åˆ°å‰å·¥å‚é‡Œçš„æ‰€æœ‰çš„TypeConverterå»å°†å±æ€§å˜ä¸ºéœ€è¦çš„å±æ€§ï¼Œå¦‚æœå˜ä¸æˆä¼šæŠ¥é”™ è‡³æ­¤ï¼Œå±æ€§èµ‹å€¼å®Œæ¯• å¤åˆ¶å®Œæ¯•åï¼Œå¼€å§‹åˆå§‹åŒ–Beanï¼Œå…ˆæ¿€æ´»æ‰€æœ‰çš„awareæ–¹æ³•ï¼Œ è°ƒç”¨BPPçš„postProcessBeforeInitializationåˆå§‹åŒ–ä¹‹å‰æ–¹æ³•ï¼Œè®°ä½ï¼Œè¿™é‡Œçš„åˆå§‹åŒ–ï¼Œæ˜¯Beanå·²ç»å®ä¾‹åŒ–ä¹‹åçš„äº‹æƒ…äº†ï¼Œæ˜¯æ‰§è¡Œå…¶ä»–äº‹æƒ…çš„åˆå§‹åŒ– æ‰§è¡ŒafterPropertiesSetæ–¹æ³•ï¼Œåœ¨æ‰§è¡Œinit-methodsæ–¹æ³• è°ƒç”¨BPPçš„postProcessAfterInitializationåˆå§‹åŒ–ä»¥åæ–¹æ³• è‡³æ­¤è¿”å›æš´éœ²çš„beanï¼Œå³getBeanç»“æŸ æœ€åå¤„ç†é”€æ¯çš„æ–¹æ³•ï¼Œå³å‡ºå‘destory-methodçš„æ–¹æ³•  Springæ˜¯å¦‚ä½•å¤„ç†æ‰å¾ªç¯ä¾èµ–çš„  é’ˆå¯¹éå•ä¾‹Beanå‡ºç°å¾ªç¯ä¾èµ–ç›´æ¥æŠ›å‡ºå¼‚å¸¸ å•ä¾‹Bean Springå­˜åœ¨3ä¸ªç¼“å­˜Map  Springå®Œå…¨ç”Ÿæˆå¥½çš„BeanMapï¼Œkeyæ˜¯Beançš„nameï¼ŒValueæ˜¯å®ä¾‹å¯¹è±¡ Springç”ŸæˆBeançš„å·¥å‚Mapï¼Œkeyæ˜¯Beançš„nameï¼Œvalueæ˜¯å®ç°äº†ObjectFactoryæ¥å£çš„å®ä¾‹å¯¹è±¡ Springå°šæœªåˆå§‹åŒ–ï¼Œå³èµ‹äºˆå±æ€§æˆ–è€…å…¶ä»–åˆå§‹åŒ–åŠ¨ä½œçš„Beanå®ä¾‹Mapï¼Œkeyæ˜¯Beançš„nameï¼Œvalueæ˜¯å·¥å‚mapçš„å·¥å‚çš„è¿”å›å€¼ï¼Œå³ObjectFactoryçš„getObjectæ–¹æ³•ç»“æœ   å‡è®¾å­˜åœ¨å¯¹è±¡Aä¾èµ–äºå¯¹è±¡Bï¼Œå¯¹è±¡Beanä¾èµ–äºå¯¹è±¡A  Springæ ¹æ®Açš„nameï¼Œé¦–å…ˆå–BeanMapé‡Œæ‰¾æ˜¯å¦æœ‰Açš„å®ä¾‹ï¼Œæ²¡æœ‰çš„è¯ï¼Œæ£€æŸ¥Aæ˜¯å¦æ­£åœ¨åˆ›å»ºï¼Œå¦‚æœæ­£åœ¨åˆ›å»ºï¼Œåˆ™è¯´æ˜å‡ºç°äº†å¾ªç¯ä¾èµ–ã€‚ï¼ˆéœ€è¦è·å–Aï¼Œå‘ç°Aåˆåœ¨åˆ›å»ºï¼Œè¡¨åæœ‰å…¶ä»–beanéœ€è¦Aï¼‰ï¼Œå°è¯•ä»å¯æå‰ä¾èµ–çš„BeanMapè·å–EarlyBeanReferenceï¼Œå¦‚æœæ²¡æœ‰ï¼Œåˆ™å°è¯•ä»å·¥å‚Mapé‡Œæ‰¾Aå¯¹åº”çš„å·¥å‚å¯¹è±¡ï¼Œå¦‚æœæœ‰å·¥å‚å¯¹è±¡ï¼Œåˆ™è°ƒç”¨å·¥å‚å¯¹è±¡è¿›è¡Œè¿”å›ï¼Œå¹¶ä¸”å°†å·¥å‚è¿”å›çš„Beanå®ä¾‹ä½œä¸ºEarlyBeanReferenceï¼Œæ”¾å…¥æœªå®Œå…¨å®ä¾‹åŒ–ç»“æŸBeanMapé‡Œï¼Œåˆ é™¤å·¥å‚Mapå¯¹åº”çš„valueã€‚æ­¤æ—¶å·¥å‚Mapä¸ºç©ºã€‚ æ­¤æ—¶ï¼ŒAæ²¡æœ‰æ­£åœ¨åˆ›å»ºï¼Œç»§ç»­ æ ‡è®°Aæ­£åœ¨åˆ›å»ºï¼Œæ ¹ç»BeanDefinitionç”ŸæˆBeanå®ä¾‹å¯¹è±¡ï¼Œï¼ˆæ­¤æ—¶å¯¹è±¡å®ä¾‹å·²ç»ç”Ÿæˆå®Œæ¯•ï¼Œä½†æ˜¯è¿˜æ²¡æœ‰åˆå§‹åŒ–ï¼‰ï¼Œå¹¶ä¸”æŠŠAçš„åˆ›å»ºå·¥å‚ï¼Œæ”¾å…¥å·¥å‚Mapï¼Œè€Œè¿™ä¸ªåˆ›å»ºå·¥å‚getObjectè¿”å›å€¼å°±æ˜¯åˆšæ‰ç”Ÿæˆçš„å®ä¾‹å¯¹è±¡ï¼Œå¹¶ä¸”ç»™SmartInstantiationAwareBeanPostProcessoræ¥å£æœºä¼šå–æ”¹å˜è¿™ä¸ªEarlyBeanReferenceå¯¹è±¡ã€‚ å¾—åˆ°å®ä¾‹åŒ–åçš„Aå¯¹è±¡ï¼Œå¼€å§‹æ³¨å…¥Açš„å±æ€§ï¼Œå‘ç°Açš„å±æ€§bï¼Œéœ€è¦Bå¯¹è±¡ã€‚ Bå¯¹è±¡å¼€å§‹è·å–ï¼ˆæ­¤æ—¶ï¼ŒAè¿˜æ²¡æœ‰ç»“æŸï¼Œå³ä¸€çº§ç¼“å­˜ä¸­æ²¡æœ‰Aï¼ŒäºŒçº§ç¼“å­˜ä¸­æœ‰Açš„å·¥å‚Mapï¼‰ Bçš„è·å–å¦‚ä¸Šè¿°ä¸€è‡´ï¼Œ ç›´è‡³Bå®ä¾‹åŒ–ç»“æŸï¼Œå¼€å§‹æ³¨å…¥Bçš„å±æ€§ï¼Œå‘ç°Bçš„å±æ€§aï¼Œéœ€è¦Aå¯¹è±¡ åˆåˆ°äº†Aå¯¹è±¡å¼€å§‹è·å– æ­¤æ—¶ï¼Œè¿›å…¥ç¬¬ä¸€ä¸ªæµç¨‹ï¼Œå‘ç°ä¸€çº§ç¼“å­˜é‡Œæ²¡æœ‰Aï¼Œè€ŒAåˆæ­£åœ¨åˆ›å»ºä¸­ï¼Œå‡ºç°å¾ªç¯ä¾èµ–ï¼Œå»äºŒçº§ç¼“å­˜é‡Œæ‰¾Açš„å·¥å‚Mapï¼Œè°ƒç”¨å·¥å‚Mapæ–¹æ³•å»ï¼Œå¾—åˆ°äº†EarlyBeanReferenceï¼Œæ”¾å…¥ä¸‰çº§ç¼“å­˜é‡Œï¼Œè¿”å›å›å» å³æ­¤æ—¶ï¼ŒBæ³¨å…¥å±æ€§æˆåŠŸï¼Œå¹¶ä¸”è¿”å›äº†ä¸€ä¸ªEarlyBeanReferenceï¼Œå³å½“å‰æ­£åœ¨åˆ›å»ºçš„Aå¯¹è±¡å®ä¾‹ã€‚ Bæ³¨å…¥æˆåŠŸå±æ€§åï¼ŒBå®ä¾‹åŒ–å®Œå…¨ç»“æŸï¼Œç»“æŸåï¼Œæ¸…é™¤Bçš„äºŒä¸‰çº§ç¼“å­˜ï¼ŒåŠ å…¥ä¸€çº§ç¼“å­˜å¹¶è¿”å› æ­¤æ—¶å›åˆ°äº†Açš„æ³¨å…¥Bå±æ€§é€»è¾‘ä¸­ï¼ŒAå¾—åˆ°äº†Bå®ä¾‹ã€‚è€Œè¿™ä¸ªå®ä¾‹é‡Œçš„Aå±æ€§å¯¹è±¡ï¼Œå’Œå½“å‰è·å–Açš„å¯¹è±¡æ˜¯ä¸€ä¸ª Aç»§ç»­å®Œæˆåˆå§‹åŒ–åŠ¨ä½œï¼Œæœ€åAå®ä¾‹åŒ–å®Œå…¨ç»“æŸï¼Œæ¸…æ¥šAçš„äºŒä¸‰çº§ç¼“å­˜ï¼ŒåŠ å…¥ä¸€çº§ç¼“å­˜å¹¶è¿”å›   åªæœ‰2ä¸ªç¼“å­˜è¡Œå—ï¼Ÿä¸ºä»€ä¹ˆä¸€å®šè¦3ä¸ª  BeanMapæ— ç”¨è´¨ç–‘æ˜¯éœ€è¦çš„ å¦‚æœåªæœ‰å·¥å‚Mapè€Œæ²¡æœ‰ï¼Œå¯æå‰ä¾èµ–çš„BeanMapçš„è¯ï¼Œé‚£ä¹ˆåœ¨ä¸€å¼€å§‹ä»ç¼“å­˜ä¸­è·å–Beanï¼Œä¸€çº§ç¼“å­˜æ— æ³•è·å–åˆ°ï¼Œç›´æ¥å°±æœ‰å·¥å‚Beanï¼Œä¸€æ—¦æœ‰å·¥å‚å°±è°ƒç”¨å·¥å‚è¿”å›çš„å€¼ï¼Œè¿™æ ·æ˜¯ä¸è¡Œçš„ï¼Œå› ä¸ºåœ¨å·¥å‚è°ƒç”¨Beançš„æ—¶å€™ï¼Œæœ‰å¾ˆå¤šåŠ¨ä½œå°±ä¼šè¿›è¡Œé‡å¤ï¼Œæ¯”å¦‚å·¥å‚è·å–çš„æ—¶å€™ï¼Œå¯ä»¥ç»™SmartInstantiationAwareBeanPostProcessoræœºä¼šå»æ›´æ”¹EarlyBeanReferenceå¯¹è±¡ï¼Œé‡å¤æ‰§è¡Œäº†ã€‚ç¬¬äºŒï¼Œä¸å·¥å‚æ¨¡å¼çš„æ€æƒ³è¿èƒŒï¼Œå·¥å‚åªéœ€è¦åˆ¶é€ ä¸€æ¬¡ï¼Œè€Œä¸æ˜¯æ¯æ¬¡éƒ½åˆ¶é€ ã€‚ å¦‚æœåªæœ‰å¯æå‰ä¾èµ–çš„BeanMapï¼Œè€Œæ²¡æœ‰å·¥å‚Mapã€‚å®é™…ä¸Šæ˜¯å¯ä»¥çš„ï¼Œåªä¸è¿‡æ²¡æœ‰å·¥å‚çš„è¯ï¼Œä¼šå°†å¤§éƒ¨åˆ†å·¥ä½œéƒ½æŠ›ç»™åˆ›å»ºBeançš„æµç¨‹é‡Œï¼Œä¾‹å¦‚SmartInstantiationAwareBeanPostProcessorç­‰å·¥å‚åº”è¯¥è´Ÿè´£çš„å·¥ä½œ    ApplicationContextçš„Refreshæ–¹æ³•  Enviromentï¼Œç¯å¢ƒå‚æ•°ï¼Œæ ¹æ®ä¸åŒçš„ç¯å¢ƒï¼Œå®ç°Environmentä¸åŒçš„å­ç±»ï¼Œä¾‹å¦‚Webç¯å¢ƒä¼šå®ç°ï¼ŒStandardServletEnvironmentï¼Œé»˜è®¤æ˜¯å®ç°StandardEnvironmentï¼ŒåŒ…å«å¾ˆå¤šç¯å¢ƒå˜é‡ï¼Œç³»ç»Ÿå˜é‡ï¼Œjavaç¯å¢ƒå˜é‡ï¼ŒServletç¯å¢ƒå˜é‡ åˆ›å»ºbeanFactoryä½œä¸ºæˆå‘˜å˜é‡ï¼ŒApplicationContextè‡ªèº«ä¹Ÿå®ç°äº†BeanFactoryæ¥å£ï¼Œåªä¸è¿‡å…·ä½“å®ç°çš„æ–¹æ³•æ˜¯æˆå‘˜å˜é‡çš„beanFactoryçš„æ–¹æ³•ã€ å¡«å……å·¥å‚  å¢åŠ SPELè¡¨è¾¾å¼è§£æå™¨ å±æ€§ç¼–è¾‘å™¨æ³¨å…¥ å¢åŠ ä¸€ä¸ªApplicationContextAwareProcessorçš„BPPï¼Œåœ¨Beanå®ä¾‹åŒ–ä¹‹åï¼Œæ¿€æ´»å®ç°äº†awareæ¥å£çš„æ–¹æ³•çš„ä¸€ä¸ªBPP é…ç½®å¿½ç•¥æŸäº›ç±»å‹çš„å±æ€§è‡ªåŠ¨æ³¨å…¥ï¼Œå¢åŠ æŸäº›ç±»å‹è‡ªåŠ¨æ³¨å…¥   postProcessBeanFactoryï¼šç•™ç»™å­ç±»å»å®ç° è®°å½•å¯åŠ¨è·¯å¾„ æ¿€æ´»BeanFactoryPostProcessorï¼ŒinvokeBeanFactoryPostProcessors æ³¨å†ŒBeanPostProcessor åˆå§‹åŒ–å›½é™…åŒ–æ–‡ä»¶ åˆå§‹åŒ–initApplicationEventMulticasterï¼Œäº‹ä»¶ä¼ é€å™¨ï¼Œç”¨äºå‘é€äº‹ä»¶ æ³¨å†Œäº‹ä»¶ç›‘å¬å™¨ è®¾ç½®ConversionService é”å®šæ‰€æœ‰BeanDefinitionsï¼Œé˜²æ­¢æ”¹å˜ å®ä¾‹åŒ–å‰©ä¸‹æ‰€æœ‰çš„no-lazyå®ä¾‹ è°ƒç”¨æ‰€æœ‰å®ç°LifeCycleæ¥å£çš„bean å‘é€ContextRefreshedEventäº‹ä»¶  BeanFactoryPostProcessorå’ŒBeanPostProcessoråŒºåˆ«   BeanFactoryPostProcessoræ˜¯å¯ä»¥ä¿®æ”¹Beançš„å…ƒæ•°æ®ï¼Œæ˜¯æ§åˆ¶BeanFactoryçš„ï¼Œè€ŒBeanPostProcessoræ˜¯Beanå®ä¾‹çš„å¤„ç†å™¨ï¼Œå¯ä»¥ä¿®æ”¹Beançš„å®ä¾‹","title":"Springé—®é¢˜æ•´ç†"},{"content":"Redis redisæœ‰å“ªäº›æ•°æ®ç»“æ„ï¼Œä½ ç”¨è¿‡å“ªäº›ï¼Œåšè¿‡ä»€ä¹ˆäº‹æƒ…   String\næœ€ç®€å•çš„æ•°æ®ç»“æ„ï¼Œç”¨äºå­˜æ”¾å­—ç¬¦ä¸²ï¼Œå®é™…ä¸Šåœ¨redisä¸­å­˜æ”¾çš„æ˜¯å­—ç¬¦æ•°ç»„ï¼Œç±»ä¼¼javaä¸­çš„arrayListï¼Œ**Redis ä¸ºäº†å¯¹å†…å­˜åšæè‡´çš„ä¼˜åŒ–ï¼Œä¸åŒé•¿åº¦çš„å­—ç¬¦ä¸²ä½¿ç”¨ä¸åŒçš„ç»“æ„ä½“æ¥è¡¨ç¤ºã€‚**Redis è§„å®šäº†å­—ç¬¦ä¸²çš„é•¿åº¦ä¸å¾—è¶…è¿‡ 512 MB\n  List\nåº•å±‚ç”¨çš„åŒå‘åˆ—è¡¨ï¼Œç±»ä¼¼javaä¸­çš„LinkedListï¼Œå› ä¸ºæ˜¯é“¾è¡¨æ‰€æœ‰ï¼Œæ’å…¥åˆ é™¤éƒ½æ˜¯O(1)ï¼ŒæŸ¥è¯¢æ˜¯O(n)\nå¸¸è§çš„å‘½ä»¤\n  lpushä»å¤´æ·»åŠ å…ƒç´ ï¼Œrpushä»å°¾æ·»åŠ \n  lpopæ‹¿å‡ºå¤´éƒ¨çš„å…ƒç´ ï¼Œrpopä»å°¾éƒ¨æ‹¿å…ƒç´ \nç´¢å¼•ï¼Œlpush+lpopå³å¯å®ç°æ ˆï¼Œrpush+lpopå¯ä»¥å®ç°é˜Ÿåˆ—\n    Hash\nå¯¹åº”ç€javaä¸­çš„hashMap\n  Set\nRedis çš„é›†åˆç›¸å½“äº Java è¯­è¨€ä¸­çš„ HashSetï¼Œå®ƒå†…éƒ¨çš„é”®å€¼å¯¹æ˜¯æ— åºã€å”¯ä¸€çš„ã€‚å®ƒçš„å†…éƒ¨å®ç°ç›¸å½“äºä¸€ä¸ªç‰¹æ®Šçš„å­—å…¸ï¼Œå­—å…¸ä¸­æ‰€æœ‰çš„ value éƒ½æ˜¯ä¸€ä¸ªå€¼ NULLã€‚\n  Zset\nå®ƒç±»ä¼¼äº Java ä¸­ SortedSet å’Œ HashMap çš„ç»“åˆä½“ï¼Œä¸€æ–¹é¢å®ƒæ˜¯ä¸€ä¸ª setï¼Œä¿è¯äº†å†…éƒ¨ value çš„å”¯ä¸€æ€§ï¼Œå¦ä¸€æ–¹é¢å®ƒå¯ä»¥ä¸ºæ¯ä¸ª value èµ‹äºˆä¸€ä¸ª score å€¼ï¼Œç”¨æ¥ä»£è¡¨æ’åºçš„æƒé‡ã€‚\nä½¿ç”¨åœºæ™¯ï¼š\n æ’è¡Œæ¦œï¼Œkeyæ˜¯ç”¨æˆ·idï¼Œvalueæ˜¯è®¿é—®æ¬¡æ•°ã€‚ é™æµï¼Œkeyæ˜¯ç”¨æˆ·id+æ¥å£idï¼Œvalueæ˜¯æ—¶é—´æˆ³ï¼Œæ¯æ¬¡è¿›æ–¹æ³•ä¹‹å‰ï¼Œæ‹¿å½“å‰æ—¶é—´æˆ³-intervalï¼Œåˆ é™¤å°äºnow-intervalçš„å…ƒç´ ï¼Œç®—å‡ºåŠ å…¥å½“å‰è¿™æ¬¡è¯·æ±‚setä¸­çš„ä¸ªæ•°æ˜¯å¦å¤§äºmaxï¼Œå¤§äºåˆ™é™æµã€‚    BloomFilter\nä½¿ç”¨é«˜æ•ˆçš„æ•°æ®ç»“æ„è§£å†³æ˜¯å¦å­˜åœ¨çš„é—®é¢˜ï¼Œå¯ä»¥è§£å†³ç©¿é€çš„é—®é¢˜\n  HyperLogLog\nå¯ä»¥ç”¨äºåŸºæ•°çš„ç»Ÿè®¡ï¼Œä¾‹å¦‚UVç»Ÿè®¡\n  rediså¦‚ä½•åšåˆ°é™æµçš„ é™æµçš„å‡ ä¸ªæ–¹å¼\n  è®¡æ•°å™¨\nè®¡æ•°å™¨å³æ˜¯è®¡ç®—åœ¨å•ä½æ—¶é—´çª—å£å†…è¯·æ±‚è®¿é—®çš„æ¬¡æ•°æ˜¯å¦è¶…è¿‡é˜€å€¼ã€‚\nçª—å£åˆ†ä¸ºï¼šå›ºå®šçª—å£ã€æ»‘åŠ¨çª—å£\n  å›ºå®šçª—å£javaå®ç°ï¼š\nprivate final AtomicInteger cur = new AtomicInteger(0); private Long startTime; public boolean isAllowed(int maxCount, int interval) { //å¦‚æœæ²¡æœ‰ç¬¬ä¸€æ¬¡æ—¶é—´ï¼Œåˆ™å½“ä¸‹ä¸ºç¬¬ä¸€æ¬¡æ—¶é—´  if (startTime == null) startTime = System.currentTimeMillis(); //æ–°å¢ä¸€æ¬¡  cur.addAndGet(1); //å¦‚æœå½“å‰æ—¶é—´å‡å»å¼€å§‹æ—¶é—´ï¼Œå¤§äºé—´éš™äº†ï¼Œè¯´æ˜è¿›å…¥æ–°ä¸€è½®è®¡ç®—  if (System.currentTimeMillis() - interval * 1000L \u0026gt; startTime) { //é‡ç½®å¼€å§‹æ—¶é—´  startTime = System.currentTimeMillis(); //é‡ç½®è®¡æ•°  cur.set(1); return true; } //è¿˜åœ¨æ—¶é—´å†…  return cur.get() \u0026lt;= maxCount; } å›ºå®šçª—å£è§£å†³äº†åœ¨å•ä½æ—¶é—´å†…æµé‡æ¬¡æ•°ä¸ä¼šè¶…è¿‡é˜€å€¼ï¼Œä½†æ˜¯åœ¨ä¸´ç•Œç‚¹ä¼šå‡ºç°é—®é¢˜ã€‚\nåœ¨å‰ä¸€ä¸ªä¸€ç§’å†…ï¼Œ0.8ç§’åˆ°1ç§’ï¼Œè®¿é—®äº†5æ¬¡ï¼Œæ²¡æœ‰è¶…è¿‡é˜€å€¼ï¼Œ1ç§’åˆ°1.2ç§’è®¿é—®äº†5æ¬¡ï¼Œæ²¡æœ‰è¶…è¿‡é˜€å€¼ã€‚0.8ç§’åˆ°1.2ç§’ä¹‹é—´çš„0.4ç§’è®¿é—®äº†10æ¬¡ï¼Œè¶…è¿‡äº†é˜€å€¼ã€‚æ²¡æœ‰è¾¾åˆ°ç›®çš„ã€‚è¿™æ ·çš„é—®é¢˜åŸå› æ˜¯çª—å£æ²¡æœ‰â€œæ»‘åŠ¨â€ã€‚\n  æ»‘åŠ¨çª—å£\næ»‘åŠ¨çª—å£æ˜¯ä¸€ç§ç®—æ³•æ€æƒ³\n æ»‘åŠ¨çª—å£ç®—æ³•ï¼ˆSliding Window Algorithmï¼‰\n  Sliding window algorithm is used to perform required operation on specific window size of given large buffer or array.\næ»‘åŠ¨çª—å£ç®—æ³•æ˜¯åœ¨ç»™å®šç‰¹å®šçª—å£å¤§å°çš„æ•°ç»„æˆ–å­—ç¬¦ä¸²ä¸Šæ‰§è¡Œè¦æ±‚çš„æ“ä½œã€‚\n  This technique shows how a nested for loop in few problems can be converted to single for loop and hence reducing the time complexity.\nè¯¥æŠ€æœ¯å¯ä»¥å°†ä¸€éƒ¨åˆ†é—®é¢˜ä¸­çš„åµŒå¥—å¾ªç¯è½¬å˜ä¸ºä¸€ä¸ªå•å¾ªç¯ï¼Œå› æ­¤å®ƒå¯ä»¥å‡å°‘æ—¶é—´å¤æ‚åº¦ã€‚\n ç®€è€Œè¨€ä¹‹ï¼Œæ»‘åŠ¨çª—å£ç®—æ³•åœ¨ä¸€ä¸ªç‰¹å®šå¤§å°çš„å­—ç¬¦ä¸²æˆ–æ•°ç»„ä¸Šè¿›è¡Œæ“ä½œï¼Œè€Œä¸åœ¨æ•´ä¸ªå­—ç¬¦ä¸²å’Œæ•°ç»„ä¸Šæ“ä½œï¼Œè¿™æ ·å°±é™ä½äº†é—®é¢˜çš„å¤æ‚åº¦ï¼Œä»è€Œä¹Ÿè¾¾åˆ°é™ä½äº†å¾ªç¯çš„åµŒå¥—æ·±åº¦ã€‚å…¶å®è¿™é‡Œå°±å¯ä»¥çœ‹å‡ºæ¥æ»‘åŠ¨çª—å£ä¸»è¦åº”ç”¨åœ¨æ•°ç»„å’Œå­—ç¬¦ä¸²ä¸Šã€‚\nå¸¸è§çš„ç®—æ³•é¢˜ï¼Œæ‰¾åˆ°Aå­—ç¬¦ä¸²ä¸­ï¼ŒåŒ…å«Tä¸ªå­—ç¬¦çš„æœ€å°è¦†ç›–å­ä¸²\n//æ‰¾åˆ°å­—ç¬¦ä¸²EBBANCFä¸­åŒ…å«ABCä¸‰ä¸ªå­—ç¬¦çš„æœ€å°å­ä¸²  //å¾€å¾€ç±»ä¼¼äºâ€œ è¯·æ‰¾åˆ°æ»¡è¶³ xx çš„æœ€ x çš„åŒºé—´ï¼ˆå­ä¸²ã€å­æ•°ç»„ï¼‰çš„ xx â€è¿™ç±»é—®é¢˜éƒ½å¯ä»¥ä½¿ç”¨è¯¥æ–¹æ³•è¿›è¡Œè§£å†³ã€‚  public String noFixed(String str,String target){ String[] s = str.split(\u0026#34;\u0026#34;); String[] t = target.split(\u0026#34;\u0026#34;); //å®šä¹‰ä¸¤ä¸ªæŒ‡é’ˆï¼Œåœ¨sä¸Šæ»‘åŠ¨  int left=0,right=0; String res=null; List window=new ArrayList(); //ä¸€ç›´æ»‘åŠ¨ï¼Œç›´åˆ°å³æŒ‡é’ˆåˆ°å¤´äº†  while (right\u0026lt;s.length){ //ç§»åŠ¨å³æŒ‡é’ˆï¼Œä¸€ç›´åˆ°åŒ…å«äº†æ‰€æœ‰çš„ç›®æ ‡å…ƒç´   window.add(s[right]); right++; //å¦‚æœwindowæ»¡è¶³è¦æ±‚äº†ï¼Œå°±ç§»åŠ¨å·¦æŒ‡é’ˆ  while (window.containsAll(Arrays.asList(t))){ if(res==null){ //ç¬¬ä¸€æ¬¡å¾—åˆ°ç»“æœ  res=String.join(\u0026#34;\u0026#34;,window); }else{ //æ¯”è¾ƒå½“å‰çš„é•¿åº¦å¤§å°å’Œç›®å‰æœ€å°çš„ç»“æœ  res=(window.size()\u0026gt;res.length())?String.join(\u0026#34;\u0026#34;,window):res; } //ç§»åŠ¨å·¦æŒ‡é’ˆ,ç›´è‡³çª—å£ä¸æ»¡è¶³  window.remove(s[left]); left++; } } return res; } /** * å›ºå®šçª—å£å¤§å°ä¸ºf */ public String fixed(Integer f, String str) { String result = null; int right = 0; //å¯»æ‰¾å­—ç¬¦ä¸²ä¸­é•¿åº¦ä¸ºfçš„åŒ…å«æœ€å¤šå…ƒéŸ³å­—æ¯çš„å­ä¸²  String[] s = str.split(\u0026#34;\u0026#34;); List window = new ArrayList(); while (right \u0026lt; s.length) { //æ»‘åŠ¨å³æŒ‡é’ˆ  window.add(s[right]); right++; //è¾¾åˆ°ç›®æ ‡çª—å£çš„å¤§å°  if (right \u0026gt;= f) { //æ£€æŸ¥æ¡ä»¶  String cur = String.join(\u0026#34;\u0026#34;, window); if (result == null) { //æ»¡è¶³æ¡ä»¶çš„è¯  if (countOfVowel(cur) \u0026gt; 0) result = cur; } else { int i = countOfVowel(result); int j = countOfVowel(cur); result = i \u0026gt; j ? result : cur; } //ç§»åŠ¨å·¦æŒ‡é’ˆï¼Œå› ä¸ºçª—å£å›ºå®šï¼Œåˆ é™¤å·¦è¾¹right-fä¸ªå­—ç¬¦  window.remove(s[right-f]); } } return result; } private int countOfVowel(String s) { String[] split = s.split(\u0026#34;\u0026#34;); List\u0026lt;String\u0026gt; vowels = Arrays.asList(\u0026#34;A\u0026#34;, \u0026#34;E\u0026#34;, \u0026#34;I\u0026#34;, \u0026#34;O\u0026#34;, \u0026#34;U\u0026#34;); int res = 0; for (int i = 0; i \u0026lt; split.length; i++) { if (vowels.contains(split[i].toUpperCase())) { res++; } } return res; } æ»‘åŠ¨çª—å£è§£å†³äº†ä¸´ç•Œçš„é—®é¢˜ï¼Œä½†æ˜¯å½“åœ¨çª—å£å†…è¾¾åˆ°äº†é˜€å€¼ï¼Œå‰©ä½™çš„è¯·æ±‚éƒ½ä¼šè¢«æ‹’ç»ï¼Œè¿™æ ·å¤„ç†ä¸å¥½ã€‚\n    æ¼æ¡¶\npublic class LeakBucketLimit { /** * å‡ºæ°´ç‡ */ private final long rate=5L;//1ç§’å‡ºæ°´5ä¸ªè¯·æ±‚  /** * æ¡¶çš„å®¹é‡ */ private final long capacity=10L; /** * å½“å‰æ°´é‡ */ private long currentWater; /** * æœ€ååˆ·æ–°æ—¶é—´ */ private long refreshTime; public boolean tryAcquire(){ /** * è·å–å½“å‰æ—¶é—´ */ long currentTime = System.currentTimeMillis(); /** * æµå‡ºå»çš„æ°´ */ long outWater = (currentTime-refreshTime)/1000*rate; /** * å½“å‰ */ currentWater = Math.max(0,currentWater-outWater); System.out.println(currentWater); refreshTime=currentTime; if(currentWater\u0026gt;=capacity){ //ä¸å¤Ÿæµäº†  return false; } //åŠ æ°´  currentWater++; return true; } } ç¼ºé™·ï¼šä¸ç®¡æ˜¯ä»€ä¹ˆæµé‡ï¼Œæ¡¶éƒ½ä¼šæŒ‰ç…§rateä¸€ç‚¹ä¸€ç‚¹æ¶ˆè´¹ï¼Œå¦‚æœæ¥äº†çˆ†ç‚¸çš„æµé‡ï¼Œä¾ç„¶ä¸€ç‚¹ä¸€ç‚¹æ¶ˆè´¹ï¼Œå®é™…æƒ…å†µä¸­ï¼Œæˆ‘ä»¬å¸Œæœ›èƒ½å¿«é€Ÿæ¶ˆè´¹ã€‚è€Œå¹³æ—¶å°±æŒ‰ç…§rateæ¶ˆè´¹ã€‚\n  ä»¤ç‰Œæ¡¶\nä»¤ç‰Œæ¡¶å°±æ˜¯ä¸ºäº†è§£å†³æ¼æ¡¶çš„ç¼ºç‚¹ã€‚\n  æœ‰ä¸€ä¸ªä»¤ç‰Œç®¡ç†å‘˜ï¼Œæ ¹æ®é™æµå¤§å°ï¼Œå®šé€Ÿå¾€ä»¤ç‰Œæ¡¶é‡Œæ”¾ä»¤ç‰Œã€‚ å¦‚æœä»¤ç‰Œæ•°é‡æ»¡äº†ï¼Œè¶…è¿‡ä»¤ç‰Œæ¡¶å®¹é‡çš„é™åˆ¶ï¼Œé‚£å°±ä¸¢å¼ƒã€‚ ç³»ç»Ÿåœ¨æ¥å—åˆ°ä¸€ä¸ªç”¨æˆ·è¯·æ±‚æ—¶ï¼Œéƒ½ä¼šå…ˆå»ä»¤ç‰Œæ¡¶è¦ä¸€ä¸ªä»¤ç‰Œã€‚å¦‚æœæ‹¿åˆ°ä»¤ç‰Œï¼Œé‚£ä¹ˆå°±å¤„ç†è¿™ä¸ªè¯·æ±‚çš„ä¸šåŠ¡é€»è¾‘ï¼› å¦‚æœæ‹¿ä¸åˆ°ä»¤ç‰Œï¼Œå°±ç›´æ¥æ‹’ç»è¿™ä¸ªè¯·æ±‚ã€‚   /** * ä»¤ç‰Œæ¡¶å‘æ”¾é€Ÿåº¦ */ private final long tokenRate=5L; /** * æ¡¶çš„å®¹é‡ */ private final long capacity=10; /** * ä¸Šä¸€æ¬¡åˆ·æ–°çš„æ—¶é—´ */ private long refreshTime; /** * å½“å‰æ¡¶é‡Œçš„ä»¤ç‰Œ */ private long currentToken; public boolean tryAcquire(){ //å½“å‰æ—¶é—´  long currentTime=System.currentTimeMillis(); //æ›´æ–°å½“å‰æ¡¶é‡Œçš„ä»¤ç‰Œä¸ªæ•°  //å½“å‰tokenä¸ªæ•°=åŸæ¥å½“å‰ä¸ªæ•°+é—´éš™ä¹‹é—´ç”Ÿäº§å‡ºæ¥çš„tokenä¸ªæ•°ï¼ˆå¯èƒ½ä¸º0ï¼‰  currentToken =Math.min (capacity,(currentToken+currentTime - refreshTime) / 1000 * tokenRate); refreshTime=currentTime; if(currentToken\u0026gt;0){ //è¿˜æœ‰ä»¤ç‰Œ  currentToken--; return true; } return false; }   redisæ˜¯å•çº¿ç¨‹çš„å—ï¼Œå®ƒä¸ºä»€ä¹ˆè¿™ä¹ˆå¿«ï¼Ÿ   æ˜¯â€œå•çº¿ç¨‹â€ä¹Ÿä¸æ˜¯â€œå•çº¿ç¨‹â€\nåœ¨redis6.0åï¼Œæ¨å‡ºäº†å¤šçº¿ç¨‹çš„æ¦‚å¿µã€‚è¿™é‡Œçš„å•çº¿ç¨‹æˆ–è€…å¤šçº¿ç¨‹ï¼Œæ˜¯å¯¹äºæ•´ä¸ªredisæ¥è¯´çš„ã€‚å¹¶ä¸æ˜¯é’ˆå¯¹ä¸€ä¸ªç¼“å­˜çš„è¯»å–è€Œè¨€ã€‚\nè¯´redisæ˜¯å•çº¿ç¨‹çš„ï¼Œå¹¶ä¸æ˜¯è¯´redisçš„æ‰€æœ‰æ“ä½œæ¨¡å—éƒ½æ˜¯å•çº¿ç¨‹çš„ã€‚rediså•çº¿ç¨‹æŒ‡çš„æ˜¯ï¼Œç”¨å•ä¸ªçº¿ç¨‹è¿›è¡Œç½‘ç»œioå’Œé”®å€¼è¯»å–ã€‚\nRedisä¸­åªæœ‰ç½‘ç»œè¯·æ±‚æ¨¡å—å’Œæ•°æ®æ“ä½œæ¨¡å—æ˜¯å•çº¿ç¨‹çš„ã€‚è€Œå…¶ä»–çš„å¦‚æŒä¹…åŒ–å­˜å‚¨æ¨¡å—ã€é›†ç¾¤æ”¯æ’‘æ¨¡å—ç­‰æ˜¯å¤šçº¿ç¨‹çš„\nåœ¨redis6.0ä¹‹å‰ä¸€ç›´æ˜¯è¿™æ ·å¤„ç†çš„ï¼Œä¸ºä»€ä¹ˆå¯¹äºç½‘ç»œçš„ioä¸ç”¨å¤šçº¿ç¨‹å‘¢ã€‚\n é¦–å…ˆä½¿ç”¨å¤šçº¿ç¨‹çš„ç›®çš„æ˜¯ä¸ºäº†æé«˜IOåˆ©ç”¨ç‡å’ŒCPUåˆ©ç”¨ç‡ï¼Œè€Œredisçš„æ˜¯ioå¯†é›†å‹è½¯ä»¶ã€‚CPUå¹¶ä¸æ˜¯å®ƒçš„ç“¶é¢ˆã€‚å¯ä»¥ä½¿ç”¨å¤šçº¿ç¨‹æ¥æé«˜IO\nåˆ©ç”¨ç‡ï¼Œä½†æ˜¯æé«˜IOåˆ©ç”¨ç‡çš„æ–¹æ³•å¹¶éåªæœ‰å¤šçº¿ç¨‹ä¸€ç§æ–¹å¼\n å¯¹çº¿ç¨‹å¸¦æ¥çš„å¼Šç«¯ï¼šå†…å­˜æ¨¡å‹ï¼Œé”ï¼ŒCASæ“ä½œä¿è¯å¹¶å‘ã€‚\nè™½ç„¶ï¼Œé‡‡ç”¨å¤šçº¿ç¨‹å¯ä»¥å¸®åŠ©æˆ‘ä»¬æå‡CPUå’ŒI/Oçš„åˆ©ç”¨ç‡ï¼Œä½†æ˜¯å¤šçº¿ç¨‹å¸¦æ¥çš„å¹¶å‘é—®é¢˜ä¹Ÿç»™è¿™äº›è¯­è¨€å’Œæ¡†æ¶å¸¦æ¥äº†æ›´å¤šçš„å¤æ‚æ€§ã€‚è€Œä¸”ï¼Œå¤šçº¿ç¨‹æ¨¡å‹ä¸­ï¼Œå¤šä¸ªçº¿ç¨‹çš„äº’ç›¸åˆ‡æ¢ä¹Ÿä¼šå¸¦æ¥ä¸€å®šçš„æ€§èƒ½å¼€é”€ã€‚\næ‰€ä»¥ï¼Œåœ¨æå‡I/Oåˆ©ç”¨ç‡è¿™ä¸ªæ–¹é¢ä¸Šï¼ŒRediså¹¶æ²¡æœ‰é‡‡ç”¨å¤šçº¿ç¨‹æŠ€æœ¯ï¼Œè€Œæ˜¯é€‰æ‹©äº†å¤šè·¯å¤ç”¨ I/OæŠ€æœ¯ã€‚\nå¤šè·¯å¤ç”¨å³redisä½¿ç”¨å•çº¿ç¨‹ï¼Œå»æ¥æ”¶å¹¶å‘ä¸‹çš„ç½‘ç»œå¥—æ¥å­—ã€‚redisæ²¡æœ‰ä½¿ç”¨å¤šçº¿ç¨‹ï¼Œå‡å°‘çº¿ç¨‹ä¹‹å‰åˆ‡æ¢çš„å¼€é”€ï¼Œä»¥åŠå¤šçº¿ç¨‹å¸¦æ¥çš„å…±äº«å¯¹è±¡çš„å¹¶å‘é—®é¢˜ã€‚å› æ­¤å¤§å®¶ç§°redisæ˜¯å•çº¿ç¨‹çš„\nç”±äºå¤šè·¯å¤ç”¨çš„IOæ¨¡å‹æœ¬è´¨ä¸Šä»ç„¶æ˜¯åŒæ­¥é˜»å¡å‹IOæ¨¡å‹ã€‚\nåœ¨å¤šè·¯å¤ç”¨çš„IOæ¨¡å‹ä¸­ï¼Œåœ¨å¤„ç†ç½‘ç»œè¯·æ±‚æ—¶ï¼Œè°ƒç”¨ select ï¼ˆå…¶ä»–å‡½æ•°åŒç†ï¼‰çš„è¿‡ç¨‹æ˜¯é˜»å¡çš„ï¼Œä¹Ÿå°±æ˜¯è¯´è¿™ä¸ªè¿‡ç¨‹ä¼šé˜»å¡çº¿ç¨‹ï¼Œå¦‚æœå¹¶å‘é‡å¾ˆé«˜ï¼Œæ­¤å¤„å¯èƒ½ä¼šæˆä¸ºç“¶é¢ˆã€‚\nå¦‚æœèƒ½é‡‡ç”¨å¤šçº¿ç¨‹ï¼Œä½¿å¾—ç½‘ç»œå¤„ç†çš„è¯·æ±‚å¹¶å‘è¿›è¡Œï¼Œå°±å¯ä»¥å¤§å¤§çš„æå‡æ€§èƒ½ã€‚å¤šçº¿ç¨‹é™¤äº†å¯ä»¥å‡å°‘ç”±äºç½‘ç»œ I/O ç­‰å¾…é€ æˆçš„å½±å“ï¼Œè¿˜å¯ä»¥å……åˆ†åˆ©ç”¨ CPU çš„å¤šæ ¸ä¼˜åŠ¿ã€‚\nRedis 6.0é‡‡ç”¨å¤šä¸ªIOçº¿ç¨‹æ¥å¤„ç†ç½‘ç»œè¯·æ±‚ï¼Œç½‘ç»œè¯·æ±‚çš„è§£æå¯ä»¥ç”±å…¶ä»–çº¿ç¨‹å®Œæˆï¼Œç„¶åæŠŠè§£æåçš„è¯·æ±‚äº¤ç”±ä¸»çº¿ç¨‹è¿›è¡Œå®é™…çš„å†…å­˜è¯»å†™ã€‚æå‡ç½‘ç»œè¯·æ±‚å¤„ç†çš„å¹¶è¡Œåº¦ï¼Œè¿›è€Œæå‡æ•´ä½“æ€§èƒ½ã€‚\nä½†æ˜¯ï¼ŒRedis çš„å¤š IO çº¿ç¨‹åªæ˜¯ç”¨æ¥å¤„ç†ç½‘ç»œè¯·æ±‚çš„ï¼Œå¯¹äºè¯»å†™å‘½ä»¤ï¼ŒRedis ä»ç„¶ä½¿ç”¨å•çº¿ç¨‹æ¥å¤„ç†ã€‚å› æ­¤ä¸ä¼šæ•°æ®ä¸Šçš„å¹¶å‘å®‰å…¨é—®é¢˜\n  ä¸ºä»€ä¹ˆå¿«ï¼Ÿ\n  å®Œå…¨åŸºäºå†…å­˜\n  æ•°æ®ç»“æ„ç®€å•ï¼Œå¯¹æ•°æ®æ“ä½œä¹Ÿç®€å•ï¼Œå¦‚å“ˆå¸Œè¡¨ã€è·³è¡¨éƒ½æœ‰å¾ˆé«˜çš„æ€§èƒ½\n  é‡‡ç”¨å•çº¿ç¨‹ï¼Œé¿å…äº†ä¸å¿…è¦çš„ä¸Šä¸‹æ–‡åˆ‡æ¢å’Œç«äº‰æ¡ä»¶ï¼Œä¹Ÿä¸å­˜åœ¨å¤šè¿›ç¨‹æˆ–è€…å¤šçº¿ç¨‹å¯¼è‡´çš„åˆ‡æ¢è€Œæ¶ˆè€— CPU\n  ä½¿ç”¨å¤šè·¯I/Oå¤ç”¨æ¨¡å‹ï¼Œéé˜»å¡ï¼Œå³reactoræ¨¡å‹\nIOå¤šè·¯å¤ç”¨ï¼Œå³å•ä¸ªçº¿ç¨‹å¤„ç†å¤šä¸ªsocketè¯·æ±‚ï¼Œéé˜»å¡åªsocketè®¾ç½®ä¸ºéé˜»å¡ï¼Œå‘é€è¯·æ±‚åä¸ä¼šç»§ç»­ç­‰å¾…ï¼Œè€Œæ˜¯å¯ä»¥ç»§ç»­å†å‘ä¿¡æ¯æˆ–è€…æ”¶ä¿¡æ¯ã€‚epollç›‘å¬å“ªäº›socketä¸Šæœ‰äº‹ä»¶åˆ°è¾¾ï¼Œå½“ acceptã€readã€write å’Œ close æ–‡ä»¶äº‹ä»¶äº§ç”Ÿæ—¶ï¼Œå°±ä¼šå›è°ƒ FD ç»‘å®šçš„äº‹ä»¶å¤„ç†å™¨\n    Redisåœ¨ä¸»ä»å¤åˆ¶çš„å’Œæ•…éšœè½¬ç§»çš„è¿‡ç¨‹ä¸­ä¼šå¯¼è‡´æ•°æ®ä¸¢å¤±å—   å¼‚æ­¥æ•°æ®ä¸¢å¤±ï¼š\næ˜¾ç„¶æ˜¯ä¼šçš„ï¼Œä»ä¸Šé¢çš„ã€Œä¸»ä»å¤åˆ¶ã€æµç¨‹æ¥çœ‹ï¼Œè¿™ä¸ªè¿‡ç¨‹æ˜¯å¼‚æ­¥çš„ï¼ˆåœ¨å¤åˆ¶çš„è¿‡ç¨‹ä¸­ï¼šä¸»æœåŠ¡å™¨ä¼šä¸€ç›´æ¥æ”¶è¯·æ±‚ï¼Œç„¶åæŠŠä¿®æ”¹å‘½ä»¤å‘ç»™ä»æœåŠ¡å™¨ï¼‰ï¼Œ\nå‡å¦‚ä¸»æœåŠ¡å™¨çš„å‘½ä»¤è¿˜æ²¡å‘å®Œç»™ä»æœåŠ¡å™¨ï¼Œè‡ªå·±å°±æŒ‚æ‰äº†ã€‚è¿™æ—¶å€™æƒ³è¦è®©ä»æœåŠ¡å™¨é¡¶ä¸Šä¸»æœåŠ¡å™¨ï¼Œä½†ä»æœåŠ¡å™¨çš„æ•°æ®æ˜¯ä¸å…¨çš„\n  è„‘è£‚\nè¿˜æœ‰å¦ä¸€ç§æƒ…å†µå°±æ˜¯ï¼šæœ‰å¯èƒ½å“¨å…µè®¤ä¸ºä¸»æœåŠ¡å™¨æŒ‚äº†ï¼Œä½†çœŸå®æ˜¯ä¸»æœåŠ¡å™¨å¹¶æ²¡æœ‰æŒ‚( ç½‘ç»œæŠ–åŠ¨)ï¼Œè€Œå“¨å…µå·²ç»é€‰ä¸¾äº†ä¸€å°ä»æœåŠ¡å™¨å½“åšæ˜¯ä¸»æœåŠ¡å™¨äº†ï¼Œæ­¤æ—¶ã€Œå®¢æˆ·ç«¯ã€è¿˜æ²¡ååº”è¿‡æ¥ï¼Œè¿˜ç»§ç»­å†™å‘æ—§ä¸»æœåŠ¡å™¨å†™æ•°æ®\n  redisçš„é«˜å¯ç”¨å’ŒæŒä¹…åŒ– é«˜å¯ç”¨ï¼š\n  å“¨å…µï¼š\nå“¨å…µã€å¹²çš„äº‹æƒ…ä¸»è¦å°±æ˜¯ï¼šç›‘æ§ï¼ˆç›‘æ§ä¸»æœåŠ¡å™¨çš„çŠ¶æ€ï¼‰ã€é€‰ä¸»ï¼ˆä¸»æœåŠ¡å™¨æŒ‚äº†ï¼Œåœ¨ä»æœåŠ¡å™¨é€‰å‡ºä¸€ä¸ªä½œä¸ºä¸»æœåŠ¡å™¨ï¼‰ã€é€šçŸ¥ï¼ˆæ•…éšœå‘é€æ¶ˆæ¯ç»™ç®¡ç†å‘˜ï¼‰å’Œé…ç½®ï¼ˆä½œä¸ºé…ç½®ä¸­å¿ƒï¼Œæä¾›å½“å‰ä¸»æœåŠ¡å™¨çš„ä¿¡æ¯ï¼‰ï¼Œå¯ä»¥æŠŠã€Œå“¨å…µã€å½“åšæ˜¯è¿è¡Œåœ¨ã€Œç‰¹æ®Šã€æ¨¡å¼ä¸‹çš„RedisæœåŠ¡å™¨ï¼Œä¸ºäº†ã€Œé«˜å¯ç”¨ã€ï¼Œå“¨å…µä¹Ÿæ˜¯é›†ç¾¤æ¶æ„çš„ã€‚\n å“¨å…µå¯ä»¥ç†è§£ä¸ºç‰¹æ®Šçš„RedisæœåŠ¡å™¨ï¼Œä¸€èˆ¬ä¼šç»„æˆå“¨å…µé›†ç¾¤ å“¨å…µä¸»è¦å·¥ä½œæ˜¯ç›‘æ§ã€å‘Šè­¦ã€é…ç½®ä»¥åŠé€‰ä¸» å½“ä¸»æœåŠ¡å™¨å‘ç”Ÿæ•…éšœæ—¶ï¼Œä¼šã€Œé€‰å‡ºã€ä¸€å°ä»æœåŠ¡å™¨æ¥é¡¶ä¸Šã€Œå®¢è§‚ä¸‹çº¿ã€çš„æœåŠ¡å™¨ï¼Œç”±ã€Œé¢†å¤´å“¨å…µã€è¿›è¡Œåˆ‡æ¢    ä¸»ä»å¤‡ä»½ï¼šå’Œmysqlç±»ä¼¼ï¼Œä¸»èŠ‚ç‚¹åªå¤„ç†å†™çš„è¯·æ±‚ï¼Œè€Œä»èŠ‚ç‚¹å¤„ç†è¯»çš„è¯·æ±‚ï¼Œä»–ä»¬ä¹‹é—´æ˜¯é€šè¿‡psyncåŒæ­¥\n ä½ å¯åŠ¨ä¸€å°slave çš„æ—¶å€™ï¼Œä»–ä¼šå‘é€ä¸€ä¸ªpsyncå‘½ä»¤ç»™master ï¼Œå¦‚æœæ˜¯è¿™ä¸ªslaveç¬¬ä¸€æ¬¡è¿æ¥åˆ°masterï¼Œä»–ä¼šè§¦å‘ä¸€ä¸ªå…¨é‡å¤åˆ¶ã€‚masterå°±ä¼šå¯åŠ¨ä¸€ä¸ªçº¿ç¨‹ï¼Œç”ŸæˆRDBå¿«ç…§ï¼Œè¿˜ä¼šæŠŠæ–°çš„å†™è¯·æ±‚éƒ½ç¼“å­˜åœ¨å†…å­˜ä¸­ï¼ŒRDBæ–‡ä»¶ç”Ÿæˆåï¼Œmasterä¼šå°†è¿™ä¸ªRDBå‘é€ç»™slaveçš„ï¼Œslaveæ‹¿åˆ°ä¹‹ååšçš„ç¬¬ä¸€ä»¶äº‹æƒ…å°±æ˜¯å†™è¿›æœ¬åœ°çš„ç£ç›˜ï¼Œç„¶ååŠ è½½è¿›å†…å­˜ï¼Œç„¶åmasterä¼šæŠŠå†…å­˜é‡Œé¢ç¼“å­˜çš„é‚£äº›æ–°å‘½åéƒ½å‘ç»™slaveã€‚\n  PSYNCå‘½ä»¤ä¸¤ç§æ¨¡å¼ï¼šå®Œå…¨é‡åŒæ­¥ã€éƒ¨åˆ†é‡åŒæ­¥ å®Œå…¨é‡åŒæ­¥ï¼šä¸»ä»æœåŠ¡å™¨å»ºç«‹è¿æ¥ã€ä¸»æœåŠ¡å™¨ç”ŸæˆRDBæ–‡ä»¶å‘ç»™ä»æœåŠ¡å™¨ã€ä¸»æœåŠ¡å™¨ä¸é˜»å¡ï¼ˆç›¸å…³ä¿®æ”¹å‘½ä»¤è®°å½•è‡³bufferï¼‰ã€å°†ä¿®æ”¹å‘½ä»¤å‘ç»™ä»æœåŠ¡å™¨ éƒ¨åˆ†é‡åŒæ­¥ï¼šä»æœåŠ¡å™¨æ–­çº¿é‡è¿ï¼Œå‘é€RunIdå’Œoffsetç»™ä¸»æœåŠ¡å™¨ï¼Œä¸»æœåŠ¡å™¨åˆ¤æ–­offsetå’ŒrunIdï¼Œå°†è¿˜æœªåŒæ­¥ç»™ä»æœåŠ¡å™¨çš„offsetç›¸å…³æŒ‡ä»¤è¿›è¡Œå‘é€    redis clusterï¼š\nåˆ†ç‰‡é›†ç¾¤ï¼šç”¨äºè§£å†³ä¸»ä»å¤åˆ¶ã€è„‘è£‚çš„é—®é¢˜ã€‚ç±»ä¼¼es\n  redisçš„æŒä¹…åŒ–ï¼š\nâ€‹\tRedisæä¾›äº†2ä¸­æŒä¹…åŒ–æ–¹å¼AOFï¼ŒRDB\n æ ¹æ®æˆ‘ä»¬è‡ªå·±é…ç½®çš„æ—¶é—´æˆ–è€…æ‰‹åŠ¨å»æ‰§è¡ŒBGSAVEæˆ–SAVEå‘½ä»¤ï¼ŒRediså°±ä¼šå»ç”ŸæˆRDBæ–‡ä»¶ï¼Œè¿™ä¸ªRDBæ–‡ä»¶å®é™…ä¸Šå°±æ˜¯ä¸€ä¸ªç»è¿‡å‹ç¼©çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼ŒRediså¯ä»¥é€šè¿‡è¿™ä¸ªæ–‡ä»¶åœ¨å¯åŠ¨çš„æ—¶å€™æ¥è¿˜åŸæˆ‘ä»¬çš„æ•°æ®\nè€ŒAOFåˆ™æ˜¯æŠŠRedisæœåŠ¡å™¨æ¥æ”¶åˆ°çš„æ‰€æœ‰å†™å‘½ä»¤éƒ½è®°å½•åˆ°æ—¥å¿—ä¸­\nRedisé‡è·‘ä¸€éè¿™ä¸ªè®°å½•ä¸‹çš„æ—¥å¿—æ–‡ä»¶ï¼Œå°±ç›¸å½“äºè¿˜åŸäº†æ•°æ®\n   RDBï¼šRDB æŒä¹…åŒ–æœºåˆ¶ï¼Œæ˜¯å¯¹ Redis ä¸­çš„æ•°æ®æ‰§è¡Œå‘¨æœŸæ€§çš„æŒä¹…åŒ–ã€‚\n ä¼˜ç‚¹ï¼š ä»–ä¼šç”Ÿæˆå¤šä¸ªæ•°æ®æ–‡ä»¶ï¼Œæ¯ä¸ªæ•°æ®æ–‡ä»¶åˆ†åˆ«éƒ½ä»£è¡¨äº†æŸä¸€æ—¶åˆ»Redisé‡Œé¢çš„æ•°æ®ï¼Œè¿™ç§æ–¹å¼ï¼Œæœ‰æ²¡æœ‰è§‰å¾—å¾ˆé€‚åˆåšå†·å¤‡ï¼Œå®Œæ•´çš„æ•°æ®è¿ç»´è®¾ç½®å®šæ—¶ä»»åŠ¡ï¼Œå®šæ—¶åŒæ­¥åˆ°è¿œç«¯çš„æœåŠ¡å™¨ï¼Œæ¯”å¦‚é˜¿é‡Œçš„äº‘æœåŠ¡ï¼Œè¿™æ ·ä¸€æ—¦çº¿ä¸ŠæŒ‚äº†ï¼Œä½ æƒ³æ¢å¤å¤šå°‘åˆ†é’Ÿä¹‹å‰çš„æ•°æ®ï¼Œå°±å»è¿œç«¯æ‹·è´ä¸€ä»½ä¹‹å‰çš„æ•°æ®å°±å¥½äº†ã€‚\nRDBå¯¹Redisçš„æ€§èƒ½å½±å“éå¸¸å°ï¼Œæ˜¯å› ä¸ºåœ¨åŒæ­¥æ•°æ®çš„æ—¶å€™ä»–åªæ˜¯forkäº†ä¸€ä¸ªå­è¿›ç¨‹å»åšæŒä¹…åŒ–çš„ï¼Œè€Œä¸”ä»–åœ¨æ•°æ®æ¢å¤çš„æ—¶å€™é€Ÿåº¦æ¯”AOFæ¥çš„å¿«ã€‚\nç¼ºç‚¹ï¼š RDBéƒ½æ˜¯å¿«ç…§æ–‡ä»¶ï¼Œéƒ½æ˜¯é»˜è®¤äº”åˆ†é’Ÿç”šè‡³æ›´ä¹…çš„æ—¶é—´æ‰ä¼šç”Ÿæˆä¸€æ¬¡ï¼Œè¿™æ„å‘³ç€ä½ è¿™æ¬¡åŒæ­¥åˆ°ä¸‹æ¬¡åŒæ­¥è¿™ä¸­é—´äº”åˆ†é’Ÿçš„æ•°æ®éƒ½å¾ˆå¯èƒ½å…¨éƒ¨ä¸¢å¤±æ‰ã€‚AOFåˆ™æœ€å¤šä¸¢ä¸€ç§’çš„æ•°æ®ï¼Œæ•°æ®å®Œæ•´æ€§ä¸Šé«˜ä¸‹ç«‹åˆ¤ã€‚\nè¿˜æœ‰å°±æ˜¯RDBåœ¨ç”Ÿæˆæ•°æ®å¿«ç…§çš„æ—¶å€™ï¼Œå¦‚æœæ–‡ä»¶å¾ˆå¤§ï¼Œå®¢æˆ·ç«¯å¯èƒ½ä¼šæš‚åœå‡ æ¯«ç§’ç”šè‡³å‡ ç§’ï¼Œä½ å…¬å¸åœ¨åšç§’æ€çš„æ—¶å€™ä»–åˆšå¥½åœ¨è¿™ä¸ªæ—¶å€™forkäº†ä¸€ä¸ªå­è¿›ç¨‹å»ç”Ÿæˆä¸€ä¸ªå¤§å¿«ç…§ï¼Œå“¦è±ï¼Œå‡ºå¤§é—®é¢˜ã€‚\n   AOFï¼šAOF æœºåˆ¶å¯¹æ¯æ¡å†™å…¥å‘½ä»¤ä½œä¸ºæ—¥å¿—ï¼Œä»¥ append-only çš„æ¨¡å¼å†™å…¥ä¸€ä¸ªæ—¥å¿—æ–‡ä»¶ä¸­ï¼Œå› ä¸ºè¿™ä¸ªæ¨¡å¼æ˜¯åªè¿½åŠ çš„æ–¹å¼ï¼Œæ‰€ä»¥æ²¡æœ‰ä»»ä½•ç£ç›˜å¯»å€çš„å¼€é”€ï¼Œæ‰€ä»¥å¾ˆå¿«ï¼Œæœ‰ç‚¹åƒMysqlä¸­çš„binlogã€‚\n ä¼˜ç‚¹ï¼š ä¸Šé¢æåˆ°äº†ï¼ŒRDBäº”åˆ†é’Ÿä¸€æ¬¡ç”Ÿæˆå¿«ç…§ï¼Œä½†æ˜¯AOFæ˜¯ä¸€ç§’ä¸€æ¬¡å»é€šè¿‡ä¸€ä¸ªåå°çš„çº¿ç¨‹fsyncæ“ä½œï¼Œé‚£æœ€å¤šä¸¢è¿™ä¸€ç§’çš„æ•°æ®ã€‚\nAOFåœ¨å¯¹æ—¥å¿—æ–‡ä»¶è¿›è¡Œæ“ä½œçš„æ—¶å€™æ˜¯ä»¥append-onlyçš„æ–¹å¼å»å†™çš„ï¼Œä»–åªæ˜¯è¿½åŠ çš„æ–¹å¼å†™æ•°æ®ï¼Œè‡ªç„¶å°±å°‘äº†å¾ˆå¤šç£ç›˜å¯»å€çš„å¼€é”€äº†ï¼Œå†™å…¥æ€§èƒ½æƒŠäººï¼Œæ–‡ä»¶ä¹Ÿä¸å®¹æ˜“ç ´æŸã€‚\nç¼ºç‚¹ï¼š ä¸€æ ·çš„æ•°æ®ï¼ŒAOFæ–‡ä»¶æ¯”RDBè¿˜è¦å¤§ã€‚\nAOFå¼€å¯åï¼ŒRedisæ”¯æŒå†™çš„QPSä¼šæ¯”RDBæ”¯æŒå†™çš„è¦ä½ï¼Œä»–ä¸æ˜¯æ¯ç§’éƒ½è¦å»å¼‚æ­¥åˆ·æ–°ä¸€æ¬¡æ—¥å¿—å˜›fsyncï¼Œå½“ç„¶å³ä½¿è¿™æ ·æ€§èƒ½è¿˜æ˜¯å¾ˆé«˜.\n   å®é™…ä¸Šï¼š\nä½¿ç”¨RDBå…ˆæ¢å¤æ•°æ®ï¼Œé€Ÿåº¦å¿«ï¼Œç„¶åé€šè¿‡AOFè¿›è¡Œè¡¥å…¨\n  rediså¸ƒéš†è¿‡æ»¤å™¨ å¸ƒéš†è¿‡æ»¤å™¨å¯ä»¥ä½¿ç”¨é«˜æ•ˆçš„æ•°æ®ç»“æ„ï¼Œå­˜æ”¾å¤§é‡çš„æ•°æ®ã€‚å¸ƒéš†è¿‡æ»¤å™¨è¯´å­˜åœ¨ï¼Œåˆ™ä¸ä¸€å®šå­˜åœ¨ï¼Œä½†æ˜¯å¸ƒéš†è¿‡æ»¤å™¨è¯´ä¸å­˜åœ¨ï¼Œåˆ™ä¸€å®šä¸å­˜åœ¨ã€‚å¸¸ç”¨äºç¼“å­˜ç©¿é€çš„é—®é¢˜ã€‚\nç‰¹ç‚¹\n ç©ºé—´æ•ˆç‡é«˜ å¤šæ¬¡hashï¼Œæ—¶é—´æ•ˆç‡é«˜ å­˜åœ¨è¯¯åˆ¤ï¼Œæ‰€ä»¥ä¸å¥½åšåˆ é™¤  ä½¿ç”¨åœºæ™¯\n é»‘åå• URLå»é‡ IDæ ¡éªŒ é˜²æ­¢ç©¿é€  åŸç†ï¼š\n å¸ƒéš†è¿‡æ»¤å™¨æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªä½æ•°ç»„ï¼Œæ¯ä¸ªå…ƒç´ åªå 1ä¸ªbitï¼Œåªä¼šæœ‰0å’Œ1ï¼Œé€šè¿‡næ¬¡hashï¼Œå‡å°‘hashç¢°æ’ã€‚å½“ä¸€ä¸ªkeyè¿‡æ¥çš„æ—¶å€™ï¼Œè¿›è¡Œnæ¬¡hashï¼Œå¾—å‡ºnæ¬¡ç»“æœï¼Œå°†næ¬¡ç»“æœçš„ä½å€¼åœ¨æ•°ç»„ä¸­æŸ¥æ‰¾ï¼Œå¦‚æœå‘ç°æœ‰ä¸€ä¸ªå€¼ä¸º0ï¼Œåˆ™keyä¸€å®šä¸åœ¨è¿‡æ»¤å™¨ä¸­ã€‚å¦‚æœéƒ½ä¸º1å¯èƒ½åœ¨è¿‡æ»¤å™¨ä¸­ï¼Œå› ä¸ºhashå€¼ä¼šç¢°æ’ã€‚hashçš„æ¬¡æ•°å’Œæ•°ç»„çš„å¤§å°å†³å®šäº†å¸ƒéš†è¿‡æ»¤å™¨çš„å‡†ç¡®åº¦ã€‚  ä½¿ç”¨ï¼š\n googleåœ¨guavaä¸­å°è£…å¥½çš„BloomFilter redis 4.0åå¯ä»¥åŠ å…¥module BloomFilter  redisåˆ†å¸ƒå¼é” SETNX + EXPIRE\nredisä¸ºä»€ä¹ˆé€‰ç”¨è·³è¡¨   è·³è¡¨æ˜¯ä¸€ç§è¿›é˜¶å‹çš„é“¾è¡¨ï¼Œå…·æœ‰äºŒåˆ†æŸ¥æ‰¾çš„åŠŸèƒ½å‚è€ƒ\n Redisåªåœ¨ä¸¤ä¸ªåœ°æ–¹ç”¨åˆ°äº†è·³è·ƒè¡¨ï¼Œä¸€ä¸ªæ˜¯å®ç°æœ‰åºé›†åˆé”®(zset)ï¼Œå¦ä¸€ä¸ªæ˜¯åœ¨é›†ç¾¤èŠ‚ç‚¹ä¸­ç”¨ä½œå†…éƒ¨æ•°æ®ç»“æ„ï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œè·³è¡¨åœ¨Redisé‡Œé¢æ²¡æœ‰å…¶ä»–ç”¨é€”ã€‚\nä½†æ˜¯ä¸ºä»€ä¹ˆç”¨è·³è¡¨è€Œä¸ç”¨çº¢é»‘æ ‘å‘¢ï¼ŸçŒœæƒ³å¦‚ä¸‹ï¼š 1ï¼‰åœ¨åšèŒƒå›´æŸ¥æ‰¾çš„æ—¶å€™ï¼Œå¹³è¡¡æ ‘æ¯”skiplistæ“ä½œè¦å¤æ‚ã€‚åœ¨å¹³è¡¡æ ‘ä¸Šï¼Œæˆ‘ä»¬æ‰¾åˆ°æŒ‡å®šèŒƒå›´çš„å°å€¼ä¹‹åï¼Œè¿˜éœ€è¦ä»¥ä¸­åºéå†çš„é¡ºåºç»§ç»­å¯»æ‰¾å…¶å®ƒä¸è¶…è¿‡å¤§å€¼çš„èŠ‚ç‚¹ã€‚å¦‚æœä¸å¯¹å¹³è¡¡æ ‘è¿›è¡Œä¸€å®šçš„æ”¹é€ ï¼Œè¿™é‡Œçš„ä¸­åºéå†å¹¶ä¸å®¹æ˜“å®ç°ã€‚è€Œåœ¨skiplistä¸Šè¿›è¡ŒèŒƒå›´æŸ¥æ‰¾å°±éå¸¸ç®€å•ï¼Œåªéœ€è¦åœ¨æ‰¾åˆ°å°å€¼ä¹‹åï¼Œå¯¹ç¬¬1å±‚é“¾è¡¨è¿›è¡Œè‹¥å¹²æ­¥çš„éå†å°±å¯ä»¥å®ç°ã€‚ 2ï¼‰å¹³è¡¡æ ‘çš„æ’å…¥å’Œåˆ é™¤æ“ä½œå¯èƒ½å¼•å‘å­æ ‘çš„è°ƒæ•´ï¼Œé€»è¾‘å¤æ‚ï¼Œè€Œskiplistçš„æ’å…¥å’Œåˆ é™¤åªéœ€è¦ä¿®æ”¹ç›¸é‚»èŠ‚ç‚¹çš„æŒ‡é’ˆï¼Œæ“ä½œç®€å•åˆå¿«é€Ÿã€‚ 3ï¼‰ä»å†…å­˜å ç”¨ä¸Šæ¥è¯´ï¼Œskiplistæ¯”å¹³è¡¡æ ‘æ›´çµæ´»ä¸€äº›ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œå¹³è¡¡æ ‘æ¯ä¸ªèŠ‚ç‚¹åŒ…å«2ä¸ªæŒ‡é’ˆï¼ˆåˆ†åˆ«æŒ‡å‘å·¦å³å­æ ‘ï¼‰ï¼Œè€Œskiplistæ¯ä¸ªèŠ‚ç‚¹åŒ…å«çš„æŒ‡é’ˆæ•°ç›®å¹³å‡ä¸º1/(1-p)ï¼Œå…·ä½“å–å†³äºå‚æ•°pçš„å¤§å°ã€‚å¦‚æœåƒRedisé‡Œçš„å®ç°ä¸€æ ·ï¼Œå–p=1/4ï¼Œé‚£ä¹ˆå¹³å‡æ¯ä¸ªèŠ‚ç‚¹åŒ…å«1.33ä¸ªæŒ‡é’ˆï¼Œæ¯”å¹³è¡¡æ ‘æ›´æœ‰ä¼˜åŠ¿ã€‚ 4ï¼‰æŸ¥æ‰¾å•ä¸ªkeyï¼Œskiplistå’Œå¹³è¡¡æ ‘çš„æ—¶é—´å¤æ‚åº¦éƒ½ä¸ºO(log n)ï¼Œå¤§ä½“ç›¸å½“ï¼›è€Œå“ˆå¸Œè¡¨åœ¨ä¿æŒè¾ƒä½çš„å“ˆå¸Œå€¼å†²çªæ¦‚ç‡çš„å‰æä¸‹ï¼ŒæŸ¥æ‰¾æ—¶é—´å¤æ‚åº¦æ¥è¿‘O(1)ï¼Œæ€§èƒ½æ›´é«˜ä¸€äº›ã€‚æ‰€ä»¥æˆ‘ä»¬å¹³å¸¸ä½¿ç”¨çš„å„ç§Mapæˆ–dictionaryç»“æ„ï¼Œå¤§éƒ½æ˜¯åŸºäºå“ˆå¸Œè¡¨å®ç°çš„ã€‚ 5ï¼‰ä»ç®—æ³•å®ç°éš¾åº¦ä¸Šæ¥æ¯”è¾ƒï¼Œskiplistæ¯”å¹³è¡¡æ ‘è¦ç®€å•å¾—å¤šã€‚\n   redisé˜²å‡»ç©¿ã€é›ªå´©ã€ç©¿é€   å‡»ç©¿\nå’Œé›ªå´©æœ‰ä¸€ç‚¹åƒã€‚å‡»ç©¿æ˜¯å¤§é‡è¯·æ±‚ï¼Œæ‰“ä¸€ä¸ªkeyï¼Œè¿™ä¸ªkeyçªç„¶å¤±æ•ˆï¼Œå¯¼è‡´æ‰“æŒ‚äº†åº“ã€‚è€Œé›ªå´©æ˜¯å¤§é‡keyä¸€èµ·å¤±æ•ˆï¼Œè®¾è®¡æ°¸ä¸è¿‡æœŸ\n  ç©¿é€\nè®¿é—®ä¸€ä¸ªä¸å¯èƒ½å­˜åœ¨çš„keyï¼Œä¸€ç›´æ‰“åˆ°æ•°æ®åº“ï¼Œå¯¼è‡´æ•°æ®åº“æŒ‚äº†\nè§£å†³æ–¹æ¡ˆï¼š\n ä»£ç ä¸­é’ˆå¯¹æŸ¥keyçš„é€»è¾‘éœ€è¦æ³¨æ„ï¼Œåœ¨é€»è¾‘ä¸Šå°±å¤„ç†æ‰è¿™äº›ä¸ä¼šå‡ºç°çš„key å¯¹äºä¸å­˜åœ¨çš„keyï¼Œä¾ç„¶å­˜ç¼“å­˜ï¼Œvalueè®¾ä¸ºnullï¼Œæˆ–è€…æç¤ºè¯­å¥ã€‚ä¾‹å¦‚â€œç¨åå†è¯•ï¼Œè¯·æ±‚ä¸æ­£ç¡®â€ã€‚å¹¶ä¸”ç»™ä»–ä¸€ä¸ªè¿‡æœŸæ—¶é—´ ä½¿ç”¨å¸ƒéš†è¿‡æ»¤å™¨ é€šè¿‡nginxåšipçš„é™åˆ¶ï¼ŒåŠ é»‘åå•ã€‚    é›ªå´©\nå¤§æ‰¹é‡çš„keyåœ¨åŒæ—¶ä¸€æ—¶åˆ»å¤±æ•ˆï¼Œå¯¼è‡´å¤§æ‰¹é‡çš„è¯·æ±‚å…¨éƒ¨æ‰“åˆ°æ•°æ®ä¸Šã€‚æ•°æ®åº“æ‰¿å—ä¸ä½æŒ‚äº†ã€‚\nè§£å†³æ–¹æ¡ˆï¼š\n è®¾ç½®è¿‡æœŸæ—¶é—´çš„æ—¶å€™åŠ ä¸Šéšæœºæ•°ï¼Œä¿è¯åŒä¸€æ—¶é—´ä¸ä¼šæœ‰å¤§é‡çš„keyå¤±æ•ˆ è®¾ç½®è¿™ç§çƒ­ç‚¹æ•°æ®ç”¨ä¸è¿‡æœŸã€‚éœ€è¦æ›´æ–°çš„æ—¶å€™ï¼Œé¡ºæ‰‹æ›´æ–°ä¸€ä¸‹ç¼“å­˜å°±å¯ä»¥äº†    redisæ˜¯å…ˆåˆ ç¼“å­˜è¿˜æ˜¯å…ˆå†™åº“ï¼Œæ€ä¹ˆè§£å†³ç¼“å­˜ä¸€è‡´æ€§   å…ˆåˆ ç¼“å­˜ï¼Œå†æ›´æ–°æ•°æ®åº“\nç¼“å­˜åˆ é™¤å®Œæˆåï¼Œæ•°æ®åº“æ›´æ–°æ“ä½œè¿˜æ²¡å¥½ï¼Œæ­¤æ—¶è¯·æ±‚è¿‡æ¥ï¼Œè¯»ç¼“å­˜ï¼Œè¯»ä¸åˆ°ï¼Œè¯»æ•°æ®åº“ï¼Œå¾—åˆ°çš„æ˜¯æ—§æ•°æ®\nè§£å†³æ–¹æ¡ˆï¼šå»¶æ—¶åŒåˆ \n æµç¨‹å¦‚ä¸‹ï¼š\n çº¿ç¨‹1åˆ é™¤ç¼“å­˜ï¼Œç„¶åå»æ›´æ–°æ•°æ®åº“ çº¿ç¨‹2æ¥è¯»ç¼“å­˜ï¼Œå‘ç°ç¼“å­˜å·²ç»è¢«åˆ é™¤ï¼Œæ‰€ä»¥ç›´æ¥ä»æ•°æ®åº“ä¸­è¯»å–ï¼Œè¿™æ—¶å€™ç”±äºçº¿ç¨‹1è¿˜æ²¡æœ‰æ›´æ–°å®Œæˆï¼Œæ‰€ä»¥è¯»åˆ°çš„æ˜¯æ—§å€¼ï¼Œç„¶åæŠŠæ—§å€¼å†™å…¥ç¼“å­˜ çº¿ç¨‹1ï¼Œæ ¹æ®ä¼°ç®—çš„æ—¶é—´ï¼Œsleepï¼Œç”±äºsleepçš„æ—¶é—´å¤§äºçº¿ç¨‹2è¯»æ•°æ®+å†™ç¼“å­˜çš„æ—¶é—´ï¼Œæ‰€ä»¥ç¼“å­˜è¢«å†æ¬¡åˆ é™¤ å¦‚æœè¿˜æœ‰å…¶ä»–çº¿ç¨‹æ¥è¯»å–ç¼“å­˜çš„è¯ï¼Œå°±ä¼šå†æ¬¡ä»æ•°æ®åº“ä¸­è¯»å–åˆ°æœ€æ–°å€¼     å…ˆæ›´æ–°åº“ï¼Œå†åˆ é™¤ç¼“å­˜\næ›´æ–°æ•°æ®åº“æˆåŠŸï¼Œå¦‚æœåˆ é™¤ç¼“å­˜å¤±è´¥æˆ–è€…è¿˜æ²¡æœ‰æ¥å¾—åŠåˆ é™¤ï¼Œé‚£ä¹ˆï¼Œå…¶ä»–çº¿ç¨‹ä»ç¼“å­˜ä¸­è¯»å–åˆ°çš„å°±æ˜¯æ—§å€¼ï¼Œè¿˜æ˜¯ä¼šå‘ç”Ÿä¸ä¸€è‡´ã€‚\nè§£å†³æ–¹æ¡ˆï¼šå…ˆæ›´æ–°æ•°æ®åº“ï¼ŒæˆåŠŸåå¾€æ¶ˆæ¯é˜Ÿåˆ—å‘æ¶ˆæ¯ï¼Œæ¶ˆè´¹åˆ°æ¶ˆæ¯åå†åˆ é™¤ç¼“å­˜ï¼Œå€ŸåŠ©æ¶ˆæ¯é˜Ÿåˆ—çš„é‡è¯•æœºåˆ¶æ¥å®ç°ï¼Œè¾¾åˆ°æœ€ç»ˆä¸€è‡´æ€§çš„æ•ˆæœã€‚è¿›é˜¶ä¸€ç‚¹ï¼Œä½¿ç”¨æ•°æ®çš„binlogé€šçŸ¥åˆ°æ¶ˆæ¯é˜Ÿåˆ—ï¼Œç„¶åæ›´æ–°ç¼“å­˜ã€‚æ— ä»£ç å…¥ä¾µ\n ç¼ºé™·ï¼š\n å¼•å…¥æ¶ˆæ¯ä¸­é—´ä»¶ä¹‹åï¼Œé—®é¢˜æ›´å¤æ‚äº†ï¼Œæ€ä¹ˆä¿è¯æ¶ˆæ¯ä¸ä¸¢å¤±æ›´éº»çƒ¦ å°±ç®—æ›´æ–°æ•°æ®åº“å’Œåˆ é™¤ç¼“å­˜éƒ½æ²¡æœ‰å‘ç”Ÿé—®é¢˜ï¼Œæ¶ˆæ¯çš„å»¶è¿Ÿä¹Ÿä¼šå¸¦æ¥çŸ­æš‚çš„ä¸ä¸€è‡´æ€§ï¼Œä¸è¿‡è¿™ä¸ªå»¶è¿Ÿç›¸å¯¹æ¥è¯´è¿˜æ˜¯å¯ä»¥æ¥å—çš„     è®¾ç½®è¿‡æœŸæ—¶é—´\n æ¯æ¬¡æ”¾å…¥ç¼“å­˜çš„æ—¶å€™ï¼Œè®¾ç½®ä¸€ä¸ªè¿‡æœŸæ—¶é—´ï¼Œæ¯”å¦‚5åˆ†é’Ÿï¼Œä»¥åçš„æ“ä½œåªä¿®æ”¹æ•°æ®åº“ï¼Œä¸æ“ä½œç¼“å­˜ï¼Œç­‰å¾…ç¼“å­˜è¶…æ—¶åä»æ•°æ®åº“é‡æ–°è¯»å–ã€‚\nå¦‚æœå¯¹äºä¸€è‡´æ€§è¦æ±‚ä¸æ˜¯å¾ˆé«˜çš„æƒ…å†µï¼Œå¯ä»¥é‡‡ç”¨è¿™ç§æ–¹æ¡ˆã€‚\nè¿™ä¸ªæ–¹æ¡ˆè¿˜ä¼šæœ‰å¦å¤–ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯å¦‚æœæ•°æ®æ›´æ–°çš„ç‰¹åˆ«é¢‘ç¹ï¼Œä¸ä¸€è‡´æ€§çš„é—®é¢˜å°±å¾ˆå¤§äº†ã€‚\nåœ¨å®é™…ç”Ÿäº§ä¸­ï¼Œæˆ‘ä»¬æœ‰ä¸€äº›æ´»åŠ¨çš„ç¼“å­˜æ•°æ®æ˜¯ä½¿ç”¨è¿™ç§æ–¹å¼å¤„ç†çš„ã€‚\nå› ä¸ºæ´»åŠ¨å¹¶ä¸é¢‘ç¹å‘ç”Ÿæ”¹å˜ï¼Œè€Œä¸”å¯¹äºæ´»åŠ¨æ¥è¯´ï¼ŒçŸ­æš‚çš„ä¸ä¸€è‡´æ€§å¹¶ä¸ä¼šæœ‰ä»€ä¹ˆå¤§çš„é—®é¢˜ã€‚\n   æ€»ç»“\né¦–å…ˆï¼Œæˆ‘ä»¬è¦æ˜ç¡®ä¸€ç‚¹ï¼Œç¼“å­˜ä¸æ˜¯æ›´æ–°ï¼Œè€Œåº”è¯¥æ˜¯åˆ é™¤ã€‚\nåˆ é™¤ç¼“å­˜æœ‰ä¸¤ç§æ–¹å¼ï¼š\n ä¸¾ä¸ªæ —å­ï¼Œä¸€ä¸ªç¼“å­˜æ¶‰åŠçš„è¡¨çš„å­—æ®µï¼Œåœ¨ 1 åˆ†é’Ÿå†…å°±ä¿®æ”¹äº† 20 æ¬¡ï¼Œæˆ–è€…æ˜¯ 100 æ¬¡ï¼Œé‚£ä¹ˆç¼“å­˜æ›´æ–° 20 æ¬¡ã€100 æ¬¡ï¼›ä½†æ˜¯è¿™ä¸ªç¼“å­˜åœ¨ 1 åˆ†é’Ÿå†…åªè¢«è¯»å–äº† 1 æ¬¡ï¼Œæœ‰å¤§é‡çš„å†·æ•°æ®ã€‚ å®é™…ä¸Šï¼Œå¦‚æœä½ åªæ˜¯åˆ é™¤ç¼“å­˜çš„è¯ï¼Œé‚£ä¹ˆåœ¨ 1 åˆ†é’Ÿå†…ï¼Œè¿™ä¸ªç¼“å­˜ä¸è¿‡å°±é‡æ–°è®¡ç®—ä¸€æ¬¡è€Œå·²ï¼Œå¼€é”€å¤§å¹…åº¦é™ä½ã€‚ç”¨åˆ°ç¼“å­˜æ‰å»ç®—ç¼“å­˜ã€‚\n  å…ˆåˆ é™¤ç¼“å­˜ï¼Œå†æ›´æ–°æ•°æ®åº“ã€‚è§£å†³æ–¹æ¡ˆæ˜¯ä½¿ç”¨å»¶è¿ŸåŒåˆ ã€‚ å…ˆæ›´æ–°æ•°æ®åº“ï¼Œå†åˆ é™¤ç¼“å­˜ã€‚è§£å†³æ–¹æ¡ˆæ˜¯æ¶ˆæ¯é˜Ÿåˆ—æˆ–è€…å…¶ä»–binlogåŒæ­¥ï¼Œå¼•å…¥æ¶ˆæ¯é˜Ÿåˆ—ä¼šå¸¦æ¥æ›´å¤šçš„é—®é¢˜ï¼Œå¹¶ä¸æ¨èç›´æ¥ä½¿ç”¨ã€‚  é’ˆå¯¹ç¼“å­˜ä¸€è‡´æ€§è¦æ±‚ä¸æ˜¯å¾ˆé«˜çš„åœºæ™¯ï¼Œé‚£ä¹ˆåªé€šè¿‡è®¾ç½®è¶…æ—¶æ—¶é—´å°±å¯ä»¥äº†ã€‚\nå…¶å®ï¼Œå¦‚æœä¸æ˜¯å¾ˆé«˜çš„å¹¶å‘ï¼Œæ— è®ºä½ é€‰æ‹©å…ˆåˆ ç¼“å­˜è¿˜æ˜¯ååˆ ç¼“å­˜çš„æ–¹å¼ï¼Œéƒ½å‡ ä¹å¾ˆå°‘èƒ½äº§ç”Ÿè¿™ç§é—®é¢˜ï¼Œä½†æ˜¯åœ¨é«˜å¹¶å‘ä¸‹ï¼Œä½ åº”è¯¥çŸ¥é“æ€ä¹ˆè§£å†³é—®é¢˜ã€‚\n  redisçš„æ·˜æ±°ç­–ç•¥ å®˜ç½‘ä¸Šç»™åˆ°çš„å†…å­˜æ·˜æ±°æœºåˆ¶æ˜¯ä»¥ä¸‹å‡ ä¸ªï¼š\n  noeviction:è¿”å›é”™è¯¯å½“å†…å­˜é™åˆ¶è¾¾åˆ°å¹¶ä¸”å®¢æˆ·ç«¯å°è¯•æ‰§è¡Œä¼šè®©æ›´å¤šå†…å­˜è¢«ä½¿ç”¨çš„å‘½ä»¤ï¼ˆå¤§éƒ¨åˆ†çš„å†™å…¥æŒ‡ä»¤ï¼Œä½†DELå’Œå‡ ä¸ªä¾‹å¤–ï¼‰\n  allkeys-lru: å°è¯•å›æ”¶æœ€å°‘ä½¿ç”¨çš„é”®ï¼ˆLRUï¼‰ï¼Œä½¿å¾—æ–°æ·»åŠ çš„æ•°æ®æœ‰ç©ºé—´å­˜æ”¾ã€‚\n  volatile-lru: å°è¯•å›æ”¶æœ€å°‘ä½¿ç”¨çš„é”®ï¼ˆLRUï¼‰ï¼Œä½†ä»…é™äºåœ¨è¿‡æœŸé›†åˆçš„é”®,ä½¿å¾—æ–°æ·»åŠ çš„æ•°æ®æœ‰ç©ºé—´å­˜æ”¾ã€‚\n  allkeys-random: å›æ”¶éšæœºçš„é”®ä½¿å¾—æ–°æ·»åŠ çš„æ•°æ®æœ‰ç©ºé—´å­˜æ”¾ã€‚\n  volatile-random: å›æ”¶éšæœºçš„é”®ä½¿å¾—æ–°æ·»åŠ çš„æ•°æ®æœ‰ç©ºé—´å­˜æ”¾ï¼Œä½†ä»…é™äºåœ¨è¿‡æœŸé›†åˆçš„é”®ã€‚\n  volatile-ttl: å›æ”¶åœ¨è¿‡æœŸé›†åˆçš„é”®ï¼Œå¹¶ä¸”ä¼˜å…ˆå›æ”¶å­˜æ´»æ—¶é—´ï¼ˆTTLï¼‰è¾ƒçŸ­çš„é”®,ä½¿å¾—æ–°æ·»åŠ çš„æ•°æ®æœ‰ç©ºé—´å­˜æ”¾ã€‚\nå¦‚æœæ²¡æœ‰é”®æ»¡è¶³å›æ”¶çš„å‰ææ¡ä»¶çš„è¯ï¼Œç­–ç•¥volatile-lru, volatile-randomä»¥åŠvolatile-ttlå°±å’Œnoeviction å·®ä¸å¤šäº†ã€‚\n  é—®é¢˜æ’æŸ¥ arthas jdkè‡ªå¸¦å‘½ä»¤ jps\njcmd\njstate\nhttps://docs.oracle.com/en/java/javase/11/tools/tools-and-command-reference.html\nKafka æ¶ˆæ¯é˜Ÿåˆ—çš„é€šä¿¡æ¨¡å¼   ç‚¹å¯¹ç‚¹æ¨¡å¼\nç‚¹å¯¹ç‚¹æ¨¡å¼é€šå¸¸æ˜¯åŸºäºæ‹‰å–æˆ–è€…è½®è¯¢çš„æ¶ˆæ¯ä¼ é€æ¨¡å‹ï¼Œç”Ÿäº§è€…å°†æ¶ˆæ¯å‘é€åˆ°é˜Ÿåˆ—ä¸­ï¼Œæ¶ˆè´¹è€…ä¸»åŠ¨å»æ‹¿æ¶ˆæ¯ã€‚ç‚¹å¯¹ç‚¹æ¨¡å‹çš„çš„ä¼˜ç‚¹æ˜¯æ¶ˆè´¹è€…æ‹‰å–æ¶ˆæ¯çš„é¢‘ç‡å¯ä»¥ç”±è‡ªå·±æ§åˆ¶ã€‚ä½†æ˜¯æ¶ˆæ¯é˜Ÿåˆ—æ˜¯å¦æœ‰æ¶ˆæ¯éœ€è¦æ¶ˆè´¹ï¼Œåœ¨æ¶ˆè´¹è€…ç«¯æ— æ³•æ„ŸçŸ¥ï¼Œæ‰€ä»¥åœ¨æ¶ˆè´¹è€…ç«¯éœ€è¦é¢å¤–çš„çº¿ç¨‹å»ç›‘æ§ã€‚\n  å‘å¸ƒè®¢é˜…æ¨¡å¼\nå‘å¸ƒè®¢é˜…æ¨¡å¼æ˜¯ä¸€ä¸ªåŸºäºæ¶ˆæ¯é€çš„æ¶ˆæ¯ä¼ é€æ¨¡å‹ï¼Œæ”¹æ¨¡å‹å¯ä»¥æœ‰å¤šç§ä¸åŒçš„è®¢é˜…è€…ã€‚ç”Ÿäº§è€…å°†æ¶ˆæ¯æ”¾å…¥æ¶ˆæ¯é˜Ÿåˆ—åï¼Œé˜Ÿåˆ—ä¼šå°†æ¶ˆæ¯æ¨é€ç»™è®¢é˜…è¿‡è¯¥ç±»æ¶ˆæ¯çš„æ¶ˆè´¹è€…ï¼ˆç±»ä¼¼å¾®ä¿¡å…¬ä¼—å·ï¼‰ã€‚ç”±äºæ˜¯æ¶ˆè´¹è€…è¢«åŠ¨æ¥æ”¶æ¨é€ï¼Œæ‰€ä»¥æ— éœ€æ„ŸçŸ¥æ¶ˆæ¯é˜Ÿåˆ—æ˜¯å¦æœ‰å¾…æ¶ˆè´¹çš„æ¶ˆæ¯ï¼ä½†æ˜¯consumer1ã€consumer2ã€consumer3ç”±äºæœºå™¨æ€§èƒ½ä¸ä¸€æ ·ï¼Œæ‰€ä»¥å¤„ç†æ¶ˆæ¯çš„èƒ½åŠ›ä¹Ÿä¼šä¸ä¸€æ ·ï¼Œä½†æ¶ˆæ¯é˜Ÿåˆ—å´æ— æ³•æ„ŸçŸ¥æ¶ˆè´¹è€…æ¶ˆè´¹çš„é€Ÿåº¦ï¼æ‰€ä»¥æ¨é€çš„é€Ÿåº¦æˆäº†å‘å¸ƒè®¢é˜…æ¨¡æ¨¡å¼çš„ä¸€ä¸ªé—®é¢˜ï¼å‡è®¾ä¸‰ä¸ªæ¶ˆè´¹è€…å¤„ç†é€Ÿåº¦åˆ†åˆ«æ˜¯8M/sã€5M/sã€2M/sï¼Œå¦‚æœé˜Ÿåˆ—æ¨é€çš„é€Ÿåº¦ä¸º5M/sï¼Œåˆ™consumer3æ— æ³•æ‰¿å—ï¼å¦‚æœé˜Ÿåˆ—æ¨é€çš„é€Ÿåº¦ä¸º2M/sï¼Œåˆ™consumer1ã€consumer2ä¼šå‡ºç°èµ„æºçš„æå¤§æµªè´¹ï¼\n  Kafkaæ¶æ„   Producerï¼šProducerå³ç”Ÿäº§è€…ï¼Œæ¶ˆæ¯çš„äº§ç”Ÿè€…ï¼Œæ˜¯æ¶ˆæ¯çš„å…¥å£ã€‚\nkafka clusterï¼š\nBrokerï¼šBrokeræ˜¯kafkaå®ä¾‹ï¼Œæ¯ä¸ªæœåŠ¡å™¨ä¸Šæœ‰ä¸€ä¸ªæˆ–å¤šä¸ªkafkaçš„å®ä¾‹ï¼Œæˆ‘ä»¬å§‘ä¸”è®¤ä¸ºæ¯ä¸ªbrokerå¯¹åº”ä¸€å°æœåŠ¡å™¨ã€‚æ¯ä¸ªkafkaé›†ç¾¤å†…çš„brokeréƒ½æœ‰ä¸€ä¸ªä¸é‡å¤çš„ç¼–å·ï¼Œå¦‚å›¾ä¸­çš„broker-0ã€broker-1ç­‰â€¦â€¦\nTopicï¼šæ¶ˆæ¯çš„ä¸»é¢˜ï¼Œå¯ä»¥ç†è§£ä¸ºæ¶ˆæ¯çš„åˆ†ç±»ï¼Œkafkaçš„æ•°æ®å°±ä¿å­˜åœ¨topicã€‚åœ¨æ¯ä¸ªbrokerä¸Šéƒ½å¯ä»¥åˆ›å»ºå¤šä¸ªtopicã€‚\nPartitionï¼šTopicçš„åˆ†åŒºï¼Œæ¯ä¸ªtopicå¯ä»¥æœ‰å¤šä¸ªåˆ†åŒºï¼Œåˆ†åŒºçš„ä½œç”¨æ˜¯åšè´Ÿè½½ï¼Œæé«˜kafkaçš„ååé‡ã€‚åŒä¸€ä¸ªtopicåœ¨ä¸åŒçš„åˆ†åŒºçš„æ•°æ®æ˜¯ä¸é‡å¤çš„ï¼Œpartitionçš„è¡¨ç°å½¢å¼å°±æ˜¯ä¸€ä¸ªä¸€ä¸ªçš„æ–‡ä»¶å¤¹ï¼\nReplication:æ¯ä¸€ä¸ªåˆ†åŒºéƒ½æœ‰å¤šä¸ªå‰¯æœ¬ï¼Œå‰¯æœ¬çš„ä½œç”¨æ˜¯åšå¤‡èƒã€‚å½“ä¸»åˆ†åŒºï¼ˆLeaderï¼‰æ•…éšœçš„æ—¶å€™ä¼šé€‰æ‹©ä¸€ä¸ªå¤‡èƒï¼ˆFollowerï¼‰ä¸Šä½ï¼Œæˆä¸ºLeaderã€‚åœ¨kafkaä¸­é»˜è®¤å‰¯æœ¬çš„æœ€å¤§æ•°é‡æ˜¯10ä¸ªï¼Œä¸”å‰¯æœ¬çš„æ•°é‡ä¸èƒ½å¤§äºBrokerçš„æ•°é‡ï¼Œfollowerå’Œleaderç»å¯¹æ˜¯åœ¨ä¸åŒçš„æœºå™¨ï¼ŒåŒä¸€æœºå™¨å¯¹åŒä¸€ä¸ªåˆ†åŒºä¹Ÿåªå¯èƒ½å­˜æ”¾ä¸€ä¸ªå‰¯æœ¬ï¼ˆåŒ…æ‹¬è‡ªå·±ï¼‰ã€‚\nMessageï¼šæ¯ä¸€æ¡å‘é€çš„æ¶ˆæ¯ä¸»ä½“ã€‚\nConsumerï¼šæ¶ˆè´¹è€…ï¼Œå³æ¶ˆæ¯çš„æ¶ˆè´¹æ–¹ï¼Œæ˜¯æ¶ˆæ¯çš„å‡ºå£ã€‚\nConsumer Groupï¼šæˆ‘ä»¬å¯ä»¥å°†å¤šä¸ªæ¶ˆè´¹ç»„ç»„æˆä¸€ä¸ªæ¶ˆè´¹è€…ç»„ï¼Œåœ¨kafkaçš„è®¾è®¡ä¸­åŒä¸€ä¸ªåˆ†åŒºçš„æ•°æ®åªèƒ½è¢«æ¶ˆè´¹è€…ç»„ä¸­çš„æŸä¸€ä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹ã€‚åŒä¸€ä¸ªæ¶ˆè´¹è€…ç»„çš„æ¶ˆè´¹è€…å¯ä»¥æ¶ˆè´¹åŒä¸€ä¸ªtopicçš„ä¸åŒåˆ†åŒºçš„æ•°æ®ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºäº†æé«˜kafkaçš„ååé‡ï¼\nZookeeperï¼škafkaé›†ç¾¤ä¾èµ–zookeeperæ¥ä¿å­˜é›†ç¾¤çš„çš„å…ƒä¿¡æ¯ï¼Œæ¥ä¿è¯ç³»ç»Ÿçš„å¯ç”¨æ€§ã€‚\n  ä¸ºä»€ä¹ˆè¦ç”¨æ¶ˆæ¯é˜Ÿåˆ— è§£è€¦ã€å¼‚æ­¥ã€å‰Šä¸°\nKafkaçš„æ¨è¿˜æ˜¯æ‹‰ æ‹‰\nKafkaå¦‚ä½•åšåˆ°æ¶ˆæ¯ä¸ä¸¢å¤±çš„ æ¶ˆæ¯ä¸¢å¤±æœ‰å¦‚ä¸‹åœºæ™¯\n  producerå‘é€ç»™broker\nä¼šå‡ºç°ï¼Œproducerå‘ç»™brokeræ²¡æ”¶åˆ°ï¼Œbrokeræ”¶åˆ°äº†è¿˜æ²¡åŒæ­¥ç»™å…¶ä»–brokerå°±æŒ‚äº†ï¼ŒbrokeræŒä¹…åŒ–çš„æ—¶å€™ï¼Œèµ°ç£ç›˜ç¼“å­˜æŒ‚äº†\nä¸æƒ³ä¸¢æ•°æ®ï¼Œé‚£å°±ä½¿ç”¨å¸¦æœ‰callbackçš„apiï¼Œè®¾ç½® acksã€retriesã€factorç­‰ç­‰äº›å‚æ•°æ¥ä¿è¯Producerå‘é€çš„æ¶ˆæ¯ä¸ä¼šä¸¢å°±å¥½å•¦ã€‚\n  å®¢æˆ·ç«¯æ¶ˆè´¹brokerä¸¢äº†\né¦–å…ˆï¼Œè¦æƒ³clientç«¯æ¶ˆè´¹æ•°æ®ä¸èƒ½ä¸¢ï¼Œè‚¯å®šæ˜¯ä¸èƒ½ä½¿ç”¨autoCommitçš„ï¼Œæ‰€ä»¥å¿…é¡»æ˜¯æ‰‹åŠ¨æäº¤çš„\n  ç”Ÿäº§è€…ä¿è¯æ¶ˆæ¯å‘é€åˆ°é›†ç¾¤\n ä½¿ç”¨å¸¦æœ‰å›è°ƒæ–¹æ³•ï¼ˆcallbackï¼‰çš„apiï¼Œå¹¶è®¾ç½®å¥½å‚æ•°ackså’Œretrieså’Œretry.backoff.msè¿™å‡ ä¸ªå‚æ•° ackså‚æ•°è¡¨ç¤ºå¦‚ä½•åˆ¤æ–­ç³»ç»Ÿè®¤ä¸ºæ¶ˆæ¯å‘é€æˆåŠŸã€‚0ï¼Œåªè¦å‘è¿‡å»å°±è¡Œäº†ï¼Œ1brokerçš„leaderæ”¶åˆ°å°±è¡Œäº†ï¼Œ-1ï¼Œå‰¯æœ¬è¦åŒæ­¥å®Œæ¯•æ‰ç®—æˆåŠŸ\nretrieså‚æ•°è¡¨ç¤ºç”Ÿäº§è€…ç”Ÿäº§æ¶ˆæ¯çš„é‡è¯•æ¬¡æ•°ã€‚ retry.backoff.mså‚æ•°è¡¨ç¤ºæ¶ˆæ¯ç”Ÿäº§è¶…æ—¶å¤±è´¥åé‡è¯•çš„é—´éš”æ—¶é—´ã€‚ é€šè¿‡å›è°ƒå‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“æ¶ˆæ¯æ˜¯å¦å‘é€æˆåŠŸã€‚å¦‚æœå‘é€å¤±è´¥ï¼Œæˆ‘ä»¬éœ€è¦è¿›è¡Œå¼‚å¸¸å¤„ç†ã€‚ æ¯”å¦‚æŠŠå¤±è´¥æ¶ˆæ¯å­˜å…¥æœ¬åœ°ç£ç›˜æˆ–è€…è¿œç¨‹æ•°æ®åº“ï¼Œç­‰æœåŠ¡æ­£å¸¸äº†å†å‘é€ã€‚è¿™æ ·æ‰èƒ½ä¿è¯æ¶ˆæ¯ä¸ä¸¢å¤±ã€‚\n   Kafkaä¸ºä»€ä¹ˆå¯ä»¥æœ‰è¿™ä¹ˆå¤§çš„ååé‡ æ¶ˆæ¯é˜Ÿåˆ—ã€Œæœ€æ ¸å¿ƒã€çš„åŠŸèƒ½å°±æ˜¯æŠŠç”Ÿäº§çš„æ•°æ®å­˜å‚¨èµ·æ¥ï¼Œç„¶åç»™å„ä¸ªä¸šåŠ¡æŠŠæ•°æ®å†è¯»å–å‡ºæ¥ã€‚\nKafkaåœ¨ã€Œå­˜å‚¨ã€å’Œã€Œè¯»å–ã€è¿™ä¸ªè¿‡ç¨‹ä¸­åˆåšäº†å¾ˆå¤šçš„ä¼˜åŒ–\n æˆ‘ä»¬å¾€ä¸€ä¸ªTopicå‘é€æ¶ˆæ¯æˆ–è€…è¯»å–æ¶ˆæ¯æ—¶ï¼Œå®é™…å†…éƒ¨æ˜¯å¤šä¸ªPartitionåœ¨å¤„ç†ã€å¹¶è¡Œã€‘ åœ¨å­˜å‚¨æ¶ˆæ¯æ—¶ï¼ŒKafkaå†…éƒ¨æ˜¯é¡ºåºå†™ç£ç›˜çš„ï¼Œå¹¶ä¸”åˆ©ç”¨äº†æ“ä½œç³»ç»Ÿçš„ç¼“å†²åŒºæ¥æé«˜æ€§èƒ½ã€append+cacheã€‘ åœ¨è¯»å†™æ•°æ®ä¸­ä¹Ÿå‡å°‘CPUæ‹·è´æ–‡ä»¶çš„æ¬¡æ•°ã€é›¶æ‹·è´ã€‘  Kafkaæ€ä¹ˆä¿è¯é¡ºåºæ¶ˆè´¹ kafka çš„åˆ†å¸ƒå¼å•ä½æ˜¯ partitionï¼ŒåŒä¸€ä¸ª partition ä¸­çš„æ•°æ®å¯ä»¥ä¿è¯ FIFOã€‚ä¸åŒçš„ partition ä¹‹é—´ä¸èƒ½ä¿è¯é¡ºåºã€‚æ¯ä¸ªpartition åªèƒ½å¤Ÿæœ‰ä¸€ä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹ã€‚å› ä¸ºåœ¨å‘é€æ•°æ®çš„æ—¶å€™ï¼Œç»å¤§å¤šæ•°ç”¨æˆ·éƒ½å¯ä»¥é€šè¿‡ message key æ¥å®šä¹‰ï¼ŒåŒä¸€ä¸ª key çš„ message éƒ½ä¼šå‘é€åˆ°åŒä¸€ä¸ª partition ä¸Šé¢ï¼Œæ‰€ä»¥ä¸€èˆ¬ä¸ä¼šæœ‰é—®é¢˜ã€‚\nkafkaæ€ä¹ˆä¿è¯ä¸é‡å¤æ¶ˆè´¹çš„ æ¶ˆè´¹æ–¹è¿›è¡Œåšå»é‡è¡¨\nMySql æ¨èæ–‡ç« \n https://www.cnblogs.com/lianzhilei/p/11250589.html https://mp.weixin.qq.com/s/BFuA-59Fpue2r6dt8YBbrQ  ä¸€æ¡è¯­å¥çš„æ‰§è¡Œè¿‡ç¨‹  å®¢æˆ·ç«¯è¯·æ±‚ è¿æ¥å™¨ï¼ˆéªŒè¯ç”¨æˆ·èº«ä»½ï¼Œç»™äºˆæƒé™ï¼‰ æŸ¥è¯¢ç¼“å­˜ï¼ˆå­˜åœ¨ç¼“å­˜åˆ™ç›´æ¥è¿”å›ï¼Œä¸å­˜åœ¨åˆ™æ‰§è¡Œåç»­æ“ä½œï¼‰ åˆ†æå™¨ï¼ˆå¯¹SQLè¿›è¡Œè¯æ³•åˆ†æå’Œè¯­æ³•åˆ†ææ“ä½œï¼‰ ä¼˜åŒ–å™¨ï¼ˆä¸»è¦å¯¹æ‰§è¡Œçš„sqlä¼˜åŒ–é€‰æ‹©æœ€ä¼˜çš„æ‰§è¡Œæ–¹æ¡ˆæ–¹æ³•ï¼‰ æ‰§è¡Œå™¨ï¼ˆæ‰§è¡Œæ—¶ä¼šå…ˆçœ‹ç”¨æˆ·æ˜¯å¦æœ‰æ‰§è¡Œæƒé™ï¼Œæœ‰æ‰å»ä½¿ç”¨è¿™ä¸ªå¼•æ“æä¾›çš„æ¥å£ï¼‰ å»å¼•æ“å±‚è·å–æ•°æ®è¿”å›ï¼ˆå¦‚æœå¼€å¯æŸ¥è¯¢ç¼“å­˜åˆ™ä¼šç¼“å­˜æŸ¥è¯¢ç»“æœï¼‰  å¸¸è§çš„å­˜å‚¨å¼•æ“ ä½¿ç”¨å“ªä¸€ç§å¼•æ“å¯ä»¥çµæ´»é€‰æ‹©ï¼Œä¸€ä¸ªæ•°æ®åº“ä¸­å¤šä¸ªè¡¨å¯ä»¥ä½¿ç”¨ä¸åŒå¼•æ“ä»¥æ»¡è¶³å„ç§æ€§èƒ½å’Œå®é™…éœ€æ±‚ï¼Œä½¿ç”¨åˆé€‚çš„å­˜å‚¨å¼•æ“ï¼Œå°†ä¼šæé«˜æ•´ä¸ªæ•°æ®åº“çš„æ€§èƒ½ ã€‚\nMysqlçš„Dataç›®å½•ä¸‹éƒ½ä¼šå­˜æ”¾æ¯ä¸ªè¡¨çš„å…ƒæ•°æ®ä¿¡æ¯ï¼ŒåŒ…æ‹¬è¡¨çš„å®šä¹‰ä¸æ•°æ®åº“å¼•æ“æ²¡æœ‰å…³ç³»ï¼Œæ–‡ä»¶ä¸º**.frm**ç»“å°¾ï¼Œä¾‹å¦‚user.frmå­˜æ”¾çš„æ˜¯userè¡¨çš„å…ƒæ•°æ®ä¿¡æ¯\n InnoDB  .frmæ–‡ä»¶ï¼šä¸è¡¨ç›¸å…³çš„å…ƒæ•°æ®ä¿¡æ¯éƒ½å­˜æ”¾åœ¨frmæ–‡ä»¶ï¼ŒåŒ…æ‹¬è¡¨ç»“æ„çš„å®šä¹‰ä¿¡æ¯ç­‰ .MYD (MYData) æ–‡ä»¶ï¼šMyISAM å­˜å‚¨å¼•æ“ä¸“ç”¨ï¼Œç”¨äºå­˜å‚¨MyISAM è¡¨çš„æ•°æ® .MYI (MYIndex)æ–‡ä»¶ï¼šMyISAM å­˜å‚¨å¼•æ“ä¸“ç”¨ï¼Œç”¨äºå­˜å‚¨MyISAM è¡¨çš„ç´¢å¼•ç›¸å…³ä¿¡æ¯   MyISAM  .frm æ–‡ä»¶ï¼šä¸è¡¨ç›¸å…³çš„å…ƒæ•°æ®ä¿¡æ¯éƒ½å­˜æ”¾åœ¨frmæ–‡ä»¶ï¼ŒåŒ…æ‹¬è¡¨ç»“æ„çš„å®šä¹‰ä¿¡æ¯ç­‰ .ibd æ–‡ä»¶æˆ– .ibdata æ–‡ä»¶ï¼šè¿™ä¸¤ç§æ–‡ä»¶éƒ½æ˜¯å­˜æ”¾ InnoDB æ•°æ®çš„æ–‡ä»¶ï¼Œä¹‹æ‰€ä»¥æœ‰ä¸¤ç§æ–‡ä»¶å½¢å¼å­˜æ”¾ InnoDB çš„æ•°æ®ï¼Œæ˜¯å› ä¸º InnoDB çš„æ•°æ®å­˜å‚¨æ–¹å¼èƒ½å¤Ÿé€šè¿‡é…ç½®æ¥å†³å®šæ˜¯ä½¿ç”¨å…±äº«è¡¨ç©ºé—´å­˜æ”¾å­˜å‚¨æ•°æ®ï¼Œè¿˜æ˜¯ç”¨ç‹¬äº«è¡¨ç©ºé—´å­˜æ”¾å­˜å‚¨æ•°æ®ã€‚   å¯¹æ¯”  InnoDB æ”¯æŒäº‹åŠ¡ï¼ŒMyISAM ä¸æ”¯æŒäº‹åŠ¡ã€‚è¿™æ˜¯ MySQL å°†é»˜è®¤å­˜å‚¨å¼•æ“ä» MyISAM å˜æˆ InnoDB çš„é‡è¦åŸå› ä¹‹ä¸€ï¼› InnoDB æ”¯æŒå¤–é”®ï¼Œè€Œ MyISAM ä¸æ”¯æŒã€‚å¯¹ä¸€ä¸ªåŒ…å«å¤–é”®çš„ InnoDB è¡¨è½¬ä¸º MYISAM ä¼šå¤±è´¥ï¼› InnoDB æ˜¯èšç°‡ç´¢å¼•ï¼ŒMyISAM æ˜¯éèšç°‡ç´¢å¼•ã€‚èšç°‡ç´¢å¼•çš„æ–‡ä»¶å­˜æ”¾åœ¨ä¸»é”®ç´¢å¼•çš„å¶å­èŠ‚ç‚¹ä¸Šï¼Œå› æ­¤ InnoDB å¿…é¡»è¦æœ‰ä¸»é”®ï¼Œé€šè¿‡ä¸»é”®ç´¢å¼•æ•ˆç‡å¾ˆé«˜ã€‚ä½†æ˜¯è¾…åŠ©ç´¢å¼•éœ€è¦ä¸¤æ¬¡æŸ¥è¯¢ï¼Œå…ˆæŸ¥è¯¢åˆ°ä¸»é”®ï¼Œç„¶åå†é€šè¿‡ä¸»é”®æŸ¥è¯¢åˆ°æ•°æ®ã€‚å› æ­¤ï¼Œä¸»é”®ä¸åº”è¯¥è¿‡å¤§ï¼Œå› ä¸ºä¸»é”®å¤ªå¤§ï¼Œå…¶ä»–ç´¢å¼•ä¹Ÿéƒ½ä¼šå¾ˆå¤§ã€‚è€Œ MyISAM æ˜¯éèšé›†ç´¢å¼•ï¼Œæ•°æ®æ–‡ä»¶æ˜¯åˆ†ç¦»çš„ï¼Œç´¢å¼•ä¿å­˜çš„æ˜¯æ•°æ®æ–‡ä»¶çš„æŒ‡é’ˆã€‚ä¸»é”®ç´¢å¼•å’Œè¾…åŠ©ç´¢å¼•æ˜¯ç‹¬ç«‹çš„ã€‚ InnoDB ä¸ä¿å­˜è¡¨çš„å…·ä½“è¡Œæ•°ï¼Œæ‰§è¡Œselect count(*) from table æ—¶éœ€è¦å…¨è¡¨æ‰«æã€‚è€Œ MyISAM ç”¨ä¸€ä¸ªå˜é‡ä¿å­˜äº†æ•´ä¸ªè¡¨çš„è¡Œæ•°ï¼Œæ‰§è¡Œä¸Šè¿°è¯­å¥æ—¶åªéœ€è¦è¯»å‡ºè¯¥å˜é‡å³å¯ï¼Œé€Ÿåº¦å¾ˆå¿«ï¼› InnoDB æœ€å°çš„é”ç²’åº¦æ˜¯è¡Œé”ï¼ŒMyISAM æœ€å°çš„é”ç²’åº¦æ˜¯è¡¨é”ã€‚ä¸€ä¸ªæ›´æ–°è¯­å¥ä¼šé”ä½æ•´å¼ è¡¨ï¼Œå¯¼è‡´å…¶ä»–æŸ¥è¯¢å’Œæ›´æ–°éƒ½ä¼šè¢«é˜»å¡ï¼Œå› æ­¤å¹¶å‘è®¿é—®å—é™ã€‚è¿™ä¹Ÿæ˜¯ MySQL å°†é»˜è®¤å­˜å‚¨å¼•æ“ä» MyISAM å˜æˆ InnoDB çš„é‡è¦åŸå› ä¹‹ä¸€ï¼›       å¯¹æ¯”é¡¹ MyISAM InnoDB     ä¸»å¤–é”® ä¸æ”¯æŒ æ”¯æŒ   äº‹åŠ¡ ä¸æ”¯æŒ æ”¯æŒ   è¡Œè¡¨é” è¡¨é”ï¼Œå³ä½¿æ“ä½œä¸€æ¡è®°å½•ä¹Ÿä¼šé”ä½æ•´ä¸ªè¡¨ï¼Œä¸é€‚åˆé«˜å¹¶å‘çš„æ“ä½œ è¡Œé”,æ“ä½œæ—¶åªé”æŸä¸€è¡Œï¼Œä¸å¯¹å…¶å®ƒè¡Œæœ‰å½±å“ï¼Œé€‚åˆé«˜å¹¶å‘çš„æ“ä½œ   ç¼“å­˜ åªç¼“å­˜ç´¢å¼•ï¼Œä¸ç¼“å­˜çœŸå®æ•°æ® ä¸ä»…ç¼“å­˜ç´¢å¼•è¿˜è¦ç¼“å­˜çœŸå®æ•°æ®ï¼Œå¯¹å†…å­˜è¦æ±‚è¾ƒé«˜ï¼Œè€Œä¸”å†…å­˜å¤§å°å¯¹æ€§èƒ½æœ‰å†³å®šæ€§çš„å½±å“   è¡¨ç©ºé—´ å° å¤§   å…³æ³¨ç‚¹ æ€§èƒ½ äº‹åŠ¡   é»˜è®¤å®‰è£… æ˜¯ æ˜¯    ä¸€å¼ è¡¨ï¼Œé‡Œé¢æœ‰IDè‡ªå¢ä¸»é”®ï¼Œå½“insertäº†17æ¡è®°å½•ä¹‹åï¼Œåˆ é™¤äº†ç¬¬15,16,17æ¡è®°å½•ï¼Œå†æŠŠMysqlé‡å¯ï¼Œå†insertä¸€æ¡è®°å½•ï¼Œè¿™æ¡è®°å½•çš„IDæ˜¯18è¿˜æ˜¯15 ï¼Ÿ å¦‚æœè¡¨çš„ç±»å‹æ˜¯MyISAMï¼Œé‚£ä¹ˆæ˜¯18ã€‚å› ä¸ºMyISAMè¡¨ä¼šæŠŠè‡ªå¢ä¸»é”®çš„æœ€å¤§ID è®°å½•åˆ°æ•°æ®æ–‡ä»¶ä¸­ï¼Œé‡å¯MySQLè‡ªå¢ä¸»é”®çš„æœ€å¤§IDä¹Ÿä¸ä¼šä¸¢å¤±ï¼›\nå¦‚æœè¡¨çš„ç±»å‹æ˜¯InnoDBï¼Œé‚£ä¹ˆæ˜¯15ã€‚å› ä¸ºInnoDB è¡¨åªæ˜¯æŠŠè‡ªå¢ä¸»é”®çš„æœ€å¤§IDè®°å½•åˆ°å†…å­˜ä¸­ï¼Œæ‰€ä»¥é‡å¯æ•°æ®åº“æˆ–å¯¹è¡¨è¿›è¡ŒOPTIONæ“ä½œï¼Œéƒ½ä¼šå¯¼è‡´æœ€å¤§IDä¸¢å¤±ã€‚\nè‡ªå¢ä¸»é”®ç”¨å®Œäº†æ€ä¹ˆåŠ ä¼šæŠ¥é‡å¤ä¸»é”®é”™è¯¯ï¼Œ2äº¿äº†ï¼Œæ—©å°±å¼€å§‹åˆ†åº“åˆ†è¡¨äº†\nmysqlçš„ç´¢å¼•æ•°æ®ç»“æ„ä¸ºä»€ä¹ˆç”¨B+æ ‘ï¼Œè®²ä¸€è®²mysqlç´¢å¼•çš„æ•°æ®ç»“æ„æ˜¯ä»€ä¹ˆæ ·çš„   ç´¢å¼•æ˜¯å¸®åŠ©mysqlæ›´å¿«è·å¾—æ•°æ®çš„ä¸€ç§æ•°æ®ç»“æ„\n  ç´¢å¼•åˆ†ç±»\næ•°æ®ç»“æ„è§’åº¦\n B+æ ‘ç´¢å¼• Hashç´¢å¼• Full-Textå…¨æ–‡ç´¢å¼•  ä»ç‰©ç†å­˜å‚¨è§’åº¦\n  æ ¹æ®æ•°æ®ä¸ç´¢å¼•çš„å­˜å‚¨å…³è”æ€§ï¼Œå¯ä»¥åˆ†ä¸ºèšç°‡ç´¢å¼•å’Œéèšç°‡ç´¢å¼•ï¼ˆä¹Ÿå«èšé›†ç´¢å¼•å’Œéèšé›†ç´¢å¼•ï¼‰ã€‚èšç°‡ç´¢å¼•ä¹Ÿå«ç°‡ç±»ç´¢å¼•ï¼Œæ˜¯ä¸€ç§å¯¹ç£ç›˜ä¸Šå®é™…æ•°æ®é‡æ–°ç»„ç»‡ä»¥æŒ‰æŒ‡å®šçš„ä¸€ä¸ªæˆ–å¤šä¸ªåˆ—çš„å€¼æ’åºã€‚æ•´ä¸ªç®€æ´çš„è¯´æ³•ï¼Œè¿™ä¿©çš„åŒºåˆ«å°±æ˜¯ç´¢å¼•çš„å­˜å‚¨é¡ºåºå’Œæ•°æ®çš„å­˜å‚¨é¡ºåºæ˜¯å¦æ˜¯å…³ç³»çš„ï¼Œæœ‰å…³å°±æ˜¯èšç°‡ç´¢å¼•ï¼Œæ— å…³å°±æ˜¯éèšç°‡ç´¢å¼•ã€‚å…·ä½“å®ç°æ–¹å¼æ ¹æ®ç´¢å¼•çš„æ•°æ®ç»“æ„ä¸åŒä¼šæœ‰æ‰€ä¸åŒã€‚ä¸‹é¢ä»¥B+æ ‘å®ç°çš„ç´¢å¼•ä¸ºä¾‹ï¼Œä¸¾ä¾‹æ¥è¯´æ˜èšç°‡ç´¢å¼•å’Œéèšç°‡ç´¢å¼•ã€‚\n  èšé›†ç´¢å¼•ï¼ˆclustered indexï¼‰,InnoDb çš„ä¸»é”®ç´¢å¼•å°±æ˜¯èšé›†ç´¢å¼•\n  éèšé›†ç´¢å¼•ï¼ˆnon-clustered indexï¼‰ï¼Œä¹Ÿå«è¾…åŠ©ç´¢å¼•ï¼ˆsecondary indexï¼‰ï¼Œä¹Ÿå«äºŒçº§ç´¢å¼•\nå¦‚æœä¸æ˜¯ä¸»é”®ç´¢å¼•ï¼Œåˆ™å°±å¯ä»¥ç§°ä¹‹ä¸ºéä¸»é”®ç´¢å¼•ï¼Œåˆå¯ä»¥ç§°ä¹‹ä¸ºè¾…åŠ©ç´¢å¼•æˆ–è€…äºŒçº§ç´¢å¼•ã€‚ä¸»é”®ç´¢å¼•çš„å¶å­èŠ‚ç‚¹å­˜å‚¨äº†å®Œæ•´çš„æ•°æ®è¡Œï¼Œè€Œéä¸»é”®ç´¢å¼•çš„å¶å­èŠ‚ç‚¹å­˜å‚¨çš„åˆ™æ˜¯ä¸»é”®ç´¢å¼•å€¼ï¼Œé€šè¿‡éä¸»é”®ç´¢å¼•æŸ¥è¯¢æ•°æ®æ—¶ï¼Œä¼šå…ˆæŸ¥æ‰¾åˆ°ä¸»é”®ç´¢å¼•ï¼Œç„¶åå†åˆ°ä¸»é”®ç´¢å¼•ä¸Šå»æŸ¥æ‰¾å¯¹åº”çš„æ•°æ®ã€‚\n åœ¨è¿™é‡Œå‡è®¾æˆ‘ä»¬æœ‰å¼ è¡¨userï¼Œå…·æœ‰ä¸‰åˆ—ï¼šIDï¼Œageï¼Œnameï¼Œcreate_timeï¼Œidæ˜¯ä¸»é”®ï¼Œï¼ˆageï¼Œcreate_time,ï¼Œnameï¼‰å»ºç«‹è¾…åŠ©ç´¢å¼•ã€‚æ‰§è¡Œå¦‚ä¸‹sqlè¯­å¥ï¼š\nselect name from user where age\u0026gt;2 order by create_time descã€‚\næ­£å¸¸çš„è¯ï¼ŒæŸ¥è¯¢åˆ†ä¸¤æ­¥ï¼š\n1.æŒ‰ç…§è¾…åŠ©ç´¢å¼•ï¼ŒæŸ¥æ‰¾åˆ°è®°å½•çš„ä¸»é”®ï¼Œ\n2.æŒ‰ç…§ä¸»é”®ä¸»é”®ç´¢å¼•é‡ŒæŸ¥æ‰¾è®°å½•ï¼Œè¿”å›nameã€‚\nä½†å®é™…ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œè¾…åŠ©ç´¢å¼•èŠ‚ç‚¹æ˜¯æŒ‰ç…§ageï¼Œcreate_timeï¼Œnameå»ºç«‹çš„ï¼Œç´¢å¼•ä¿¡æ¯é‡Œå®Œå…¨åŒ…å«æˆ‘ä»¬æ‰€è¦çš„ä¿¡æ¯ï¼Œå¦‚æœèƒ½ä»è¾…åŠ©ç´¢å¼•é‡Œè¿”å›nameä¿¡æ¯ï¼Œåˆ™ç¬¬äºŒæ­¥æ˜¯å®Œå…¨æ²¡æœ‰å¿…è¦çš„ï¼Œå¯ä»¥æå¤§æå‡æŸ¥è¯¢é€Ÿåº¦ã€‚\næŒ‰ç…§è¿™ç§æ€æƒ³Innodbé‡Œé’ˆå¯¹ä½¿ç”¨è¾…åŠ©ç´¢å¼•çš„æŸ¥è¯¢åœºæ™¯åšäº†ä¼˜åŒ–ï¼Œå«è¦†ç›–ç´¢å¼•\n èšé›†ç´¢å¼•å’Œéèšé›†ç´¢å¼•éƒ½æ˜¯B+æ ‘ç»“æ„\n  ä»é€»è¾‘è§’åº¦\n  ä¸»é”®ç´¢å¼•ï¼šä¸»é”®ç´¢å¼•æ˜¯ä¸€ç§ç‰¹æ®Šçš„å”¯ä¸€ç´¢å¼•ï¼Œä¸å…è®¸æœ‰ç©ºå€¼\nMySQLä¸­æ˜¯æ ¹æ®ä¸»é”®æ¥ç»„ç»‡æ•°æ®çš„ï¼Œæ‰€ä»¥æ¯å¼ è¡¨éƒ½å¿…é¡»æœ‰ä¸»é”®ç´¢å¼•ï¼Œä¸»é”®ç´¢å¼•åªèƒ½æœ‰ä¸€ä¸ªï¼Œä¸èƒ½ä¸ºnullåŒæ—¶å¿…é¡»ä¿è¯å”¯ä¸€æ€§ã€‚å»ºè¡¨æ—¶å¦‚æœæ²¡æœ‰æŒ‡å®šä¸»é”®ç´¢å¼•ï¼Œåˆ™ä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªéšè—çš„å­—æ®µä½œä¸ºä¸»é”®ç´¢å¼•ã€‚\n  æ™®é€šç´¢å¼•æˆ–è€…å•åˆ—ç´¢å¼•ï¼šæ¯ä¸ªç´¢å¼•åªåŒ…å«å•ä¸ªåˆ—ï¼Œä¸€ä¸ªè¡¨å¯ä»¥æœ‰å¤šä¸ªå•åˆ—ç´¢å¼•\n  å¤šåˆ—ç´¢å¼•ï¼ˆå¤åˆç´¢å¼•ã€è”åˆç´¢å¼•ï¼‰ï¼šå¤åˆç´¢å¼•æŒ‡å¤šä¸ªå­—æ®µä¸Šåˆ›å»ºçš„ç´¢å¼•ï¼Œåªæœ‰åœ¨æŸ¥è¯¢æ¡ä»¶ä¸­ä½¿ç”¨äº†åˆ›å»ºç´¢å¼•æ—¶çš„ç¬¬ä¸€ä¸ªå­—æ®µï¼Œç´¢å¼•æ‰ä¼šè¢«ä½¿ç”¨ã€‚ä½¿ç”¨å¤åˆç´¢å¼•æ—¶éµå¾ªæœ€å·¦å‰ç¼€é›†åˆ\n  å”¯ä¸€ç´¢å¼•æˆ–è€…éå”¯ä¸€ç´¢å¼•\n  ç©ºé—´ç´¢å¼•ï¼šç©ºé—´ç´¢å¼•æ˜¯å¯¹ç©ºé—´æ•°æ®ç±»å‹çš„å­—æ®µå»ºç«‹çš„ç´¢å¼•ï¼ŒMYSQLä¸­çš„ç©ºé—´æ•°æ®ç±»å‹æœ‰4ç§ï¼Œåˆ†åˆ«æ˜¯GEOMETRYã€POINTã€LINESTRINGã€POLYGONã€‚MYSQLä½¿ç”¨SPATIALå…³é”®å­—è¿›è¡Œæ‰©å±•ï¼Œä½¿å¾—èƒ½å¤Ÿç”¨äºåˆ›å»ºæ­£è§„ç´¢å¼•ç±»å‹çš„è¯­æ³•åˆ›å»ºç©ºé—´ç´¢å¼•ã€‚åˆ›å»ºç©ºé—´ç´¢å¼•çš„åˆ—ï¼Œå¿…é¡»å°†å…¶å£°æ˜ä¸ºNOT NULLï¼Œç©ºé—´ç´¢å¼•åªèƒ½åœ¨å­˜å‚¨å¼•æ“ä¸ºMYISAMçš„è¡¨ä¸­åˆ›å»º\n    B-æ ‘å’ŒB+æ ‘\n  B-æ ‘\nB-æ ‘å°±æ˜¯å¹³æ—¶è¯´çš„Bæ ‘ï¼Œå’ŒäºŒå‰æ ‘çš„åŒºåˆ«åœ¨äºï¼Œå¯ä»¥å­˜åœ¨å¤šä¸ªå­æ ‘ã€‚ä»è€Œè¾¾åˆ°æ·±åº¦ä½çš„æ•ˆæœã€‚é€šå¸¸ç”¨äºæ“ä½œç³»ç»Ÿçš„æ–‡ä»¶æŸ¥è¯¢ï¼Œå› ä¸ºä¸€æ¬¡æ·±åº¦å°±æ˜¯ä¸€æ¬¡ç£ç›˜çš„IOã€‚B-æ ‘çš„èŠ‚ç‚¹ï¼Œé™¤äº†å­èŠ‚ç‚¹çš„æŒ‡é’ˆä¿¡æ¯ï¼Œå’Œç´¢å¼•ä¿¡æ¯(ä¸»é”®)ï¼Œè¿˜å­˜æ”¾äº†æ•°æ®\n  B+æ ‘\nB+Tree æ˜¯åœ¨ B-Tree åŸºç¡€ä¸Šçš„ä¸€ç§ä¼˜åŒ–ï¼Œä½¿å…¶æ›´é€‚åˆå®ç°å¤–å­˜å‚¨ç´¢å¼•ç»“æ„ï¼ŒInnoDB å­˜å‚¨å¼•æ“å°±æ˜¯ç”¨ B+Tree å®ç°å…¶ç´¢å¼•ç»“æ„ã€‚\nä»ä¸Šä¸€èŠ‚ä¸­çš„B-Treeç»“æ„å›¾ä¸­å¯ä»¥çœ‹åˆ°æ¯ä¸ªèŠ‚ç‚¹ä¸­ä¸ä»…åŒ…å«æ•°æ®çš„keyå€¼ï¼Œè¿˜æœ‰dataå€¼ã€‚è€Œæ¯ä¸€ä¸ªé¡µçš„å­˜å‚¨ç©ºé—´æ˜¯æœ‰é™çš„ï¼Œå¦‚æœdataæ•°æ®è¾ƒå¤§æ—¶å°†ä¼šå¯¼è‡´æ¯ä¸ªèŠ‚ç‚¹ï¼ˆå³ä¸€ä¸ªé¡µï¼‰èƒ½å­˜å‚¨çš„keyçš„æ•°é‡å¾ˆå°ï¼Œå½“å­˜å‚¨çš„æ•°æ®é‡å¾ˆå¤§æ—¶åŒæ ·ä¼šå¯¼è‡´B-Treeçš„æ·±åº¦è¾ƒå¤§ï¼Œå¢å¤§æŸ¥è¯¢æ—¶çš„ç£ç›˜I/Oæ¬¡æ•°ï¼Œè¿›è€Œå½±å“æŸ¥è¯¢æ•ˆç‡ã€‚åœ¨B+Treeä¸­ï¼Œæ‰€æœ‰æ•°æ®è®°å½•èŠ‚ç‚¹éƒ½æ˜¯æŒ‰ç…§é”®å€¼å¤§å°é¡ºåºå­˜æ”¾åœ¨åŒä¸€å±‚çš„å¶å­èŠ‚ç‚¹ä¸Šï¼Œè€Œéå¶å­èŠ‚ç‚¹ä¸Šåªå­˜å‚¨keyå€¼ä¿¡æ¯ï¼Œè¿™æ ·å¯ä»¥å¤§å¤§åŠ å¤§æ¯ä¸ªèŠ‚ç‚¹å­˜å‚¨çš„keyå€¼æ•°é‡ï¼Œé™ä½B+Treeçš„é«˜åº¦ã€‚\n    æ­£å› ä¸ºInnoDBçš„æ•°æ®å’Œèšé›†ç´¢å¼•æ˜¯å­˜æ”¾åœ¨ä¸€èµ·çš„ï¼Œæ‰€ä»¥é»˜è®¤å»ºè¡¨çš„æ—¶å€™æ¨èåˆ›å»ºä¸»é”®ç´¢å¼•ï¼Œå¦‚æœæ²¡æœ‰å»ºç«‹çš„è¯ï¼Œmysqlä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ªéšè—çš„åˆ—ä½œä¸ºä¸»é”®å¹¶ä¸”è¿™ä¸ªå­—æ®µé•¿åº¦ä¸º6ä¸ªå­—èŠ‚ï¼Œç±»å‹ä¸ºæ•´å‹ã€‚\næœ€å·¦åŒ¹é…åŸåˆ™æ˜¯ä»€ä¹ˆ B+Treeæ€§è´¨\n é€šè¿‡ä¸Šé¢çš„åˆ†æï¼Œæˆ‘ä»¬çŸ¥é“IOæ¬¡æ•°å–å†³äºb+æ•°çš„é«˜åº¦hï¼Œå‡è®¾å½“å‰æ•°æ®è¡¨çš„æ•°æ®ä¸ºNï¼Œæ¯ä¸ªç£ç›˜å—çš„æ•°æ®é¡¹çš„æ•°é‡æ˜¯mï¼Œåˆ™æœ‰h=ã’(m+1)Nï¼Œå½“æ•°æ®é‡Nä¸€å®šçš„æƒ…å†µä¸‹ï¼Œmè¶Šå¤§ï¼Œhè¶Šå°ï¼›è€Œm = ç£ç›˜å—çš„å¤§å° / æ•°æ®é¡¹çš„å¤§å°ï¼Œç£ç›˜å—çš„å¤§å°ä¹Ÿå°±æ˜¯ä¸€ä¸ªæ•°æ®é¡µçš„å¤§å°ï¼Œæ˜¯å›ºå®šçš„ï¼Œå¦‚æœæ•°æ®é¡¹å çš„ç©ºé—´è¶Šå°ï¼Œæ•°æ®é¡¹çš„æ•°é‡è¶Šå¤šï¼Œæ ‘çš„é«˜åº¦è¶Šä½ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæ¯ä¸ªæ•°æ®é¡¹ï¼Œå³ç´¢å¼•å­—æ®µè¦å°½é‡çš„å°ï¼Œæ¯”å¦‚intå 4å­—èŠ‚ï¼Œè¦æ¯”bigint8å­—èŠ‚å°‘ä¸€åŠã€‚è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆb+æ ‘è¦æ±‚æŠŠçœŸå®çš„æ•°æ®æ”¾åˆ°å¶å­èŠ‚ç‚¹è€Œä¸æ˜¯å†…å±‚èŠ‚ç‚¹ï¼Œä¸€æ—¦æ”¾åˆ°å†…å±‚èŠ‚ç‚¹ï¼Œç£ç›˜å—çš„æ•°æ®é¡¹ä¼šå¤§å¹…åº¦ä¸‹é™ï¼Œå¯¼è‡´æ ‘å¢é«˜ã€‚å½“æ•°æ®é¡¹ç­‰äº1æ—¶å°†ä¼šé€€åŒ–æˆçº¿æ€§è¡¨ã€‚ å½“b+æ ‘çš„æ•°æ®é¡¹æ˜¯å¤åˆçš„æ•°æ®ç»“æ„ï¼Œæ¯”å¦‚(name,age,sex)çš„æ—¶å€™ï¼Œb+æ•°æ˜¯æŒ‰ç…§ä»å·¦åˆ°å³çš„é¡ºåºæ¥å»ºç«‹æœç´¢æ ‘çš„ï¼Œæ¯”å¦‚å½“(å¼ ä¸‰,20,F)è¿™æ ·çš„æ•°æ®æ¥æ£€ç´¢çš„æ—¶å€™ï¼Œb+æ ‘ä¼šä¼˜å…ˆæ¯”è¾ƒnameæ¥ç¡®å®šä¸‹ä¸€æ­¥çš„æ‰€æœæ–¹å‘ï¼Œå¦‚æœnameç›¸åŒå†ä¾æ¬¡æ¯”è¾ƒageå’Œsexï¼Œæœ€åå¾—åˆ°æ£€ç´¢çš„æ•°æ®ï¼›ä½†å½“(20,F)è¿™æ ·çš„æ²¡æœ‰nameçš„æ•°æ®æ¥çš„æ—¶å€™ï¼Œb+æ ‘å°±ä¸çŸ¥é“ä¸‹ä¸€æ­¥è¯¥æŸ¥å“ªä¸ªèŠ‚ç‚¹ï¼Œå› ä¸ºå»ºç«‹æœç´¢æ ‘çš„æ—¶å€™nameå°±æ˜¯ç¬¬ä¸€ä¸ªæ¯”è¾ƒå› å­ï¼Œå¿…é¡»è¦å…ˆæ ¹æ®nameæ¥æœç´¢æ‰èƒ½çŸ¥é“ä¸‹ä¸€æ­¥å»å“ªé‡ŒæŸ¥è¯¢ã€‚æ¯”å¦‚å½“(å¼ ä¸‰,F)è¿™æ ·çš„æ•°æ®æ¥æ£€ç´¢æ—¶ï¼Œb+æ ‘å¯ä»¥ç”¨nameæ¥æŒ‡å®šæœç´¢æ–¹å‘ï¼Œä½†ä¸‹ä¸€ä¸ªå­—æ®µageçš„ç¼ºå¤±ï¼Œæ‰€ä»¥åªèƒ½æŠŠåå­—ç­‰äºå¼ ä¸‰çš„æ•°æ®éƒ½æ‰¾åˆ°ï¼Œç„¶åå†åŒ¹é…æ€§åˆ«æ˜¯Fçš„æ•°æ®äº†ï¼Œ è¿™ä¸ªæ˜¯éå¸¸é‡è¦çš„æ€§è´¨ï¼Œå³ç´¢å¼•çš„æœ€å·¦åŒ¹é…ç‰¹æ€§ã€‚  Explain Explain + SQLè¯­å¥å³å¯,å¦‚ä¸‹:\nexplain select * from tbl_dept;  1æ‰§è¡Œç»“æœå¦‚ä¸‹:  **\nEXPLAINç»“æœå‚æ•°å«ä¹‰\n1.id: idä»£è¡¨æ‰§è¡Œselectå­å¥æˆ–æ“ä½œè¡¨çš„é¡ºåº,ä¾‹å¦‚,ä¸Šè¿°çš„æ‰§è¡Œç»“æœä»£è¡¨åªæœ‰ä¸€æ¬¡æ‰§è¡Œè€Œä¸”æ‰§è¡Œé¡ºåºæ˜¯ç¬¬ä¸€(å› ä¸ºåªæœ‰ä¸€ä¸ªidä¸º1çš„æ‰§è¡Œç»“æœ),idåˆ†åˆ«æœ‰ä¸‰ç§ä¸åŒçš„æ‰§è¡Œç»“æœ,åˆ†åˆ«å¦‚ä¸‹:\n idç›¸åŒ,æ‰§è¡Œé¡ºåºç”±ä¸Šè‡³ä¸‹  \n idä¸åŒ,å¦‚æœæ˜¯å­æŸ¥è¯¢,idçš„åºå·ä¼šé€’å¢,idå€¼è¶Šå¤§,ä¼˜å…ˆçº§è¶Šé«˜,è¶Šå…ˆè¢«æ‰§è¡Œ  \n idç›¸åŒå’Œä¸åŒ,åŒæ—¶å­˜åœ¨,éµä»ä¼˜å…ˆçº§é«˜çš„ä¼˜å…ˆæ‰§è¡Œ,ä¼˜å…ˆçº§ç›¸åŒçš„æŒ‰ç…§ç”±ä¸Šè‡³ä¸‹çš„é¡ºåºæ‰§è¡Œ  \n2.select_type æŸ¥è¯¢çš„ç±»å‹,ä¸»è¦ç”¨äºåŒºåˆ«æ™®é€šæŸ¥è¯¢,è”åˆæŸ¥è¯¢,å­æŸ¥è¯¢ç­‰å¤æ‚æŸ¥è¯¢\n simple: ç®€å•çš„selectæŸ¥è¯¢,æŸ¥è¯¢ä¸­ä¸åŒ…å«å­æŸ¥è¯¢æˆ–unionæŸ¥è¯¢ primary: æŸ¥è¯¢ä¸­è‹¥åŒ…å«ä»»ä½•å¤æ‚çš„å­éƒ¨åˆ†,æœ€å¤–å±‚æŸ¥è¯¢åˆ™è¢«æ ‡è®°ä¸ºprimary subquery åœ¨select æˆ–where åˆ—è¡¨ä¸­åŒ…å«äº†å­æŸ¥è¯¢ derived åœ¨fromåˆ—è¡¨ä¸­åŒ…å«çš„å­æŸ¥è¯¢è¢«æ ‡è®°ä¸ºderived,mysqlä¼šé€’å½’è¿™äº›å­æŸ¥è¯¢,æŠŠç»“æœæ”¾åœ¨ä¸´æ—¶è¡¨é‡Œ union åšç¬¬äºŒä¸ªselectå‡ºç°åœ¨unionä¹‹å,åˆ™è¢«æ ‡è®°ä¸ºunion,è‹¥unionåŒ…å«åœ¨fromå­å¥çš„å­æŸ¥è¯¢ä¸­,å¤–å±‚selectå°†è¢«æ ‡è®°ä¸ºderived union result ä»unionè¡¨è·å–ç»“æœçš„select  3.table æ˜¾ç¤ºä¸€è¡Œçš„æ•°æ®æ—¶å…³äºå“ªå¼ è¡¨çš„ 4.type æŸ¥è¯¢ç±»å‹ä»æœ€å¥½åˆ°æœ€å·®ä¾æ¬¡æ˜¯:system\u0026gt;const\u0026gt;eq_ref\u0026gt;ref\u0026gt;range\u0026gt;index\u0026gt;All,ä¸€èˆ¬æƒ…å†µä¸‹,å¾—è‡³å°‘ä¿è¯è¾¾åˆ°rangeçº§åˆ«,æœ€å¥½èƒ½è¾¾åˆ°ref\n system:è¡¨åªæœ‰ä¸€è¡Œè®°å½•,è¿™æ˜¯constç±»å‹çš„ç‰¹ä¾‹,å¹³æ—¶ä¸ä¼šå‡ºç° const:è¡¨ç¤ºé€šè¿‡ç´¢å¼•ä¸€æ¬¡å°±æ‰¾åˆ°äº†,constå³å¸¸é‡,å®ƒç”¨äºæ¯”è¾ƒprimary keyæˆ–uniqueç´¢å¼•,å› ä¸ºåªåŒ¹é…ä¸€è¡Œæ•°æ®,æ‰€ä»¥æ•ˆç‡å¾ˆå¿«,å¦‚å°†ä¸»é”®ç½®äºwhereæ¡ä»¶ä¸­,mysqlå°±èƒ½å°†è¯¥æŸ¥è¯¢è½¬æ¢ä¸ºä¸€ä¸ªå¸¸é‡  \n eq_ref:å”¯ä¸€æ€§ç´¢å¼•æ‰«æ,å¯¹äºæ¯ä¸ªç´¢å¼•é”®,è¡¨ä¸­åªæœ‰ä¸€æ¡è®°å½•ä¸ä¹‹åŒ¹é…,å¸¸è§äºä¸»é”®æˆ–å”¯ä¸€ç´¢å¼•æ‰«æ ref:éå”¯ä¸€æ€§ç´¢å¼•æ‰«æ,è¿”å›åŒ¹é…æŸä¸ªå•ç‹¬å€¼çš„è¡Œ,å®ƒå¯èƒ½ä¼šæ‰¾åˆ°å¤šä¸ªç¬¦åˆæ¡ä»¶çš„è¡Œ,æ‰€ä»¥ä»–åº”è¯¥å±äºæŸ¥æ‰¾å’Œæ‰«æçš„æ··åˆä½“ range:åªæ£€ç´¢ç»™å®šèŒƒå›´çš„è¡Œ,ä½¿ç”¨ä¸€ä¸ªç´¢å¼•æ¥é€‰æ‹©è¡Œ,å¦‚whereè¯­å¥ä¸­å‡ºç°äº†between,\u0026lt;,\u0026gt;,inç­‰æŸ¥è¯¢,è¿™ç§èŒƒå›´æ‰«æç´¢å¼•æ¯”å…¨è¡¨æ‰«æè¦å¥½ï¼Œå› ä¸ºå®ƒåªéœ€è¦å¼€å§‹äºç´¢å¼•çš„æŸä¸€ç‚¹ï¼Œè€Œç»“æŸäºå¦ä¸€ç‚¹ï¼Œä¸ç”¨æ‰«æå…¨éƒ¨ç´¢å¼•ã€‚ index:indexç±»å‹åªéå†ç´¢å¼•æ ‘,è¿™é€šå¸¸æ¯”Allå¿«,å› ä¸ºç´¢å¼•æ–‡ä»¶é€šå¸¸æ¯”æ•°æ®æ–‡ä»¶å°,indexæ˜¯ä»ç´¢å¼•ä¸­è¯»å–,allä»ç¡¬ç›˜ä¸­è¯»å– all:å…¨è¡¨æ‰«æ,æ˜¯æœ€å·®çš„ä¸€ç§æŸ¥è¯¢ç±»å‹  5.possible_keys æ˜¾ç¤ºå¯èƒ½åº”ç”¨åœ¨è¿™å¼ è¡¨ä¸­çš„ç´¢å¼•,ä¸€ä¸ªæˆ–å¤šä¸ª,æŸ¥è¯¢åˆ°çš„ç´¢å¼•ä¸ä¸€å®šæ˜¯çœŸæ­£è¢«ç”¨åˆ°çš„\n6.key å®é™…ä½¿ç”¨çš„ç´¢å¼•,å¦‚æœä¸ºnull,åˆ™æ²¡æœ‰ä½¿ç”¨ç´¢å¼•,å› æ­¤ä¼šå‡ºç°possible_keysåˆ—æœ‰å¯èƒ½è¢«ç”¨åˆ°çš„ç´¢å¼•,ä½†æ˜¯keyåˆ—ä¸ºnull,è¡¨ç¤ºå®é™…æ²¡ç”¨ç´¢å¼•ã€‚\n7.key_len è¡¨ç¤ºç´¢å¼•ä¸­ä½¿ç”¨çš„å­—èŠ‚æ•°,è€Œé€šè¿‡è¯¥åˆ—è®¡ç®—æŸ¥è¯¢ä¸­ä½¿ç”¨çš„ ç´¢å¼•é•¿åº¦,åœ¨ä¸æŸå¤±ç²¾ç¡®æ€§çš„æƒ…å†µä¸‹,é•¿åº¦è¶ŠçŸ­è¶Šå¥½,key_lenæ˜¾ç¤ºçš„å€¼ä¸ºç´¢å¼•å­—æ®µçš„æœ€å¤§å¯èƒ½é•¿åº¦,å¹¶éå®é™…ä½¿ç”¨é•¿åº¦,å³,key_lenæ˜¯æ ¹æ®è¡¨å®šä¹‰è®¡ç®—è€Œå¾—ä¹ˆä¸æ˜¯é€šè¿‡è¡¨å†…æ£€ç´¢å‡ºçš„\n8.ref æ˜¾ç¤ºç´¢å¼•çš„å“ªä¸€åˆ—è¢«ä½¿ç”¨äº†,å¦‚æœå¯èƒ½çš„è¯æ˜¯ä¸€ä¸ªå¸¸æ•°,å“ªäº›åˆ—æˆ–å¸¸é‡è¢«ç”¨äºæŸ¥æ‰¾ç´¢å¼•åˆ—ä¸Šçš„å€¼\n9.rows æ ¹æ®è¡¨ç»Ÿè®¡ä¿¡æ¯åŠç´¢å¼•é€‰ç”¨æƒ…å†µ,å¤§åªä¼°ç®—å‡ºæ‰¾åˆ°æ‰€éœ€çš„è®°å½•æ‰€éœ€è¦è¯»å–çš„è¡Œæ•°\n10.Extra\n Using filesort:è¯´æ˜mysqlä¼šå¯¹æ•°æ®ä½¿ç”¨ä¸€ä¸ªå¤–éƒ¨çš„ç´¢å¼•æ’åº,è€Œä¸æ˜¯æŒ‰ç…§è¡¨å†…çš„ç´¢å¼•é¡ºåºè¿›è¡Œè¯»å–,mysqlä¸­æ— æ³•åˆ©ç”¨ç´¢å¼•å®Œæˆçš„æ’åºæ“ä½œç§°ä¸º\u0026quot;æ–‡ä»¶æ’åº\u0026quot; Using temporary :ä½¿ç”¨äº†ä¸´æ—¶è¡¨ä¿å­˜ä¸­é—´ç»“æœ,mysqlåœ¨å¯¹æŸ¥è¯¢ç»“æœæ’åºæ—¶ä½¿ç”¨ä¸´æ—¶è¡¨,å¸¸è§äºorder byå’Œåˆ†ç»„æŸ¥è¯¢group by Using index:è¡¨ç¤ºç›¸åº”çš„selectæ“ä½œä¸­ä½¿ç”¨äº†è¦†ç›–ç´¢å¼•ï¼ˆCovering Indexï¼‰ï¼Œé¿å…è®¿é—®äº†è¡¨çš„æ•°æ®è¡Œï¼Œæ•ˆç‡ä¸é”™ã€‚å¦‚æœåŒæ—¶å‡ºç°using whereï¼Œè¡¨æ˜ç´¢å¼•è¢«ç”¨æ¥æ‰§è¡Œç´¢å¼•é”®å€¼çš„æŸ¥æ‰¾ï¼›å¦‚æœæ²¡æœ‰åŒæ—¶å‡ºç°using whereï¼Œè¡¨æ˜ç´¢å¼•ç”¨æ¥è¯»å–æ•°æ®è€Œéæ‰§è¡ŒæŸ¥æ‰¾åŠ¨ä½œã€‚ å…¶ä¸­çš„è¦†ç›–ç´¢å¼•å«ä¹‰æ˜¯æ‰€æŸ¥è¯¢çš„åˆ—æ˜¯å’Œå»ºç«‹çš„ç´¢å¼•å­—æ®µå’Œä¸ªæ•°æ˜¯ä¸€ä¸€å¯¹åº”çš„ Using where:è¡¨æ˜ä½¿ç”¨äº†whereè¿‡æ»¤ Using join buffer:è¡¨æ˜ä½¿ç”¨äº†è¿æ¥ç¼“å­˜,å¦‚åœ¨æŸ¥è¯¢çš„æ—¶å€™ä¼šæœ‰å¤šæ¬¡join,åˆ™å¯èƒ½ä¼šäº§ç”Ÿä¸´æ—¶è¡¨ impossible where:è¡¨ç¤ºwhereå­å¥çš„å€¼æ€»æ˜¯false,ä¸èƒ½ç”¨æ¥è·å–ä»»ä½•å…ƒç¥–ã€‚å¦‚ä¸‹ä¾‹ï¼š  select * from t1 where id='1' and id='2';  select tables optimized away  åœ¨æ²¡æœ‰GROUPBYå­å¥çš„æƒ…å†µä¸‹ï¼ŒåŸºäºç´¢å¼•ä¼˜åŒ–MIN/MAXæ“ä½œæˆ–è€…å¯¹äºMyISAMå­˜å‚¨å¼•æ“ä¼˜åŒ–COUNT(*)æ“ä½œï¼Œä¸å¿…ç­‰åˆ°æ‰§è¡Œé˜¶æ®µå†è¿›è¡Œè®¡ç®—ï¼ŒæŸ¥è¯¢æ‰§è¡Œè®¡åˆ’ç”Ÿæˆçš„é˜¶æ®µå³å®Œæˆä¼˜åŒ–ã€‚\n distinctï¼šä¼˜åŒ–distinctæ“ä½œï¼Œåœ¨æ‰¾åˆ°ç¬¬ä¸€åŒ¹é…çš„å…ƒç»„åå³åœæ­¢æ‰¾åŒæ ·å€¼çš„åŠ¨ä½œï¼Œå³ä¸€æ—¦MySQLæ‰¾åˆ°äº†ä¸è¡Œç›¸è”åˆåŒ¹é…çš„è¡Œï¼Œå°±ä¸å†æœç´¢äº†ã€‚  é‡ç‚¹ï¼š\nã€€typeï¼šè®¿é—®ç±»å‹ï¼ŒæŸ¥çœ‹SQLåˆ°åº•æ˜¯ä»¥ä½•ç§ç±»å‹è®¿é—®æ•°æ®çš„ã€‚\nã€€keyï¼šä½¿ç”¨çš„ç´¢å¼•ï¼ŒMySQLç”¨äº†å“ªä¸ªç´¢å¼•ï¼Œæœ‰æ—¶å€™MySQLç”¨çš„ç´¢å¼•ä¸æ˜¯æœ€å¥½çš„ï¼Œéœ€è¦force index()ã€‚\nã€€rowsï¼šæœ€å¤§æ‰«æçš„åˆ—æ•°ã€‚\nã€€extraï¼šé‡è¦çš„é¢å¤–ä¿¡æ¯ï¼Œç‰¹åˆ«æ³¨æ„æŸè€—æ€§èƒ½çš„ä¸¤ä¸ªæƒ…å†µï¼Œusing filesortå’Œusing temporaryã€‚\nè¯´å‡ºä½ å¦‚ä½•è°ƒä¼˜çš„ ç›´æ¥explain\nå¸¸è§çš„ä¼˜åŒ–æ‰‹æ®µ  ä½¿ç”¨è¦†ç›–ç´¢å¼•è§£å†³å›è¡¨ï¼Œæé«˜æŸ¥è¯¢æ•ˆç‡ ä½¿ç”¨explainæ£€æŸ¥sqlè¯­å¥æ‰§è¡Œçš„æƒ…å†µ whereè¯­å¥æ—¶ï¼Œå­—æ®µç±»å‹ä¸€å®šè¦ä¸€ç›´ï¼Œå¦åˆ™ç´¢å¼•å¤±æ•ˆ ä½¿ç”¨å‡½æ•°ç´¢å¼•ä¸èµ° ORå¯¼è‡´ç´¢å¼•æ˜¯åœ¨ç‰¹å®šæƒ…å†µä¸‹çš„ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰çš„ORéƒ½æ˜¯ä½¿ç´¢å¼•å¤±æ•ˆï¼Œå¦‚æœORè¿æ¥çš„æ˜¯åŒä¸€ä¸ªå­—æ®µï¼Œé‚£ä¹ˆç´¢å¼•ä¸ä¼šå¤±æ•ˆï¼Œåä¹‹ç´¢å¼•å¤±æ•ˆã€‚ æ¨¡ç³ŠåŒ¹é…ï¼Œlike ä¸­%ä¸èƒ½å†™åœ¨å‰é¢ IS NULLèµ°ç´¢å¼•ï¼ŒIS NOT NULLèµ°ç´¢å¼• å¼€å¯æ…¢æ—¥å¿—ï¼ŒæŸ¥çœ‹å“ªäº›sqlæ‰§è¡Œå¤ªæ…¢  MVVC MySQLçš„å¤§å¤šæ•°äº‹åŠ¡å‹å­˜å‚¨å¼•æ“å®ç°éƒ½ä¸æ˜¯ç®€å•çš„è¡Œçº§é”ã€‚åŸºäºæå‡å¹¶å‘æ€§è€ƒè™‘ï¼Œä¸€èˆ¬éƒ½åŒæ—¶å®ç°äº†å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼ˆMVCCï¼‰ï¼ŒåŒ…æ‹¬Oracleã€PostgreSQLã€‚åªæ˜¯å®ç°æœºåˆ¶å„ä¸ç›¸åŒã€‚\nå¯ä»¥è®¤ä¸º MVCC æ˜¯è¡Œçº§é”çš„ä¸€ä¸ªå˜ç§ï¼Œä½†å®ƒåœ¨å¾ˆå¤šæƒ…å†µä¸‹é¿å…äº†åŠ é”æ“ä½œï¼Œå› æ­¤å¼€é”€æ›´ä½ã€‚è™½ç„¶å®ç°æœºåˆ¶æœ‰æ‰€ä¸åŒï¼Œä½†å¤§éƒ½å®ç°äº†éé˜»å¡çš„è¯»æ“ä½œï¼Œå†™æ“ä½œä¹Ÿåªæ˜¯é”å®šå¿…è¦çš„è¡Œã€‚\nMVCC çš„å®ç°æ˜¯é€šè¿‡ä¿å­˜æ•°æ®åœ¨æŸä¸ªæ—¶é—´ç‚¹çš„å¿«ç…§æ¥å®ç°çš„ã€‚ä¹Ÿå°±æ˜¯è¯´ä¸ç®¡éœ€è¦æ‰§è¡Œå¤šé•¿æ—¶é—´ï¼Œæ¯ä¸ªäº‹ç‰©çœ‹åˆ°çš„æ•°æ®éƒ½æ˜¯ä¸€è‡´çš„ã€‚\nå…¸å‹çš„MVCCå®ç°æ–¹å¼ï¼Œåˆ†ä¸ºä¹è§‚ï¼ˆoptimisticï¼‰å¹¶å‘æ§åˆ¶å’Œæ‚²è§‚ï¼ˆpressimisticï¼‰å¹¶å‘æ§åˆ¶ã€‚ä¸‹è¾¹é€šè¿‡ InnoDBçš„ç®€åŒ–ç‰ˆè¡Œä¸ºæ¥è¯´æ˜ MVCC æ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚\nInnoDB çš„ MVCCï¼Œæ˜¯é€šè¿‡åœ¨æ¯è¡Œè®°å½•åé¢ä¿å­˜ä¸¤ä¸ªéšè—çš„åˆ—æ¥å®ç°ã€‚è¿™ä¸¤ä¸ªåˆ—ï¼Œä¸€ä¸ªä¿å­˜äº†è¡Œçš„åˆ›å»ºæ—¶é—´ï¼Œä¸€ä¸ªä¿å­˜è¡Œçš„è¿‡æœŸæ—¶é—´ï¼ˆåˆ é™¤æ—¶é—´ï¼‰ã€‚å½“ç„¶å­˜å‚¨çš„å¹¶ä¸æ˜¯çœŸå®çš„æ—¶é—´ï¼Œè€Œæ˜¯ç³»ç»Ÿç‰ˆæœ¬å·ï¼ˆsystem version numberï¼‰ã€‚æ¯å¼€å§‹ä¸€ä¸ªæ–°çš„äº‹åŠ¡ï¼Œç³»ç»Ÿç‰ˆæœ¬å·éƒ½ä¼šè‡ªåŠ¨é€’å¢ã€‚äº‹åŠ¡å¼€å§‹æ—¶åˆ»çš„ç³»ç»Ÿç‰ˆæœ¬å·ä¼šä½œä¸ºäº‹åŠ¡çš„ç‰ˆæœ¬å·ï¼Œç”¨æ¥å’ŒæŸ¥è¯¢åˆ°çš„æ¯è¡Œè®°å½•çš„ç‰ˆæœ¬å·è¿›è¡Œæ¯”è¾ƒã€‚\nREPEATABLE READï¼ˆå¯é‡è¯»ï¼‰éš”ç¦»çº§åˆ«ä¸‹MVCCå¦‚ä½•å·¥ä½œï¼š\n  SELECT\nInnoDBä¼šæ ¹æ®ä»¥ä¸‹ä¸¤ä¸ªæ¡ä»¶æ£€æŸ¥æ¯è¡Œè®°å½•ï¼š\nåªæœ‰ç¬¦åˆä¸Šè¿°ä¸¤ä¸ªæ¡ä»¶çš„æ‰ä¼šè¢«æŸ¥è¯¢å‡ºæ¥\n   InnoDBåªæŸ¥æ‰¾ç‰ˆæœ¬æ—©äºå½“å‰äº‹åŠ¡ç‰ˆæœ¬çš„æ•°æ®è¡Œï¼Œè¿™æ ·å¯ä»¥ç¡®ä¿äº‹åŠ¡è¯»å–çš„è¡Œï¼Œè¦ä¹ˆæ˜¯åœ¨å¼€å§‹äº‹åŠ¡ä¹‹å‰å·²ç»å­˜åœ¨è¦ä¹ˆæ˜¯äº‹åŠ¡è‡ªèº«æ’å…¥æˆ–è€…ä¿®æ”¹è¿‡çš„ è¡Œçš„åˆ é™¤ç‰ˆæœ¬å·è¦ä¹ˆæœªå®šä¹‰ï¼Œè¦ä¹ˆå¤§äºå½“å‰äº‹åŠ¡ç‰ˆæœ¬å·ï¼Œè¿™æ ·å¯ä»¥ç¡®ä¿äº‹åŠ¡è¯»å–åˆ°çš„è¡Œåœ¨äº‹åŠ¡å¼€å§‹ä¹‹å‰æœªè¢«åˆ é™¤    INSERTï¼šInnoDBä¸ºæ–°æ’å…¥çš„æ¯ä¸€è¡Œä¿å­˜å½“å‰ç³»ç»Ÿç‰ˆæœ¬å·ä½œä¸ºè¡Œç‰ˆæœ¬å·\n  DELETEï¼šInnoDBä¸ºåˆ é™¤çš„æ¯ä¸€è¡Œä¿å­˜å½“å‰ç³»ç»Ÿç‰ˆæœ¬å·ä½œä¸ºè¡Œåˆ é™¤æ ‡è¯†\n  UPDATEï¼šInnoDBä¸ºæ’å…¥çš„ä¸€è¡Œæ–°çºªå½•ä¿å­˜å½“å‰ç³»ç»Ÿç‰ˆæœ¬å·ä½œä¸ºè¡Œç‰ˆæœ¬å·ï¼ŒåŒæ—¶ä¿å­˜å½“å‰ç³»ç»Ÿç‰ˆæœ¬å·åˆ°åŸæ¥çš„è¡Œä½œä¸ºåˆ é™¤æ ‡è¯†\n  ä¿å­˜è¿™ä¸¤ä¸ªé¢å¤–ç³»ç»Ÿç‰ˆæœ¬å·ï¼Œä½¿å¤§å¤šæ•°æ“ä½œéƒ½ä¸ç”¨åŠ é”ã€‚ä½¿æ•°æ®æ“ä½œç®€å•ï¼Œæ€§èƒ½å¾ˆå¥½ï¼Œå¹¶ä¸”ä¹Ÿèƒ½ä¿è¯åªä¼šè¯»å–åˆ°ç¬¦åˆè¦æ±‚çš„è¡Œã€‚ä¸è¶³ä¹‹å¤„æ˜¯æ¯è¡Œè®°å½•éƒ½éœ€è¦é¢å¤–çš„å­˜å‚¨ç©ºé—´ï¼Œéœ€è¦åšæ›´å¤šçš„è¡Œæ£€æŸ¥å·¥ä½œå’Œä¸€äº›é¢å¤–çš„ç»´æŠ¤å·¥ä½œã€‚\nMVCC åªåœ¨ COMMITTED READï¼ˆè¯»æäº¤ï¼‰å’ŒREPEATABLE READï¼ˆå¯é‡å¤è¯»ï¼‰ä¸¤ç§éš”ç¦»çº§åˆ«ä¸‹å·¥ä½œã€‚\näº‹åŠ¡ç‰¹æ€§ï¼Œéš”ç¦»çº§åˆ«ï¼Œæ€ä¹ˆè§£å†³å¹»è¯»ï¼Ÿ ç‰¹æ€§ï¼šACID\n  åŸå­æ€§\næ•´ä¸ªäº‹åŠ¡è¦ä¹ˆå…¨éƒ¨æ‰§è¡Œï¼Œè¦ä¹ˆå…¨éƒ¨ä¸æ‰§è¡Œï¼Œä¸ä¼šåœåœ¨ä¸­é—´ã€‚äº‹åŠ¡åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯ï¼Œä¼šè¢«å›æ»šï¼ˆRollbackï¼‰åˆ°äº‹åŠ¡å¼€å§‹å‰çš„çŠ¶æ€ï¼Œå°±åƒè¿™ä¸ªäº‹åŠ¡ä»æ¥æ²¡æœ‰æ‰§è¡Œè¿‡ä¸€æ ·\n  ä¸€è‡´æ€§\nä¸€è‡´æ€§ï¼Œè¿™ä¸ªæ˜¯å¤§å®¶è¯¯è§£æœ€æ·±çš„ï¼Œå¾ˆå¤šåšå®¢éƒ½å–œæ¬¢ç”¨é“¶è¡Œè½¬è´¦çš„ä¾‹å­æ¥è®²ä¸€ç›´æ€§ï¼Œæ‰€è°“çš„ä¸€è‡´æ€§æ˜¯åŸºäºåŸå­æ€§ã€‚\nåŸå­æ€§åªä¿è¯äº†ä¸€ä¸ªäº‹ç‰©å†…çš„æ‰€æœ‰æ“ä½œåŒä¸€æ€§ï¼Œå¤§å®¶åŒç”Ÿæ­»ï¼Œä¸ä¼šå‡ºç°ä½ æ­»äº†ï¼Œæˆ‘è¿˜æ´»ç€ã€‚ä½†æ˜¯ï¼ŒåŸå­æ€§å¹¶æ²¡æœ‰ä¿è¯å¤§å®¶åŒä¸€æ—¶åˆ»ä¸€èµ·ç”Ÿï¼Œä¸€èµ·æ­»ã€‚è®¡ç®—æœºæŒ‡ä»¤æ˜¯æœ‰å…ˆåé¡ºåºçš„ï¼Œè¿™æ ·å°±å†³å®šäº†ä¸€ä¸ªäº‹ç‰©çš„æäº¤ï¼Œä¼šç»å†ä¸€ä¸ªæ—¶é—´è¿‡ç¨‹ï¼Œé‚£ä¹ˆå¦‚æœäº‹ç‰©æäº¤è¿›è¡Œåˆ°äº†ä¸€åŠï¼Œæˆ‘è¯»å–äº†æ•°æ®åº“ï¼Œä¼šä¸ä¼šè¯»åˆ°ä¸­é—´ç»“æœï¼Ÿ\nä¸ºäº†é˜²æ­¢è¿™æ ·çš„æƒ…å†µï¼Œæ•°æ®åº“äº‹ç‰©çš„ä¸€è‡´æ€§å°±è§„å®šäº†äº‹ç‰©æäº¤å‰åï¼Œæ°¸è¿œåªå¯èƒ½å­˜åœ¨äº‹ç‰©æäº¤å‰çš„çŠ¶æ€å’Œäº‹ç‰©æäº¤åçš„çŠ¶æ€ï¼Œä»ä¸€ä¸ªä¸€è‡´æ€§çš„çŠ¶æ€åˆ°å¦ä¸€ä¸ªä¸€è‡´æ€§çŠ¶æ€ï¼Œè€Œä¸å¯èƒ½å‡ºç°ä¸­é—´çš„è¿‡ç¨‹æ€ã€‚ä¹Ÿå°±æ˜¯è¯´äº‹ç‰©çš„æ‰§è¡Œç»“æœæ˜¯é‡å­åŒ–çŠ¶æ€ï¼Œè€Œä¸æ˜¯çº¿æ€§çŠ¶æ€ã€‚\næ•°æ®åº“æäº¤äº‹ç‰©ä¼šæœ‰ä¸€ä¸ªè¿‡ç¨‹ï¼Œå¦‚æœæäº¤çš„æ—¶å€™ï¼Œå­˜åœ¨ä¸€ä¸ªæ—¶é—´å·®ï¼Œåœ¨æäº¤çš„ç¬¬ä¸€ç§’ï¼Œä¸€ä¸ªåˆ é™¤è¿‡ç¨‹è¿˜æ²¡å®Œæˆåˆ°äº†ç¬¬ä¸‰ç§’æ‰å®Œæˆï¼Œä¼šä¸ä¼šç¬¬ä¸€ç§’è®¿é—®çš„äººå’Œç¬¬ä¸‰ç§’è®¿é—®çš„äººå¾—åˆ°ä¸åŒçš„ç»“æœï¼Ÿå‡ºç°ä¸ä¸€è‡´ï¼ŒçŠ¶æ€çš„æ··æ²Œï¼Ÿè¿™å°±æ˜¯ä¸€è‡´æ€§å¾—ä¿è¯çš„åªä¼šæœ‰å‰çŠ¶æ€å’ŒåçŠ¶æ€ï¼Œç»ä¸ä¼šå‡ºç°ä¸­é—´æ€ã€‚\n  éš”ç¦»æ€§\nä¸€ä¸ªäº‹åŠ¡çš„æ‰§è¡Œä¸èƒ½å…¶å®ƒäº‹åŠ¡å¹²æ‰°ã€‚å³ä¸€ä¸ªäº‹åŠ¡å†…éƒ¨çš„æ“ä½œåŠä½¿ç”¨çš„æ•°æ®å¯¹å…¶å®ƒå¹¶å‘äº‹åŠ¡æ˜¯éš”ç¦»çš„ï¼Œå¹¶å‘æ‰§è¡Œçš„å„ä¸ªäº‹åŠ¡ä¹‹é—´ä¸èƒ½äº’ç›¸å¹²æ‰°\n  æŒä¹…æ€§\nåœ¨äº‹åŠ¡å®Œæˆä»¥åï¼Œè¯¥äº‹åŠ¡æ‰€å¯¹æ•°æ®åº“æ‰€ä½œçš„æ›´æ”¹ä¾¿æŒä¹…çš„ä¿å­˜åœ¨æ•°æ®åº“ä¹‹ä¸­ï¼Œå¹¶ä¸ä¼šè¢«å›æ»š\n  éš”ç¦»çº§åˆ«ï¼š\n  è¯»æœªæäº¤\nè„è¯»ï¼Œäº‹åŠ¡Aè¯»å–äº†äº‹åŠ¡Bæ›´æ–°çš„æ•°æ®ï¼Œç„¶åBå›æ»šæ“ä½œï¼Œé‚£ä¹ˆAè¯»å–åˆ°çš„æ•°æ®æ˜¯è„æ•°æ®\n  è¯»å·²æäº¤\nä¸å¯é‡å¤è¯»ï¼Œä¸€ä¸ªäº‹åŠ¡è¯»2æ¬¡ï¼Œ2æ¬¡è¯»çš„ç»“æœä¸ä¸€æ ·ï¼ŒåŠ¡ A å¤šæ¬¡è¯»å–åŒä¸€æ•°æ®ï¼Œäº‹åŠ¡Båœ¨äº‹åŠ¡Aå¤šæ¬¡è¯»å–çš„è¿‡ç¨‹ä¸­ï¼Œå¯¹æ•°æ®ä½œäº†æ›´æ–°å¹¶æäº¤ï¼Œå¯¼è‡´äº‹åŠ¡Aå¤šæ¬¡è¯»å–åŒä¸€æ•°æ®æ—¶ï¼Œç»“æœä¸ä¸€è‡´ã€‚\n  å¯é‡å¤è¯»\nä¼šé€ æˆå¹»è¯»\n å¹»è¯»æ˜¯äº‹åŠ¡éç‹¬ç«‹æ‰§è¡Œæ—¶å‘ç”Ÿçš„ä¸€ç§ç°è±¡ã€‚ä¾‹å¦‚äº‹åŠ¡T1å¯¹ä¸€ä¸ªè¡¨ä¸­æ‰€æœ‰çš„è¡Œçš„æŸä¸ªæ•°æ®é¡¹åšäº†ä»â€œ1â€ä¿®æ”¹ä¸ºâ€œ2â€çš„æ“ä½œï¼Œè¿™æ—¶äº‹åŠ¡T2åˆå¯¹è¿™ä¸ªè¡¨ä¸­æ’å…¥äº†ä¸€è¡Œæ•°æ®é¡¹ï¼Œè€Œè¿™ä¸ªæ•°æ®é¡¹çš„æ•°å€¼è¿˜æ˜¯ä¸ºâ€œ1â€å¹¶ä¸”æäº¤ç»™æ•°æ®åº“ã€‚è€Œæ“ä½œäº‹åŠ¡T1çš„ç”¨æˆ·å¦‚æœå†æŸ¥çœ‹åˆšåˆšä¿®æ”¹çš„æ•°æ®ï¼Œä¼šå‘ç°è¿˜æœ‰ä¸€è¡Œæ²¡æœ‰ä¿®æ”¹ï¼Œå…¶å®è¿™è¡Œæ˜¯ä»äº‹åŠ¡T2ä¸­æ·»åŠ çš„ï¼Œå°±å¥½åƒäº§ç”Ÿå¹»è§‰ä¸€æ ·ï¼Œè¿™å°±æ˜¯å‘ç”Ÿäº†å¹»è¯»ã€‚ å¹»è¯»å’Œä¸å¯é‡å¤è¯»éƒ½æ˜¯è¯»å–äº†å¦ä¸€æ¡å·²ç»æäº¤çš„äº‹åŠ¡ï¼ˆè¿™ç‚¹å°±è„è¯»ä¸åŒï¼‰ï¼Œæ‰€ä¸åŒçš„æ˜¯ä¸å¯é‡å¤è¯»æŸ¥è¯¢çš„éƒ½æ˜¯åŒä¸€ä¸ªæ•°æ®é¡¹ï¼Œè€Œå¹»è¯»é’ˆå¯¹çš„æ˜¯ä¸€æ‰¹æ•°æ®æ•´ä½“ï¼ˆæ¯”å¦‚æ•°æ®çš„ä¸ªæ•°ï¼‰ã€‚\n   SERIALIZABLE(å¯ä¸²è¡ŒåŒ–)ï¼š æœ€é«˜çš„éš”ç¦»çº§åˆ«ï¼Œå®Œå…¨æœä»ACIDçš„éš”ç¦»çº§åˆ«ã€‚æ‰€æœ‰çš„äº‹åŠ¡ä¾æ¬¡é€ä¸ªæ‰§è¡Œï¼Œè¿™æ ·äº‹åŠ¡ä¹‹é—´å°±å®Œå…¨ä¸å¯èƒ½äº§ç”Ÿå¹²æ‰°ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè¯¥çº§åˆ«å¯ä»¥é˜²æ­¢è„è¯»ã€ä¸å¯é‡å¤è¯»ä»¥åŠå¹»è¯»ã€‚\n  å¦‚ä½•è§£å†³å¹»è¯»\nmysqlä½¿ç”¨äº†é—´éš™é”å’Œè®°å½•é”æ¥è§£å†³çš„ï¼Œé—´éš™é”å°±æ˜¯å¯¹ä¸€æ®µåŒºåŸŸçš„è®°å½•éƒ½é”å®š\næ‰€ä»¥ï¼ŒInnodb å¼•æ“ä¸ºäº†è§£å†³ã€Œå¯é‡å¤è¯»ã€éš”ç¦»çº§åˆ«ä½¿ç”¨ã€Œå½“å‰è¯»ã€è€Œé€ æˆçš„å¹»è¯»é—®é¢˜ï¼Œå°±å¼•å‡ºäº† next-key é”ï¼Œå°±æ˜¯è®°å½•é”å’Œé—´éš™é”çš„ç»„åˆã€‚\n è®°å½•é”ï¼Œé”çš„æ˜¯è®°å½•æœ¬èº«ï¼› é—´éš™é”ï¼Œé”çš„å°±æ˜¯ä¸¤ä¸ªå€¼ä¹‹é—´çš„ç©ºéš™ï¼Œä»¥é˜²æ­¢å…¶ä»–äº‹åŠ¡åœ¨è¿™ä¸ªç©ºéš™é—´æ’å…¥æ–°çš„æ•°æ®ï¼Œä»è€Œé¿å…å¹»è¯»ç°è±¡ã€‚  å‚è€ƒ\n  ä¸‰èŒƒå¼  ç¬¬ä¸€èŒƒå¼ï¼šåˆ—ä¸èƒ½å†æ‹†åˆ†äº† ç¬¬äºŒèŒƒå¼ï¼šæ¯ä¸€æ¡æ•°æ®å¿…é¡»èƒ½å¤Ÿè¢«åŒºåˆ†ï¼Œä¸»é”®å­˜åœ¨ï¼Œè€Œä¸”èƒ½ä¿è¯å”¯ä¸€ ç¬¬ä¸‰èŒƒå¼ï¼šä¸è¦æœ‰å†—ä½™ åèŒƒå¼ï¼šå†—ä½™ä¸€äº›å­—æ®µï¼Œé¿å…æŸ¥è¯¢  ä¸ºä»€ä¹ˆè¦åˆ†åº“åˆ†è¡¨ï¼Œæœ‰ä»€ä¹ˆæ–¹æ¡ˆ åˆ†åº“\n å‚ç›´åˆ†åº“ï¼Œæ¯ä¸ªä¸šåŠ¡æœ‰è‡ªå·±å•ç‹¬çš„åº“  åˆ†è¡¨\n å‚ç›´åˆ†è¡¨ï¼šå•è¡¨åˆ†æˆå¤šè¡¨ï¼Œæ‰©å±•å¼€æ¥ æ°´å¹³åˆ†è¡¨ï¼šæ•°æ®åˆ†å¼€æ¥ï¼Œä¾‹å¦‚ç”¨æˆ·è¡¨ï¼Œé€šè¿‡idåˆ†ä¸ºuser-10000,user-20000ï¼Œé€šè¿‡hashï¼Œè®©æ•°æ®æ•£åˆ—åˆ°ä¸åŒçš„åº“ä¸åŒè¡¨ï¼Œä¸è‡³äºå•åº“å‹åŠ›å¤§  ç¼ºç‚¹ï¼š\n åˆ†å¸ƒå¼äº‹åŠ¡ï¼šSeata è¿è¡¨æŸ¥è¯¢ï¼šå°½é‡é¿å…ï¼Œå®åœ¨ä¸è¡Œåªèƒ½åˆ†å¼€æŸ¥è¯¢ï¼Œå†æ±‡æ€» åˆ†é¡µæ’åºç­‰ï¼šæŸ¥å®Œå†…å­˜åˆ†é¡µæ’åº åˆ†å¸ƒå¼IDï¼Œå”¯ä¸€ä¸»é”®ï¼šé›ªèŠ±ç®—æ³•  ä»€ä¹ˆæ˜¯å›è¡¨ æŒ‡éèšé›†ç´¢å¼•åœ¨æŸ¥æ‰¾æ•°æ®çš„æ—¶å€™ï¼Œä¼šå…ˆæŸ¥æ‰¾åˆ°èšé›†ç´¢å¼•ï¼Œå†é€šè¿‡èšé›†ç´¢å¼•æ‰¾åˆ°æœ€ç»ˆçš„æ•°æ®ã€‚è¿™å°±æ˜¯å›è¡¨\nMySQLè¦†ç›–ç´¢å¼• è¦†ç›–ç´¢å¼•ï¼ˆCovering Indexï¼‰,æˆ–è€…å«ç´¢å¼•è¦†ç›–ï¼Œ ä¹Ÿå°±æ˜¯å¹³æ—¶æ‰€è¯´çš„ä¸éœ€è¦å›è¡¨æ“ä½œ\n  å°±æ˜¯selectçš„æ•°æ®åˆ—åªç”¨ä»ç´¢å¼•ä¸­å°±èƒ½å¤Ÿå–å¾—ï¼Œä¸å¿…è¯»å–æ•°æ®è¡Œï¼ŒMySQLå¯ä»¥åˆ©ç”¨ç´¢å¼•è¿”å›selectåˆ—è¡¨ä¸­çš„å­—æ®µï¼Œè€Œä¸å¿…æ ¹æ®ç´¢å¼•å†æ¬¡è¯»å–æ•°æ®æ–‡ä»¶ï¼Œæ¢å¥è¯è¯´æŸ¥è¯¢åˆ—è¦è¢«æ‰€å»ºçš„ç´¢å¼•è¦†ç›–ã€‚\n  ç´¢å¼•æ˜¯é«˜æ•ˆæ‰¾åˆ°è¡Œçš„ä¸€ä¸ªæ–¹æ³•ï¼Œä½†æ˜¯ä¸€èˆ¬æ•°æ®åº“ä¹Ÿèƒ½ä½¿ç”¨ç´¢å¼•æ‰¾åˆ°ä¸€ä¸ªåˆ—çš„æ•°æ®ï¼Œå› æ­¤å®ƒä¸å¿…è¯»å–æ•´ä¸ªè¡Œã€‚æ¯•ç«Ÿç´¢å¼•å¶å­èŠ‚ç‚¹å­˜å‚¨äº†å®ƒä»¬ç´¢å¼•çš„æ•°æ®ï¼Œå½“èƒ½é€šè¿‡è¯»å–ç´¢å¼•å°±å¯ä»¥å¾—åˆ°æƒ³è¦çš„æ•°æ®ï¼Œé‚£å°±ä¸éœ€è¦è¯»å–è¡Œäº†ã€‚ä¸€ä¸ªç´¢å¼•åŒ…å«ï¼ˆè¦†ç›–ï¼‰æ»¡è¶³æŸ¥è¯¢ç»“æœçš„æ•°æ®å°±å«åšè¦†ç›–ç´¢å¼•ã€‚\n  åˆ¤æ–­æ ‡å‡†\nä½¿ç”¨explainï¼Œå¯ä»¥é€šè¿‡è¾“å‡ºçš„extraåˆ—æ¥åˆ¤æ–­ï¼Œå¯¹äºä¸€ä¸ªç´¢å¼•è¦†ç›–æŸ¥è¯¢ï¼Œæ˜¾ç¤ºä¸ºusing indexï¼ŒMySQLæŸ¥è¯¢ä¼˜åŒ–å™¨åœ¨æ‰§è¡ŒæŸ¥è¯¢å‰ä¼šå†³å®šæ˜¯å¦æœ‰ç´¢å¼•è¦†ç›–æŸ¥è¯¢\n  ä¸ºä»€ä¹ˆéä¸»é”®ç´¢å¼•ç»“æ„å¶å­èŠ‚ç‚¹å­˜å‚¨çš„æ˜¯ä¸»é”®å€¼ï¼Ÿ  ä¿è¯æ•°æ®ä¸€è‡´æ€§å’ŒèŠ‚çœå­˜å‚¨ç©ºé—´ï¼Œå¯ä»¥è¿™ä¹ˆç†è§£ï¼šå•†åŸç³»ç»Ÿè®¢å•è¡¨ä¼šå­˜å‚¨ä¸€ä¸ªç”¨æˆ·IDä½œä¸ºå…³è”å¤–é”®ï¼Œè€Œä¸æ¨èå­˜å‚¨å®Œæ•´çš„ç”¨æˆ·ä¿¡æ¯ï¼Œå› ä¸ºå½“æˆ‘ä»¬ç”¨æˆ·è¡¨ä¸­çš„ä¿¡æ¯ï¼ˆçœŸå®åç§°ã€æ‰‹æœºå·ã€æ”¶è´§åœ°å€Â·Â·Â·ï¼‰ä¿®æ”¹åï¼Œä¸éœ€è¦å†æ¬¡ç»´æŠ¤è®¢å•è¡¨çš„ç”¨æˆ·æ•°æ®ï¼ŒåŒæ—¶ä¹ŸèŠ‚çœäº†å­˜å‚¨ç©ºé—´\n ä¸ºä»€ä¹ˆMysqlç´¢å¼•è¦ç”¨B+æ ‘ä¸æ˜¯Bæ ‘ï¼Ÿ  ç”¨B+æ ‘ä¸ç”¨Bæ ‘è€ƒè™‘çš„æ˜¯IOå¯¹æ€§èƒ½çš„å½±å“ï¼ŒBæ ‘çš„æ¯ä¸ªèŠ‚ç‚¹éƒ½å­˜å‚¨æ•°æ®ï¼Œè€ŒB+æ ‘åªæœ‰å¶å­èŠ‚ç‚¹æ‰å­˜å‚¨æ•°æ®ï¼Œæ‰€ä»¥æŸ¥æ‰¾ç›¸åŒæ•°æ®é‡çš„æƒ…å†µä¸‹ï¼ŒBæ ‘çš„é«˜åº¦æ›´é«˜ï¼ŒIOæ›´é¢‘ç¹ã€‚æ•°æ®åº“ç´¢å¼•æ˜¯å­˜å‚¨åœ¨ç£ç›˜ä¸Šçš„ï¼Œå½“æ•°æ®é‡å¤§æ—¶ï¼Œå°±ä¸èƒ½æŠŠæ•´ä¸ªç´¢å¼•å…¨éƒ¨åŠ è½½åˆ°å†…å­˜äº†ï¼Œåªèƒ½é€ä¸€åŠ è½½æ¯ä¸€ä¸ªç£ç›˜é¡µï¼ˆå¯¹åº”ç´¢å¼•æ ‘çš„èŠ‚ç‚¹ï¼‰ã€‚å…¶ä¸­åœ¨MySQLåº•å±‚å¯¹B+æ ‘è¿›è¡Œè¿›ä¸€æ­¥ä¼˜åŒ–ï¼šåœ¨å¶å­èŠ‚ç‚¹ä¸­æ˜¯åŒå‘é“¾è¡¨ï¼Œä¸”åœ¨é“¾è¡¨çš„å¤´ç»“ç‚¹å’Œå°¾èŠ‚ç‚¹ä¹Ÿæ˜¯å¾ªç¯æŒ‡å‘çš„ã€‚\n ä¸ºä½•ä¸é‡‡ç”¨Hashåˆ›å»ºç´¢å¼•æ–¹å¼ï¼Ÿ  å› ä¸ºHashç´¢å¼•åº•å±‚æ˜¯å“ˆå¸Œè¡¨ï¼Œå“ˆå¸Œè¡¨æ˜¯ä¸€ç§ä»¥key-valueå­˜å‚¨æ•°æ®çš„ç»“æ„ï¼Œæ‰€ä»¥å¤šä¸ªæ•°æ®åœ¨å­˜å‚¨å…³ç³»ä¸Šæ˜¯å®Œå…¨æ²¡æœ‰ä»»ä½•é¡ºåºå…³ç³»çš„ï¼Œæ‰€ä»¥ï¼Œå¯¹äºåŒºé—´æŸ¥è¯¢æ˜¯æ— æ³•ç›´æ¥é€šè¿‡ç´¢å¼•æŸ¥è¯¢çš„ï¼Œå°±éœ€è¦å…¨è¡¨æ‰«æã€‚æ‰€ä»¥ï¼Œå“ˆå¸Œç´¢å¼•åªé€‚ç”¨äºç­‰å€¼æŸ¥è¯¢çš„åœºæ™¯ã€‚è€ŒB+ Treeæ˜¯ä¸€ç§å¤šè·¯å¹³è¡¡æŸ¥è¯¢æ ‘ï¼Œæ‰€ä»¥ä»–çš„èŠ‚ç‚¹æ˜¯å¤©ç„¶æœ‰åºçš„ï¼ˆå·¦å­èŠ‚ç‚¹å°äºçˆ¶èŠ‚ç‚¹ã€çˆ¶èŠ‚ç‚¹å°äºå³å­èŠ‚ç‚¹ï¼‰ï¼Œæ‰€ä»¥å¯¹äºèŒƒå›´æŸ¥è¯¢çš„æ—¶å€™ä¸éœ€è¦åšå…¨è¡¨æ‰«æã€‚\nå“ˆå¸Œç´¢å¼•ä¸æ”¯æŒå¤šåˆ—è”åˆç´¢å¼•çš„æœ€å·¦åŒ¹é…è§„åˆ™ï¼Œå¦‚æœæœ‰å¤§é‡é‡å¤é”®å€¼å¾—æƒ…å†µä¸‹ï¼Œå“ˆå¸Œç´¢å¼•çš„æ•ˆç‡ä¼šå¾ˆä½ï¼Œå› ä¸ºå­˜åœ¨å“ˆå¸Œç¢°æ’é—®é¢˜ã€‚\n ä»€ä¹ˆæ—¶å€™éœ€è¦å»ºç«‹ç´¢å¼•ï¼Œä»€ä¹ˆæ—¶å€™ä¸éœ€è¦å»ºç«‹ç´¢å¼•  åˆ›å»ºç´¢å¼•\n ä¸»é”®è‡ªåŠ¨å»ºç«‹å”¯ä¸€ç´¢å¼• é¢‘ç¹ä½œä¸ºæŸ¥è¯¢æ¡ä»¶çš„å­—æ®µ æŸ¥è¯¢ä¸­ä¸å…¶ä»–è¡¨å…³è”çš„å­—æ®µï¼Œå¤–é”®å…³ç³»å»ºç«‹ç´¢å¼• å•é”®/ç»„åˆç´¢å¼•çš„é€‰æ‹©é—®é¢˜ï¼Œé«˜å¹¶å‘ä¸‹å€¾å‘åˆ›å»ºç»„åˆç´¢å¼• æŸ¥è¯¢ä¸­æ’åºçš„å­—æ®µï¼Œæ’åºå­—æ®µé€šè¿‡ç´¢å¼•è®¿é—®å¤§å¹…æé«˜æ’åºé€Ÿåº¦ æŸ¥è¯¢ä¸­ç»Ÿè®¡æˆ–åˆ†ç»„å­—æ®µ  ä¸å»ºç«‹ç´¢å¼•\n è¡¨è®°å½•å¤ªå°‘ ç»å¸¸å¢åˆ æ”¹çš„è¡¨ æ•°æ®é‡å¤ä¸”åˆ†å¸ƒå‡åŒ€çš„è¡¨å­—æ®µï¼Œåªåº”è¯¥ä¸ºæœ€ç»å¸¸æŸ¥è¯¢å’Œæœ€ç»å¸¸æ’åºçš„æ•°æ®åˆ—å»ºç«‹ç´¢å¼•ï¼ˆå¦‚æœæŸä¸ªæ•°æ®ç±»åŒ…å«å¤ªå¤šçš„é‡å¤æ•°æ®ï¼Œå»ºç«‹ç´¢å¼•æ²¡æœ‰å¤ªå¤§æ„ä¹‰ï¼‰ é¢‘ç¹æ›´æ–°çš„å­—æ®µä¸é€‚åˆåˆ›å»ºç´¢å¼•ï¼ˆä¼šåŠ é‡IOè´Ÿæ‹…ï¼‰ whereæ¡ä»¶é‡Œç”¨ä¸åˆ°çš„å­—æ®µä¸åˆ›å»ºç´¢å¼•   æ•°æ®åº“å»ºç«‹ç´¢å¼•å¸¸ç”¨çš„è§„åˆ™å¦‚ä¸‹ï¼š  è¡¨çš„ä¸»é”®ã€å¤–é”®å¿…é¡»æœ‰ç´¢å¼•ï¼› æ•°æ®é‡è¶…è¿‡300çš„è¡¨åº”è¯¥æœ‰ç´¢å¼•ï¼› ç»å¸¸ä¸å…¶ä»–è¡¨è¿›è¡Œè¿æ¥çš„è¡¨ï¼Œåœ¨è¿æ¥å­—æ®µä¸Šåº”è¯¥å»ºç«‹ç´¢å¼•ï¼› ç»å¸¸å‡ºç°åœ¨Whereå­å¥ä¸­çš„å­—æ®µï¼Œç‰¹åˆ«æ˜¯å¤§è¡¨çš„å­—æ®µï¼Œåº”è¯¥å»ºç«‹ç´¢å¼•ï¼› ç´¢å¼•åº”è¯¥å»ºåœ¨é€‰æ‹©æ€§é«˜çš„å­—æ®µä¸Šï¼› ç´¢å¼•åº”è¯¥å»ºåœ¨å°å­—æ®µä¸Šï¼Œå¯¹äºå¤§çš„æ–‡æœ¬å­—æ®µç”šè‡³è¶…é•¿å­—æ®µï¼Œä¸è¦å»ºç´¢å¼•ï¼› å¤åˆç´¢å¼•çš„å»ºç«‹éœ€è¦è¿›è¡Œä»”ç»†åˆ†æï¼›å°½é‡è€ƒè™‘ç”¨å•å­—æ®µç´¢å¼•ä»£æ›¿ï¼š    æ­£ç¡®é€‰æ‹©å¤åˆç´¢å¼•ä¸­çš„ä¸»åˆ—å­—æ®µï¼Œä¸€èˆ¬æ˜¯é€‰æ‹©æ€§è¾ƒå¥½çš„å­—æ®µï¼› å¤åˆç´¢å¼•çš„å‡ ä¸ªå­—æ®µæ˜¯å¦ç»å¸¸åŒæ—¶ä»¥ANDæ–¹å¼å‡ºç°åœ¨Whereå­å¥ä¸­ï¼Ÿå•å­—æ®µæŸ¥è¯¢æ˜¯å¦æå°‘ç”šè‡³æ²¡æœ‰ï¼Ÿå¦‚æœæ˜¯ï¼Œåˆ™å¯ä»¥å»ºç«‹å¤åˆç´¢å¼•ï¼›å¦åˆ™è€ƒè™‘å•å­—æ®µç´¢å¼•ï¼› å¦‚æœå¤åˆç´¢å¼•ä¸­åŒ…å«çš„å­—æ®µç»å¸¸å•ç‹¬å‡ºç°åœ¨Whereå­å¥ä¸­ï¼Œåˆ™åˆ†è§£ä¸ºå¤šä¸ªå•å­—æ®µç´¢å¼•ï¼› å¦‚æœæ—¢æœ‰å•å­—æ®µç´¢å¼•ï¼Œåˆæœ‰è¿™å‡ ä¸ªå­—æ®µä¸Šçš„å¤åˆç´¢å¼•ï¼Œä¸€èˆ¬å¯ä»¥åˆ é™¤å¤åˆç´¢å¼•ï¼›    é¢‘ç¹è¿›è¡Œæ•°æ®æ“ä½œçš„è¡¨ï¼Œä¸è¦å»ºç«‹å¤ªå¤šçš„ç´¢å¼•ï¼› åˆ é™¤æ— ç”¨çš„ç´¢å¼•ï¼Œé¿å…å¯¹æ‰§è¡Œè®¡åˆ’é€ æˆè´Ÿé¢å½±å“ï¼›  ä»¥ä¸Šæ˜¯ä¸€äº›æ™®éçš„å»ºç«‹ç´¢å¼•æ—¶çš„åˆ¤æ–­ä¾æ®ã€‚ ç´¢å¼•çš„å»ºç«‹å¿…é¡»æ…é‡ï¼Œå¯¹æ¯ä¸ªç´¢å¼•çš„å¿…è¦æ€§éƒ½åº”è¯¥ç»è¿‡ä»”ç»†åˆ†æï¼Œè¦æœ‰å»ºç«‹çš„ä¾æ®ã€‚ å› ä¸ºå¤ªå¤šçš„ç´¢å¼•ä¸ä¸å……åˆ†ã€ä¸æ­£ç¡®çš„ç´¢å¼•å¯¹æ€§èƒ½éƒ½æ¯«æ— ç›Šå¤„ï¼šåœ¨è¡¨ä¸Šå»ºç«‹çš„æ¯ä¸ªç´¢å¼•éƒ½ä¼šå¢åŠ å­˜å‚¨å¼€é”€ï¼Œç´¢å¼•å¯¹äºæ’å…¥ã€åˆ é™¤ã€æ›´æ–°æ“ä½œä¹Ÿä¼šå¢åŠ å¤„ç†ä¸Šçš„å¼€é”€ã€‚ å¦å¤–ï¼Œè¿‡å¤šçš„å¤åˆç´¢å¼•ï¼Œåœ¨æœ‰å•å­—æ®µç´¢å¼•çš„æƒ…å†µä¸‹ï¼Œä¸€èˆ¬éƒ½æ˜¯æ²¡æœ‰å­˜åœ¨ä»·å€¼çš„ï¼›ç›¸åï¼Œè¿˜ä¼šé™ä½æ•°æ®å¢åŠ åˆ é™¤æ—¶çš„æ€§èƒ½ï¼Œç‰¹åˆ«æ˜¯å¯¹é¢‘ç¹æ›´æ–°çš„è¡¨æ¥è¯´ï¼Œè´Ÿé¢å½±å“æ›´å¤§ã€‚ æ€»çš„æ¥è¯´ï¼Œå°å‹è¡¨è‚¯å®šä¸å»ºç´¢å¼•ï¼Œ æˆ–è€…æ•°æ®åº“è®°å½•åœ¨äº¿æ¡æ•°æ®çº§ä»¥ä¸Šï¼Œè¿˜æ˜¯å»ºè®®ä½¿ç”¨éå…³ç³»å‹æ•°æ®åº“ã€‚ è¿˜æœ‰äº›ç‰¹æ®Šå­—æ®µçš„æ•°æ®åº“ï¼Œæ¯”å¦‚BLOBï¼ŒCLOBå­—æ®µè‚¯å®šä¹Ÿä¸é€‚åˆå»ºç´¢å¼•ã€‚ å…¶å®è¿™ä¸ªé—®é¢˜æ›´æ„Ÿè§‰åå‘äºåšè½¯ä»¶é¡¹ç›®çš„ä¸€ç§ç»éªŒã€‚\ncount(1)ï¼Œcount(*)ï¼Œcount(åˆ—å)  count(*)åŒ…æ‹¬äº†æ‰€æœ‰çš„åˆ—ï¼Œç›¸å½“äºè¡Œæ•°ï¼Œåœ¨ç»Ÿè®¡ç»“æœçš„æ—¶å€™ï¼Œä¸ä¼šå¿½ç•¥åˆ—å€¼ä¸ºNULL count(1)åŒ…æ‹¬äº†æ‰€æœ‰åˆ—ï¼Œç”¨1ä»£è¡¨ä»£ç è¡Œï¼Œåœ¨ç»Ÿè®¡ç»“æœçš„æ—¶å€™ï¼Œä¸ä¼šå¿½ç•¥åˆ—å€¼ä¸ºNULL count(åˆ—å)åªåŒ…æ‹¬åˆ—åé‚£ä¸€åˆ—ï¼Œåœ¨ç»Ÿè®¡ç»“æœçš„æ—¶å€™ï¼Œä¼šå¿½ç•¥åˆ—å€¼ä¸ºç©ºï¼ˆè¿™é‡Œçš„ç©ºä¸æ˜¯åªç©ºå­—ç¬¦ä¸²æˆ–è€…0ï¼Œè€Œæ˜¯è¡¨ç¤ºnullï¼‰çš„è®¡æ•°ï¼Œå³æŸä¸ªå­—æ®µå€¼ä¸ºNULLæ—¶ï¼Œä¸ç»Ÿè®¡ã€‚ æ‰§è¡Œæ•ˆç‡ä¸Šï¼š  åˆ—åä¸ºä¸»é”®ï¼Œcount(åˆ—å)ä¼šæ¯”count(1)å¿« åˆ—åä¸ä¸ºä¸»é”®ï¼Œcount(1)ä¼šæ¯”count(åˆ—å)å¿« å¦‚æœè¡¨å¤šä¸ªåˆ—å¹¶ä¸”æ²¡æœ‰ä¸»é”®ï¼Œåˆ™ count(1) çš„æ‰§è¡Œæ•ˆç‡ä¼˜äº count(*) å¦‚æœæœ‰ä¸»é”®ï¼Œåˆ™ select countï¼ˆä¸»é”®ï¼‰çš„æ‰§è¡Œæ•ˆç‡æ˜¯æœ€ä¼˜çš„ å¦‚æœè¡¨åªæœ‰ä¸€ä¸ªå­—æ®µï¼Œåˆ™ select count(*) æœ€ä¼˜ã€‚    mysqlå•è¡¨ä¸€åƒä¸‡æ•°æ®ï¼Œæ€ä¹ˆæŸ¥æœ€å¿«   limitï¼Œoffset\nåœ¨limitçš„åç§»é‡è¶Šæ¥è¶Šå¤§çš„æ—¶å€™ï¼Œæ•°æ®åˆ™ä¼šè¶Šæ¥è¶Šæ…¢ï¼ŒèŠ±è´¹çš„æ—¶é—´ä¹Ÿä¼šè¶Šæ¥è¶Šé•¿ï¼Œä½¿ç”¨å­æŸ¥è¯¢\n  Mybatis è®²ä¸€è®²mybatis çš„å·¥ä½œåŸç† Spring Springçš„Beanæ³¨å…¥è¿‡ç¨‹è®²ä¸€ä¸‹ Springä¸­å¸¸è§çš„è®¾è®¡æ¨¡å¼è¯´ä¸€è¯´ Springæ˜¯æ€ä¹ˆè§£å†³Beanä¹‹é—´çš„å¾ªç¯ä¾èµ–é—®é¢˜ springé’ˆå¯¹å¦‚æœæ˜¯éå•ä¾‹çš„beanç›´æ¥ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚\nå•ä¾‹çš„beanæ˜¯\nSpringMvcçš„æµç¨‹ SpringBootçš„å¯åŠ¨åŸç† SpringCloudäº†è§£å¤šå°‘ AOPæ€ä¹ˆå®ç°çš„ @Configureableçš„ä½œç”¨ åˆ†å¸ƒå¼ æ€ä¹ˆä¿è¯å¹‚ç­‰  å”¯ä¸€ç´¢å¼• æ‚²è§‚é”ï¼ŒåŠ é”  CAP C (ä¸€è‡´æ€§):å¯¹æŸä¸ªæŒ‡å®šçš„å®¢æˆ·ç«¯æ¥è¯´ï¼Œè¯»æ“ä½œèƒ½è¿”å›æœ€æ–°çš„å†™æ“ä½œã€‚å¯¹äºæ•°æ®åˆ†å¸ƒåœ¨ä¸åŒèŠ‚ç‚¹ä¸Šçš„æ•°æ®ä¸Šæ¥è¯´ï¼Œå¦‚æœåœ¨æŸä¸ªèŠ‚ç‚¹æ›´æ–°äº†æ•°æ®ï¼Œé‚£ä¹ˆåœ¨å…¶ä»–èŠ‚ç‚¹å¦‚æœéƒ½èƒ½è¯»å–åˆ°è¿™ä¸ªæœ€æ–°çš„æ•°æ®ï¼Œé‚£ä¹ˆå°±ç§°ä¸ºå¼ºä¸€è‡´ï¼Œå¦‚æœæœ‰æŸä¸ªèŠ‚ç‚¹æ²¡æœ‰è¯»å–åˆ°ï¼Œé‚£å°±æ˜¯åˆ†å¸ƒå¼ä¸ä¸€è‡´ã€‚\nA (å¯ç”¨æ€§)ï¼šéæ•…éšœçš„èŠ‚ç‚¹åœ¨åˆç†çš„æ—¶é—´å†…è¿”å›åˆç†çš„å“åº”(ä¸æ˜¯é”™è¯¯å’Œè¶…æ—¶çš„å“åº”)ã€‚å¯ç”¨æ€§çš„ä¸¤ä¸ªå…³é”®ä¸€ä¸ªæ˜¯åˆç†çš„æ—¶é—´ï¼Œä¸€ä¸ªæ˜¯åˆç†çš„å“åº”ã€‚åˆç†çš„æ—¶é—´æŒ‡çš„æ˜¯è¯·æ±‚ä¸èƒ½æ— é™è¢«é˜»å¡ï¼Œåº”è¯¥åœ¨åˆç†çš„æ—¶é—´ç»™å‡ºè¿”å›ã€‚åˆç†çš„å“åº”æŒ‡çš„æ˜¯ç³»ç»Ÿåº”è¯¥æ˜ç¡®è¿”å›ç»“æœå¹¶ä¸”ç»“æœæ˜¯æ­£ç¡®çš„ï¼Œè¿™é‡Œçš„æ­£ç¡®æŒ‡çš„æ˜¯æ¯”å¦‚åº”è¯¥è¿”å›50ï¼Œè€Œä¸æ˜¯è¿”å›40ã€‚\nP (åˆ†åŒºå®¹é”™æ€§):å½“å‡ºç°ç½‘ç»œåˆ†åŒºåï¼Œç³»ç»Ÿèƒ½å¤Ÿç»§ç»­å·¥ä½œã€‚æ‰“ä¸ªæ¯”æ–¹ï¼Œè¿™é‡Œä¸ªé›†ç¾¤æœ‰å¤šå°æœºå™¨ï¼Œæœ‰å°æœºå™¨ç½‘ç»œå‡ºç°äº†é—®é¢˜ï¼Œä½†æ˜¯è¿™ä¸ªé›†ç¾¤ä»ç„¶å¯ä»¥æ­£å¸¸å·¥ä½œã€‚\nNacosæ€ä¹ˆå®ç°çš„APå’ŒCP åœ¨nacosä¸­ï¼ŒCPä¸APåˆ‡æ¢çš„æ¡ä»¶æ˜¯æ³¨å†Œçš„æœåŠ¡å®ä¾‹æ˜¯å¦æ˜¯ä¸´æ—¶å®ä¾‹\nä¸ºä»€ä¹ˆè¦ç”¨dubboï¼Œå’ŒSpringCloudçš„åŒºåˆ«æ˜¯ä»€ä¹ˆ Dubboç”±äºæ˜¯äºŒè¿›åˆ¶çš„ä¼ è¾“ï¼Œå ç”¨å¸¦å®½ä¼šæ›´å°‘ã€‚Spring Cloud æ˜¯ HTTP åè®®ä¼ è¾“ï¼Œå¸¦å®½å ç”¨ä¼šæ¯”è¾ƒå¤šï¼ŒåŒæ—¶ä½¿ç”¨ HTTP åè®®ä¸€èˆ¬ä¼šä½¿ç”¨ JSON æŠ¥æ–‡ï¼Œæ¶ˆè€—ä¼šæ›´å¤§ã€‚\nDubbo çš„å¼€å‘éš¾åº¦è¾ƒå¤§ï¼ŒåŸå› æ˜¯ Dubbo çš„ jar åŒ…ä¾èµ–é—®é¢˜å¾ˆå¤šå¤§å‹å·¥ç¨‹æ— æ³•è§£å†³ï¼›Spring Cloud çš„æ¥å£åè®®çº¦å®šæ¯”è¾ƒè‡ªç”±ä¸”æ¾æ•£ï¼Œéœ€è¦æœ‰å¼ºæœ‰åŠ›çš„è¡Œæ”¿æªæ–½æ¥é™åˆ¶æ¥å£æ— åºå‡çº§ã€‚\nDubbo çš„æ³¨å†Œä¸­å¿ƒå¯ä»¥é€‰æ‹© Zookeeperã€Redis ç­‰å¤šç§ï¼›Spring Cloud çš„æ³¨å†Œä¸­å¿ƒåªèƒ½ç”¨ Eureka æˆ–è€…è‡ªç ”\nåˆ†å¸ƒå¼äº‹åŠ¡ã€åˆ†å¸ƒå¼é”ã€åˆ†å¸ƒå¼é“¾è·¯è¿½è¸ªè§£å†³æ–¹æ¡ˆ   åˆ†å¸ƒå¼é”  åŸºäº MySQL ä¸­çš„é”ï¼šMySQL æœ¬èº«æœ‰è‡ªå¸¦çš„æ‚²è§‚é” for update å…³é”®å­—ï¼Œä¹Ÿå¯ä»¥è‡ªå·±å®ç°æ‚²è§‚/ä¹è§‚é”æ¥è¾¾åˆ°ç›®çš„ï¼›\n  åŸºäº Zookeeper æœ‰åºèŠ‚ç‚¹ï¼šZookeeper å…è®¸ä¸´æ—¶åˆ›å»ºæœ‰åºçš„å­èŠ‚ç‚¹ï¼Œè¿™æ ·å®¢æˆ·ç«¯è·å–èŠ‚ç‚¹åˆ—è¡¨æ—¶ï¼Œå°±èƒ½å¤Ÿå½“å‰å­èŠ‚ç‚¹åˆ—è¡¨ä¸­çš„åºå·åˆ¤æ–­æ˜¯å¦èƒ½å¤Ÿè·å¾—é”ï¼›\nzooKeeperæ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼çš„ï¼Œå¼€æ”¾æºç çš„åˆ†å¸ƒå¼åº”ç”¨ç¨‹åºåè°ƒæœåŠ¡ï¼Œå®ƒå¯ä»¥ä¸ºåˆ†å¸ƒå¼åº”ç”¨æä¾›ä¸€è‡´æ€§æœåŠ¡ï¼Œå®ƒæ˜¯Hadoopå’ŒHbaseçš„é‡è¦ç»„ä»¶ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥ä½œä¸ºé…ç½®ä¸­å¿ƒã€æ³¨å†Œä¸­å¿ƒè¿ç”¨åœ¨å¾®æœåŠ¡ä½“ç³»ä¸­ã€‚\n  åŸºäº Redis çš„å•çº¿ç¨‹ï¼šç”±äº Redis æ˜¯å•çº¿ç¨‹ï¼Œæ‰€ä»¥å‘½ä»¤ä¼šä»¥ä¸²è¡Œçš„æ–¹å¼æ‰§è¡Œï¼Œå¹¶ä¸”æœ¬èº«æä¾›äº†åƒ SETNX(set if not exists) è¿™æ ·çš„æŒ‡ä»¤ï¼Œæœ¬èº«å…·æœ‰äº’æ–¥æ€§ï¼›\n  é”è¶…æ—¶ï¼šå¦‚æœæŸæœåŠ¡è·å–åˆ°é”ï¼ŒæŒ‚äº†ï¼Œé‚£ä¹ˆé”å°±æ°¸è¿œå¾—ä¸åˆ°äº†ã€‚å› æ­¤éœ€è¦è®¾ç½®è¶…æ—¶æ—¶é—´\nä½†æ˜¯å¦ä¸€ä¸ªé—®é¢˜éšå³è€Œæ¥ï¼šå¦‚æœåœ¨åŠ é”å’Œé‡Šæ”¾é”ä¹‹é—´çš„é€»è¾‘æ‰§è¡Œå¾—å¤ªé•¿ï¼Œä»¥è‡³äºè¶…å‡ºäº†é”çš„è¶…æ—¶é™åˆ¶ï¼Œä¹Ÿä¼šå‡ºç°é—®é¢˜ã€‚å› ä¸ºè¿™æ—¶å€™ç¬¬ä¸€ä¸ªçº¿ç¨‹æŒæœ‰é”è¿‡æœŸäº†ï¼Œè€Œä¸´ç•ŒåŒºçš„é€»è¾‘è¿˜æ²¡æœ‰æ‰§è¡Œå®Œï¼Œä¸æ­¤åŒæ—¶ç¬¬äºŒä¸ªçº¿ç¨‹å°±æå‰æ‹¥æœ‰äº†è¿™æŠŠé”ï¼Œå¯¼è‡´ä¸´ç•ŒåŒºçš„ä»£ç ä¸èƒ½å¾—åˆ°ä¸¥æ ¼çš„ä¸²è¡Œæ‰§è¡Œã€‚\nä¸ºäº†é¿å…è¿™ä¸ªé—®é¢˜ï¼ŒRedis åˆ†å¸ƒå¼é”ä¸è¦ç”¨äºè¾ƒé•¿æ—¶é—´çš„ä»»åŠ¡ã€‚å¦‚æœçœŸçš„å¶å°”å‡ºç°äº†é—®é¢˜ï¼Œé€ æˆçš„æ•°æ®å°é”™ä¹±å¯èƒ½å°±éœ€è¦äººå·¥çš„å¹²é¢„ã€‚\næœ‰ä¸€ä¸ªç¨å¾®å®‰å…¨ä¸€ç‚¹çš„æ–¹æ¡ˆæ˜¯ å°†é”çš„ value å€¼è®¾ç½®ä¸ºä¸€ä¸ªéšæœºæ•°ï¼Œé‡Šæ”¾é”æ—¶å…ˆåŒ¹é…éšæœºæ•°æ˜¯å¦ä¸€è‡´ï¼Œç„¶åå†åˆ é™¤ keyï¼Œè¿™æ˜¯ä¸ºäº† ç¡®ä¿å½“å‰çº¿ç¨‹å æœ‰çš„é”ä¸ä¼šè¢«å…¶ä»–çº¿ç¨‹é‡Šæ”¾ï¼Œé™¤éè¿™ä¸ªé”æ˜¯å› ä¸ºè¿‡æœŸäº†è€Œè¢«æœåŠ¡å™¨è‡ªåŠ¨é‡Šæ”¾çš„ã€‚\nä½†æ˜¯åŒ¹é… value å’Œåˆ é™¤ key åœ¨ Redis ä¸­å¹¶ä¸æ˜¯ä¸€ä¸ªåŸå­æ€§çš„æ“ä½œï¼Œä¹Ÿæ²¡æœ‰ç±»ä¼¼ä¿è¯åŸå­æ€§çš„æŒ‡ä»¤ï¼Œæ‰€ä»¥å¯èƒ½éœ€è¦ä½¿ç”¨åƒ Lua è¿™æ ·çš„è„šæœ¬æ¥å¤„ç†äº†ï¼Œå› ä¸º Lua è„šæœ¬å¯ä»¥ ä¿è¯å¤šä¸ªæŒ‡ä»¤çš„åŸå­æ€§æ‰§è¡Œã€‚\n  RedLockï¼šè§£å†³å¤šèŠ‚ç‚¹redisæ—¶ï¼Œå‘ç”Ÿè·å–é”åï¼Œä¸»èŠ‚ç‚¹æ‰çº¿ï¼Œå¯¼è‡´å…¶ä»–æœåŠ¡è·å–åˆ°äº†é”\n      åˆ†å¸ƒå¼äº‹åŠ¡\né˜¿é‡Œçš„Seata\n  ES ä¸ºä»€ä¹ˆESèƒ½æŸ¥è¯¢çš„è¿™ä¹ˆå¿« ä½ äº†è§£å¤šå°‘ESï¼Œä¸ºä»€ä¹ˆé€‰æ‹©ç”¨ES Zookeeper Zookeeperæ˜¯å¹²ä»€ä¹ˆçš„ï¼Œä½ ä½¿ç”¨è¿‡å—ï¼Œç”¨å®ƒåšè¿‡ä»€ä¹ˆäº‹æƒ…å— Javaå¹¶å‘ è®²ä¸€ä¸‹ä¼ªå…±äº« åœ¨è®¡ç®—æœºä¸­ï¼ŒçœŸæ­£åšè®¡ç®—çš„åŠ¨ä½œéƒ½æ˜¯cpuæ ¸å¿ƒã€‚è€Œä¸cpuäº¤äº’æœ€å¤šçš„æ˜¯å†…å­˜ã€‚æ¯æ¬¡ä»£ç åœ¨æ‰§è¡Œçš„æ—¶å€™ï¼Œå˜é‡éƒ½æ˜¯å­˜æ”¾åœ¨å†…å­˜ä¸­çš„ã€‚ä½†æ˜¯å†…å­˜çš„é€Ÿåº¦ç›¸å¯¹äºCPUæ¥è¯´æ˜¯ç›¸å½“æ…¢çš„ã€‚å› æ­¤åœ¨CPUå’Œå†…å­˜ä¸­é—´è¿˜æœ‰â€œé«˜é€Ÿç¼“å­˜â€ï¼Œä¸€èˆ¬æœ‰3çº§ï¼ŒL1ï¼ŒL2ï¼ŒL3ä¾æ­¤ç¦»CPUçš„è·ç¦»å˜è¿œã€‚è¶Šè¿‘çš„å®¹é‡è¶Šå°ï¼Œé€ ä»·è¶Šé«˜ã€‚å…¶ä¸­L3æ˜¯å¤šæ ¸å¿ƒå…±äº«çš„ã€‚\nCPUå†è®¡ç®—çš„æ—¶å€™ï¼Œä¼šå…ˆä»L1ä¸­æ‰¾ï¼Œæ‰¾ä¸åˆ°ä»L2ä¸­ï¼Œå†ä»L3ä¸­ï¼Œæœ€åæ‰ä»ä¸»å†…å­˜ä¸­åŠ è½½ã€‚\nè€Œé«˜é€Ÿç¼“å­˜çš„å•ä½é€šå¸¸æ˜¯è¿ç»­çš„64å­—èŠ‚çš„ä¸€ä¸ªâ€œç¼“å­˜è¡Œâ€ã€‚\nåœ¨ç¨‹åºè¿è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œç¼“å­˜æ¯æ¬¡æ›´æ–°éƒ½ä»ä¸»å†…å­˜ä¸­åŠ è½½è¿ç»­çš„ 64 ä¸ªå­—èŠ‚ã€‚å› æ­¤ï¼Œå¦‚æœè®¿é—®ä¸€ä¸ª long ç±»å‹çš„æ•°ç»„æ—¶ï¼Œå½“æ•°ç»„ä¸­çš„ä¸€ä¸ªå€¼è¢«åŠ è½½åˆ°ç¼“å­˜ä¸­æ—¶ï¼Œå¦å¤– 7 ä¸ªå…ƒç´ ä¹Ÿä¼šè¢«åŠ è½½åˆ°ç¼“å­˜ä¸­ã€‚\nä½†æ˜¯ï¼Œå¦‚æœä½¿ç”¨çš„æ•°æ®ç»“æ„ä¸­çš„é¡¹åœ¨å†…å­˜ä¸­ä¸æ˜¯å½¼æ­¤ç›¸é‚»çš„ï¼Œæ¯”å¦‚é“¾è¡¨ï¼Œé‚£ä¹ˆå°†å¾—ä¸åˆ°å…è´¹ç¼“å­˜åŠ è½½å¸¦æ¥çš„å¥½å¤„ã€‚\nä¸è¿‡ï¼Œè¿™ç§å…è´¹åŠ è½½ä¹Ÿæœ‰ä¸€ä¸ªåå¤„ã€‚è®¾æƒ³å¦‚æœæˆ‘ä»¬æœ‰ä¸ª long ç±»å‹çš„å˜é‡ aï¼Œå®ƒä¸æ˜¯æ•°ç»„çš„ä¸€éƒ¨åˆ†ï¼Œè€Œæ˜¯ä¸€ä¸ªå•ç‹¬çš„å˜é‡ï¼Œå¹¶ä¸”è¿˜æœ‰å¦å¤–ä¸€ä¸ª long ç±»å‹çš„å˜é‡ b ç´§æŒ¨ç€å®ƒï¼Œé‚£ä¹ˆå½“åŠ è½½ a çš„æ—¶å€™å°†å…è´¹åŠ è½½ bã€‚\nçœ‹èµ·æ¥ä¼¼ä¹æ²¡æœ‰ä»€ä¹ˆæ¯›ç—…ï¼Œä½†æ˜¯å¦‚æœä¸€ä¸ª CPU æ ¸å¿ƒçš„çº¿ç¨‹åœ¨å¯¹ a è¿›è¡Œä¿®æ”¹ï¼Œå¦ä¸€ä¸ª CPU æ ¸å¿ƒçš„çº¿ç¨‹å´åœ¨å¯¹ b è¿›è¡Œè¯»å–ã€‚\nå½“å‰è€…ä¿®æ”¹ a æ—¶ï¼Œä¼šæŠŠ a å’Œ b åŒæ—¶åŠ è½½åˆ°å‰è€…æ ¸å¿ƒçš„ç¼“å­˜è¡Œä¸­ï¼Œæ›´æ–°å®Œ a åå…¶å®ƒæ‰€æœ‰åŒ…å« a çš„ç¼“å­˜è¡Œéƒ½å°†å¤±æ•ˆï¼Œå› ä¸ºå…¶å®ƒç¼“å­˜ä¸­çš„ a ä¸æ˜¯æœ€æ–°å€¼äº†ã€‚\nè€Œå½“åè€…è¯»å– b æ—¶ï¼Œå‘ç°è¿™ä¸ªç¼“å­˜è¡Œå·²ç»å¤±æ•ˆäº†ï¼Œéœ€è¦ä»ä¸»å†…å­˜ä¸­é‡æ–°åŠ è½½ã€‚\nè¯·è®°ä½ï¼Œæˆ‘ä»¬çš„ç¼“å­˜éƒ½æ˜¯ä»¥ç¼“å­˜è¡Œä½œä¸ºä¸€ä¸ªå•ä½æ¥å¤„ç†çš„ï¼Œæ‰€ä»¥å¤±æ•ˆ a çš„ç¼“å­˜çš„åŒæ—¶ï¼Œä¹Ÿä¼šæŠŠ b å¤±æ•ˆï¼Œåä¹‹äº¦ç„¶ã€‚\nè¿™æ ·å°±å‡ºç°äº†ä¸€ä¸ªé—®é¢˜ï¼Œb å’Œ a å®Œå…¨ä¸ç›¸å¹²ï¼Œæ¯æ¬¡å´è¦å› ä¸º a çš„æ›´æ–°éœ€è¦ä»ä¸»å†…å­˜é‡æ–°è¯»å–ï¼Œå®ƒè¢«ç¼“å­˜æœªå‘½ä¸­ç»™æ‹–æ…¢äº†ã€‚\nè¿™å°±æ˜¯ä¼ è¯´ä¸­çš„ä¼ªå…±äº«ã€‚\nä½ çŸ¥é“UnSafeç±»å—ï¼Œä¸ºä»€ä¹ˆä»–æ˜¯â€œUnSafeâ€çš„ï¼Œå®ƒèƒ½åšä»€ä¹ˆ   UnSafeçš„è·å–æ–¹å¼\nField f = Unsafe.class.getDeclaredField(\u0026#34;theUnsafe\u0026#34;); f.setAccessible(true); Unsafe unsafe = (Unsafe) f.get(null);   å¯ä»¥åšä»€ä¹ˆ\n  å®ä¾‹åŒ–ä¸€ä¸ªç±»\nUnsafe.allocateInstance()åªä¼šç»™å¯¹è±¡åˆ†é…å†…å­˜ï¼Œå¹¶ä¸ä¼šè°ƒç”¨æ„é€ æ–¹æ³•\n  ä½¿ç”¨Unsafeçš„putXXX()æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥ä¿®æ”¹ä»»æ„ç§æœ‰å­—æ®µçš„å€¼ã€‚\n    æŠ›å‡ºcheckå¼‚å¸¸\næˆ‘ä»¬çŸ¥é“å¦‚æœä»£ç æŠ›å‡ºäº†checkedå¼‚å¸¸ï¼Œè¦ä¸å°±ä½¿ç”¨try\u0026hellip;catchæ•è·å®ƒï¼Œè¦ä¸å°±åœ¨æ–¹æ³•ç­¾åä¸Šå®šä¹‰è¿™ä¸ªå¼‚å¸¸ï¼Œä½†æ˜¯ï¼Œé€šè¿‡Unsafeæˆ‘ä»¬å¯ä»¥æŠ›å‡ºä¸€ä¸ªcheckedå¼‚å¸¸ï¼ŒåŒæ—¶å´ä¸ç”¨æ•è·æˆ–åœ¨æ–¹æ³•ç­¾åä¸Šå®šä¹‰å®ƒã€‚\n// ä½¿ç”¨æ­£å¸¸æ–¹å¼æŠ›å‡ºIOExceptionéœ€è¦å®šä¹‰åœ¨æ–¹æ³•ç­¾åä¸Šå¾€å¤–æŠ› public static void readFile() throws IOException { throw new IOException(); } // ä½¿ç”¨UnsafeæŠ›å‡ºå¼‚å¸¸ä¸éœ€è¦å®šä¹‰åœ¨æ–¹æ³•ç­¾åä¸Šå¾€å¤–æŠ› public static void readFileUnsafe() { unsafe.throwException(new IOException()); }   ä½¿ç”¨å †å¤–å†…å­˜\nå¦‚æœè¿›ç¨‹åœ¨è¿è¡Œè¿‡ç¨‹ä¸­JVMä¸Šçš„å†…å­˜ä¸è¶³äº†ï¼Œä¼šå¯¼è‡´é¢‘ç¹çš„è¿›è¡ŒGCã€‚ç†æƒ³æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥è€ƒè™‘ä½¿ç”¨å †å¤–å†…å­˜ï¼Œè¿™æ˜¯ä¸€å—ä¸å—JVMç®¡ç†çš„å†…å­˜ã€‚\nä½¿ç”¨Unsafeçš„allocateMemory()æˆ‘ä»¬å¯ä»¥ç›´æ¥åœ¨å †å¤–åˆ†é…å†…å­˜ï¼Œè¿™å¯èƒ½éå¸¸æœ‰ç”¨ï¼Œä½†æˆ‘ä»¬è¦è®°ä½ï¼Œè¿™ä¸ªå†…å­˜ä¸å—JVMç®¡ç†ï¼Œå› æ­¤æˆ‘ä»¬è¦è°ƒç”¨freeMemory()æ–¹æ³•æ‰‹åŠ¨é‡Šæ”¾å®ƒã€‚\n  CompareAndSwapæ“ä½œ\nJUCä¸‹é¢å¤§é‡ä½¿ç”¨äº†CASæ“ä½œï¼Œå®ƒä»¬çš„åº•å±‚æ˜¯è°ƒç”¨çš„Unsafeçš„CompareAndSwapXXX()æ–¹æ³•ã€‚è¿™ç§æ–¹å¼å¹¿æ³›è¿ç”¨äºæ— é”ç®—æ³•ï¼Œä¸javaä¸­æ ‡å‡†çš„æ‚²è§‚é”æœºåˆ¶ç›¸æ¯”ï¼Œå®ƒå¯ä»¥åˆ©ç”¨CASå¤„ç†å™¨æŒ‡ä»¤æä¾›æå¤§çš„åŠ é€Ÿã€‚\n  park/unpark\nJVMåœ¨ä¸Šä¸‹æ–‡åˆ‡æ¢çš„æ—¶å€™ä½¿ç”¨äº†Unsafeä¸­çš„ä¸¤ä¸ªéå¸¸ç‰›é€¼çš„æ–¹æ³•park()å’Œunpark()ã€‚\nå½“ä¸€ä¸ªçº¿ç¨‹æ­£åœ¨ç­‰å¾…æŸä¸ªæ“ä½œæ—¶ï¼ŒJVMè°ƒç”¨Unsafeçš„park()æ–¹æ³•æ¥é˜»å¡æ­¤çº¿ç¨‹ã€‚\nå½“é˜»å¡ä¸­çš„çº¿ç¨‹éœ€è¦å†æ¬¡è¿è¡Œæ—¶ï¼ŒJVMè°ƒç”¨Unsafeçš„unpark()æ–¹æ³•æ¥å”¤é†’æ­¤çº¿ç¨‹ã€‚\næˆ‘ä»¬ä¹‹å‰åœ¨åˆ†æjavaä¸­çš„é›†åˆæ—¶çœ‹åˆ°äº†å¤§é‡çš„LockSupport.park()/unpark()ï¼Œå®ƒä»¬åº•å±‚éƒ½æ˜¯è°ƒç”¨çš„Unsafeçš„è¿™ä¸¤ä¸ªæ–¹æ³•ã€‚\n  å¼‚æ­¥ã€åŒæ­¥ï¼›é˜»å¡ã€éé˜»å¡ï¼›çº¿ç¨‹ã€è¿›ç¨‹ä»–ä»¬çš„å…³ç³»   å¼‚æ­¥å’ŒåŒæ­¥\nåŒæ­¥ä¸å¼‚æ­¥æœ€å¤§çš„åŒºåˆ«å°±æ˜¯è¢«è°ƒç”¨æ–¹çš„æ‰§è¡Œæ–¹å¼å’Œè¿”å›æ—¶æœºï¼ŒåŒæ­¥æŒ‡çš„æ˜¯è¢«è°ƒç”¨æ–¹åšå®Œäº‹æƒ…ä¹‹åå†è¿”å›ï¼Œå¼‚æ­¥æŒ‡çš„æ˜¯è¢«è°ƒç”¨æ–¹å…ˆè¿”å›ï¼Œç„¶åå†åšäº‹æƒ…ï¼Œåšå®Œä¹‹åå†æƒ³åŠæ³•é€šçŸ¥è°ƒç”¨æ–¹\n  é˜»å¡å’Œéé˜»å¡\né˜»å¡å°±æ˜¯å‘èµ·ä¸€ä¸ªè¯·æ±‚ï¼Œè°ƒç”¨è€…ä¸€ç›´ç­‰å¾…è¯·æ±‚ç»“æœè¿”å›ï¼Œä¹Ÿå°±æ˜¯å½“å‰çº¿ç¨‹ä¼šè¢«æŒ‚èµ·ï¼Œæ— æ³•ä»äº‹å…¶ä»–ä»»åŠ¡ï¼Œåªæœ‰å½“æ¡ä»¶å°±ç»ªæ‰èƒ½ç»§ç»­ã€‚\néé˜»å¡å°±æ˜¯å‘èµ·ä¸€ä¸ªè¯·æ±‚ï¼Œè°ƒç”¨è€…ä¸ç”¨ä¸€ç›´ç­‰ç€ç»“æœè¿”å›ï¼Œå¯ä»¥å…ˆå»å¹²å…¶ä»–äº‹æƒ…ã€‚\n   é˜»å¡å’ŒåŒæ­¥ä¸æ˜¯ä¸€å›äº‹ï¼ŒåŒæ­¥ï¼Œå¼‚æ­¥ä¸é˜»å¡ï¼Œéé˜»å¡é’ˆå¯¹çš„å¯¹è±¡æ˜¯ä¸ä¸€æ ·çš„ï¼Œé˜»å¡,éé˜»å¡æ˜¯è¯´çš„è°ƒç”¨è€…ï¼ŒåŒæ­¥ï¼Œå¼‚æ­¥è¯´çš„æ˜¯è¢«è°ƒç”¨è€…\n ä½ çŸ¥é“å“ªå‡ ç§é”   å…¬å¹³é”/éå…¬å¹³é”\nå…¬å¹³é”ï¼šæŒ‰ç…§çº¿ç¨‹çš„ç”³è¯·é¡ºåºè·å–é”\néå…¬å¹³é”ï¼šä¸æ˜¯æŒ‰ç…§ç”³è¯·çš„é¡ºåºï¼Œå¯èƒ½åç”³è¯·çš„çº¿ç¨‹åè€Œå…ˆè·å–åˆ°é”\nReentrantLockä¸­å¯ä»¥é€šè¿‡æ„é€ æ–¹æ³•æŒ‡å®šæ˜¯å¦ä¸ºå…¬å¹³é”ï¼Œé»˜è®¤ä¸ºéå…¬å¹³é”ï¼Œéå…¬å¹³é”çš„ä¼˜ç‚¹åœ¨äºååé‡å¤§ã€‚\nsynchronizedæ— æ³•æŒ‡å®šä¸ºå…¬å¹³é”ï¼Œä¸€ç›´éƒ½æ˜¯éå…¬å¹³é”ã€‚\n  å¯é‡å…¥é”\nå¯é‡å…¥é”ï¼Œæ˜¯æŒ‡ä¸€ä¸ªçº¿ç¨‹è·å–é”ä¹‹åå†å°è¯•è·å–é”æ—¶ä¼šè‡ªåŠ¨è·å–é”ï¼Œå¯é‡å…¥é”çš„ä¼˜ç‚¹æ˜¯é¿å…æ­»é”ã€‚\nå…·ä½“ä¸€ç‚¹ï¼Œå°±æ˜¯ä¸€ä¸ªçº¿ç¨‹è·å¾—é”ä¹‹åï¼Œå†æ¬¡è·å¾—é”çš„æ—¶å€™ï¼Œä¸éœ€è¦é‡Šæ”¾é”ã€‚\nimport java.util.concurrent.atomic.AtomicReference; public class UnreentrantLock { private AtomicReference\u0026lt;Thread\u0026gt; owner = new AtomicReference\u0026lt;Thread\u0026gt;(); public void lock() { Thread current = Thread.currentThread(); //è¿™å¥æ˜¯å¾ˆç»å…¸çš„â€œè‡ªæ—‹â€è¯­æ³•ï¼ŒAtomicIntegerä¸­ä¹Ÿæœ‰  for (;;) { if (!owner.compareAndSet(null, current)) { return; } } } public void unlock() { Thread current = Thread.currentThread(); owner.compareAndSet(current, null); } } ä»£ç ä¹Ÿæ¯”è¾ƒç®€å•ï¼Œä½¿ç”¨åŸå­å¼•ç”¨æ¥å­˜æ”¾çº¿ç¨‹ï¼ŒåŒä¸€çº¿ç¨‹ä¸¤æ¬¡è°ƒç”¨lock()æ–¹æ³•ï¼Œå¦‚æœä¸æ‰§è¡Œunlock()é‡Šæ”¾é”çš„è¯ï¼Œç¬¬äºŒæ¬¡è°ƒç”¨è‡ªæ—‹çš„æ—¶å€™å°±ä¼šäº§ç”Ÿæ­»é”ï¼Œè¿™ä¸ªé”å°±ä¸æ˜¯å¯é‡å…¥çš„ï¼Œè€Œå®é™…ä¸ŠåŒä¸€ä¸ªçº¿ç¨‹ä¸å¿…æ¯æ¬¡éƒ½å»é‡Šæ”¾é”å†æ¥è·å–é”ï¼Œè¿™æ ·çš„è°ƒåº¦åˆ‡æ¢æ˜¯å¾ˆè€—èµ„æºçš„ã€‚ç¨å¾®æ”¹ä¸€ä¸‹ï¼ŒæŠŠå®ƒå˜æˆä¸€ä¸ªå¯é‡å…¥é”ï¼š\nimport java.util.concurrent.atomic.AtomicReference; public class UnreentrantLock { private AtomicReference\u0026lt;Thread\u0026gt; owner = new AtomicReference\u0026lt;Thread\u0026gt;(); private int state = 0; public void lock() { Thread current = Thread.currentThread(); if (current == owner.get()) { state++; return; } //è¿™å¥æ˜¯å¾ˆç»å…¸çš„â€œè‡ªæ—‹â€å¼è¯­æ³•ï¼ŒAtomicIntegerä¸­ä¹Ÿæœ‰  for (;;) { if (!owner.compareAndSet(null, current)) { return; } } } public void unlock() { Thread current = Thread.currentThread(); if (current == owner.get()) { if (state != 0) { state--; } else { owner.compareAndSet(current, null); } } } } ReentrantLockå’Œsynchronizedéƒ½æ˜¯å¯é‡å…¥é”ã€‚\nsynchronizedæ˜¯åœ¨å¯¹è±¡å¤´ä¸­åšäº†è®¡æ•°å™¨ï¼Œmonitorenterçš„æ—¶å€™ï¼Œè®¡æ•°å™¨+1ï¼Œmonitorexitçš„æ—¶å€™ï¼Œè®¡æ•°å™¨-1ã€‚æ¥è¾¾åˆ°é‡å…¥é”çš„ç›®çš„ã€‚\nReentrantLockåº•å±‚ç”¨çš„AQSï¼ŒAQSä¸­æœ‰ä¸€ä¸ªstateå˜é‡ï¼Œè·å–é”æˆåŠŸåï¼Œä¼š+1ï¼Œç”¨æ¥è§£å†³é‡å…¥é”çš„é—®é¢˜\n  ç‹¬å é”/å…±äº«é”\nç‹¬å é”ï¼šé”ä¸€æ¬¡åªèƒ½è¢«ä¸€ä¸ªçº¿ç¨‹å æœ‰\nå…±äº«é”ï¼šé”å¯ä»¥è¢«å¤šä¸ªçº¿ç¨‹å æœ‰\nReentrantLockå’Œsynchronizedéƒ½æ˜¯ç‹¬äº«é”ï¼ŒReadWriteLockçš„è¯»é”æ˜¯å…±äº«é”ï¼Œå†™é”æ˜¯ç‹¬äº«é”ã€‚\n  äº’æ–¥é”/è¯»å†™é”\nä¸ç‹¬äº«é”/å…±äº«é”çš„æ¦‚å¿µå·®ä¸å¤šï¼Œæ˜¯ç‹¬äº«é”/å…±äº«é”çš„å…·ä½“å®ç°ã€‚\nReentrantLockå’Œsynchronizedéƒ½æ˜¯äº’æ–¥é”\nReadWriteLockæ˜¯è¯»å†™é”\n  ä¹è§‚é”/æ‚²è§‚é”\næ‚²è§‚é”ï¼Œæ˜¯æŒ‡è®¤ä¸ºå¯¹äºåŒä¸€ä¸ªæ•°æ®çš„å¹¶å‘æ“ä½œå¿…ç„¶ä¼šå‘ç”Ÿä¿®æ”¹ï¼Œå³ä½¿ä¸ä¼šå‘ç”Ÿä¿®æ”¹ä¹Ÿè¿™ä¹ˆè®¤ä¸ºï¼Œæ‰€ä»¥ä¸€å®šè¦åŠ é”ã€‚\nä¹è§‚é”ï¼Œæ˜¯æŒ‡è®¤ä¸ºå¯¹äºåŒä¸€ä¸ªæ•°æ®çš„å¹¶å‘æ“ä½œä¸ä¸€å®šä¼šå‘ç”Ÿä¿®æ”¹ï¼Œåœ¨æ›´æ–°æ•°æ®çš„æ—¶å€™ï¼Œå°è¯•å»æ›´æ–°æ•°æ®ï¼Œå¦‚æœå¤±è´¥å°±ä¸æ–­å°è¯•ã€‚\næ‚²è§‚é”é€‚ç”¨äºå†™æ“ä½œå¤šçš„åœºæ™¯ï¼Œä¹è§‚é”é€‚ç”¨äºè¯»æ“ä½œå¤šçš„åœºæ™¯ã€‚\n  åˆ†æ®µé”\nåˆ†æ®µé”ï¼Œæ˜¯ä¸€ç§é”çš„è®¾è®¡æ€è·¯ï¼Œå®ƒç»†åŒ–äº†é”çš„ç²’åº¦ï¼Œä¸»è¦è¿ç”¨åœ¨ConcurrentHashMapä¸­ï¼Œå®ç°é«˜æ•ˆçš„å¹¶å‘æ“ä½œï¼Œå½“æ“ä½œä¸éœ€è¦æ›´æ–°æ•´ä¸ªæ•°ç»„æ—¶ï¼Œå°±åªé”æ•°ç»„ä¸­çš„ä¸€é¡¹å°±å¯ä»¥äº†ã€‚\n  åå‘é”/è½»é‡çº§é”/é‡é‡çº§é”\nè¿™ä¸‰ç§é”ï¼Œéƒ½æ˜¯é’ˆå¯¹äºSynchronizedå…³é”®å­—è¿›è¡Œä¼˜åŒ–çš„ï¼Œä¸»è¦é€šè¿‡å¯¹è±¡ç›‘è§†å™¨åœ¨å¯¹è±¡å¤´ä¸­çš„å­—æ®µæ¥è¡¨æ˜çš„\n  åå‘é”\nå½“åŒä¸€æ®µåŒæ­¥ä»£ç ä¸€ç›´è¢«ä¸€ä¸ªçº¿ç¨‹è®¿é—®ï¼Œé‚£ä¹ˆè¿™ä¸ªçº¿ç¨‹ä¼šè‡ªåŠ¨è·å–é”ï¼Œé™ä½è·å–é”çš„ä»£ä»·\n  è½»é‡çº§é”\nå½“å‰çš„é”å¦‚æœæ˜¯åå‘é”çš„è¯ï¼Œå¦‚æœè¢«å¦ä¸€ä¸ªçº¿ç¨‹è®¿é—®ä¸­ï¼Œå°±æ˜¯æŒæœ‰ä¸­ã€‚åå‘é”ä¼šå‡çº§ä¸ºè½»é‡çº§é”ï¼Œè¿™ä¸ªçº¿ç¨‹ä¼šé€šè¿‡è‡ªæ—‹çš„æ–¹å¼ä¸æ–­çš„å°è¯•è·å–é”\n  é‡é‡çº§é”\nå½“å‰é”æ˜¯è½»é‡çº§é”çš„æƒ…å†µä¸‹ï¼Œå½“è‡ªæ—‹çš„çº¿ç¨‹è‡ªæ—‹äº†ä¸€å®šç¨‹åº¦åï¼Œè¿˜æ²¡æœ‰è·å¾—åˆ°é”çš„è¯ï¼Œå°±ä¼šè¿›å…¥é˜»å¡çŠ¶æ€ï¼Œè¯¥é”ä¼šå‡çº§ä¸ºé‡é‡çº§é”ï¼Œé‡é‡çº§é”ä¼šè®©å…¶ä»–çº¿ç¨‹è¿›å…¥é˜»å¡çŠ¶æ€ï¼Œæ€§èƒ½é™ä½\n    è‡ªæ—‹é”\né€šè¿‡ä¸æ–­å°è¯•è·å–é”ï¼Œé€šè¿‡å‡å°‘ä¸Šä¸‹æ–‡åˆ‡æ¢å¸¦æ¥çš„å¼€é”æ¶ˆè€—ã€‚æé«˜æ€§èƒ½ï¼Œç¼ºç‚¹æ˜¯å¾ªç¯ä¼šæ¶ˆè€—CPU\n  ç›‘è§†å™¨é”\nsynchronizedçš„å®ç°æ–¹å¼ï¼Œä½¿ç”¨monitorenterå’Œmonitorexitæ¥å®ç°\n  mutexé”\näº’æ–¥é”ï¼ŒLockSupport.part()åº•å±‚é€šè¿‡mutexå®ç°çš„\n  è‡ªå·±å®ç°ä¸€ä¸ªé” /** * å®ç°ä¸€ä¸ªé” * * æ€è·¯ï¼šé€šè¿‡å®šä¹‰ä¸€ä¸ªå˜é‡ï¼Œè®©å¤šä¸ªçº¿ç¨‹å»ä¿®æ”¹ä»–ï¼Œé€šè¿‡CASæ“ä½œï¼Œå¦‚æœæ²¡æœ‰æ“ä½œæˆåŠŸçš„ï¼Œåˆ™è¿›å…¥é˜Ÿåˆ— * */ public class MyLock { //å®šä¹‰ä¸€ä¸ªçŠ¶æ€å˜é‡ï¼Œé€šè¿‡volatileå…³é”®å­—ä¿®é¥°,è®©æ¯ä¸ªçº¿ç¨‹éƒ½èƒ½çœ‹åˆ°  private volatile int state; private static long stateOffset; private static long tailOffset; //UnSafeç±»  private static Unsafe unsafe; private static class Node { // å­˜å‚¨çš„å…ƒç´ ä¸ºçº¿ç¨‹  Thread thread; // å‰ä¸€ä¸ªèŠ‚ç‚¹ï¼ˆå¯ä»¥æ²¡æœ‰ï¼Œä½†å®ç°èµ·æ¥å¾ˆå›°éš¾ï¼‰  Node prev; // åä¸€ä¸ªèŠ‚ç‚¹  Node next; public Node() { } public Node(Thread thread, Node prev) { this.thread = thread; this.prev = prev; } } // é“¾è¡¨å¤´  private volatile Node head; // é“¾è¡¨å°¾  private volatile Node tail; static { Field f = null; try { f = Unsafe.class.getDeclaredField(\u0026#34;theUnsafe\u0026#34;); f.setAccessible(true); unsafe = (Unsafe) f.get(null); // è·å–stateçš„åç§»é‡  stateOffset = unsafe.objectFieldOffset(MyLock.class.getDeclaredField(\u0026#34;state\u0026#34;)); // è·å–tailçš„åç§»é‡  tailOffset = unsafe.objectFieldOffset(MyLock.class.getDeclaredField(\u0026#34;tail\u0026#34;)); } catch (NoSuchFieldException | IllegalAccessException e) { e.printStackTrace(); } } // åŸå­æ›´æ–°tailå­—æ®µ  private boolean compareAndSetTail(Node expect, Node update) { return unsafe.compareAndSwapObject(this, tailOffset, expect, update); } /** * casæ›´æ–°state * @param expect * @param update * @return */ private boolean compareAndSetState(int expect, int update) { return unsafe.compareAndSwapInt(this, stateOffset, expect, update); } private Node empty = new Node(); public MyLock() { this.head=this.tail=empty; } public void lock() { // å°è¯•æ›´æ–°stateå­—æ®µï¼Œæ›´æ–°æˆåŠŸè¯´æ˜å æœ‰äº†é”  if (compareAndSetState(0, 1)) { return; } // æœªæ›´æ–°æˆåŠŸåˆ™å…¥é˜Ÿ  Node node = enqueue(); Node prev = node.prev; // å†æ¬¡å°è¯•è·å–é”ï¼Œéœ€è¦æ£€æµ‹ä¸Šä¸€ä¸ªèŠ‚ç‚¹æ˜¯ä¸æ˜¯headï¼Œæ£€æŸ¥æ˜¯ä¸æ˜¯ä¸‹ä¸€ä¸ªåº”è¯¥çš„ï¼ŒæŒ‰å…¥é˜Ÿé¡ºåºåŠ é”  while (node.prev != head || !compareAndSetState(0, 1)) { // æœªè·å–åˆ°é”ï¼Œé˜»å¡  unsafe.park(false, 0L); } // ä¸‹é¢ä¸éœ€è¦åŸå­æ›´æ–°ï¼Œå› ä¸ºåŒæ—¶åªæœ‰ä¸€ä¸ªçº¿ç¨‹è®¿é—®åˆ°è¿™é‡Œ  // è·å–åˆ°é”äº†ä¸”ä¸Šä¸€ä¸ªèŠ‚ç‚¹æ˜¯head  // headåç§»ä¸€ä½  head = node; // æ¸…ç©ºå½“å‰èŠ‚ç‚¹çš„å†…å®¹ï¼ŒååŠ©GC  node.thread = null; // å°†ä¸Šä¸€ä¸ªèŠ‚ç‚¹ä»é“¾è¡¨ä¸­å‰”é™¤ï¼ŒååŠ©GC  node.prev = null; prev.next = null; } // å…¥é˜Ÿ  private Node enqueue() { while (true) { // è·å–å°¾èŠ‚ç‚¹  Node t = tail; // æ„é€ æ–°èŠ‚ç‚¹  Node node = new Node(Thread.currentThread(), t); // ä¸æ–­å°è¯•åŸå­æ›´æ–°å°¾èŠ‚ç‚¹  if (compareAndSetTail(t, node)) { // æ›´æ–°å°¾èŠ‚ç‚¹æˆåŠŸäº†ï¼Œè®©åŸå°¾èŠ‚ç‚¹çš„nextæŒ‡é’ˆæŒ‡å‘å½“å‰èŠ‚ç‚¹  t.next = node; return node; } } } // è§£é”  public void unlock() { // æŠŠstateæ›´æ–°æˆ0ï¼Œè¿™é‡Œä¸éœ€è¦åŸå­æ›´æ–°ï¼Œå› ä¸ºåŒæ—¶åªæœ‰ä¸€ä¸ªçº¿ç¨‹è®¿é—®åˆ°è¿™é‡Œ  state = 0; // ä¸‹ä¸€ä¸ªå¾…å”¤é†’çš„èŠ‚ç‚¹  Node next = head.next; // ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ä¸ä¸ºç©ºï¼Œå°±å”¤é†’å®ƒ  if (next != null) { unsafe.unpark(next.thread); } } public static int count; public static void main(String[] args) throws InterruptedException { MyLock lock = new MyLock(); CountDownLatch countDownLatch = new CountDownLatch(1000); IntStream.range(0, 1000).forEach(i -\u0026gt; new Thread(() -\u0026gt; { lock.lock(); try { IntStream.range(0, 10000).forEach(j -\u0026gt; { count++; }); } finally { lock.unlock(); } // System.out.println(Thread.currentThread().getName());  countDownLatch.countDown(); }, \u0026#34;tt-\u0026#34; + i).start()); countDownLatch.await(); System.out.println(count); } } è®²ä¸€ä¸‹çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸ java.lang.Thread.Stateä¸­å®šä¹‰äº†çº¿ç¨‹çš„çŠ¶æ€\npublic enum State { /** * Thread state for a thread which has not yet started. */ //æ–°å»ºçŠ¶æ€,çº¿ç¨‹è¿˜æœªå¼€å§‹  NEW, /** * Thread state for a runnable thread. A thread in the runnable * state is executing in the Java virtual machine but it may * be waiting for other resources from the operating system * such as processor. */ //å¯ä»¥è¿è¡ŒçŠ¶æ€ï¼Œå·²ç»åœ¨jvmè™šæ‹Ÿæœºä¸­äº†ï¼Œæ­£åœ¨ç­‰å¾…æ“ä½œç³»ç»Ÿåˆ†é…èµ„æº  RUNNABLE, /** * Thread state for a thread blocked waiting for a monitor lock. * A thread in the blocked state is waiting for a monitor lock * to enter a synchronized block/method or * reenter a synchronized block/method after calling * {@link Object#wait() Object.wait}. */ //é˜»å¡çŠ¶æ€ï¼Œæ­£åœ¨ç­‰å¾…ä¸€ä¸ªmonitoré”ï¼Œå°±æ˜¯æˆ‘ä»¬å¹³æ—¶ç”¨çš„synchronizedçš„å…³é”®å­—ã€‚  //æˆ–è€…åœ¨è°ƒç”¨äº†Object.wait()æ–¹æ³•ä¸”è¢«notify()ä¹‹åä¹Ÿä¼šè¿›å…¥BLOCKEDçŠ¶æ€  BLOCKED, /** * Thread state for a waiting thread. * A thread is in the waiting state due to calling one of the * following methods: * \u0026lt;ul\u0026gt; * \u0026lt;li\u0026gt;{@link Object#wait() Object.wait} with no timeout\u0026lt;/li\u0026gt; * \u0026lt;li\u0026gt;{@link #join() Thread.join} with no timeout\u0026lt;/li\u0026gt; * \u0026lt;li\u0026gt;{@link LockSupport#park() LockSupport.park}\u0026lt;/li\u0026gt; * \u0026lt;/ul\u0026gt; * * \u0026lt;p\u0026gt;A thread in the waiting state is waiting for another thread to * perform a particular action. * * For example, a thread that has called {@code Object.wait()} * on an object is waiting for another thread to call * {@code Object.notify()} or {@code Object.notifyAll()} on * that object. A thread that has called {@code Thread.join()} * is waiting for a specified thread to terminate. * ç­‰å¾…çŠ¶æ€ * 1. Object.wait()æ— è¶…æ—¶çš„æ–¹æ³•åä¸”æœªè¢«notify()å‰ï¼Œå¦‚æœè¢«notify()äº†ä¼šè¿›å…¥BLOCKEDçŠ¶æ€ * 2. Thread.join()æ— è¶…æ—¶çš„æ–¹æ³•å * 3. LockSupport.park()æ— è¶…æ—¶çš„æ–¹æ³•å */ WAITING, /** * Thread state for a waiting thread with a specified waiting time. * A thread is in the timed waiting state due to calling one of * the following methods with a specified positive waiting time: * \u0026lt;ul\u0026gt; * \u0026lt;li\u0026gt;{@link #sleep Thread.sleep}\u0026lt;/li\u0026gt; * \u0026lt;li\u0026gt;{@link Object#wait(long) Object.wait} with timeout\u0026lt;/li\u0026gt; * \u0026lt;li\u0026gt;{@link #join(long) Thread.join} with timeout\u0026lt;/li\u0026gt; * \u0026lt;li\u0026gt;{@link LockSupport#parkNanos LockSupport.parkNanos}\u0026lt;/li\u0026gt; * \u0026lt;li\u0026gt;{@link LockSupport#parkUntil LockSupport.parkUntil}\u0026lt;/li\u0026gt; * \u0026lt;/ul\u0026gt; *è¶…å¸‚ç­‰å¾…çŠ¶æ€,è°ƒç”¨äº† * 1. Thread.sleep()æ–¹æ³•å * 2. Object.wait(timeout)æ–¹æ³•åä¸”æœªåˆ°è¶…æ—¶æ—¶é—´å‰ï¼Œå¦‚æœè¾¾åˆ°è¶…æ—¶äº†æˆ–è¢«notify()äº†ä¼šè¿›å…¥BLOCKEDçŠ¶æ€ * 3. Thread.join(timeout)æ–¹æ³•å * 4. LockSupport.parkNanos(nanos)æ–¹æ³•å * 5. LockSupport.parkUntil(deadline)æ–¹æ³•å /* TIMED_WAITING, /** * Thread state for a terminated thread. * The thread has completed execution. */ //ç»ˆæ­¢çŠ¶æ€ï¼Œçº¿ç¨‹æ‰§è¡Œå®Œæ¯•  TERMINATED; } çº¿ç¨‹å¯ä»¥è¢«ç»ˆæ­¢å—ï¼Œæ€ä¹ˆç»ˆæ­¢ å¯ä»¥è¢«ç»ˆæ­¢\n é€šè¿‡è®¾ç½®æ ‡è®°ï¼Œé…åˆå¾ªç¯  â€‹\tçº¿ç¨‹åªæœ‰åœ¨æ‰§è¡Œå®Œä»£ç åæ‰ä¼šç»ˆæ­¢ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥ä½¿ç”¨whileå¾ªç¯ï¼Œé€šè¿‡ä¸€ä¸ªvolatileä¿®é¥°çš„å˜é‡æ§åˆ¶è·³å‡ºå¾ªç¯å³å¯\n  é€šè¿‡interruptæ–¹æ³•\n  ä½†æ˜¯è¿™ç§æ–¹å¼æœ‰é—®é¢˜ï¼Œå®é™…ä¸Šåœ¨æ‰§è¡Œinterruptåï¼Œä¾ç„¶ä¼šç»§ç»­æ‰§è¡Œä¸€ä¼šå„¿ï¼Œå¹¶ä¸èƒ½åšåˆ°ç«‹é©¬åœæ­¢ã€‚\nå¦‚æœæœ‰é˜»å¡çš„åŠ¨ä½œï¼Œä¼šç«‹é©¬æŠ›å‡ºå¼‚å¸¸\n interrupt()æ–¹æ³•ï¼Œæ ‡è®°çº¿ç¨‹ç»“æŸï¼Œåªæ˜¯ç»™ä¸€ä¸ªæ ‡è®°ï¼Œå¹¶ä¸ç»ˆæ­¢ã€‚ interrupted()æ–¹æ³•ï¼Œè¿”å›å½“å‰çº¿ç¨‹æ˜¯å¦æœ‰ç»ˆæ­¢çš„æ ‡è®°ï¼Œå¹¶ä¸”æ¸…é™¤æ ‡è®°ã€‚ä¸‹ä¸€æ¬¡å†è°ƒè¿™ä¸ªæ–¹æ³•ä¼šè¿”å›false isInterrupted()æ–¹æ³•ï¼Œè¿”å›å½“å‰çº¿ç¨‹æ˜¯å¦æœ‰ç»ˆæ­¢çš„æ ‡è®°ï¼Œä½†ä¸æ¸…é™¤æ ‡è®°ã€‚ é€šè¿‡stopæ–¹æ³•ï¼Œstopå°±åƒç›´æ¥æ‹”æ‰æ’å¤´ä¸€æ ·ï¼Œä¼šé€ æˆå¾ˆå¤šé—®é¢˜ï¼Œä¸æ¨èä½¿ç”¨  AQSæ˜¯ä»€ä¹ˆï¼Ÿ AQSå…¨ç§°\nAbstractQueuedSynchronizerï¼ŒæŠ½è±¡çš„é˜Ÿåˆ—åŒæ­¥å™¨\nAQSæ˜¯åŸºäºFIFOçš„é˜Ÿåˆ—å®ç°çš„ï¼Œå¹¶ä¸”å†…éƒ¨ç»´æŠ¤äº†ä¸€ä¸ªçŠ¶æ€å˜é‡stateï¼Œé€šè¿‡åŸå­æ›´æ–°è¿™ä¸ªçŠ¶æ€å˜é‡stateå³å¯ä»¥å®ç°åŠ é”è§£é”æ“ä½œã€‚\nå†…éƒ¨ç»“æ„\n Nodeï¼šå…¸å‹çš„åŒé“¾è¡¨ç»“æ„ï¼ŒèŠ‚ç‚¹ä¸­ä¿å­˜ç€å½“å‰çº¿ç¨‹ã€å‰ä¸€ä¸ªèŠ‚ç‚¹ã€åä¸€ä¸ªèŠ‚ç‚¹ä»¥åŠçº¿ç¨‹çš„çŠ¶æ€ç­‰ä¿¡æ¯ã€‚ Stateï¼šé€šè¿‡è¿™ä¸ªçŠ¶æ€ç”¨æ¥æ§åˆ¶é”  éœ€è¦å­ç±»å®ç°çš„æ–¹æ³•ï¼š\n// äº’æ–¥æ¨¡å¼ä¸‹ä½¿ç”¨ï¼šå°è¯•è·å–é” protected boolean tryAcquire(int arg) { throw new UnsupportedOperationException(); } // äº’æ–¥æ¨¡å¼ä¸‹ä½¿ç”¨ï¼šå°è¯•é‡Šæ”¾é” protected boolean tryRelease(int arg) { throw new UnsupportedOperationException(); } // å…±äº«æ¨¡å¼ä¸‹ä½¿ç”¨ï¼šå°è¯•è·å–é” protected int tryAcquireShared(int arg) { throw new UnsupportedOperationException(); } // å…±äº«æ¨¡å¼ä¸‹ä½¿ç”¨ï¼šå°è¯•é‡Šæ”¾é” protected boolean tryReleaseShared(int arg) { throw new UnsupportedOperationException(); } // å¦‚æœå½“å‰çº¿ç¨‹ç‹¬å ç€é”ï¼Œè¿”å›true protected boolean isHeldExclusively() { throw new UnsupportedOperationException(); } é€šè¿‡AQSè‡ªå·±å®ç°ä¸€ä¸ªé”\npublic class MyLockBaseOnAqs { // å®šä¹‰ä¸€ä¸ªåŒæ­¥å™¨ï¼Œå®ç°AQSç±»  private static class Sync extends AbstractQueuedSynchronizer { // å®ç°tryAcquire(acquires)æ–¹æ³•  @Override public boolean tryAcquire(int acquires) { if (compareAndSetState(0, 1)) { setExclusiveOwnerThread(Thread.currentThread()); return true; } return false; } // å®ç°tryRelease(releases)æ–¹æ³•  @Override protected boolean tryRelease(int releases) { setExclusiveOwnerThread(null); setState(0); return true; } } // å£°æ˜åŒæ­¥å™¨  private final Sync sync = new Sync(); // åŠ é”  public void lock() { sync.acquire(1); } // è§£é”  public void unlock() { sync.release(1); } private static int count = 0; public static void main(String[] args) throws InterruptedException { MyLockBaseOnAqs lock = new MyLockBaseOnAqs(); CountDownLatch countDownLatch = new CountDownLatch(1000); IntStream.range(0, 1000).forEach(i -\u0026gt; new Thread(() -\u0026gt; { lock.lock(); try { IntStream.range(0, 10000).forEach(j -\u0026gt; { count++; }); } finally { lock.unlock(); } // System.out.println(Thread.currentThread().getName());  countDownLatch.countDown(); }, \u0026#34;tt-\u0026#34; + i).start()); countDownLatch.await(); System.out.println(count); } } wait()ã€notify()ã€sleep()ã€yield()ã€join()ã€Interrupt()è¿™å‡ ä¸ªæ–¹æ³•çš„ä½œç”¨   wait\nå½“æˆ‘ä»¬è°ƒç”¨waitï¼ˆï¼‰æ–¹æ³•åï¼Œçº¿ç¨‹ä¼šæ”¾åˆ°ç­‰å¾…æ± å½“ä¸­ï¼Œç­‰å¾…æ± çš„çº¿ç¨‹æ˜¯ä¸ä¼šå»ç«äº‰åŒæ­¥é”ã€‚åªæœ‰è°ƒç”¨äº†notifyï¼ˆï¼‰æˆ–notifyAll()åç­‰å¾…æ± çš„çº¿ç¨‹æ‰ä¼šå¼€å§‹å»ç«äº‰é”ï¼Œnotifyï¼ˆï¼‰æ˜¯éšæœºä»ç­‰å¾…æ± é€‰å‡ºä¸€ä¸ªçº¿ç¨‹æ”¾åˆ°é”æ± ï¼Œè€ŒnotifyAll()æ˜¯å°†ç­‰å¾…æ± çš„æ‰€æœ‰çº¿ç¨‹æ”¾åˆ°é”æ± å½“ä¸­\nwaitä¼šé‡Šæ”¾å¯¹è±¡é”\n  notify()éšæœºä»ç­‰å¾…æ± é‡Œï¼Œé€‰ä¸€ä¸ªçº¿ç¨‹å»äº‰å¤ºé”ã€‚notify()é‡Šæ”¾æ‰€æœ‰çš„ç­‰å¾…æ± é‡Œçš„çº¿ç¨‹ã€‚\nwait()å’Œsynchroinzedè¦é”çš„å¯¹è±¡æ˜¯åŒä¸€ä¸ªå¯¹è±¡æ‰å¯ä»¥wait()å’Œnotify()å› ä¸ºä¼šå¯¹å¯¹è±¡çš„â€œé”æ ‡å¿—â€è¿›è¡Œæ“ä½œï¼Œæ‰€ä»¥å®ƒä»¬å¿…é¡»åœ¨è·å¾—å¯¹è±¡é”åæ‰§è¡Œå³åœ¨ synchronizedå‡½æ•°æˆ–synchronized blockä¸­è¿›è¡Œè°ƒç”¨ï¼Œå¦åˆ™å¦‚æœè™½ç„¶èƒ½ç¼–è¯‘é€šè¿‡ï¼Œä½†åœ¨è¿è¡Œæ—¶ä¼šå‘ç”ŸIllegalMonitorStateExceptionçš„å¼‚å¸¸ã€‚\n  join\nThreadå®ä¾‹çš„æ–¹æ³•ï¼Œé‡Šæ”¾CPUæ‰§è¡Œæƒï¼Œç­‰å¾…è¢«è°ƒç”¨joinæ–¹æ³•çš„çº¿ç¨‹ç»“æŸæ‰ç»§ç»­æ‰§è¡Œæœ¬çº¿ç¨‹ä¸‹é¢çš„æ“ä½œã€‚ä¸ä¼šé‡Šæ”¾æ‰€æŒæœ‰å¯¹è±¡çš„é”ã€‚\n  sleep()\nThreadç±»çš„é™æ€æ–¹æ³•ï¼Œé‡Šæ”¾CPUæ‰§è¡Œæƒï¼Œå¯ä»¥è®©å…¶ä»–çº¿ç¨‹æ‹¥æœ‰æœºä¼šå»æŠ¢å CPUã€‚ç­‰å¾…æŒ‡å®šæ—¶é—´åè‡ªå·±é†’æ¥ã€‚ä¸ä¼šé‡Šæ”¾æ‰€æŒæœ‰å¯¹è±¡çš„é”ã€‚\n  interrupt()\nåªæ˜¯å•çº¯çš„æ‰“ä¸Šä¸­æ­¢çš„æ ‡è®°ã€‚æ–­å¤„äºç­‰å¾…çŠ¶æ€çš„çº¿ç¨‹ï¼ˆå¯¹äºé˜»å¡çŠ¶æ€çš„çº¿ç¨‹ä¸èµ·ä½œç”¨ï¼Œå¦‚å› synchronizedæ–¹æ³•æˆ–ä»£ç å—ç­‰è€Œé˜»å¡çš„çº¿ç¨‹ï¼‰ï¼šåœ¨waitæˆ–sleepçš„çº¿ç¨‹ã€åœ¨ç­‰å¾…çº¿ç¨‹ç»“æŸçš„çº¿ç¨‹ï¼ˆjoinçš„è°ƒç”¨è€…ï¼‰å¯ä»¥è¢«ä¸­æ–­ï¼Œå¦‚æœè¢«ä¸­æ–­ï¼Œä¼šæŠ›å‡ºInterruptedExceptionï¼›2ã€å¯¹éç­‰å¾…çŠ¶æ€çš„çº¿ç¨‹è°ƒç”¨interruptä¸ä¼šæŠ›å¼‚å¸¸ï¼Œéœ€è¦æ‰‹åŠ¨æ£€æµ‹çº¿ç¨‹çŠ¶æ€å¹¶åšç›¸åº”å¤„ç†ã€‚\n  yield()\nThreadçš„é™æ€æ–¹æ³•ï¼Œæ­¤æ–¹æ³•åªæ˜¯ä½¿å½“å‰çº¿ç¨‹é‡æ–°å›åˆ°å¯æ‰§è¡ŒçŠ¶æ€ï¼Œä¸ä¼šé˜»å¡çº¿ç¨‹ï¼Œå› æ­¤æ‰§è¡Œyield()çš„çº¿ç¨‹æœ‰å¯èƒ½åœ¨è¿›å…¥åˆ°å¯æ‰§è¡ŒçŠ¶æ€åé©¬ä¸Šåˆè¢«æ‰§è¡Œã€‚å®é™…ä¸Šï¼Œå½“æŸä¸ªçº¿ç¨‹è°ƒç”¨äº†yieldæ–¹æ³•æš‚åœä¹‹åï¼Œåªæœ‰ä¼˜å…ˆçº§ä¸å½“å‰çº¿ç¨‹ç›¸åŒï¼Œæˆ–è€…ä¼˜å…ˆçº§æ¯”å½“å‰çº¿ç¨‹æ›´é«˜çš„å¤„äºå°±ç»ªçŠ¶æ€çš„çº¿ç¨‹æ‰ä¼šè·å¾—æ‰§è¡Œçš„æœºä¼šã€‚\n  å®ç°çº¿ç¨‹å®‰å…¨çš„æ–¹æ³• åŠ é”å°±å®Œäº‹\nå…¬å¹³é”å’Œéå…¬å¹³é”çš„åŒºåˆ«,ReentrantLockæ˜¯æ€ä¹ˆå®ç°çš„ï¼ŒReentrantLockåˆæ˜¯æ€ä¹ˆå®ç°é‡å…¥é”çš„ï¼Œå®ƒçš„æ¡ä»¶é”åˆæ˜¯ä»€ä¹ˆï¼Ÿ ReentrantLockï¼Œè¡¨é¢æ„æ€é‡å¤è¿›å…¥çš„é”\n é€šè¿‡stateå˜é‡æ¯æ¬¡é€’å¢ï¼Œç”¨æ¥å®ç°é‡å…¥é”ã€‚æ£€æŸ¥å½“å‰çš„ç‹¬å é”æ˜¯å¦æ˜¯å½“å‰çº¿ç¨‹ï¼Œå¦‚æœæ˜¯çš„è¯ï¼Œç›´æ¥ç»™stateå˜é‡+1ï¼Œä¸ä¼šé‡Šæ”¾é”ï¼Œå†åŠ é”  ReentrantLockå†…éƒ¨çš„ä¸»è¦çš„å±æ€§Syncï¼Œæ˜¯å®ç°äº†AQSçš„ä¸€ä¸ªé”ã€‚å…¶è¿˜æœ‰2ä¸ªå­ç±»ï¼Œ\n  FairSync\nå…¬å¹³é”ï¼Œå®ç°å…·ä½“å…¬å¹³é”çš„å®ç°é€»è¾‘\n  NoFairSync\néå…¬å¹³é”ï¼Œå®ç°å…·ä½“çš„éå…¬å¹³é”é€»è¾‘\n  ReentrantLockå®ç°äº†Lockæ¥å£\n// è·å–é” void lock(); // è·å–é”ï¼ˆå¯ä¸­æ–­ï¼‰ void lockInterruptibly() throws InterruptedException; // å°è¯•è·å–é”ï¼Œå¦‚æœæ²¡è·å–åˆ°é”ï¼Œå°±è¿”å›false boolean tryLock(); // å°è¯•è·å–é”ï¼Œå¦‚æœæ²¡è·å–åˆ°é”ï¼Œå°±ç­‰å¾…ä¸€æ®µæ—¶é—´ï¼Œè¿™æ®µæ—¶é—´å†…è¿˜æ²¡è·å–åˆ°é”å°±è¿”å›false boolean tryLock(long time, TimeUnit unit) throws InterruptedException; // é‡Šæ”¾é” void unlock(); // æ¡ä»¶é” Condition newCondition();   æ„é€ æ–¹æ³•\n// é»˜è®¤æ„é€ æ–¹æ³• public ReentrantLock() { sync = new NonfairSync(); } // è‡ªå·±å¯é€‰æ‹©ä½¿ç”¨å…¬å¹³é”è¿˜æ˜¯éå…¬å¹³é” public ReentrantLock(boolean fair) { sync = fair ? new FairSync() : new NonfairSync(); }   å…¬å¹³é”åŠ é”è¿‡ç¨‹\n// ReentrantLock.lock() public void lock() { // è°ƒç”¨çš„syncå±æ€§çš„lock()æ–¹æ³•  // è¿™é‡Œçš„syncæ˜¯å…¬å¹³é”ï¼Œæ‰€ä»¥æ˜¯FairSyncçš„å®ä¾‹  sync.lock(); } // ReentrantLock.FairSync.lock() final void lock() { // è°ƒç”¨AQSçš„acquire()æ–¹æ³•è·å–é”  // æ³¨æ„ï¼Œè¿™é‡Œä¼ çš„å€¼ä¸º1  acquire(1); } // AbstractQueuedSynchronizer.acquire() public final void acquire(int arg) { // å°è¯•è·å–é”  // å¦‚æœå¤±è´¥äº†ï¼Œå°±æ’é˜Ÿ  if (!tryAcquire(arg) \u0026amp;\u0026amp; // æ³¨æ„addWaiter()è¿™é‡Œä¼ å…¥çš„èŠ‚ç‚¹æ¨¡å¼ä¸ºç‹¬å æ¨¡å¼  acquireQueued(addWaiter(Node.EXCLUSIVE), arg)) selfInterrupt(); } // ReentrantLock.FairSync.tryAcquire() protected final boolean tryAcquire(int acquires) { // å½“å‰çº¿ç¨‹  final Thread current = Thread.currentThread(); // æŸ¥çœ‹å½“å‰çŠ¶æ€å˜é‡çš„å€¼  int c = getState(); // å¦‚æœçŠ¶æ€å˜é‡çš„å€¼ä¸º0ï¼Œè¯´æ˜æš‚æ—¶è¿˜æ²¡æœ‰äººå æœ‰é”  if (c == 0) { // å¦‚æœæ²¡æœ‰å…¶å®ƒçº¿ç¨‹åœ¨æ’é˜Ÿï¼Œé‚£ä¹ˆå½“å‰çº¿ç¨‹å°è¯•æ›´æ–°stateçš„å€¼ä¸º1  // å¦‚æœæˆåŠŸäº†ï¼Œåˆ™è¯´æ˜å½“å‰çº¿ç¨‹è·å–äº†é”  if (!hasQueuedPredecessors() \u0026amp;\u0026amp; compareAndSetState(0, acquires)) { // å½“å‰çº¿ç¨‹è·å–äº†é”ï¼ŒæŠŠè‡ªå·±è®¾ç½®åˆ°exclusiveOwnerThreadå˜é‡ä¸­  // exclusiveOwnerThreadæ˜¯AQSçš„çˆ¶ç±»AbstractOwnableSynchronizerä¸­æä¾›çš„å˜é‡  setExclusiveOwnerThread(current); // è¿”å›trueè¯´æ˜æˆåŠŸè·å–äº†é”  return true; } } // å¦‚æœå½“å‰çº¿ç¨‹æœ¬èº«å°±å æœ‰ç€é”ï¼Œç°åœ¨åˆå°è¯•è·å–é”  // é‚£ä¹ˆï¼Œç›´æ¥è®©å®ƒè·å–é”å¹¶è¿”å›true  else if (current == getExclusiveOwnerThread()) { // çŠ¶æ€å˜é‡stateçš„å€¼åŠ 1  int nextc = c + acquires; // å¦‚æœæº¢å‡ºäº†ï¼Œåˆ™æŠ¥é”™  if (nextc \u0026lt; 0) throw new Error(\u0026#34;Maximum lock count exceeded\u0026#34;); // è®¾ç½®åˆ°stateä¸­  // è¿™é‡Œä¸éœ€è¦CASæ›´æ–°state  // å› ä¸ºå½“å‰çº¿ç¨‹å æœ‰ç€é”ï¼Œå…¶å®ƒçº¿ç¨‹åªä¼šCASæŠŠstateä»0æ›´æ–°æˆ1ï¼Œæ˜¯ä¸ä¼šæˆåŠŸçš„  // æ‰€ä»¥ä¸å­˜åœ¨ç«äº‰ï¼Œè‡ªç„¶ä¸éœ€è¦ä½¿ç”¨CASæ¥æ›´æ–°  setState(nextc); // å½“çº¿ç¨‹è·å–é”æˆåŠŸ  return true; } // å½“å‰çº¿ç¨‹å°è¯•è·å–é”å¤±è´¥  return false; } // AbstractQueuedSynchronizer.addWaiter() // è°ƒç”¨è¿™ä¸ªæ–¹æ³•ï¼Œè¯´æ˜ä¸Šé¢å°è¯•è·å–é”å¤±è´¥äº† private Node addWaiter(Node mode) { // æ–°å»ºä¸€ä¸ªèŠ‚ç‚¹  Node node = new Node(Thread.currentThread(), mode); // è¿™é‡Œå…ˆå°è¯•æŠŠæ–°èŠ‚ç‚¹åŠ åˆ°å°¾èŠ‚ç‚¹åé¢  // å¦‚æœæˆåŠŸäº†å°±è¿”å›æ–°èŠ‚ç‚¹  // å¦‚æœæ²¡æˆåŠŸå†è°ƒç”¨enq()æ–¹æ³•ä¸æ–­å°è¯•  Node pred = tail; // å¦‚æœå°¾èŠ‚ç‚¹ä¸ä¸ºç©º  if (pred != null) { // è®¾ç½®æ–°èŠ‚ç‚¹çš„å‰ç½®èŠ‚ç‚¹ä¸ºç°åœ¨çš„å°¾èŠ‚ç‚¹  node.prev = pred; // CASæ›´æ–°å°¾èŠ‚ç‚¹ä¸ºæ–°èŠ‚ç‚¹  if (compareAndSetTail(pred, node)) { // å¦‚æœæˆåŠŸäº†ï¼ŒæŠŠæ—§å°¾èŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹æŒ‡å‘æ–°èŠ‚ç‚¹  pred.next = node; // å¹¶è¿”å›æ–°èŠ‚ç‚¹  return node; } } // å¦‚æœä¸Šé¢å°è¯•å…¥é˜Ÿæ–°èŠ‚ç‚¹æ²¡æˆåŠŸï¼Œè°ƒç”¨enq()å¤„ç†  enq(node); return node; } // AbstractQueuedSynchronizer.enq() private Node enq(final Node node) { // è‡ªæ—‹ï¼Œä¸æ–­å°è¯•  for (;;) { Node t = tail; // å¦‚æœå°¾èŠ‚ç‚¹ä¸ºç©ºï¼Œè¯´æ˜è¿˜æœªåˆå§‹åŒ–  if (t == null) { // Must initialize  // åˆå§‹åŒ–å¤´èŠ‚ç‚¹å’Œå°¾èŠ‚ç‚¹  if (compareAndSetHead(new Node())) tail = head; } else { // å¦‚æœå°¾èŠ‚ç‚¹ä¸ä¸ºç©º  // è®¾ç½®æ–°èŠ‚ç‚¹çš„å‰ä¸€ä¸ªèŠ‚ç‚¹ä¸ºç°åœ¨çš„å°¾èŠ‚ç‚¹  node.prev = t; // CASæ›´æ–°å°¾èŠ‚ç‚¹ä¸ºæ–°èŠ‚ç‚¹  if (compareAndSetTail(t, node)) { // æˆåŠŸäº†ï¼Œåˆ™è®¾ç½®æ—§å°¾èŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ä¸ºæ–°èŠ‚ç‚¹  t.next = node; // å¹¶è¿”å›æ—§å°¾èŠ‚ç‚¹  return t; } } } } // AbstractQueuedSynchronizer.acquireQueued() // è°ƒç”¨ä¸Šé¢çš„addWaiter()æ–¹æ³•ä½¿å¾—æ–°èŠ‚ç‚¹å·²ç»æˆåŠŸå…¥é˜Ÿäº† // è¿™ä¸ªæ–¹æ³•æ˜¯å°è¯•è®©å½“å‰èŠ‚ç‚¹æ¥è·å–é”çš„ final boolean acquireQueued(final Node node, int arg) { // å¤±è´¥æ ‡è®°  boolean failed = true; try { // ä¸­æ–­æ ‡è®°  boolean interrupted = false; // è‡ªæ—‹  for (;;) { // å½“å‰èŠ‚ç‚¹çš„å‰ä¸€ä¸ªèŠ‚ç‚¹  final Node p = node.predecessor(); // å¦‚æœå½“å‰èŠ‚ç‚¹çš„å‰ä¸€ä¸ªèŠ‚ç‚¹ä¸ºheadèŠ‚ç‚¹ï¼Œåˆ™è¯´æ˜è½®åˆ°è‡ªå·±è·å–é”äº†  // è°ƒç”¨ReentrantLock.FairSync.tryAcquire()æ–¹æ³•å†æ¬¡å°è¯•è·å–é”  if (p == head \u0026amp;\u0026amp; tryAcquire(arg)) { // å°è¯•è·å–é”æˆåŠŸ  // è¿™é‡ŒåŒæ—¶åªä¼šæœ‰ä¸€ä¸ªçº¿ç¨‹åœ¨æ‰§è¡Œï¼Œæ‰€ä»¥ä¸éœ€è¦ç”¨CASæ›´æ–°  // æŠŠå½“å‰èŠ‚ç‚¹è®¾ç½®ä¸ºæ–°çš„å¤´èŠ‚ç‚¹  setHead(node); // å¹¶æŠŠä¸Šä¸€ä¸ªèŠ‚ç‚¹ä»é“¾è¡¨ä¸­åˆ é™¤  p.next = null; // help GC  // æœªå¤±è´¥  failed = false; return interrupted; } // æ˜¯å¦éœ€è¦é˜»å¡  if (shouldParkAfterFailedAcquire(p, node) \u0026amp;\u0026amp; // çœŸæ­£é˜»å¡çš„æ–¹æ³•  parkAndCheckInterrupt()) // å¦‚æœä¸­æ–­äº†  interrupted = true; } } finally { // å¦‚æœå¤±è´¥äº†  if (failed) // å–æ¶ˆè·å–é”  cancelAcquire(node); } } // AbstractQueuedSynchronizer.shouldParkAfterFailedAcquire() // è¿™ä¸ªæ–¹æ³•æ˜¯åœ¨ä¸Šé¢çš„for()å¾ªç¯é‡Œé¢è°ƒç”¨çš„ // ç¬¬ä¸€æ¬¡è°ƒç”¨ä¼šæŠŠå‰ä¸€ä¸ªèŠ‚ç‚¹çš„ç­‰å¾…çŠ¶æ€è®¾ç½®ä¸ºSIGNALï¼Œå¹¶è¿”å›false // ç¬¬äºŒæ¬¡è°ƒç”¨æ‰ä¼šè¿”å›true private static boolean shouldParkAfterFailedAcquire(Node pred, Node node) { // ä¸Šä¸€ä¸ªèŠ‚ç‚¹çš„ç­‰å¾…çŠ¶æ€  // æ³¨æ„Nodeçš„waitStatuså­—æ®µæˆ‘ä»¬åœ¨ä¸Šé¢åˆ›å»ºNodeçš„æ—¶å€™å¹¶æ²¡æœ‰æŒ‡å®š  // ä¹Ÿå°±æ˜¯è¯´ä½¿ç”¨çš„æ˜¯é»˜è®¤å€¼0  // è¿™é‡ŒæŠŠå„ç§ç­‰å¾…çŠ¶æ€å†è´´å‡ºæ¥  //static final int CANCELLED = 1;  //static final int SIGNAL = -1;  //static final int CONDITION = -2;  //static final int PROPAGATE = -3;  int ws = pred.waitStatus; // å¦‚æœç­‰å¾…çŠ¶æ€ä¸ºSIGNAL(ç­‰å¾…å”¤é†’)ï¼Œç›´æ¥è¿”å›true  if (ws == Node.SIGNAL) return true; // å¦‚æœå‰ä¸€ä¸ªèŠ‚ç‚¹çš„çŠ¶æ€å¤§äº0ï¼Œä¹Ÿå°±æ˜¯å·²å–æ¶ˆçŠ¶æ€  if (ws \u0026gt; 0) { // æŠŠå‰é¢æ‰€æœ‰å–æ¶ˆçŠ¶æ€çš„èŠ‚ç‚¹éƒ½ä»é“¾è¡¨ä¸­åˆ é™¤  do { node.prev = pred = pred.prev; } while (pred.waitStatus \u0026gt; 0); pred.next = node; } else { // å¦‚æœå‰ä¸€ä¸ªèŠ‚ç‚¹çš„çŠ¶æ€å°äºç­‰äº0ï¼Œåˆ™æŠŠå…¶çŠ¶æ€è®¾ç½®ä¸ºç­‰å¾…å”¤é†’  // è¿™é‡Œå¯ä»¥ç®€å•åœ°ç†è§£ä¸ºæŠŠåˆå§‹çŠ¶æ€0è®¾ç½®ä¸ºSIGNAL  // CONDITIONæ˜¯æ¡ä»¶é”çš„æ—¶å€™ä½¿ç”¨çš„  // PROPAGATEæ˜¯å…±äº«é”ä½¿ç”¨çš„  compareAndSetWaitStatus(pred, ws, Node.SIGNAL); } return false; } // AbstractQueuedSynchronizer.parkAndCheckInterrupt() private final boolean parkAndCheckInterrupt() { // é˜»å¡å½“å‰çº¿ç¨‹  // åº•å±‚è°ƒç”¨çš„æ˜¯Unsafeçš„park()æ–¹æ³•  LockSupport.park(this); // è¿”å›æ˜¯å¦å·²ä¸­æ–­  return Thread.interrupted(); }   éå…¬å¹³é”è¿‡ç¨‹\n// ReentrantLock.lock() public void lock() { sync.lock(); } // ReentrantLock.NonfairSync.lock() // è¿™ä¸ªæ–¹æ³•åœ¨å…¬å¹³é”æ¨¡å¼ä¸‹æ˜¯ç›´æ¥è°ƒç”¨çš„acquire(1); final void lock() { // ç›´æ¥å°è¯•CASæ›´æ–°çŠ¶æ€å˜é‡  if (compareAndSetState(0, 1)) // å¦‚æœæ›´æ–°æˆåŠŸï¼Œè¯´æ˜è·å–åˆ°é”ï¼ŒæŠŠå½“å‰çº¿ç¨‹è®¾ä¸ºç‹¬å çº¿ç¨‹  setExclusiveOwnerThread(Thread.currentThread()); else acquire(1); } // ReentrantLock.NonfairSync.tryAcquire() protected final boolean tryAcquire(int acquires) { // è°ƒç”¨çˆ¶ç±»çš„æ–¹æ³•  return nonfairTryAcquire(acquires); } // ReentrantLock.Sync.nonfairTryAcquire() final boolean nonfairTryAcquire(int acquires) { final Thread current = Thread.currentThread(); int c = getState(); if (c == 0) { // å¦‚æœçŠ¶æ€å˜é‡çš„å€¼ä¸º0ï¼Œå†æ¬¡å°è¯•CASæ›´æ–°çŠ¶æ€å˜é‡çš„å€¼  // ç›¸å¯¹äºå…¬å¹³é”æ¨¡å¼å°‘äº†!hasQueuedPredecessors()æ¡ä»¶  if (compareAndSetState(0, acquires)) { setExclusiveOwnerThread(current); return true; } } else if (current == getExclusiveOwnerThread()) { int nextc = c + acquires; if (nextc \u0026lt; 0) // overflow  throw new Error(\u0026#34;Maximum lock count exceeded\u0026#34;); setState(nextc); return true; } return false; }   é‡Šæ”¾é”è¿‡ç¨‹\n// java.util.concurrent.locks.ReentrantLock.unlock() public void unlock() { sync.release(1); } // java.util.concurrent.locks.AbstractQueuedSynchronizer.release public final boolean release(int arg) { // è°ƒç”¨AQSå®ç°ç±»çš„tryRelease()æ–¹æ³•é‡Šæ”¾é”  if (tryRelease(arg)) { Node h = head; // å¦‚æœå¤´èŠ‚ç‚¹ä¸ä¸ºç©ºï¼Œä¸”ç­‰å¾…çŠ¶æ€ä¸æ˜¯0ï¼Œå°±å”¤é†’ä¸‹ä¸€ä¸ªèŠ‚ç‚¹  // è¿˜è®°å¾—waitStatuså—ï¼Ÿ  // åœ¨æ¯ä¸ªèŠ‚ç‚¹é˜»å¡ä¹‹å‰ä¼šæŠŠå…¶ä¸Šä¸€ä¸ªèŠ‚ç‚¹çš„ç­‰å¾…çŠ¶æ€è®¾ä¸ºSIGNALï¼ˆ-1ï¼‰  // æ‰€ä»¥ï¼ŒSIGNALçš„å‡†ç¡®ç†è§£åº”è¯¥æ˜¯å”¤é†’ä¸‹ä¸€ä¸ªç­‰å¾…çš„çº¿ç¨‹  if (h != null \u0026amp;\u0026amp; h.waitStatus != 0) unparkSuccessor(h); return true; } return false; } // java.util.concurrent.locks.ReentrantLock.Sync.tryRelease protected final boolean tryRelease(int releases) { int c = getState() - releases; // å¦‚æœå½“å‰çº¿ç¨‹ä¸æ˜¯å æœ‰ç€é”çš„çº¿ç¨‹ï¼ŒæŠ›å‡ºå¼‚å¸¸  if (Thread.currentThread() != getExclusiveOwnerThread()) throw new IllegalMonitorStateException(); boolean free = false; // å¦‚æœçŠ¶æ€å˜é‡çš„å€¼ä¸º0äº†ï¼Œè¯´æ˜å®Œå…¨é‡Šæ”¾äº†é”  // è¿™ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆé‡å…¥é”è°ƒç”¨äº†å¤šå°‘æ¬¡lock()å°±è¦è°ƒç”¨å¤šå°‘æ¬¡unlock()çš„åŸå›   // å¦‚æœä¸è¿™æ ·åšï¼Œä¼šå¯¼è‡´é”ä¸ä¼šå®Œå…¨é‡Šæ”¾ï¼Œåˆ«çš„çº¿ç¨‹æ°¸è¿œæ— æ³•è·å–åˆ°é”  if (c == 0) { free = true; // æ¸…ç©ºå æœ‰çº¿ç¨‹  setExclusiveOwnerThread(null); } // è®¾ç½®çŠ¶æ€å˜é‡çš„å€¼  setState(c); return free; } private void unparkSuccessor(Node node) { // æ³¨æ„ï¼Œè¿™é‡Œçš„nodeæ˜¯å¤´èŠ‚ç‚¹  // å¦‚æœå¤´èŠ‚ç‚¹çš„ç­‰å¾…çŠ¶æ€å°äº0ï¼Œå°±æŠŠå®ƒè®¾ç½®ä¸º0  int ws = node.waitStatus; if (ws \u0026lt; 0) compareAndSetWaitStatus(node, ws, 0); // å¤´èŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹  Node s = node.next; // å¦‚æœä¸‹ä¸€ä¸ªèŠ‚ç‚¹ä¸ºç©ºï¼Œæˆ–è€…å…¶ç­‰å¾…çŠ¶æ€å¤§äº0ï¼ˆå®é™…ä¸ºå·²å–æ¶ˆï¼‰  if (s == null || s.waitStatus \u0026gt; 0) { s = null; // ä»å°¾èŠ‚ç‚¹å‘å‰éå†å–åˆ°é˜Ÿåˆ—æœ€å‰é¢çš„é‚£ä¸ªçŠ¶æ€ä¸æ˜¯å·²å–æ¶ˆçŠ¶æ€çš„èŠ‚ç‚¹  for (Node t = tail; t != null \u0026amp;\u0026amp; t != node; t = t.prev) if (t.waitStatus \u0026lt;= 0) s = t; } // å¦‚æœä¸‹ä¸€ä¸ªèŠ‚ç‚¹ä¸ä¸ºç©ºï¼Œåˆ™å”¤é†’å®ƒ  if (s != null) LockSupport.unpark(s.thread); }   æ¡ä»¶é”\n æ¡ä»¶é”ï¼Œæ˜¯æŒ‡åœ¨è·å–é”ä¹‹åå‘ç°å½“å‰ä¸šåŠ¡åœºæ™¯è‡ªå·±æ— æ³•å¤„ç†ï¼Œè€Œéœ€è¦ç­‰å¾…æŸä¸ªæ¡ä»¶çš„å‡ºç°æ‰å¯ä»¥ç»§ç»­å¤„ç†æ—¶ä½¿ç”¨çš„ä¸€ç§é”ã€‚\næ¯”å¦‚ï¼Œåœ¨é˜»å¡é˜Ÿåˆ—ä¸­ï¼Œå½“é˜Ÿåˆ—ä¸­æ²¡æœ‰å…ƒç´ çš„æ—¶å€™æ˜¯æ— æ³•å¼¹å‡ºä¸€ä¸ªå…ƒç´ çš„ï¼Œè¿™æ—¶å€™å°±éœ€è¦é˜»å¡åœ¨æ¡ä»¶notEmptyä¸Šï¼Œç­‰å¾…å…¶å®ƒçº¿ç¨‹å¾€é‡Œé¢æ”¾å…¥ä¸€ä¸ªå…ƒç´ åï¼Œå”¤é†’è¿™ä¸ªæ¡ä»¶notEmptyï¼Œå½“å‰çº¿ç¨‹æ‰å¯ä»¥ç»§ç»­å»åšâ€œå¼¹å‡ºä¸€ä¸ªå…ƒç´ â€çš„è¡Œä¸ºã€‚\n   æ¡ä»¶é”æµç¨‹\n// AbstractQueuedSynchronizer.ConditionObject.await() public final void await() throws InterruptedException { // å¦‚æœçº¿ç¨‹ä¸­æ–­äº†ï¼ŒæŠ›å‡ºå¼‚å¸¸  if (Thread.interrupted()) throw new InterruptedException(); // æ·»åŠ èŠ‚ç‚¹åˆ°Conditionçš„é˜Ÿåˆ—ä¸­ï¼Œå¹¶è¿”å›è¯¥èŠ‚ç‚¹  Node node = addConditionWaiter(); // å®Œå…¨é‡Šæ”¾å½“å‰çº¿ç¨‹è·å–çš„é”  // å› ä¸ºé”æ˜¯å¯é‡å…¥çš„ï¼Œæ‰€ä»¥è¿™é‡Œè¦æŠŠè·å–çš„é”å…¨éƒ¨é‡Šæ”¾  int savedState = fullyRelease(node); int interruptMode = 0; // æ˜¯å¦åœ¨åŒæ­¥é˜Ÿåˆ—ä¸­  while (!isOnSyncQueue(node)) { // é˜»å¡å½“å‰çº¿ç¨‹  LockSupport.park(this); // ä¸Šé¢éƒ¨åˆ†æ˜¯è°ƒç”¨await()æ—¶é‡Šæ”¾è‡ªå·±å æœ‰çš„é”ï¼Œå¹¶é˜»å¡è‡ªå·±ç­‰å¾…æ¡ä»¶çš„å‡ºç°  // *************************åˆ†ç•Œçº¿************************* //  // ä¸‹é¢éƒ¨åˆ†æ˜¯æ¡ä»¶å·²ç»å‡ºç°ï¼Œå°è¯•å»è·å–é”  if ((interruptMode = checkInterruptWhileWaiting(node)) != 0) break; } // å°è¯•è·å–é”ï¼Œæ³¨æ„ç¬¬äºŒä¸ªå‚æ•°ï¼Œè¿™æ˜¯ä¸Šä¸€ç« åˆ†æè¿‡çš„æ–¹æ³•  // å¦‚æœæ²¡è·å–åˆ°ä¼šå†æ¬¡é˜»å¡ï¼ˆè¿™ä¸ªæ–¹æ³•è¿™é‡Œå°±ä¸è´´å‡ºæ¥äº†ï¼Œæœ‰å…´è¶£çš„ç¿»ç¿»ä¸Šä¸€ç« çš„å†…å®¹ï¼‰  if (acquireQueued(node, savedState) \u0026amp;\u0026amp; interruptMode != THROW_IE) interruptMode = REINTERRUPT; // æ¸…é™¤å–æ¶ˆçš„èŠ‚ç‚¹  if (node.nextWaiter != null) // clean up if cancelled  unlinkCancelledWaiters(); // çº¿ç¨‹ä¸­æ–­ç›¸å…³  if (interruptMode != 0) reportInterruptAfterWait(interruptMode); } // AbstractQueuedSynchronizer.ConditionObject.addConditionWaiter private Node addConditionWaiter() { Node t = lastWaiter; // å¦‚æœæ¡ä»¶é˜Ÿåˆ—çš„å°¾èŠ‚ç‚¹å·²å–æ¶ˆï¼Œä»å¤´èŠ‚ç‚¹å¼€å§‹æ¸…é™¤æ‰€æœ‰å·²å–æ¶ˆçš„èŠ‚ç‚¹  if (t != null \u0026amp;\u0026amp; t.waitStatus != Node.CONDITION) { unlinkCancelledWaiters(); // é‡æ–°è·å–å°¾èŠ‚ç‚¹  t = lastWaiter; } // æ–°å»ºä¸€ä¸ªèŠ‚ç‚¹ï¼Œå®ƒçš„ç­‰å¾…çŠ¶æ€æ˜¯CONDITION  Node node = new Node(Thread.currentThread(), Node.CONDITION); // å¦‚æœå°¾èŠ‚ç‚¹ä¸ºç©ºï¼Œåˆ™æŠŠæ–°èŠ‚ç‚¹èµ‹å€¼ç»™å¤´èŠ‚ç‚¹ï¼ˆç›¸å½“äºåˆå§‹åŒ–é˜Ÿåˆ—ï¼‰  // å¦åˆ™æŠŠæ–°èŠ‚ç‚¹èµ‹å€¼ç»™å°¾èŠ‚ç‚¹çš„nextWaiteræŒ‡é’ˆ  if (t == null) firstWaiter = node; else t.nextWaiter = node; // å°¾èŠ‚ç‚¹æŒ‡å‘æ–°èŠ‚ç‚¹  lastWaiter = node; // è¿”å›æ–°èŠ‚ç‚¹  return node; } // AbstractQueuedSynchronizer.fullyRelease final int fullyRelease(Node node) { boolean failed = true; try { // è·å–çŠ¶æ€å˜é‡çš„å€¼ï¼Œé‡å¤è·å–é”ï¼Œè¿™ä¸ªå€¼ä¼šä¸€ç›´ç´¯åŠ   // æ‰€ä»¥è¿™ä¸ªå€¼ä¹Ÿä»£è¡¨ç€è·å–é”çš„æ¬¡æ•°  int savedState = getState(); // ä¸€æ¬¡æ€§é‡Šæ”¾æ‰€æœ‰è·å¾—çš„é”  if (release(savedState)) { failed = false; // è¿”å›è·å–é”çš„æ¬¡æ•°  return savedState; } else { throw new IllegalMonitorStateException(); } } finally { if (failed) node.waitStatus = Node.CANCELLED; } } // AbstractQueuedSynchronizer.isOnSyncQueue final boolean isOnSyncQueue(Node node) { // å¦‚æœç­‰å¾…çŠ¶æ€æ˜¯CONDITIONï¼Œæˆ–è€…å‰ä¸€ä¸ªæŒ‡é’ˆä¸ºç©ºï¼Œè¿”å›false  // è¯´æ˜è¿˜æ²¡æœ‰ç§»åˆ°AQSçš„é˜Ÿåˆ—ä¸­  if (node.waitStatus == Node.CONDITION || node.prev == null) return false; // å¦‚æœnextæŒ‡é’ˆæœ‰å€¼ï¼Œè¯´æ˜å·²ç»ç§»åˆ°AQSçš„é˜Ÿåˆ—ä¸­äº†  if (node.next != null) // If has successor, it must be on queue  return true; // ä»AQSçš„å°¾èŠ‚ç‚¹å¼€å§‹å¾€å‰å¯»æ‰¾çœ‹æ˜¯å¦å¯ä»¥æ‰¾åˆ°å½“å‰èŠ‚ç‚¹ï¼Œæ‰¾åˆ°äº†ä¹Ÿè¯´æ˜å·²ç»åœ¨AQSçš„é˜Ÿåˆ—ä¸­äº†  return findNodeFromTail(node); } æ¡ä»¶é€šçŸ¥æ–¹æ³•\n// AbstractQueuedSynchronizer.ConditionObject.signal public final void signal() { // å¦‚æœä¸æ˜¯å½“å‰çº¿ç¨‹å æœ‰ç€é”ï¼Œè°ƒç”¨è¿™ä¸ªæ–¹æ³•æŠ›å‡ºå¼‚å¸¸  // è¯´æ˜signal()ä¹Ÿè¦åœ¨è·å–é”ä¹‹åæ‰§è¡Œ  if (!isHeldExclusively()) throw new IllegalMonitorStateException(); // æ¡ä»¶é˜Ÿåˆ—çš„å¤´èŠ‚ç‚¹  Node first = firstWaiter; // å¦‚æœæœ‰ç­‰å¾…æ¡ä»¶çš„èŠ‚ç‚¹ï¼Œåˆ™é€šçŸ¥å®ƒæ¡ä»¶å·²æˆç«‹  if (first != null) doSignal(first); } // AbstractQueuedSynchronizer.ConditionObject.doSignal private void doSignal(Node first) { do { // ç§»åˆ°æ¡ä»¶é˜Ÿåˆ—çš„å¤´èŠ‚ç‚¹å¾€åä¸€ä½  if ( (firstWaiter = first.nextWaiter) == null) lastWaiter = null; // ç›¸å½“äºæŠŠå¤´èŠ‚ç‚¹ä»é˜Ÿåˆ—ä¸­å‡ºé˜Ÿ  first.nextWaiter = null; // è½¬ç§»èŠ‚ç‚¹åˆ°AQSé˜Ÿåˆ—ä¸­  } while (!transferForSignal(first) \u0026amp;\u0026amp; (first = firstWaiter) != null); } // AbstractQueuedSynchronizer.transferForSignal final boolean transferForSignal(Node node) { // æŠŠèŠ‚ç‚¹çš„çŠ¶æ€æ›´æ”¹ä¸º0ï¼Œä¹Ÿå°±æ˜¯è¯´å³å°†ç§»åˆ°AQSé˜Ÿåˆ—ä¸­  // å¦‚æœå¤±è´¥äº†ï¼Œè¯´æ˜èŠ‚ç‚¹å·²ç»è¢«æ”¹æˆå–æ¶ˆçŠ¶æ€äº†  // è¿”å›falseï¼Œé€šè¿‡ä¸Šé¢çš„å¾ªç¯å¯çŸ¥ä¼šå¯»æ‰¾ä¸‹ä¸€ä¸ªå¯ç”¨èŠ‚ç‚¹  if (!compareAndSetWaitStatus(node, Node.CONDITION, 0)) return false; // è°ƒç”¨AQSçš„å…¥é˜Ÿæ–¹æ³•æŠŠèŠ‚ç‚¹ç§»åˆ°AQSçš„é˜Ÿåˆ—ä¸­  // æ³¨æ„ï¼Œè¿™é‡Œenq()çš„è¿”å›å€¼æ˜¯nodeçš„ä¸Šä¸€ä¸ªèŠ‚ç‚¹ï¼Œä¹Ÿå°±æ˜¯æ—§å°¾èŠ‚ç‚¹  Node p = enq(node); // ä¸Šä¸€ä¸ªèŠ‚ç‚¹çš„ç­‰å¾…çŠ¶æ€  int ws = p.waitStatus; // å¦‚æœä¸Šä¸€ä¸ªèŠ‚ç‚¹å·²å–æ¶ˆäº†ï¼Œæˆ–è€…æ›´æ–°çŠ¶æ€ä¸ºSIGNALå¤±è´¥ï¼ˆä¹Ÿæ˜¯è¯´æ˜ä¸Šä¸€ä¸ªèŠ‚ç‚¹å·²ç»å–æ¶ˆäº†ï¼‰  // åˆ™ç›´æ¥å”¤é†’å½“å‰èŠ‚ç‚¹å¯¹åº”çš„çº¿ç¨‹  if (ws \u0026gt; 0 || !compareAndSetWaitStatus(p, ws, Node.SIGNAL)) LockSupport.unpark(node.thread); // å¦‚æœæ›´æ–°ä¸Šä¸€ä¸ªèŠ‚ç‚¹çš„ç­‰å¾…çŠ¶æ€ä¸ºSIGNALæˆåŠŸäº†  // åˆ™è¿”å›trueï¼Œè¿™æ—¶ä¸Šé¢çš„å¾ªç¯ä¸æˆç«‹äº†ï¼Œé€€å‡ºå¾ªç¯ï¼Œä¹Ÿå°±æ˜¯åªé€šçŸ¥äº†ä¸€ä¸ªèŠ‚ç‚¹  // æ­¤æ—¶å½“å‰èŠ‚ç‚¹è¿˜æ˜¯é˜»å¡çŠ¶æ€  // ä¹Ÿå°±æ˜¯è¯´è°ƒç”¨signal()çš„æ—¶å€™å¹¶ä¸ä¼šçœŸæ­£å”¤é†’ä¸€ä¸ªèŠ‚ç‚¹  // åªæ˜¯æŠŠèŠ‚ç‚¹ä»æ¡ä»¶é˜Ÿåˆ—ç§»åˆ°AQSé˜Ÿåˆ—ä¸­  return true; } æ¡ä»¶é”è·å–æµç¨‹\nï¼ˆ1ï¼‰æ–°å»ºä¸€ä¸ªèŠ‚ç‚¹åŠ å…¥åˆ°æ¡ä»¶é˜Ÿåˆ—ä¸­å»ï¼›\nï¼ˆ2ï¼‰å®Œå…¨é‡Šæ”¾å½“å‰çº¿ç¨‹å æœ‰çš„é”ï¼›\nï¼ˆ3ï¼‰é˜»å¡å½“å‰çº¿ç¨‹ï¼Œå¹¶ç­‰å¾…æ¡ä»¶çš„å‡ºç°ï¼›\nï¼ˆ4ï¼‰æ¡ä»¶å·²å‡ºç°ï¼ˆæ­¤æ—¶èŠ‚ç‚¹å·²ç»ç§»åˆ°AQSçš„é˜Ÿåˆ—ä¸­ï¼‰ï¼Œå°è¯•è·å–é”ï¼›\næ¡ä»¶é”çš„å”¤é†’æµç¨‹\nï¼ˆ1ï¼‰ä»æ¡ä»¶é˜Ÿåˆ—çš„å¤´èŠ‚ç‚¹å¼€å§‹å¯»æ‰¾ä¸€ä¸ªéå–æ¶ˆçŠ¶æ€çš„èŠ‚ç‚¹ï¼›\nï¼ˆ2ï¼‰æŠŠå®ƒä»æ¡ä»¶é˜Ÿåˆ—ç§»åˆ°AQSé˜Ÿåˆ—ï¼›\nï¼ˆ3ï¼‰ä¸”åªç§»åŠ¨ä¸€ä¸ªèŠ‚ç‚¹ï¼›\n    ä¸ºä»€ä¹ˆReentrantLocké»˜è®¤é‡‡ç”¨çš„æ˜¯éå…¬å¹³æ¨¡å¼ï¼Ÿ\nç­”ï¼šå› ä¸ºéå…¬å¹³æ¨¡å¼æ•ˆç‡æ¯”è¾ƒé«˜ã€‚\nä¸ºä»€ä¹ˆéå…¬å¹³æ¨¡å¼æ•ˆç‡æ¯”è¾ƒé«˜ï¼Ÿ\nç­”ï¼šå› ä¸ºéå…¬å¹³æ¨¡å¼ä¼šåœ¨ä¸€å¼€å§‹å°±å°è¯•ä¸¤æ¬¡è·å–é”ï¼Œå¦‚æœå½“æ—¶æ­£å¥½stateçš„å€¼ä¸º0ï¼Œå®ƒå°±ä¼šæˆåŠŸè·å–åˆ°é”ï¼Œå°‘äº†æ’é˜Ÿå¯¼è‡´çš„é˜»å¡/å”¤é†’è¿‡ç¨‹ï¼Œå¹¶ä¸”å‡å°‘äº†çº¿ç¨‹é¢‘ç¹çš„åˆ‡æ¢å¸¦æ¥çš„æ€§èƒ½æŸè€—ã€‚\néå…¬å¹³æ¨¡å¼æœ‰ä»€ä¹ˆå¼Šç«¯ï¼Ÿ\nç­”ï¼šéå…¬å¹³æ¨¡å¼æœ‰å¯èƒ½ä¼šå¯¼è‡´ä¸€å¼€å§‹æ’é˜Ÿçš„çº¿ç¨‹ä¸€ç›´è·å–ä¸åˆ°é”ï¼Œå¯¼è‡´çº¿ç¨‹é¥¿æ­»ã€‚\n  å…¬å¹³éå…¬å¹³çš„å®ç°æ–¹æ³•\nå…¬å¹³é”åœ¨å®ç°çš„æ—¶å€™ï¼Œä¼šå…ˆå»æ£€æŸ¥è‡ªå·±è¿™nodeå‰é¢æœ‰æ²¡æœ‰å…¶ä»–nodeå»æ’é˜Ÿäº†\nè€Œéå…¬å¹³é”ï¼Œä¸ä¼šå»æ£€æŸ¥ï¼Œè€Œæ˜¯ç›´æ¥å»å°è¯•è·å–é”\n  ReetrantWhriteReadLockæ˜¯æ€ä¹ˆå®ç°è¯»å†™é”çš„ è¯»å†™é”\nè¯»é”ï¼šå¤šä¸ªçº¿ç¨‹å¯ä»¥è·å–åŒä¸€æŠŠé”\nå†™é”ï¼šå¤šä¸ªçº¿ç¨‹åªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥è·å–åˆ°å†™é”\n è¯»é”æµç¨‹  // ReentrantReadWriteLock.ReadLock.lock() public void lock() { sync.acquireShared(1); } // AbstractQueuedSynchronizer.acquireShared() public final void acquireShared(int arg) { // å°è¯•è·å–å…±äº«é”ï¼ˆè¿”å›1è¡¨ç¤ºæˆåŠŸï¼Œè¿”å›-1è¡¨ç¤ºå¤±è´¥ï¼‰  if (tryAcquireShared(arg) \u0026lt; 0) // å¤±è´¥äº†å°±å¯èƒ½è¦æ’é˜Ÿ  doAcquireShared(arg); } // ReentrantReadWriteLock.Sync.tryAcquireShared() protected final int tryAcquireShared(int unused) { Thread current = Thread.currentThread(); // çŠ¶æ€å˜é‡çš„å€¼  // åœ¨è¯»å†™é”æ¨¡å¼ä¸‹ï¼Œé«˜16ä½å­˜å‚¨çš„æ˜¯å…±äº«é”ï¼ˆè¯»é”ï¼‰è¢«è·å–çš„æ¬¡æ•°ï¼Œä½16ä½å­˜å‚¨çš„æ˜¯äº’æ–¥é”ï¼ˆå†™é”ï¼‰è¢«è·å–çš„æ¬¡æ•°  int c = getState(); // äº’æ–¥é”çš„æ¬¡æ•°  // å¦‚æœå…¶å®ƒçº¿ç¨‹è·å¾—äº†å†™é”ï¼Œç›´æ¥è¿”å›-1  if (exclusiveCount(c) != 0 \u0026amp;\u0026amp; getExclusiveOwnerThread() != current) return -1; // è¯»é”è¢«è·å–çš„æ¬¡æ•°  int r = sharedCount(c); // ä¸‹é¢è¯´æ˜æ­¤æ—¶è¿˜æ²¡æœ‰å†™é”ï¼Œå°è¯•å»æ›´æ–°stateçš„å€¼è·å–è¯»é”  // è¯»è€…æ˜¯å¦éœ€è¦æ’é˜Ÿï¼ˆæ˜¯å¦æ˜¯å…¬å¹³æ¨¡å¼ï¼‰  if (!readerShouldBlock() \u0026amp;\u0026amp; r \u0026lt; MAX_COUNT \u0026amp;\u0026amp; compareAndSetState(c, c + SHARED_UNIT)) { // è·å–è¯»é”æˆåŠŸ  if (r == 0) { // å¦‚æœä¹‹å‰è¿˜æ²¡æœ‰çº¿ç¨‹è·å–è¯»é”  // è®°å½•ç¬¬ä¸€ä¸ªè¯»è€…ä¸ºå½“å‰çº¿ç¨‹  firstReader = current; // ç¬¬ä¸€ä¸ªè¯»è€…é‡å…¥çš„æ¬¡æ•°ä¸º1  firstReaderHoldCount = 1; } else if (firstReader == current) { // å¦‚æœæœ‰çº¿ç¨‹è·å–äº†è¯»é”ä¸”æ˜¯å½“å‰çº¿ç¨‹æ˜¯ç¬¬ä¸€ä¸ªè¯»è€…  // åˆ™æŠŠå…¶é‡å…¥æ¬¡æ•°åŠ 1  firstReaderHoldCount++; } else { // å¦‚æœæœ‰çº¿ç¨‹è·å–äº†è¯»é”ä¸”å½“å‰çº¿ç¨‹ä¸æ˜¯ç¬¬ä¸€ä¸ªè¯»è€…  // åˆ™ä»ç¼“å­˜ä¸­è·å–é‡å…¥æ¬¡æ•°ä¿å­˜å™¨  HoldCounter rh = cachedHoldCounter; // å¦‚æœç¼“å­˜ä¸å±æ€§å½“å‰çº¿ç¨‹  // å†ä»ThreadLocalä¸­è·å–  // readHoldsæœ¬èº«æ˜¯ä¸€ä¸ªThreadLocalï¼Œé‡Œé¢å­˜å‚¨çš„æ˜¯HoldCounter  if (rh == null || rh.tid != getThreadId(current)) // get()çš„æ—¶å€™ä¼šåˆå§‹åŒ–rh  cachedHoldCounter = rh = readHolds.get(); else if (rh.count == 0) // å¦‚æœrhçš„æ¬¡æ•°ä¸º0ï¼ŒæŠŠå®ƒæ”¾åˆ°ThreadLocalä¸­å»  readHolds.set(rh); // é‡å…¥çš„æ¬¡æ•°åŠ 1ï¼ˆåˆå§‹æ¬¡æ•°ä¸º0ï¼‰  rh.count++; } // è·å–è¯»é”æˆåŠŸï¼Œè¿”å›1  return 1; } // é€šè¿‡è¿™ä¸ªæ–¹æ³•å†å»å°è¯•è·å–è¯»é”ï¼ˆå¦‚æœä¹‹å‰å…¶å®ƒçº¿ç¨‹è·å–äº†å†™é”ï¼Œä¸€æ ·è¿”å›-1è¡¨ç¤ºå¤±è´¥ï¼‰  return fullTryAcquireShared(current); } // AbstractQueuedSynchronizer.doAcquireShared() private void doAcquireShared(int arg) { // è¿›å…¥AQSçš„é˜Ÿåˆ—ä¸­  final Node node = addWaiter(Node.SHARED); boolean failed = true; try { boolean interrupted = false; for (;;) { // å½“å‰èŠ‚ç‚¹çš„å‰ä¸€ä¸ªèŠ‚ç‚¹  final Node p = node.predecessor(); // å¦‚æœå‰ä¸€ä¸ªèŠ‚ç‚¹æ˜¯å¤´èŠ‚ç‚¹ï¼ˆè¯´æ˜æ˜¯ç¬¬ä¸€ä¸ªæ’é˜Ÿçš„èŠ‚ç‚¹ï¼‰  if (p == head) { // å†æ¬¡å°è¯•è·å–è¯»é”  int r = tryAcquireShared(arg); // å¦‚æœæˆåŠŸäº†  if (r \u0026gt;= 0) { // å¤´èŠ‚ç‚¹åç§»å¹¶ä¼ æ’­  // ä¼ æ’­å³å”¤é†’åé¢è¿ç»­çš„è¯»èŠ‚ç‚¹  setHeadAndPropagate(node, r); p.next = null; // help GC  if (interrupted) selfInterrupt(); failed = false; return; } } // æ²¡è·å–åˆ°è¯»é”ï¼Œé˜»å¡å¹¶ç­‰å¾…è¢«å”¤é†’  if (shouldParkAfterFailedAcquire(p, node) \u0026amp;\u0026amp; parkAndCheckInterrupt()) interrupted = true; } } finally { if (failed) cancelAcquire(node); } } // AbstractQueuedSynchronizer.setHeadAndPropagate() private void setHeadAndPropagate(Node node, int propagate) { // hä¸ºæ—§çš„å¤´èŠ‚ç‚¹  Node h = head; // è®¾ç½®å½“å‰èŠ‚ç‚¹ä¸ºæ–°å¤´èŠ‚ç‚¹  setHead(node); // å¦‚æœæ—§çš„å¤´èŠ‚ç‚¹æˆ–æ–°çš„å¤´èŠ‚ç‚¹ä¸ºç©ºæˆ–è€…å…¶ç­‰å¾…çŠ¶æ€å°äº0ï¼ˆè¡¨ç¤ºçŠ¶æ€ä¸ºSIGNAL/PROPAGATEï¼‰  if (propagate \u0026gt; 0 || h == null || h.waitStatus \u0026lt; 0 || (h = head) == null || h.waitStatus \u0026lt; 0) { // éœ€è¦ä¼ æ’­  // å–ä¸‹ä¸€ä¸ªèŠ‚ç‚¹  Node s = node.next; // å¦‚æœä¸‹ä¸€ä¸ªèŠ‚ç‚¹ä¸ºç©ºï¼Œæˆ–è€…æ˜¯éœ€è¦è·å–è¯»é”çš„èŠ‚ç‚¹  if (s == null || s.isShared()) // å”¤é†’ä¸‹ä¸€ä¸ªèŠ‚ç‚¹  doReleaseShared(); } } // AbstractQueuedSynchronizer.doReleaseShared() // è¿™ä¸ªæ–¹æ³•åªä¼šå”¤é†’ä¸€ä¸ªèŠ‚ç‚¹ private void doReleaseShared() { for (;;) { Node h = head; if (h != null \u0026amp;\u0026amp; h != tail) { int ws = h.waitStatus; // å¦‚æœå¤´èŠ‚ç‚¹çŠ¶æ€ä¸ºSIGNALï¼Œè¯´æ˜è¦å”¤é†’ä¸‹ä¸€ä¸ªèŠ‚ç‚¹  if (ws == Node.SIGNAL) { if (!compareAndSetWaitStatus(h, Node.SIGNAL, 0)) continue; // loop to recheck cases  // å”¤é†’ä¸‹ä¸€ä¸ªèŠ‚ç‚¹  unparkSuccessor(h); } else if (ws == 0 \u0026amp;\u0026amp; // æŠŠå¤´èŠ‚ç‚¹çš„çŠ¶æ€æ”¹ä¸ºPROPAGATEæˆåŠŸæ‰ä¼šè·³åˆ°ä¸‹é¢çš„if  !compareAndSetWaitStatus(h, 0, Node.PROPAGATE)) continue; // loop on failed CAS  } // å¦‚æœå”¤é†’åheadæ²¡å˜ï¼Œåˆ™è·³å‡ºå¾ªç¯  if (h == head) // loop if head changed  break; } }   å†™é”æµç¨‹\n// java.util.concurrent.locks.ReentrantReadWriteLock.WriteLock.lock() public void lock() { sync.acquire(1); } // java.util.concurrent.locks.AbstractQueuedSynchronizer.acquire() public final void acquire(int arg) { // å…ˆå°è¯•è·å–é”  // å¦‚æœå¤±è´¥ï¼Œåˆ™ä¼šè¿›å…¥é˜Ÿåˆ—ä¸­æ’é˜Ÿï¼Œåé¢çš„é€»è¾‘è·ŸReentrantLockä¸€æ¨¡ä¸€æ ·äº†  if (!tryAcquire(arg) \u0026amp;\u0026amp; acquireQueued(addWaiter(Node.EXCLUSIVE), arg)) selfInterrupt(); } // java.util.concurrent.locks.ReentrantReadWriteLock.Sync.tryAcquire() protected final boolean tryAcquire(int acquires) { Thread current = Thread.currentThread(); // çŠ¶æ€å˜é‡stateçš„å€¼  int c = getState(); // äº’æ–¥é”è¢«è·å–çš„æ¬¡æ•°  int w = exclusiveCount(c); if (c != 0) { // å¦‚æœc!=0ä¸”w==0ï¼Œè¯´æ˜å…±äº«é”è¢«è·å–çš„æ¬¡æ•°ä¸ä¸º0  // è¿™å¥è¯æ•´ä¸ªçš„æ„æ€å°±æ˜¯  // å¦‚æœå…±äº«é”è¢«è·å–çš„æ¬¡æ•°ä¸ä¸º0ï¼Œæˆ–è€…è¢«å…¶å®ƒçº¿ç¨‹è·å–äº†äº’æ–¥é”ï¼ˆå†™é”ï¼‰  // é‚£ä¹ˆå°±è¿”å›falseï¼Œè·å–å†™é”å¤±è´¥  if (w == 0 || current != getExclusiveOwnerThread()) return false; // æº¢å‡ºæ£€æµ‹  if (w + exclusiveCount(acquires) \u0026gt; MAX_COUNT) throw new Error(\u0026#34;Maximum lock count exceeded\u0026#34;); // åˆ°è¿™é‡Œè¯´æ˜å½“å‰çº¿ç¨‹å·²ç»è·å–è¿‡å†™é”ï¼Œè¿™é‡Œæ˜¯é‡å…¥äº†ï¼Œç›´æ¥æŠŠstateåŠ 1å³å¯  setState(c + acquires); // è·å–å†™é”æˆåŠŸ  return true; } // å¦‚æœcç­‰äº0ï¼Œå°±å°è¯•æ›´æ–°stateçš„å€¼ï¼ˆéå…¬å¹³æ¨¡å¼writerShouldBlock()è¿”å›falseï¼‰  // å¦‚æœå¤±è´¥äº†ï¼Œè¯´æ˜è·å–å†™é”å¤±è´¥ï¼Œè¿”å›false  // å¦‚æœæˆåŠŸäº†ï¼Œè¯´æ˜è·å–å†™é”æˆåŠŸï¼ŒæŠŠè‡ªå·±è®¾ç½®ä¸ºå æœ‰è€…ï¼Œå¹¶è¿”å›true  if (writerShouldBlock() || !compareAndSetState(c, c + acquires)) return false; setExclusiveOwnerThread(current); return true; } // è·å–å†™é”å¤±è´¥äº†åé¢çš„é€»è¾‘è·ŸReentrantLockæ˜¯ä¸€è‡´çš„ï¼Œè¿›å…¥é˜Ÿåˆ—æ’é˜Ÿï¼Œè¿™é‡Œå°±ä¸åˆ—æºç äº†    æ€»ç»“\n  ï¼ˆ1ï¼‰ReentrantReadWriteLocké‡‡ç”¨è¯»å†™é”çš„æ€æƒ³ï¼Œèƒ½æé«˜å¹¶å‘çš„ååé‡ï¼›\nï¼ˆ2ï¼‰è¯»é”ä½¿ç”¨çš„æ˜¯å…±äº«é”ï¼Œå¤šä¸ªè¯»é”å¯ä»¥ä¸€èµ·è·å–é”ï¼Œäº’ç›¸ä¸ä¼šå½±å“ï¼Œå³è¯»è¯»ä¸äº’æ–¥ï¼›\nï¼ˆ3ï¼‰è¯»å†™ã€å†™è¯»å’Œå†™å†™æ˜¯ä¼šäº’æ–¥çš„ï¼Œå‰è€…å æœ‰ç€é”ï¼Œåè€…éœ€è¦è¿›å…¥AQSé˜Ÿåˆ—ä¸­æ’é˜Ÿï¼›\nï¼ˆ4ï¼‰å¤šä¸ªè¿ç»­çš„è¯»çº¿ç¨‹æ˜¯ä¸€ä¸ªæ¥ç€ä¸€ä¸ªè¢«å”¤é†’çš„ï¼Œè€Œä¸æ˜¯ä¸€æ¬¡æ€§å”¤é†’æ‰€æœ‰è¯»çº¿ç¨‹ï¼›\nï¼ˆ5ï¼‰åªæœ‰å¤šä¸ªè¯»é”éƒ½å®Œå…¨é‡Šæ”¾äº†æ‰ä¼šå”¤é†’ä¸‹ä¸€ä¸ªå†™çº¿ç¨‹ï¼›\nï¼ˆ6ï¼‰åªæœ‰å†™é”å®Œå…¨é‡Šæ”¾äº†æ‰ä¼šå”¤é†’ä¸‹ä¸€ä¸ªç­‰å¾…è€…ï¼Œè¿™ä¸ªç­‰å¾…è€…æœ‰å¯èƒ½æ˜¯è¯»çº¿ç¨‹ï¼Œä¹Ÿå¯èƒ½æ˜¯å†™çº¿ç¨‹ï¼›\n  åŒä¸€ä¸ªçº¿ç¨‹å…ˆå†™åè¯»ï¼Œæ˜¯ä»€ä¹ˆæƒ…å†µ\nä¼šé˜»å¡ï¼Œè·å–ä¸åˆ°è¯»çš„é”\n  åŒä¸€ä¸ªçº¿ç¨‹å…ˆè¯»åå†™\næ­£å¸¸\n  CASæ˜¯ä»€ä¹ˆï¼Œæ€ä¹ˆè§£å†³ABAé—®é¢˜ CASæ˜¯CPUçš„åŸå­æŒ‡ä»¤å™¨ï¼Œé€šè¿‡è‡ªé€‰çš„æ–¹å¼ï¼Œå±äºä¹è§‚é”ï¼Œä¸javaçš„æ‚²è§‚é”ç›¸æ¯”æ•ˆç‡æ›´é«˜ã€‚\nABAï¼Œåªçš„æ˜¯å¤šä¸ªçº¿ç¨‹åŒæ—¶åœ¨æ›´æ–°çš„æ—¶å€™ï¼Œä¾‹å¦‚Açº¿ç¨‹è¦æŠŠtargetå˜ä¸º1ï¼Œç›®å‰æ˜¯2ï¼ŒAè¯»åˆ°äº†2ï¼Œç„¶åä¿®æ”¹æˆ1åï¼Œåˆä¿®æ”¹æˆ2ï¼Œç„¶åBè¯»åˆ°äº†2ã€‚\nè§£å†³æ–¹å¼\n  ç‰ˆæœ¬å·ï¼š\nAtomicStampedReferenceï¼šç»´æŠ¤äº†ä¸€ä¸ªç‰ˆæœ¬å·\nAtomicMarkableReferenceï¼šç»´æŠ¤äº†ä¸€ä¸ªBooleanï¼Œæ ‡è®°æ˜¯å¦æ›´æ”¹è¿‡\n  ConcurrentHashMapçš„åˆ†æ®µé” ä½ ç”¨è¿‡å“ªäº›Java.util.concurrentä¸‹çš„ç±»   Semaphore\nSemaphoreï¼Œä¿¡å·é‡ï¼Œå®ƒä¿å­˜äº†ä¸€ç³»åˆ—çš„è®¸å¯ï¼ˆpermitsï¼‰ï¼Œæ¯æ¬¡è°ƒç”¨acquire()éƒ½å°†æ¶ˆè€—ä¸€ä¸ªè®¸å¯ï¼Œæ¯æ¬¡è°ƒç”¨release()éƒ½å°†å½’è¿˜ä¸€ä¸ªè®¸å¯ã€‚\nï¼ˆ1ï¼‰Semaphoreï¼Œä¹Ÿå«ä¿¡å·é‡ï¼Œé€šå¸¸ç”¨äºæ§åˆ¶åŒä¸€æ—¶åˆ»å¯¹å…±äº«èµ„æºçš„è®¿é—®ä¸Šï¼Œä¹Ÿå°±æ˜¯é™æµåœºæ™¯ï¼›\nï¼ˆ2ï¼‰Semaphoreçš„å†…éƒ¨å®ç°æ˜¯åŸºäºAQSçš„å…±äº«é”æ¥å®ç°çš„ï¼›\nï¼ˆ3ï¼‰Semaphoreåˆå§‹åŒ–çš„æ—¶å€™éœ€è¦æŒ‡å®šè®¸å¯çš„æ¬¡æ•°ï¼Œè®¸å¯çš„æ¬¡æ•°æ˜¯å­˜å‚¨åœ¨stateä¸­ï¼›\nï¼ˆ4ï¼‰è·å–ä¸€ä¸ªè®¸å¯æ—¶ï¼Œåˆ™stateå€¼å‡1ï¼›\nï¼ˆ5ï¼‰é‡Šæ”¾ä¸€ä¸ªè®¸å¯æ—¶ï¼Œåˆ™stateå€¼åŠ 1ï¼›\nï¼ˆ6ï¼‰å¯ä»¥åŠ¨æ€å‡å°‘nä¸ªè®¸å¯ï¼›\nï¼ˆ7ï¼‰å¯ä»¥åŠ¨æ€å¢åŠ nä¸ªè®¸å¯å—:è°ƒç”¨release(int permits)å³å¯ã€‚æˆ‘ä»¬çŸ¥é“é‡Šæ”¾è®¸å¯çš„æ—¶å€™stateçš„å€¼ä¼šç›¸åº”å¢åŠ ï¼Œå†å›å¤´çœ‹çœ‹é‡Šæ”¾è®¸å¯çš„æºç ï¼Œå‘ç°ä¸ReentrantLockçš„é‡Šæ”¾é”è¿˜æ˜¯æœ‰ç‚¹åŒºåˆ«çš„ï¼ŒSemaphoreé‡Šæ”¾è®¸å¯çš„æ—¶å€™å¹¶ä¸ä¼šæ£€æŸ¥å½“å‰çº¿ç¨‹æœ‰æ²¡æœ‰è·å–è¿‡è®¸å¯ï¼Œæ‰€ä»¥å¯ä»¥è°ƒç”¨é‡Šæ”¾è®¸å¯çš„æ–¹æ³•åŠ¨æ€å¢åŠ ä¸€äº›è®¸å¯ã€‚\n  CountDownLatch\nCountDownLatchï¼Œå¯ä»¥ç¿»è¯‘ä¸ºå€’è®¡æ—¶å™¨ï¼Œä½†æ˜¯ä¼¼ä¹ä¸å¤ªå‡†ç¡®ï¼Œå®ƒçš„å«ä¹‰æ˜¯å…è®¸ä¸€ä¸ªæˆ–å¤šä¸ªçº¿ç¨‹ç­‰å¾…å…¶å®ƒçº¿ç¨‹çš„æ“ä½œæ‰§è¡Œå®Œæ¯•åå†æ‰§è¡Œåç»­çš„æ“ä½œã€‚\nCountDownLatchçš„é€šå¸¸ç”¨æ³•å’ŒThread.join()æœ‰ç‚¹ç±»ä¼¼ï¼Œç­‰å¾…å…¶å®ƒçº¿ç¨‹éƒ½å®Œæˆåå†æ‰§è¡Œä¸»ä»»åŠ¡ã€‚\n  CyclicBarrier\nCyclicBarrierï¼Œå›ç¯æ …æ ï¼Œå®ƒä¼šé˜»å¡ä¸€ç»„çº¿ç¨‹ç›´åˆ°è¿™äº›çº¿ç¨‹åŒæ—¶è¾¾åˆ°æŸä¸ªæ¡ä»¶æ‰ç»§ç»­æ‰§è¡Œã€‚å®ƒä¸CountDownLatchå¾ˆç±»ä¼¼ï¼Œä½†åˆä¸åŒï¼ŒCountDownLatchéœ€è¦è°ƒç”¨countDown()æ–¹æ³•è§¦å‘äº‹ä»¶ï¼Œè€ŒCyclicBarrierä¸éœ€è¦ï¼Œå®ƒå°±åƒä¸€ä¸ªæ …æ ä¸€æ ·ï¼Œå½“ä¸€ç»„çº¿ç¨‹éƒ½åˆ°è¾¾äº†æ …æ å¤„æ‰ç»§ç»­å¾€ä¸‹èµ°ã€‚\npublic class CyclicBarrierTest { public static void main(String[] args) { CyclicBarrier cyclicBarrier = new CyclicBarrier(3); for (int i = 0; i \u0026lt; 3; i++) { new Thread(()-\u0026gt;{ System.out.println(\u0026#34;before\u0026#34;); try { cyclicBarrier.await(); } catch (InterruptedException e) { e.printStackTrace(); } catch (BrokenBarrierException e) { e.printStackTrace(); } System.out.println(\u0026#34;after\u0026#34;); }).start(); } } }   Phaser\nPhaserï¼Œç¿»è¯‘ä¸ºé˜¶æ®µï¼Œå®ƒé€‚ç”¨äºè¿™æ ·ä¸€ç§åœºæ™¯ï¼Œä¸€ä¸ªå¤§ä»»åŠ¡å¯ä»¥åˆ†ä¸ºå¤šä¸ªé˜¶æ®µå®Œæˆï¼Œä¸”æ¯ä¸ªé˜¶æ®µçš„ä»»åŠ¡å¯ä»¥å¤šä¸ªçº¿ç¨‹å¹¶å‘æ‰§è¡Œï¼Œä½†æ˜¯å¿…é¡»ä¸Šä¸€ä¸ªé˜¶æ®µçš„ä»»åŠ¡éƒ½å®Œæˆäº†æ‰å¯ä»¥æ‰§è¡Œä¸‹ä¸€ä¸ªé˜¶æ®µçš„ä»»åŠ¡ã€‚\nè¿™ç§åœºæ™¯è™½ç„¶ä½¿ç”¨CyclicBarrieræˆ–è€…CountryDownLatchä¹Ÿå¯ä»¥å®ç°ï¼Œä½†æ˜¯è¦å¤æ‚çš„å¤šã€‚é¦–å…ˆï¼Œå…·ä½“éœ€è¦å¤šå°‘ä¸ªé˜¶æ®µæ˜¯å¯èƒ½ä¼šå˜çš„ï¼Œå…¶æ¬¡ï¼Œæ¯ä¸ªé˜¶æ®µçš„ä»»åŠ¡æ•°ä¹Ÿå¯èƒ½ä¼šå˜çš„ã€‚ç›¸æ¯”äºCyclicBarrierå’ŒCountDownLatchï¼ŒPhaseræ›´åŠ çµæ´»æ›´åŠ æ–¹ä¾¿ã€‚\npublic class PhaserTest { public static final int PARTIES = 3; public static final int PHASES = 4; public static void main(String[] args) { Phaser phaser = new Phaser(PARTIES) { @Override protected boolean onAdvance(int phase, int registeredParties) { // ã€æœ¬ç¯‡æ–‡ç« ç”±å…¬ä¼—å·â€œå½¤å“¥è¯»æºç â€åŸåˆ›ï¼Œè¯·æ”¯æŒåŸåˆ›ï¼Œè°¢è°¢ï¼ã€‘  System.out.println(\u0026#34;=======phase: \u0026#34; + phase + \u0026#34; finished=============\u0026#34;); return super.onAdvance(phase, registeredParties); } }; for (int i = 0; i \u0026lt; PARTIES; i++) { new Thread(()-\u0026gt;{ for (int j = 0; j \u0026lt; PHASES; j++) { System.out.println(String.format(\u0026#34;%s: phase: %d\u0026#34;, Thread.currentThread().getName(), j)); phaser.arriveAndAwaitAdvance(); } }, \u0026#34;Thread \u0026#34; + i).start(); } } }   è®²ä¸€ä¸‹çº¿ç¨‹æ± çš„å‡ ä¸ªå‚æ•°å«ä¹‰ å®ƒæœ‰7ä¸ªå‚æ•°ï¼Œåˆ†åˆ«ä¸ºcorePoolSizeã€maximumPoolSizeã€keepAliveTimeã€unitã€workQueueã€threadFactoryã€handlerã€‚\n  corePoolSize\næ ¸å¿ƒçº¿ç¨‹æ•°ã€‚\nå½“æ­£åœ¨è¿è¡Œçš„çº¿ç¨‹æ•°å°äºæ ¸å¿ƒçº¿ç¨‹æ•°æ—¶ï¼Œæ¥ä¸€ä¸ªä»»åŠ¡å°±åˆ›å»ºä¸€ä¸ªæ ¸å¿ƒçº¿ç¨‹ï¼›\nå½“æ­£åœ¨è¿è¡Œçš„çº¿ç¨‹æ•°å¤§äºæˆ–ç­‰äºæ ¸å¿ƒçº¿ç¨‹æ•°æ—¶ï¼Œä»»åŠ¡æ¥äº†å…ˆä¸åˆ›å»ºçº¿ç¨‹è€Œæ˜¯ä¸¢åˆ°ä»»åŠ¡é˜Ÿåˆ—ä¸­ã€‚\n  maximumPoolSize\næœ€å¤§çº¿ç¨‹æ•°ã€‚\nå½“ä»»åŠ¡é˜Ÿåˆ—æ»¡äº†æ—¶ï¼Œæ¥ä¸€ä¸ªä»»åŠ¡æ‰åˆ›å»ºä¸€ä¸ªéæ ¸å¿ƒçº¿ç¨‹ï¼Œä½†ä¸èƒ½è¶…è¿‡æœ€å¤§çº¿ç¨‹æ•°ã€‚\n  keepAliveTime + unit\nçº¿ç¨‹ä¿æŒç©ºé—²æ—¶é—´åŠå•ä½ã€‚\né»˜è®¤æƒ…å†µä¸‹ï¼Œæ­¤ä¸¤å‚æ•°ä»…å½“æ­£åœ¨è¿è¡Œçš„çº¿ç¨‹æ•°å¤§äºæ ¸å¿ƒçº¿ç¨‹æ•°æ—¶æ‰æœ‰æ•ˆï¼Œå³åªé’ˆå¯¹éæ ¸å¿ƒçº¿ç¨‹ã€‚\nä½†æ˜¯ï¼Œå¦‚æœallowCoreThreadTimeOutè¢«è®¾ç½®æˆäº†trueï¼Œé’ˆå¯¹æ ¸å¿ƒçº¿ç¨‹ä¹Ÿæœ‰æ•ˆã€‚\nå³å½“ä»»åŠ¡é˜Ÿåˆ—ä¸ºç©ºæ—¶ï¼Œçº¿ç¨‹ä¿æŒå¤šä¹…æ‰ä¼šé”€æ¯ï¼Œå†…éƒ¨ä¸»è¦æ˜¯é€šè¿‡é˜»å¡é˜Ÿåˆ—å¸¦è¶…æ—¶çš„poll(timeout, unit)æ–¹æ³•å®ç°çš„ã€‚\n  workQueue\nä»»åŠ¡é˜Ÿåˆ—ã€‚\nå½“æ­£åœ¨è¿è¡Œçš„çº¿ç¨‹æ•°å¤§äºæˆ–ç­‰äºæ ¸å¿ƒçº¿ç¨‹æ•°æ—¶ï¼Œä»»åŠ¡æ¥äº†æ˜¯å…ˆè¿›å…¥ä»»åŠ¡é˜Ÿåˆ—ä¸­çš„ã€‚\nè¿™ä¸ªé˜Ÿåˆ—å¿…é¡»æ˜¯é˜»å¡é˜Ÿåˆ—ï¼Œæ‰€ä»¥åƒConcurrentLinkedQueueå°±ä¸èƒ½ä½œä¸ºå‚æ•°ï¼Œå› ä¸ºå®ƒè™½ç„¶æ˜¯å¹¶å‘å®‰å…¨çš„é˜Ÿåˆ—ï¼Œä½†æ˜¯å®ƒä¸æ˜¯é˜»å¡é˜Ÿåˆ—ã€‚\n  threadFactory\nçº¿ç¨‹å·¥å‚ã€‚\né»˜è®¤ä½¿ç”¨çš„æ˜¯Executorså·¥å…·ç±»ä¸­çš„DefaultThreadFactoryç±»ï¼Œè¿™ä¸ªç±»æœ‰ä¸ªç¼ºç‚¹ï¼Œåˆ›å»ºçš„çº¿ç¨‹çš„åç§°æ˜¯è‡ªåŠ¨ç”Ÿæˆçš„ï¼Œæ— æ³•è‡ªå®šä¹‰ä»¥åŒºåˆ†ä¸åŒçš„çº¿ç¨‹æ± ï¼Œä¸”å®ƒä»¬éƒ½æ˜¯éå®ˆæŠ¤çº¿ç¨‹ã€‚\n  handler\næ‹’ç»ç­–ç•¥ã€‚\næ‹’ç»ç­–ç•¥è¡¨ç¤ºå½“ä»»åŠ¡é˜Ÿåˆ—æ»¡äº†ä¸”çº¿ç¨‹æ•°ä¹Ÿè¾¾åˆ°æœ€å¤§äº†ï¼Œè¿™æ—¶å€™å†æ–°åŠ ä»»åŠ¡ï¼Œçº¿ç¨‹æ± å·²ç»æ— æ³•æ‰¿å—äº†ï¼Œè¿™äº›æ–°æ¥çš„ä»»åŠ¡åº”è¯¥æŒ‰ä»€ä¹ˆé€»è¾‘æ¥å¤„ç†ã€‚\nå¸¸ç”¨çš„æ‹’ç»ç­–ç•¥æœ‰ä¸¢å¼ƒå½“å‰ä»»åŠ¡ã€ä¸¢å¼ƒæœ€è€çš„ä»»åŠ¡ã€æŠ›å‡ºå¼‚å¸¸ã€è°ƒç”¨è€…è‡ªå·±å¤„ç†ç­‰å¾…ã€‚\né»˜è®¤çš„æ‹’ç»ç­–ç•¥æ˜¯æŠ›å‡ºå¼‚å¸¸ï¼Œå³çº¿ç¨‹æ± æ— æ³•æ‰¿è½½äº†ï¼Œè°ƒç”¨è€…å†å¾€é‡Œé¢æ·»åŠ ä»»åŠ¡ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚\né»˜è®¤çš„æ‹’ç»ç­–ç•¥è™½ç„¶æ¯”è¾ƒç®€å•ç²—æš´ï¼Œä½†æ˜¯ç›¸å¯¹äºä¸¢å¼ƒä»»åŠ¡ç­–ç•¥æ˜æ˜¾è¦å¥½å¾ˆå¤šï¼Œæœ€èµ·ç è°ƒç”¨è€…è‡ªå·±å¯ä»¥æ•è·è¿™ä¸ªå¼‚å¸¸å†è¿›è¡ŒäºŒæ¬¡å¤„ç†ã€‚\n  synchronizedå…³é”®å­—ï¼Œæ€ä¹ˆä¼˜åŒ–çš„ï¼Œè†¨èƒ€çš„æµç¨‹ ç®€ä»‹\nsynchronizedå…³é”®å­—æ˜¯Javaé‡Œé¢æœ€åŸºæœ¬çš„åŒæ­¥æ‰‹æ®µï¼Œå®ƒç»è¿‡ç¼–è¯‘ä¹‹åï¼Œä¼šåœ¨åŒæ­¥å—çš„å‰ååˆ†åˆ«ç”Ÿæˆ monitorenter å’Œ monitorexit å­—èŠ‚ç æŒ‡ä»¤ï¼Œè¿™ä¸¤ä¸ªå­—èŠ‚ç æŒ‡ä»¤éƒ½éœ€è¦ä¸€ä¸ªå¼•ç”¨ç±»å‹çš„å‚æ•°æ¥æŒ‡æ˜è¦é”å®šå’Œè§£é”çš„å¯¹è±¡ã€‚\nå®ç°åŸç†\nåœ¨å­¦ä¹ Javaå†…å­˜æ¨¡å‹çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä»‹ç»è¿‡ä¸¤ä¸ªæŒ‡ä»¤ï¼šlock å’Œ unlockã€‚\nlockï¼Œé”å®šï¼Œä½œç”¨äºä¸»å†…å­˜çš„å˜é‡ï¼Œå®ƒæŠŠä¸»å†…å­˜ä¸­çš„å˜é‡æ ‡è¯†ä¸ºä¸€æ¡çº¿ç¨‹ç‹¬å çŠ¶æ€ã€‚\nunlockï¼Œè§£é”ï¼Œä½œç”¨äºä¸»å†…å­˜çš„å˜é‡ï¼Œå®ƒæŠŠé”å®šçš„å˜é‡é‡Šæ”¾å‡ºæ¥ï¼Œé‡Šæ”¾å‡ºæ¥çš„å˜é‡æ‰å¯ä»¥è¢«å…¶å®ƒçº¿ç¨‹é”å®šã€‚\nä½†æ˜¯è¿™ä¸¤ä¸ªæŒ‡ä»¤å¹¶æ²¡æœ‰ç›´æ¥æä¾›ç»™ç”¨æˆ·ä½¿ç”¨ï¼Œè€Œæ˜¯æä¾›äº†ä¸¤ä¸ªæ›´é«˜å±‚æ¬¡çš„æŒ‡ä»¤ monitorenter å’Œ monitorexit æ¥éšå¼åœ°ä½¿ç”¨ lock å’Œ unlock æŒ‡ä»¤ã€‚\nè€Œ synchronized å°±æ˜¯ä½¿ç”¨ monitorenter å’Œ monitorexit è¿™ä¸¤ä¸ªæŒ‡ä»¤æ¥å®ç°çš„ã€‚\næ ¹æ®JVMè§„èŒƒçš„è¦æ±‚ï¼Œåœ¨æ‰§è¡ŒmonitorenteræŒ‡ä»¤çš„æ—¶å€™ï¼Œé¦–å…ˆè¦å»å°è¯•è·å–å¯¹è±¡çš„é”ï¼Œå¦‚æœè¿™ä¸ªå¯¹è±¡æ²¡æœ‰è¢«é”å®šï¼Œæˆ–è€…å½“å‰çº¿ç¨‹å·²ç»æ‹¥æœ‰äº†è¿™ä¸ªå¯¹è±¡çš„é”ï¼Œå°±æŠŠé”çš„è®¡æ•°å™¨åŠ 1ï¼Œç›¸åº”åœ°ï¼Œåœ¨æ‰§è¡Œmonitorexitçš„æ—¶å€™ä¼šæŠŠè®¡æ•°å™¨å‡1ï¼Œå½“è®¡æ•°å™¨å‡å°ä¸º0æ—¶ï¼Œé”å°±é‡Šæ”¾äº†ã€‚\n å‰é¢è®²è§£Javaå†…å­˜æ¨¡å‹çš„æ—¶å€™æˆ‘ä»¬è¯´è¿‡å†…å­˜æ¨¡å‹ä¸»è¦å°±æ˜¯ç”¨æ¥è§£å†³ç¼“å­˜ä¸€è‡´æ€§çš„é—®é¢˜çš„ï¼Œè€Œç¼“å­˜ä¸€è‡´æ€§ä¸»è¦åŒ…æ‹¬åŸå­æ€§ã€å¯è§æ€§ã€æœ‰åºæ€§ã€‚\né‚£ä¹ˆï¼Œsynchronizedå…³é”®å­—èƒ½å¦ä¿è¯è¿™ä¸‰ä¸ªç‰¹æ€§å‘¢ï¼Ÿ\nè¿˜æ˜¯å›åˆ°Javaå†…å­˜æ¨¡å‹ä¸Šæ¥ï¼Œsynchronizedå…³é”®å­—åº•å±‚æ˜¯é€šè¿‡monitorenterå’Œmonitorexitå®ç°çš„ï¼Œè€Œè¿™ä¸¤ä¸ªæŒ‡ä»¤åˆæ˜¯é€šè¿‡lockå’Œunlockæ¥å®ç°çš„ã€‚\nè€Œlockå’Œunlockåœ¨Javaå†…å­˜æ¨¡å‹ä¸­æ˜¯å¿…é¡»æ»¡è¶³ä¸‹é¢å››æ¡è§„åˆ™çš„ï¼š\nï¼ˆ1ï¼‰ä¸€ä¸ªå˜é‡åŒä¸€æ—¶åˆ»åªå…è®¸ä¸€æ¡çº¿ç¨‹å¯¹å…¶è¿›è¡Œlockæ“ä½œï¼Œä½†lockæ“ä½œå¯ä»¥è¢«åŒä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œå¤šæ¬¡ï¼Œå¤šæ¬¡æ‰§è¡Œlockåï¼Œåªæœ‰æ‰§è¡Œç›¸åŒæ¬¡æ•°çš„unlockæ“ä½œï¼Œå˜é‡æ‰èƒ½è¢«è§£é”ã€‚\nï¼ˆ2ï¼‰å¦‚æœå¯¹ä¸€ä¸ªå˜é‡æ‰§è¡Œlockæ“ä½œï¼Œå°†ä¼šæ¸…ç©ºå·¥ä½œå†…å­˜ä¸­æ­¤å˜é‡çš„å€¼ï¼Œåœ¨æ‰§è¡Œå¼•æ“ä½¿ç”¨è¿™ä¸ªå˜é‡å‰ï¼Œéœ€è¦é‡æ–°æ‰§è¡Œloadæˆ–assignæ“ä½œåˆå§‹åŒ–å˜é‡çš„å€¼ï¼›\nï¼ˆ3ï¼‰å¦‚æœä¸€ä¸ªå˜é‡æ²¡æœ‰è¢«lockæ“ä½œé”å®šï¼Œåˆ™ä¸å…è®¸å¯¹å…¶æ‰§è¡Œunlockæ“ä½œï¼Œä¹Ÿä¸å…è®¸unlockä¸€ä¸ªå…¶å®ƒçº¿ç¨‹é”å®šçš„å˜é‡ï¼›\nï¼ˆ4ï¼‰å¯¹ä¸€ä¸ªå˜é‡æ‰§è¡Œunlockæ“ä½œä¹‹å‰ï¼Œå¿…é¡»å…ˆæŠŠæ­¤å˜é‡åŒæ­¥å›ä¸»å†…å­˜ä¸­ï¼Œå³æ‰§è¡Œstoreå’Œwriteæ“ä½œï¼›\né€šè¿‡è§„åˆ™ï¼ˆ1ï¼‰ï¼Œæˆ‘ä»¬çŸ¥é“å¯¹äºlockå’Œunlockä¹‹é—´çš„ä»£ç ï¼ŒåŒä¸€æ—¶åˆ»åªå…è®¸ä¸€ä¸ªçº¿ç¨‹è®¿é—®ï¼Œæ‰€ä»¥ï¼Œsynchronizedæ˜¯å…·æœ‰åŸå­æ€§çš„ã€‚\né€šè¿‡è§„åˆ™ï¼ˆ1ï¼‰ï¼ˆ2ï¼‰å’Œï¼ˆ4ï¼‰ï¼Œæˆ‘ä»¬çŸ¥é“æ¯æ¬¡lockå’Œunlockæ—¶éƒ½ä¼šä»ä¸»å†…å­˜åŠ è½½å˜é‡æˆ–æŠŠå˜é‡åˆ·æ–°å›ä¸»å†…å­˜ï¼Œè€Œlockå’Œunlockä¹‹é—´çš„å˜é‡ï¼ˆè¿™é‡Œæ˜¯æŒ‡é”å®šçš„å˜é‡ï¼‰æ˜¯ä¸ä¼šè¢«å…¶å®ƒçº¿ç¨‹ä¿®æ”¹çš„ï¼Œæ‰€ä»¥ï¼Œsynchronizedæ˜¯å…·æœ‰å¯è§æ€§çš„ã€‚\né€šè¿‡è§„åˆ™ï¼ˆ1ï¼‰å’Œï¼ˆ3ï¼‰ï¼Œæˆ‘ä»¬çŸ¥é“æ‰€æœ‰å¯¹å˜é‡çš„åŠ é”éƒ½è¦æ’é˜Ÿè¿›è¡Œï¼Œä¸”å…¶å®ƒçº¿ç¨‹ä¸å…è®¸è§£é”å½“å‰çº¿ç¨‹é”å®šçš„å¯¹è±¡ï¼Œæ‰€ä»¥ï¼Œsynchronizedæ˜¯å…·æœ‰æœ‰åºæ€§çš„ã€‚\nç»¼ä¸Šæ‰€è¿°ï¼Œsynchronizedæ˜¯å¯ä»¥ä¿è¯åŸå­æ€§ã€å¯è§æ€§å’Œæœ‰åºæ€§çš„ã€‚\n ä¼˜åŒ–è¿‡ç¨‹ï¼š\nï¼ˆ1ï¼‰åå‘é”ï¼Œæ˜¯æŒ‡ä¸€æ®µåŒæ­¥ä»£ç ä¸€ç›´è¢«ä¸€ä¸ªçº¿ç¨‹è®¿é—®ï¼Œé‚£ä¹ˆè¿™ä¸ªçº¿ç¨‹ä¼šè‡ªåŠ¨è·å–é”ï¼Œé™ä½è·å–é”çš„ä»£ä»·ã€‚\nï¼ˆ2ï¼‰è½»é‡çº§é”ï¼Œæ˜¯æŒ‡å½“é”æ˜¯åå‘é”æ—¶ï¼Œè¢«å¦ä¸€ä¸ªçº¿ç¨‹æ‰€è®¿é—®ï¼Œåå‘é”ä¼šå‡çº§ä¸ºè½»é‡çº§é”ï¼Œè¿™ä¸ªçº¿ç¨‹ä¼šé€šè¿‡è‡ªæ—‹çš„æ–¹å¼å°è¯•è·å–é”ï¼Œä¸ä¼šé˜»å¡ï¼Œæé«˜æ€§èƒ½ã€‚\nï¼ˆ3ï¼‰é‡é‡çº§é”ï¼Œæ˜¯æŒ‡å½“é”æ˜¯è½»é‡çº§é”æ—¶ï¼Œå½“è‡ªæ—‹çš„çº¿ç¨‹è‡ªæ—‹äº†ä¸€å®šçš„æ¬¡æ•°åï¼Œè¿˜æ²¡æœ‰è·å–åˆ°é”ï¼Œå°±ä¼šè¿›å…¥é˜»å¡çŠ¶æ€ï¼Œè¯¥é”å‡çº§ä¸ºé‡é‡çº§é”ï¼Œé‡é‡çº§é”ä¼šä½¿å…¶ä»–çº¿ç¨‹é˜»å¡ï¼Œæ€§èƒ½é™ä½ã€‚\nvolatileå…³é”®å­— æˆ‘ä»¬è¯´è¿‡å¯è§æ€§æ˜¯æŒ‡å½“ä¸€ä¸ªçº¿ç¨‹ä¿®æ”¹äº†å…±äº«å˜é‡çš„å€¼ï¼Œå…¶å®ƒçº¿ç¨‹èƒ½ç«‹å³æ„ŸçŸ¥åˆ°è¿™ç§å˜åŒ–ã€‚è€Œæ™®é€šå˜é‡æ— æ³•åšåˆ°ç«‹å³æ„ŸçŸ¥è¿™ä¸€ç‚¹ï¼Œå˜é‡çš„å€¼åœ¨çº¿ç¨‹ä¹‹é—´çš„ä¼ é€’å‡éœ€è¦é€šè¿‡ä¸»å†…å­˜æ¥å®Œæˆï¼Œæ¯”å¦‚ï¼Œçº¿ç¨‹Aä¿®æ”¹äº†ä¸€ä¸ªæ™®é€šå˜é‡çš„å€¼ï¼Œç„¶åå‘ä¸»å†…å­˜å›å†™ï¼Œå¦å¤–ä¸€æ¡çº¿ç¨‹Båªæœ‰åœ¨çº¿ç¨‹Açš„å›å†™å®Œæˆä¹‹åå†ä»ä¸»å†…å­˜ä¸­è¯»å–å˜é‡çš„å€¼ï¼Œæ‰èƒ½å¤Ÿè¯»å–åˆ°æ–°å˜é‡çš„å€¼ï¼Œä¹Ÿå°±æ˜¯æ–°å˜é‡æ‰èƒ½å¯¹çº¿ç¨‹Bå¯è§ã€‚\njavaå†…å­˜æ¨¡å‹è§„å®šï¼Œvolatileå˜é‡çš„æ¯æ¬¡ä¿®æ”¹éƒ½å¿…é¡»ç«‹å³å›å†™åˆ°ä¸»å†…å­˜ä¸­ï¼Œvolatileå˜é‡çš„æ¯æ¬¡ä½¿ç”¨éƒ½å¿…é¡»ä»ä¸»å†…å­˜åˆ·æ–°æœ€æ–°çš„å€¼ã€‚\n  volatileå¯ä»¥ç¦æ­¢cpuè¯­æ„é‡æ’ï¼Œä¿è¯äº†æœ‰åºæ€§\n æ™®é€šå˜é‡ä»…ä»…ä¼šä¿è¯åœ¨è¯¥æ–¹æ³•çš„æ‰§è¡Œè¿‡ç¨‹ä¸­æ‰€æœ‰ä¾èµ–èµ‹å€¼ç»“æœçš„åœ°æ–¹éƒ½èƒ½è·å¾—æ­£ç¡®çš„ç»“æœï¼Œè€Œä¸èƒ½ä¿è¯å˜é‡èµ‹å€¼æ“ä½œçš„é¡ºåºä¸ç¨‹åºä»£ç ä¸­çš„æ‰§è¡Œé¡ºåºä¸€è‡´ï¼Œå› ä¸ºä¸€ä¸ªçº¿ç¨‹çš„æ–¹æ³•æ‰§è¡Œè¿‡ç¨‹ä¸­æ— æ³•æ„ŸçŸ¥åˆ°è¿™ç‚¹ï¼Œè¿™å°±æ˜¯â€œçº¿ç¨‹å†…è¡¨ç°ä¸ºä¸²è¡Œçš„è¯­ä¹‰â€\n public class VolatileTest3 { private static Config config = null; private static volatile boolean initialized = false; public static void main(String[] args) { // çº¿ç¨‹1è´Ÿè´£åˆå§‹åŒ–é…ç½®ä¿¡æ¯  new Thread(() -\u0026gt; { config = new Config(); config.name = \u0026#34;config\u0026#34;; initialized = true; }).start(); // çº¿ç¨‹2æ£€æµ‹åˆ°é…ç½®åˆå§‹åŒ–å®Œæˆåä½¿ç”¨é…ç½®ä¿¡æ¯  new Thread(() -\u0026gt; { while (!initialized) { LockSupport.parkNanos(TimeUnit.MILLISECONDS.toNanos(100)); } // do sth with config  String name = config.name; }).start(); } } class Config { String name; } åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå¦‚æœinitializedä¸ä½¿ç”¨volatileæ¥ä¿®é¥°ï¼Œå¯èƒ½å°±ä¼šå‡ºç°é‡æ’åºï¼Œæ¯”å¦‚åœ¨åˆå§‹åŒ–é…ç½®ä¹‹å‰æŠŠinitializedçš„å€¼è®¾ç½®ä¸ºäº†trueï¼Œè¿™æ ·çº¿ç¨‹2è¯»å–åˆ°è¿™ä¸ªå€¼ä¸ºtrueäº†ï¼Œå°±å»ä½¿ç”¨é…ç½®äº†ï¼Œè¿™æ—¶å€™å¯èƒ½å°±ä¼šå‡ºç°é”™è¯¯ã€‚\n  volatileæä¾›äº†å˜é‡çš„å¯è§æ€§\n  ç¼ºé™·ï¼Œæ— æ³•ä¿è¯åŸå­æ€§\n  Javaå†…å­˜æ¨¡å‹ ä»€ä¹ˆæ˜¯Javaå†…å­˜æ¨¡å‹ï¼Ÿ\nå¤šä¸ªç¼“å­˜è¯»å†™ä¸€è‡´æ€§ä»¥åŠä¹±åºæ’åºä¼˜åŒ–çš„é—®é¢˜ï¼Œè¿™å°±æœ‰äº†å†…å­˜æ¨¡å‹ï¼Œå®ƒå®šä¹‰äº†å…±äº«å†…å­˜ç³»ç»Ÿä¸­å¤šçº¿ç¨‹è¯»å†™æ“ä½œè¡Œä¸ºçš„è§„èŒƒã€‚\n Javaå†…å­˜æ¨¡å‹ï¼ˆJava Memory Modelï¼ŒJMMï¼‰æ˜¯åœ¨ç¡¬ä»¶å†…å­˜æ¨¡å‹åŸºç¡€ä¸Šæ›´é«˜å±‚çš„æŠ½è±¡ï¼Œå®ƒå±è”½äº†å„ç§ç¡¬ä»¶å’Œæ“ä½œç³»ç»Ÿå¯¹å†…å­˜è®¿é—®çš„å·®å¼‚æ€§ï¼Œä»è€Œå®ç°è®©Javaç¨‹åºåœ¨å„ç§å¹³å°ä¸‹éƒ½èƒ½è¾¾åˆ°ä¸€è‡´çš„å¹¶å‘æ•ˆæœã€‚\nJavaå†…å­˜æ¨¡å‹å®šä¹‰äº†ç¨‹åºä¸­å„ä¸ªå˜é‡çš„è®¿é—®è§„åˆ™ï¼Œå³åœ¨è™šæ‹Ÿæœºä¸­å°†å˜é‡å­˜å‚¨åˆ°å†…å­˜å’Œä»å†…å­˜ä¸­å–å‡ºè¿™æ ·çš„åº•å±‚ç»†èŠ‚ã€‚è¿™é‡Œæ‰€è¯´çš„å˜é‡åŒ…æ‹¬å®ä¾‹å­—æ®µã€é™æ€å­—æ®µï¼Œä½†ä¸åŒ…æ‹¬å±€éƒ¨å˜é‡å’Œæ–¹æ³•å‚æ•°ï¼Œå› ä¸ºå®ƒä»¬æ˜¯çº¿ç¨‹ç§æœ‰çš„ï¼Œå®ƒä»¬ä¸ä¼šè¢«å…±äº«ï¼Œè‡ªç„¶ä¸å­˜åœ¨ç«äº‰é—®é¢˜ã€‚\nä¸ºäº†è·å¾—æ›´å¥½çš„æ‰§è¡Œæ•ˆèƒ½ï¼ŒJavaå†…å­˜æ¨¡å‹å¹¶æ²¡æœ‰é™åˆ¶æ‰§è¡Œå¼•æ“ä½¿ç”¨å¤„ç†å™¨çš„ç‰¹å®šå¯„å­˜å™¨æˆ–ç¼“å­˜æ¥å’Œä¸»å†…å­˜è¿›è¡Œäº¤äº’ï¼Œä¹Ÿæ²¡æœ‰é™åˆ¶å³æ—¶ç¼–è¯‘å™¨è°ƒæ•´ä»£ç çš„æ‰§è¡Œé¡ºåºç­‰è¿™ç±»æƒåˆ©ã€‚\nJavaå†…å­˜æ¨¡å‹è§„å®šäº†æ‰€æœ‰çš„å˜é‡éƒ½å­˜å‚¨åœ¨ä¸»å†…å­˜ä¸­ï¼Œè¿™é‡Œçš„ä¸»å†…å­˜è·Ÿä»‹ç»ç¡¬ä»¶æ—¶æ‰€ç”¨çš„åå­—ä¸€æ ·ï¼Œä¸¤è€…å¯ä»¥ç±»æ¯”ï¼Œä½†æ­¤å¤„ä»…æŒ‡è™šæ‹Ÿæœºä¸­å†…å­˜çš„ä¸€éƒ¨åˆ†ã€‚\né™¤äº†ä¸»å†…å­˜ï¼Œæ¯æ¡çº¿ç¨‹è¿˜æœ‰è‡ªå·±çš„å·¥ä½œå†…å­˜ï¼Œæ­¤å¤„å¯ä¸CPUçš„é«˜é€Ÿç¼“å­˜è¿›è¡Œç±»æ¯”ã€‚å·¥ä½œå†…å­˜ä¸­ä¿å­˜ç€è¯¥çº¿ç¨‹ä½¿ç”¨åˆ°çš„å˜é‡çš„ä¸»å†…å­˜å‰¯æœ¬çš„æ‹·è´ï¼Œçº¿ç¨‹å¯¹å˜é‡çš„æ“ä½œéƒ½å¿…é¡»åœ¨å·¥ä½œå†…å­˜ä¸­è¿›è¡Œï¼ŒåŒ…æ‹¬è¯»å–å’Œèµ‹å€¼ç­‰ï¼Œè€Œä¸èƒ½ç›´æ¥è¯»å†™ä¸»å†…å­˜ä¸­çš„å˜é‡ï¼Œä¸åŒçš„çº¿ç¨‹ä¹‹é—´ä¹Ÿæ— æ³•ç›´æ¥è®¿é—®å¯¹æ–¹å·¥ä½œå†…å­˜ä¸­çš„å˜é‡ï¼Œçº¿ç¨‹é—´å˜é‡å€¼çš„ä¼ é€’å¿…é¡»é€šè¿‡ä¸»å†…å­˜æ¥å®Œæˆã€‚\n Javaå†…å­˜æ¨¡å‹è§„å®šäº†æ‰€æœ‰çš„å˜é‡éƒ½å­˜å‚¨åœ¨ä¸»å†…å­˜ä¸­ï¼Œè¿™é‡Œçš„ä¸»å†…å­˜è·Ÿä»‹ç»ç¡¬ä»¶æ—¶æ‰€ç”¨çš„åå­—ä¸€æ ·ï¼Œä¸¤è€…å¯ä»¥ç±»æ¯”ï¼Œä½†æ­¤å¤„ä»…æŒ‡è™šæ‹Ÿæœºä¸­å†…å­˜çš„ä¸€éƒ¨åˆ†ã€‚\né™¤äº†ä¸»å†…å­˜ï¼Œæ¯æ¡çº¿ç¨‹è¿˜æœ‰è‡ªå·±çš„å·¥ä½œå†…å­˜ï¼Œæ­¤å¤„å¯ä¸CPUçš„é«˜é€Ÿç¼“å­˜è¿›è¡Œç±»æ¯”ã€‚å·¥ä½œå†…å­˜ä¸­ä¿å­˜ç€è¯¥çº¿ç¨‹ä½¿ç”¨åˆ°çš„å˜é‡çš„ä¸»å†…å­˜å‰¯æœ¬çš„æ‹·è´ï¼Œçº¿ç¨‹å¯¹å˜é‡çš„æ“ä½œéƒ½å¿…é¡»åœ¨å·¥ä½œå†…å­˜ä¸­è¿›è¡Œï¼ŒåŒ…æ‹¬è¯»å–å’Œèµ‹å€¼ç­‰ï¼Œè€Œä¸èƒ½ç›´æ¥è¯»å†™ä¸»å†…å­˜ä¸­çš„å˜é‡ï¼Œä¸åŒçš„çº¿ç¨‹ä¹‹é—´ä¹Ÿæ— æ³•ç›´æ¥è®¿é—®å¯¹æ–¹å·¥ä½œå†…å­˜ä¸­çš„å˜é‡ï¼Œçº¿ç¨‹é—´å˜é‡å€¼çš„ä¼ é€’å¿…é¡»é€šè¿‡ä¸»å†…å­˜æ¥å®Œæˆã€‚\n Javaå†…å­˜æ¨¡å‹å°±æ˜¯ä¸ºäº†è§£å†³å¤šçº¿ç¨‹ç¯å¢ƒä¸‹å…±äº«å˜é‡çš„ä¸€è‡´æ€§é—®é¢˜ï¼Œé‚£ä¹ˆä¸€è‡´æ€§åŒ…å«å“ªäº›å†…å®¹å‘¢ï¼Ÿ\nä¸€è‡´æ€§ä¸»è¦åŒ…å«ä¸‰å¤§ç‰¹æ€§ï¼šåŸå­æ€§ã€å¯è§æ€§ã€æœ‰åºæ€§ï¼Œä¸‹é¢æˆ‘ä»¬å°±æ¥çœ‹çœ‹Javaå†…å­˜æ¨¡å‹æ˜¯æ€ä¹ˆå®ç°è¿™ä¸‰å¤§ç‰¹æ€§çš„ã€‚\nï¼ˆ1ï¼‰åŸå­æ€§\nåŸå­æ€§æ˜¯æŒ‡ä¸€æ®µæ“ä½œä¸€æ—¦å¼€å§‹å°±ä¼šä¸€ç›´è¿è¡Œåˆ°åº•ï¼Œä¸­é—´ä¸ä¼šè¢«å…¶å®ƒçº¿ç¨‹æ‰“æ–­ï¼Œè¿™æ®µæ“ä½œå¯ä»¥æ˜¯ä¸€ä¸ªæ“ä½œï¼Œä¹Ÿå¯ä»¥æ˜¯å¤šä¸ªæ“ä½œã€‚\nç”±Javaå†…å­˜æ¨¡å‹æ¥ç›´æ¥ä¿è¯çš„åŸå­æ€§æ“ä½œåŒ…æ‹¬readã€loadã€userã€assignã€storeã€writeè¿™ä¸¤ä¸ªæ“ä½œï¼Œæˆ‘ä»¬å¯ä»¥å¤§è‡´è®¤ä¸ºåŸºæœ¬ç±»å‹å˜é‡çš„è¯»å†™æ˜¯å…·å¤‡åŸå­æ€§çš„ã€‚\nå¦‚æœåº”ç”¨éœ€è¦ä¸€ä¸ªæ›´å¤§èŒƒå›´çš„åŸå­æ€§ï¼ŒJavaå†…å­˜æ¨¡å‹è¿˜æä¾›äº†lockå’Œunlockè¿™ä¸¤ä¸ªæ“ä½œæ¥æ»¡è¶³è¿™ç§éœ€æ±‚ï¼Œå°½ç®¡ä¸èƒ½ç›´æ¥ä½¿ç”¨è¿™ä¸¤ä¸ªæ“ä½œï¼Œä½†æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å®ƒä»¬æ›´å…·ä½“çš„å®ç°synchronizedæ¥å®ç°ã€‚\nå› æ­¤ï¼Œsynchronizedå—ä¹‹é—´çš„æ“ä½œä¹Ÿæ˜¯åŸå­æ€§çš„ã€‚\nï¼ˆ2ï¼‰å¯è§æ€§\nå¯è§æ€§æ˜¯æŒ‡å½“ä¸€ä¸ªçº¿ç¨‹ä¿®æ”¹äº†å…±äº«å˜é‡çš„å€¼ï¼Œå…¶å®ƒçº¿ç¨‹èƒ½ç«‹å³æ„ŸçŸ¥åˆ°è¿™ç§å˜åŒ–ã€‚\nJavaå†…å­˜æ¨¡å‹æ˜¯é€šè¿‡åœ¨å˜æ›´ä¿®æ”¹ååŒæ­¥å›ä¸»å†…å­˜ï¼Œåœ¨å˜é‡è¯»å–å‰ä»ä¸»å†…å­˜åˆ·æ–°å˜é‡å€¼æ¥å®ç°çš„ï¼Œå®ƒæ˜¯ä¾èµ–ä¸»å†…å­˜çš„ï¼Œæ— è®ºæ˜¯æ™®é€šå˜é‡è¿˜æ˜¯volatileå˜é‡éƒ½æ˜¯å¦‚æ­¤ã€‚\næ™®é€šå˜é‡ä¸volatileå˜é‡çš„ä¸»è¦åŒºåˆ«æ˜¯æ˜¯å¦ä¼šåœ¨ä¿®æ”¹ä¹‹åç«‹å³åŒæ­¥å›ä¸»å†…å­˜ï¼Œä»¥åŠæ˜¯å¦åœ¨æ¯æ¬¡è¯»å–å‰ç«‹å³ä»ä¸»å†…å­˜åˆ·æ–°ã€‚å› æ­¤æˆ‘ä»¬å¯ä»¥è¯´volatileå˜é‡ä¿è¯äº†å¤šçº¿ç¨‹ç¯å¢ƒä¸‹å˜é‡çš„å¯è§æ€§ï¼Œä½†æ™®é€šå˜é‡ä¸èƒ½ä¿è¯è¿™ä¸€ç‚¹ã€‚\né™¤äº†volatileä¹‹å¤–ï¼Œè¿˜æœ‰ä¸¤ä¸ªå…³é”®å­—ä¹Ÿå¯ä»¥ä¿è¯å¯è§æ€§ï¼Œå®ƒä»¬æ˜¯synchronizedå’Œfinalã€‚\nsynchronizedçš„å¯è§æ€§æ˜¯ç”±â€œå¯¹ä¸€ä¸ªå˜é‡æ‰§è¡Œunlockæ“ä½œä¹‹å‰ï¼Œå¿…é¡»å…ˆæŠŠæ­¤å˜é‡åŒæ­¥å›ä¸»å†…å­˜ä¸­ï¼Œå³æ‰§è¡Œstoreå’Œwriteæ“ä½œâ€è¿™æ¡è§„åˆ™è·å–çš„ã€‚\nfinalçš„å¯è§æ€§æ˜¯æŒ‡è¢«finalä¿®é¥°çš„å­—æ®µåœ¨æ„é€ å™¨ä¸­ä¸€æ—¦è¢«åˆå§‹åŒ–å®Œæˆï¼Œé‚£ä¹ˆå…¶å®ƒçº¿ç¨‹ä¸­å°±èƒ½çœ‹è§è¿™ä¸ªfinalå­—æ®µäº†ã€‚\nï¼ˆ3ï¼‰æœ‰åºæ€§\nJavaç¨‹åºä¸­å¤©ç„¶çš„æœ‰åºæ€§å¯ä»¥æ€»ç»“ä¸ºä¸€å¥è¯ï¼šå¦‚æœåœ¨æœ¬çº¿ç¨‹ä¸­è§‚å¯Ÿï¼Œæ‰€æœ‰çš„æ“ä½œéƒ½æ˜¯æœ‰åºçš„ï¼›å¦‚æœåœ¨å¦ä¸€ä¸ªçº¿ç¨‹ä¸­è§‚å¯Ÿï¼Œæ‰€æœ‰çš„æ“ä½œéƒ½æ˜¯æ— åºçš„ã€‚\nå‰åŠå¥æ˜¯æŒ‡çº¿ç¨‹å†…è¡¨ç°ä¸ºä¸²è¡Œçš„è¯­ä¹‰ï¼ŒååŠå¥æ˜¯æŒ‡â€œæŒ‡ä»¤é‡æ’åºâ€ç°è±¡å’Œâ€œå·¥ä½œå†…å­˜å’Œä¸»å†…å­˜åŒæ­¥å»¶è¿Ÿâ€ç°è±¡ã€‚\nJavaä¸­æä¾›äº†volatileå’Œsynchronizedä¸¤ä¸ªå…³é”®å­—æ¥ä¿è¯æœ‰åºæ€§ã€‚\nvolatileå¤©ç„¶å°±å…·æœ‰æœ‰åºæ€§ï¼Œå› ä¸ºå…¶ç¦æ­¢é‡æ’åºã€‚\nsynchronizedçš„æœ‰åºæ€§æ˜¯ç”±â€œä¸€ä¸ªå˜é‡åŒä¸€æ—¶åˆ»åªå…è®¸ä¸€æ¡çº¿ç¨‹å¯¹å…¶è¿›è¡Œlockæ“ä½œâ€è¿™æ¡è§„åˆ™è·å–çš„ã€‚\n ThreadLocal JavaåŸºç¡€ è¯´ä¸‹Javaçš„åŸºæœ¬ç±»å‹   byte/8bit/1B\n  char/16Bit/2B\n  short/16Bit/2B\n  int/32Bit/4B\n  float/32Bit/4B\n  long/64Bit/8B\n  double/64Bit/8B\n  boolen/~\n boolean åªæœ‰ä¸¤ä¸ªå€¼ï¼štrueã€falseï¼Œå¯ä»¥ä½¿ç”¨ 1 bit æ¥å­˜å‚¨ï¼Œä½†æ˜¯å…·ä½“å¤§å°æ²¡æœ‰æ˜ç¡®è§„å®šã€‚JVM ä¼šåœ¨ç¼–è¯‘æ—¶æœŸå°† boolean ç±»å‹çš„æ•°æ®è½¬æ¢ä¸º intï¼Œä½¿ç”¨ 1 æ¥è¡¨ç¤º trueï¼Œ0 è¡¨ç¤º falseã€‚JVM æ”¯æŒ boolean æ•°ç»„ï¼Œä½†æ˜¯æ˜¯é€šè¿‡è¯»å†™ byte æ•°ç»„æ¥å®ç°çš„ã€‚\n   è‡ªåŠ¨æ‹†åŒ…ç®±\nInteger x = 2; // è£…ç®± è°ƒç”¨äº† Integer.valueOf(2) int y = x; // æ‹†ç®± è°ƒç”¨äº† X.intValue() å‚è€ƒ\nInteger a = 300; Integer b = 300; System.out.println(a == b);//è¿”å›falseï¼Œå› ==æ¯”è¾ƒçš„æ˜¯å¯¹è±¡çš„åœ°å€  Integer a = 127; Integer b = 127; System.out.println(a == b);//è¿”å›trueï¼Œå› javaé»˜è®¤ç¼“å­˜äº†-128åˆ°127ä¹‹é—´çš„å€¼    ç¼“å­˜æ± \nnew Integer(123) ä¸ Integer.valueOf(123) çš„åŒºåˆ«åœ¨äºï¼š\n new Integer(123) æ¯æ¬¡éƒ½ä¼šæ–°å»ºä¸€ä¸ªå¯¹è±¡ï¼› Integer.valueOf(123) ä¼šä½¿ç”¨ç¼“å­˜æ± ä¸­çš„å¯¹è±¡ï¼Œå¤šæ¬¡è°ƒç”¨ä¼šå–å¾—åŒä¸€ä¸ªå¯¹è±¡çš„å¼•ç”¨ã€‚  Integer x = new Integer(123); Integer y = new Integer(123); System.out.println(x == y); // false Integer z = Integer.valueOf(123); Integer k = Integer.valueOf(123); System.out.println(z == k); // true valueOf() æ–¹æ³•çš„å®ç°æ¯”è¾ƒç®€å•ï¼Œå°±æ˜¯å…ˆåˆ¤æ–­å€¼æ˜¯å¦åœ¨ç¼“å­˜æ± ä¸­ï¼Œå¦‚æœåœ¨çš„è¯å°±ç›´æ¥è¿”å›ç¼“å­˜æ± çš„å†…å®¹ã€‚\npublic static Integer valueOf(int i) { if (i \u0026gt;= IntegerCache.low \u0026amp;\u0026amp; i \u0026lt;= IntegerCache.high) return IntegerCache.cache[i + (-IntegerCache.low)]; return new Integer(i); }   é‡è½½å’Œé‡å†™  é‡å†™æ˜¯ä½¿ç”¨æ³¨è§£@Overrideé‡å†™çˆ¶ç±»çš„æ–¹æ³• é‡è½½æ˜¯åŒä¸€ä¸ªç±»ï¼Œç›¸åŒæ–¹æ³•åï¼Œä½†æ˜¯å‚æ•°ä¸ªæ•°ï¼Œç±»å‹ï¼Œé¡ºåºï¼Œæœ‰ä¸€ä¸ªä¸ä¸€æ ·ã€‚è¿”å›å€¼ç±»å‹å¯ä»¥ä¸€æ ·å¯ä»¥ä¸ä¸€æ ·  è®²ä¸€ä¸‹String String è¢«å£°æ˜ä¸º finalï¼Œå› æ­¤å®ƒä¸å¯è¢«ç»§æ‰¿ã€‚(Integer ç­‰åŒ…è£…ç±»ä¹Ÿä¸èƒ½è¢«ç»§æ‰¿ï¼‰\nåœ¨ Java 8 ä¸­ï¼ŒString å†…éƒ¨ä½¿ç”¨ char æ•°ç»„å­˜å‚¨æ•°æ®ã€‚\npublic final class String implements java.io.Serializable, Comparable\u0026lt;String\u0026gt;, CharSequence { /** The value is used for character storage. */ private final char value[]; } åœ¨ Java 9 ä¹‹åï¼ŒString ç±»çš„å®ç°æ”¹ç”¨ byte æ•°ç»„å­˜å‚¨å­—ç¬¦ä¸²ï¼ŒåŒæ—¶ä½¿ç”¨ coder æ¥æ ‡è¯†ä½¿ç”¨äº†å“ªç§ç¼–ç ã€‚\npublic final class String implements java.io.Serializable, Comparable\u0026lt;String\u0026gt;, CharSequence { /** The value is used for character storage. */ private final byte[] value; /** The identifier of the encoding used to encode the bytes in {@code value}. */ private final byte coder; } value æ•°ç»„è¢«å£°æ˜ä¸º finalï¼Œè¿™æ„å‘³ç€ value æ•°ç»„åˆå§‹åŒ–ä¹‹åå°±ä¸èƒ½å†å¼•ç”¨å…¶å®ƒæ•°ç»„ã€‚å¹¶ä¸” String å†…éƒ¨æ²¡æœ‰æ”¹å˜ value æ•°ç»„çš„æ–¹æ³•ï¼Œå› æ­¤å¯ä»¥ä¿è¯ String ä¸å¯å˜ã€‚\n String Pool  å­—ç¬¦ä¸²å¸¸é‡æ± ï¼ˆString Poolï¼‰ä¿å­˜ç€æ‰€æœ‰å­—ç¬¦ä¸²å­—é¢é‡ï¼ˆliteral stringsï¼‰ï¼Œè¿™äº›å­—é¢é‡åœ¨ç¼–è¯‘æ—¶æœŸå°±ç¡®å®šã€‚ä¸ä»…å¦‚æ­¤ï¼Œè¿˜å¯ä»¥ä½¿ç”¨ String çš„ intern() æ–¹æ³•åœ¨è¿è¡Œè¿‡ç¨‹å°†å­—ç¬¦ä¸²æ·»åŠ åˆ° String Pool ä¸­ã€‚\nå½“ä¸€ä¸ªå­—ç¬¦ä¸²è°ƒç”¨ intern() æ–¹æ³•æ—¶ï¼Œå¦‚æœ String Pool ä¸­å·²ç»å­˜åœ¨ä¸€ä¸ªå­—ç¬¦ä¸²å’Œè¯¥å­—ç¬¦ä¸²å€¼ç›¸ç­‰ï¼ˆä½¿ç”¨ equals() æ–¹æ³•è¿›è¡Œç¡®å®šï¼‰ï¼Œé‚£ä¹ˆå°±ä¼šè¿”å› String Pool ä¸­å­—ç¬¦ä¸²çš„å¼•ç”¨ï¼›å¦åˆ™ï¼Œå°±ä¼šåœ¨ String Pool ä¸­æ·»åŠ ä¸€ä¸ªæ–°çš„å­—ç¬¦ä¸²ï¼Œå¹¶è¿”å›è¿™ä¸ªæ–°å­—ç¬¦ä¸²çš„å¼•ç”¨ã€‚\nä¸‹é¢ç¤ºä¾‹ä¸­ï¼Œs1 å’Œ s2 é‡‡ç”¨ new String() çš„æ–¹å¼æ–°å»ºäº†ä¸¤ä¸ªä¸åŒå­—ç¬¦ä¸²ï¼Œè€Œ s3 å’Œ s4 æ˜¯é€šè¿‡ s1.intern() å’Œ s2.intern() æ–¹æ³•å–å¾—åŒä¸€ä¸ªå­—ç¬¦ä¸²å¼•ç”¨ã€‚intern() é¦–å…ˆæŠŠ \u0026ldquo;aaa\u0026rdquo; æ”¾åˆ° String Pool ä¸­ï¼Œç„¶åè¿”å›è¿™ä¸ªå­—ç¬¦ä¸²å¼•ç”¨ï¼Œå› æ­¤ s3 å’Œ s4 å¼•ç”¨çš„æ˜¯åŒä¸€ä¸ªå­—ç¬¦ä¸²ã€‚\nString s1 = new String(\u0026#34;aaa\u0026#34;); String s2 = new String(\u0026#34;aaa\u0026#34;); System.out.println(s1 == s2); // false String s3 = s1.intern(); String s4 = s2.intern(); System.out.println(s3 == s4); // true å¦‚æœæ˜¯é‡‡ç”¨ \u0026ldquo;bbb\u0026rdquo; è¿™ç§å­—é¢é‡çš„å½¢å¼åˆ›å»ºå­—ç¬¦ä¸²ï¼Œä¼šè‡ªåŠ¨åœ°å°†å­—ç¬¦ä¸²æ”¾å…¥ String Pool ä¸­ã€‚\nString s5 = \u0026#34;bbb\u0026#34;; String s6 = \u0026#34;bbb\u0026#34;; System.out.println(s5 == s6); // true   new String(\u0026ldquo;abc\u0026rdquo;)\nä½¿ç”¨è¿™ç§æ–¹å¼ä¸€å…±ä¼šåˆ›å»ºä¸¤ä¸ªå­—ç¬¦ä¸²å¯¹è±¡ï¼ˆå‰ææ˜¯ String Pool ä¸­è¿˜æ²¡æœ‰ \u0026ldquo;abc\u0026rdquo; å­—ç¬¦ä¸²å¯¹è±¡ï¼‰ã€‚\n \u0026ldquo;abc\u0026rdquo; å±äºå­—ç¬¦ä¸²å­—é¢é‡ï¼Œå› æ­¤ç¼–è¯‘æ—¶æœŸä¼šåœ¨ String Pool ä¸­åˆ›å»ºä¸€ä¸ªå­—ç¬¦ä¸²å¯¹è±¡ï¼ŒæŒ‡å‘è¿™ä¸ª \u0026ldquo;abc\u0026rdquo; å­—ç¬¦ä¸²å­—é¢é‡ï¼› è€Œä½¿ç”¨ new çš„æ–¹å¼ä¼šåœ¨å †ä¸­åˆ›å»ºä¸€ä¸ªå­—ç¬¦ä¸²å¯¹è±¡ã€‚  åˆ›å»ºä¸€ä¸ªæµ‹è¯•ç±»ï¼Œå…¶ main æ–¹æ³•ä¸­ä½¿ç”¨è¿™ç§æ–¹å¼æ¥åˆ›å»ºå­—ç¬¦ä¸²å¯¹è±¡ã€‚\npublic class NewStringTest { public static void main(String[] args) { String s = new String(\u0026#34;abc\u0026#34;); } }   è®²ä¸€ä¸‹final  finalå£°æ˜çš„æ•°æ®ä¸ºå¸¸é‡ï¼Œåˆå§‹åŒ–åä¸å¯ä»¥è¢«æ›´æ”¹ å¯¹äºåŸºæœ¬ç±»å‹ï¼Œfinalå£°æ˜çš„å˜é‡ï¼Œå€¼ä¸å¯ä»¥è¢«æ›´æ”¹ å¯¹äºå¼•ç”¨ç±»å‹ï¼Œfinalå£°æ˜çš„å˜é‡ï¼Œå¼•ç”¨ä¸å¯ä»¥è¢«æ›´æ”¹ï¼Œä¹Ÿå°±æ˜¯ä¸èƒ½å¼•ç”¨å…¶ä»–å¯¹è±¡ï¼Œä½†æ˜¯è¢«å¼•ç”¨çš„å¯¹è±¡æœ¬èº«å¯ä»¥ä¿®æ”¹ finalä¿®é¥°çš„æ–¹æ³•ï¼Œä¸èƒ½è¢«å­ç±»é‡å†™ finalä¿®é¥°çš„ç±»ï¼Œä¸èƒ½è¢«ç»§æ‰¿  è®²ä¸€ä¸‹Static   staticä¿®é¥°çš„å˜é‡å«é™æ€å˜é‡ï¼Œè¿™ä¸ªå˜é‡å±äºè¿™ä¸ªç±»ï¼Œç±»çš„æ‰€æœ‰éƒ½å…±äº«å˜é‡ï¼Œå¯ä»¥é€šè¿‡ç±»åç›´æ¥è®¿é—®ä»–ï¼Œæ•´ä¸ªå†…å­˜ä¸­åªå­˜åœ¨ä¸€ä»½ï¼Œåœ¨jvmæ–¹æ³•åŒºçš„é™æ€å¸¸é‡æ± é‡Œ\n  staticä¿®é¥°çš„æ–¹æ³•å«é™æ€æ–¹æ³•ï¼Œå®ƒä¸ä¾èµ–äºä»»ä½•å®ä¾‹ï¼Œæ‰€ä»¥é™æ€æ–¹æ³•å¿…é¡»è¦æœ‰å®ç°ï¼Œä¹Ÿå°±æ˜¯ä¸èƒ½abstractï¼Œå†…éƒ¨ä¹Ÿåªèƒ½è®¿é—®é™æ€å­—æ®µå’Œé™æ€æ–¹æ³•ï¼Œæ–¹æ³•ä¸­ä¸èƒ½æœ‰thisæˆ–è€…superå…³é”®å­—ï¼Œå› ä¸ºè¿™ä¸¤ä¸ªå…³é”®å­—ä¸å…·ä½“çš„å¯¹è±¡å…³è”\n  staticä¿®é¥°çš„ä»£ç å—ï¼Œåªä¼šåœ¨ç±»åˆå§‹åŒ–çš„æ—¶å€™æ‰§è¡Œä¸€æ¬¡\n  staticä¿®é¥°çš„å†…éƒ¨ç±»æ˜¯é™æ€å†…éƒ¨ç±»ï¼Œéé™æ€å†…éƒ¨ç±»ä¾èµ–äºå¤–éƒ¨ç±»çš„å®ä¾‹ï¼Œä¹Ÿå°±æ˜¯è¦å…ˆåˆ›å»ºå¤–éƒ¨ç±»çš„å®ä¾‹æ‰å¯ä»¥ç”¨è¿™ä¸ªå®ä¾‹å»åˆ›å»ºéé™æ€å†…éƒ¨ç±»ï¼Œè€Œé™æ€å†…éƒ¨ç±»ä¸éœ€è¦ã€‚é™æ€å†…éƒ¨ç±»ä¸èƒ½è®¿é—®å¤–éƒ¨ç±»çš„éé™æ€çš„å˜é‡å’Œæ–¹æ³•\npublic class OuterClass { class InnerClass { } static class StaticInnerClass { } public static void main(String[] args) { // InnerClass innerClass = new InnerClass(); // \u0026#39;OuterClass.this\u0026#39; cannot be referenced from a static context  OuterClass outerClass = new OuterClass(); InnerClass innerClass = outerClass.new InnerClass(); StaticInnerClass staticInnerClass = new StaticInnerClass(); } }   å­˜åœ¨ç»§æ‰¿çš„æƒ…å†µä¸‹ï¼Œåˆå§‹åŒ–é¡ºåºä¸ºï¼š\n çˆ¶ç±»ï¼ˆé™æ€å˜é‡ã€é™æ€è¯­å¥å—ï¼‰ å­ç±»ï¼ˆé™æ€å˜é‡ã€é™æ€è¯­å¥å—ï¼‰ çˆ¶ç±»ï¼ˆå®ä¾‹å˜é‡ã€æ™®é€šè¯­å¥å—ï¼‰ çˆ¶ç±»ï¼ˆæ„é€ å‡½æ•°ï¼‰ å­ç±»ï¼ˆå®ä¾‹å˜é‡ã€æ™®é€šè¯­å¥å—ï¼‰ å­ç±»ï¼ˆæ„é€ å‡½æ•°ï¼‰    è®²ä¸€ä¸‹equalså’ŒhashCodeä»¥åŠclone   equals\nç­‰ä»·ä¸ç›¸ç­‰\n å¯¹äºåŸºæœ¬ç±»å‹ï¼Œ== åˆ¤æ–­ä¸¤ä¸ªå€¼æ˜¯å¦ç›¸ç­‰ï¼ŒåŸºæœ¬ç±»å‹æ²¡æœ‰ equals() æ–¹æ³•ã€‚ å¯¹äºå¼•ç”¨ç±»å‹ï¼Œ== åˆ¤æ–­ä¸¤ä¸ªå˜é‡æ˜¯å¦å¼•ç”¨åŒä¸€ä¸ªå¯¹è±¡ï¼Œè€Œ equals() åˆ¤æ–­å¼•ç”¨çš„å¯¹è±¡æ˜¯å¦ç­‰ä»·ã€‚  //é‡å†™ public class EqualExample { private int x; private int y; private int z; public EqualExample(int x, int y, int z) { this.x = x; this.y = y; this.z = z; } @Override public boolean equals(Object o) { if (this == o) return true; if (o == null || getClass() != o.getClass()) return false; EqualExample that = (EqualExample) o; if (x != that.x) return false; if (y != that.y) return false; return z == that.z; } }   hashCode\nhashCode() è¿”å›å“ˆå¸Œå€¼ï¼Œè€Œ equals() æ˜¯ç”¨æ¥åˆ¤æ–­ä¸¤ä¸ªå¯¹è±¡æ˜¯å¦ç­‰ä»·ã€‚ç­‰ä»·çš„ä¸¤ä¸ªå¯¹è±¡æ•£åˆ—å€¼ä¸€å®šç›¸åŒï¼Œä½†æ˜¯æ•£åˆ—å€¼ç›¸åŒçš„ä¸¤ä¸ªå¯¹è±¡ä¸ä¸€å®šç­‰ä»·ï¼Œè¿™æ˜¯å› ä¸ºè®¡ç®—å“ˆå¸Œå€¼å…·æœ‰éšæœºæ€§ï¼Œä¸¤ä¸ªå€¼ä¸åŒçš„å¯¹è±¡å¯èƒ½è®¡ç®—å‡ºç›¸åŒçš„å“ˆå¸Œå€¼ã€‚\næ‰€ä»¥åœ¨è¦†ç›– equals() æ–¹æ³•æ—¶åº”å½“æ€»æ˜¯è¦†ç›– hashCode() æ–¹æ³•ï¼Œä¿è¯ç­‰ä»·çš„ä¸¤ä¸ªå¯¹è±¡å“ˆå¸Œå€¼ä¹Ÿç›¸ç­‰ã€‚\nHashSet å’Œ HashMap ç­‰é›†åˆç±»ä½¿ç”¨äº† hashCode() æ–¹æ³•æ¥è®¡ç®—å¯¹è±¡åº”è¯¥å­˜å‚¨çš„ä½ç½®ï¼Œå› æ­¤è¦å°†å¯¹è±¡æ·»åŠ åˆ°è¿™äº›é›†åˆç±»ä¸­ï¼Œéœ€è¦è®©å¯¹åº”çš„ç±»å®ç° hashCode() æ–¹æ³•ã€‚\n  clone\nclone() æ˜¯ Object çš„ protected æ–¹æ³•ï¼Œå®ƒä¸æ˜¯ publicï¼Œä¸€ä¸ªç±»ä¸æ˜¾å¼å»é‡å†™ clone()ï¼Œå…¶å®ƒç±»å°±ä¸èƒ½ç›´æ¥å»è°ƒç”¨è¯¥ç±»å®ä¾‹çš„ clone() æ–¹æ³•ã€‚\npublic class CloneExample { private int a; private int b; }\tCloneExample e1 = new CloneExample(); // CloneExample e2 = e1.clone(); // \u0026#39;clone()\u0026#39; has protected access in \u0026#39;java.lang.Object\u0026#39; é‡å†™ clone() å¾—åˆ°ä»¥ä¸‹å®ç°ï¼š\npublic class CloneExample { private int a; private int b; @Override public CloneExample clone() throws CloneNotSupportedException { return (CloneExample)super.clone(); } } CloneExample e1 = new CloneExample(); try { CloneExample e2 = e1.clone(); } catch (CloneNotSupportedException e) { e.printStackTrace(); } java.lang.CloneNotSupportedException: CloneExample ä»¥ä¸ŠæŠ›å‡ºäº† CloneNotSupportedExceptionï¼Œè¿™æ˜¯å› ä¸º CloneExample æ²¡æœ‰å®ç° Cloneable æ¥å£ã€‚\nåº”è¯¥æ³¨æ„çš„æ˜¯ï¼Œclone() æ–¹æ³•å¹¶ä¸æ˜¯ Cloneable æ¥å£çš„æ–¹æ³•ï¼Œè€Œæ˜¯ Object çš„ä¸€ä¸ª protected æ–¹æ³•ã€‚Cloneable æ¥å£åªæ˜¯è§„å®šï¼Œå¦‚æœä¸€ä¸ªç±»æ²¡æœ‰å®ç° Cloneable æ¥å£åˆè°ƒç”¨äº† clone() æ–¹æ³•ï¼Œå°±ä¼šæŠ›å‡º CloneNotSupportedExceptionã€‚\npublic class CloneExample implements Cloneable { private int a; private int b; @Override public Object clone() throws CloneNotSupportedException { return super.clone(); } }   å¦‚ä½•å®ç°æµ…æ‹·è´å’Œæ·±æ‹·è´   æµ…æ‹·è´\næ‹·è´å¯¹è±¡å’ŒåŸå§‹å¯¹è±¡çš„å¼•ç”¨ç±»å‹å¼•ç”¨åŒä¸€ä¸ªå¯¹è±¡ã€‚\n  æ·±æ‹·è´\næ‹·è´å¯¹è±¡å’ŒåŸå§‹å¯¹è±¡çš„å¼•ç”¨ç±»å‹å¼•ç”¨ä¸åŒå¯¹è±¡ã€‚\n  æ›¿ä»£cloneçš„æ–¹æ³•\né‡å†™ä¸€ä¸ªå·¥å‚æ„é€ æ–¹æ³•\nç”¨ObjectInputStremå’ŒObjectOutputStream\n  javaé™å®šç¬¦ Java ä¸­æœ‰ä¸‰ä¸ªè®¿é—®æƒé™ä¿®é¥°ç¬¦ï¼šprivateã€protected ä»¥åŠ publicï¼Œå¦‚æœä¸åŠ è®¿é—®ä¿®é¥°ç¬¦ï¼Œè¡¨ç¤ºåŒ…çº§å¯è§ã€‚\nå¯ä»¥å¯¹ç±»æˆ–ç±»ä¸­çš„æˆå‘˜ï¼ˆå­—æ®µå’Œæ–¹æ³•ï¼‰åŠ ä¸Šè®¿é—®ä¿®é¥°ç¬¦ã€‚\n ç±»å¯è§è¡¨ç¤ºå…¶å®ƒç±»å¯ä»¥ç”¨è¿™ä¸ªç±»åˆ›å»ºå®ä¾‹å¯¹è±¡ã€‚ æˆå‘˜å¯è§è¡¨ç¤ºå…¶å®ƒç±»å¯ä»¥ç”¨è¿™ä¸ªç±»çš„å®ä¾‹å¯¹è±¡è®¿é—®åˆ°è¯¥æˆå‘˜ï¼›  æ¥å£å’ŒæŠ½è±¡ç±»   æŠ½è±¡ç±»\næŠ½è±¡ç±»å’ŒæŠ½è±¡æ–¹æ³•éƒ½ä½¿ç”¨ abstract å…³é”®å­—è¿›è¡Œå£°æ˜ã€‚å¦‚æœä¸€ä¸ªç±»ä¸­åŒ…å«æŠ½è±¡æ–¹æ³•ï¼Œé‚£ä¹ˆè¿™ä¸ªç±»å¿…é¡»å£°æ˜ä¸ºæŠ½è±¡ç±»ã€‚\næŠ½è±¡ç±»å’Œæ™®é€šç±»æœ€å¤§çš„åŒºåˆ«æ˜¯ï¼ŒæŠ½è±¡ç±»ä¸èƒ½è¢«å®ä¾‹åŒ–ï¼Œåªèƒ½è¢«ç»§æ‰¿ã€‚\n  æ¥å£\næ¥å£æ˜¯æŠ½è±¡ç±»çš„å»¶ä¼¸ï¼Œåœ¨ Java 8 ä¹‹å‰ï¼Œå®ƒå¯ä»¥çœ‹æˆæ˜¯ä¸€ä¸ªå®Œå…¨æŠ½è±¡çš„ç±»ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒä¸èƒ½æœ‰ä»»ä½•çš„æ–¹æ³•å®ç°ã€‚\nä» Java 8 å¼€å§‹ï¼Œæ¥å£ä¹Ÿå¯ä»¥æ‹¥æœ‰é»˜è®¤çš„æ–¹æ³•å®ç°ï¼Œè¿™æ˜¯å› ä¸ºä¸æ”¯æŒé»˜è®¤æ–¹æ³•çš„æ¥å£çš„ç»´æŠ¤æˆæœ¬å¤ªé«˜äº†ã€‚åœ¨ Java 8 ä¹‹å‰ï¼Œå¦‚æœä¸€ä¸ªæ¥å£æƒ³è¦æ·»åŠ æ–°çš„æ–¹æ³•ï¼Œé‚£ä¹ˆè¦ä¿®æ”¹æ‰€æœ‰å®ç°äº†è¯¥æ¥å£çš„ç±»ï¼Œè®©å®ƒä»¬éƒ½å®ç°æ–°å¢çš„æ–¹æ³•ã€‚\næ¥å£çš„æˆå‘˜ï¼ˆå­—æ®µ + æ–¹æ³•ï¼‰é»˜è®¤éƒ½æ˜¯ public çš„ï¼Œå¹¶ä¸”ä¸å…è®¸å®šä¹‰ä¸º private æˆ–è€… protectedã€‚ä» Java 9 å¼€å§‹ï¼Œå…è®¸å°†æ–¹æ³•å®šä¹‰ä¸º privateï¼Œè¿™æ ·å°±èƒ½å®šä¹‰æŸäº›å¤ç”¨çš„ä»£ç åˆä¸ä¼šæŠŠæ–¹æ³•æš´éœ²å‡ºå»ã€‚\næ¥å£çš„å­—æ®µé»˜è®¤éƒ½æ˜¯ static å’Œ final çš„ã€‚\n  æ¯”è¾ƒ\n ä»è®¾è®¡å±‚é¢ä¸Šçœ‹ï¼ŒæŠ½è±¡ç±»æä¾›äº†ä¸€ç§ IS-A å…³ç³»ï¼Œéœ€è¦æ»¡è¶³é‡Œå¼æ›¿æ¢åŸåˆ™ï¼Œå³å­ç±»å¯¹è±¡å¿…é¡»èƒ½å¤Ÿæ›¿æ¢æ‰æ‰€æœ‰çˆ¶ç±»å¯¹è±¡ã€‚è€Œæ¥å£æ›´åƒæ˜¯ä¸€ç§ LIKE-A å…³ç³»ï¼Œå®ƒåªæ˜¯æä¾›ä¸€ç§æ–¹æ³•å®ç°å¥‘çº¦ï¼Œå¹¶ä¸è¦æ±‚æ¥å£å’Œå®ç°æ¥å£çš„ç±»å…·æœ‰ IS-A å…³ç³»ã€‚ ä»ä½¿ç”¨ä¸Šæ¥çœ‹ï¼Œä¸€ä¸ªç±»å¯ä»¥å®ç°å¤šä¸ªæ¥å£ï¼Œä½†æ˜¯ä¸èƒ½ç»§æ‰¿å¤šä¸ªæŠ½è±¡ç±»ã€‚ æ¥å£çš„å­—æ®µåªèƒ½æ˜¯ static å’Œ final ç±»å‹çš„ï¼Œè€ŒæŠ½è±¡ç±»çš„å­—æ®µæ²¡æœ‰è¿™ç§é™åˆ¶ã€‚ æ¥å£çš„æˆå‘˜åªèƒ½æ˜¯ public çš„ï¼Œè€ŒæŠ½è±¡ç±»çš„æˆå‘˜å¯ä»¥æœ‰å¤šç§è®¿é—®æƒé™ã€‚    è¯´ä¸€è¯´ä½ ç†è§£çš„å¤šæ€  å®ç°å¤šæ€çš„å¿…è¦æ¡ä»¶ï¼š  ç»§æ‰¿ é‡å†™ çˆ¶ç±»å¼•ç”¨æŒ‡å‘å­ç±»å¯¹è±¡ï¼šParent p = new Child();   é‡å†™ã€æ¥å£ã€æŠ½è±¡ç±»å’ŒæŠ½è±¡æ–¹æ³• å¤šæ€å®é™…ä¸Šå°±æ˜¯ä¸€ç§äº‹ç‰©çš„ä¸åŒä½“ç°ï¼Œä¾‹å¦‚åŒæ ·çš„humanå¯¹è±¡ï¼Œå®ç°å¯ä»¥æ˜¯womenä¹Ÿå¯ä»¥æ˜¯manï¼Œè¿™å°±æ˜¯å¤šæ€  è®²ä¸€ä¸‹æ³›å‹å’Œæ³¨è§£   æ³¨è§£å°±æ˜¯ä»£ç ä¸­çš„ç‰¹æ®Šæ ‡è®°ï¼Œè¿™äº›æ ‡è®°å¯ä»¥åœ¨ç¼–è¯‘ã€ç±»åŠ è½½ã€è¿è¡Œæ—¶è¢«è¯»å–ï¼Œå¹¶æ‰§è¡Œç›¸å¯¹åº”çš„å¤„ç†\n  å¼€å‘ä¸­ç”¨åˆ°äº†å“ªäº›æ³¨è§£ï¼Ÿ\næˆ‘ç”¨åˆ°Springç‰¹åˆ«å¤šï¼Œå¸¸è§çš„@Controllerï¼Œ@Paramï¼Œ@Serviceï¼Œæœ‰çš„é¡¹ç›®ä¼šç”¨åˆ°lombokæ³¨è§£ï¼Œ@Dataï¼Œ@Slf4jç­‰ã€‚javaåŸç”Ÿä¹Ÿæœ‰@Overriedï¼Œ@Deprecatedï¼Œ@FunctionalInterfaceï¼ŒjavaåŸç”Ÿçš„æ³¨è§£å¤šç”¨äºæ ‡è®°å’Œæ£€æŸ¥ã€‚\né™¤äº†è¿™äº›åŸºæœ¬æ³¨è§£ï¼Œè¿˜æœ‰ä¸€ä¸ªæ³¨è§£å«å…ƒæ³¨è§£ï¼Œç”¨äºæè¿°æ³¨è§£çš„æ³¨è§£ã€‚å¸¸è§çš„æœ‰@Retention,@Targetã€‚@Retentionç”¨äºè®¾ç½®æ³¨è§£çš„ç”Ÿå‘½å‘¨æœŸï¼Œ@Targetç”¨äºè®¾ç½®æ³¨è§£çš„ä¿®é¥°åœ°æ–¹ï¼Œä¾‹å¦‚ç±»ã€æ–¹æ³•ã€å‚æ•°ï¼Œæˆå‘˜å˜é‡ç­‰\n @Retentionæ³¨è§£ä¼ å…¥çš„æ˜¯RetentionPolicyæšä¸¾ï¼Œè¯¥æšä¸¾æœ‰ä¸‰ä¸ªå¸¸é‡ï¼Œåˆ†åˆ«æ˜¯SOURCEã€CLASSå’ŒRUNTIMEï¼ŒSOURCEä»£è¡¨ç€æ³¨è§£ä»…ä¿ç•™åœ¨æºçº§åˆ«ä¸­ï¼Œå¹¶ç”±ç¼–è¯‘å™¨å¿½ç•¥ã€‚CLASSä»£è¡¨ç€æ³¨è§£åœ¨ç¼–è¯‘æ—¶ç”±ç¼–è¯‘å™¨ä¿ç•™ï¼Œä½†Javaè™šæ‹Ÿæœºï¼ˆJVMï¼‰ä¼šå¿½ç•¥ã€‚RUNTIMEä»£è¡¨ç€æ ‡è®°çš„æ³¨è§£ä¼šç”±JVMä¿ç•™ï¼Œå› æ­¤è¿è¡Œæ—¶ç¯å¢ƒå¯ä»¥ä½¿ç”¨å®ƒã€‚   ä»ä¸Šé¢çš„å›¾å¯ä»¥å‘ç°æœ‰ä¸ªã€Œæ³¨è§£æŠ½è±¡è¯­æ³•æ ‘ã€ï¼Œè¿™é‡Œå…¶å®å°±ä¼šå»è§£ææ³¨è§£ï¼Œç„¶ååšå¤„ç†çš„é€»è¾‘ã€‚å¦‚æœä½ æƒ³è¦åœ¨ç¼–è¯‘æœŸé—´å¤„ç†æ³¨è§£ç›¸å…³çš„é€»è¾‘ï¼Œä½ éœ€è¦ç»§æ‰¿AbstractProcessor å¹¶å®ç°processæ–¹æ³•ã€‚æ¯”å¦‚å¯ä»¥çœ‹åˆ°lombokå°±ç”¨AnnotationProcessorç»§æ‰¿äº†AbstractProcessorã€‚lombokçš„å®ç°åŸç†å°±æ˜¯åœ¨è¿™ï¼ˆä¸ºä»€ä¹ˆä½¿ç”¨äº†ä¸ª@Dataè¿™æ ·çš„æ³¨è§£å°±èƒ½æœ‰set/getç­‰æ–¹æ³•äº†ï¼Œå°±æ˜¯åœ¨è¿™é‡ŒåŠ ä¸Šå»çš„ï¼‰    æ³›å‹å°±æ˜¯åœ¨åˆ›å»ºå¯¹è±¡æˆ–è€…è°ƒç”¨æ–¹æ³•æ—¶æ‰æ˜ç¡®å…·ä½“çš„ç±»å‹ï¼Œä½¿ç”¨æ³›å‹çš„å¥½å¤„å°±æ˜¯ä»£ç æ›´åŠ ç®€æ´ï¼ˆä¸å†éœ€è¦å¼ºåˆ¶è½¬æ¢ï¼‰ï¼Œç¨‹åºæ›´åŠ å¥å£®ï¼ˆåœ¨ç¼–è¯‘æœŸé—´æ²¡æœ‰è­¦å‘Šï¼Œåœ¨è¿è¡ŒæœŸå°±ä¸ä¼šå‡ºç°ClassCastExceptionå¼‚å¸¸ï¼‰ï¼Œå†æ˜ç¡®ä¸€ä¸‹æ³›å‹å°±æ˜¯ã€Œåœ¨åˆ›å»ºå¯¹è±¡æˆ–è°ƒç”¨æ–¹æ³•çš„æ—¶å€™æ‰æ˜ç¡®ä¸‹å…·ä½“çš„ç±»å‹ã€ï¼Œè€Œç»„ä»¶ä¸ºäº†åšåˆ°è¶³å¤Ÿçš„é€šç”¨æ€§ï¼Œæ˜¯ä¸çŸ¥é“ã€Œç”¨æˆ·ã€ä¼ å…¥ä»€ä¹ˆç±»å‹å‚æ•°è¿›æ¥çš„ï¼Œæ‰€ä»¥åœ¨è¿™ç§æƒ…å†µä¸‹ç”¨æ³›å‹å°±æ˜¯å¾ˆå¥½çš„å®è·µã€‚\nä¸€èˆ¬ä¼šä½¿ç”¨åå°„+æ³›å‹ç»„åˆä½¿ç”¨\n  è®²ä¸€ä¸‹åå°„å’ŒåŠ¨æ€ä»£ç†   åå°„ï¼šç®€å•è¯´åå°„å°±æ˜¯Javaå¯ä»¥ç»™æˆ‘ä»¬åœ¨è¿è¡Œæ—¶è·å–ç±»çš„ä¿¡æ¯ï¼Œæ ¸å¿ƒæ˜¯åœ¨è¿è¡Œæ—¶ã€‚\nè¿è¡Œæ—¶æŒ‡çš„å°±æ˜¯æˆ‘ä»¬åœ¨ç¼–è¯‘å™¨å†™çš„ä»£ç æ˜¯ .java æ–‡ä»¶ï¼Œç»è¿‡javac ç¼–è¯‘ä¼šå˜æˆ .class æ–‡ä»¶ï¼Œclass æ–‡ä»¶ä¼šè¢«JVMè£…è½½è¿è¡Œï¼ˆè¿™é‡Œå°±æ˜¯çœŸæ­£è¿è¡Œç€æˆ‘ä»¬æ‰€å†™çš„ä»£ç ï¼ˆè™½ç„¶æ˜¯è¢«ç¼–è¯‘è¿‡çš„ï¼‰ï¼Œä¹Ÿå°±æ‰€è°“çš„è¿è¡Œæ—¶ã€‚\nè·å–ç±»çš„åŸä¿¡æ¯ï¼Œå­—æ®µå’Œæ–¹æ³•ç”¨çš„æ¯”è¾ƒå¤š\n æ¯ä¸ªç±»éƒ½æœ‰ä¸€ä¸ª Class å¯¹è±¡ï¼ŒåŒ…å«äº†ä¸ç±»æœ‰å…³çš„ä¿¡æ¯ã€‚å½“ç¼–è¯‘ä¸€ä¸ªæ–°ç±»æ—¶ï¼Œä¼šäº§ç”Ÿä¸€ä¸ªåŒåçš„ .class æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶å†…å®¹ä¿å­˜ç€ Class å¯¹è±¡ã€‚\nç±»åŠ è½½ç›¸å½“äº Class å¯¹è±¡çš„åŠ è½½ï¼Œç±»åœ¨ç¬¬ä¸€æ¬¡ä½¿ç”¨æ—¶æ‰åŠ¨æ€åŠ è½½åˆ° JVM ä¸­ã€‚ä¹Ÿå¯ä»¥ä½¿ç”¨ Class.forName(\u0026quot;com.mysql.jdbc.Driver\u0026quot;) è¿™ç§æ–¹å¼æ¥æ§åˆ¶ç±»çš„åŠ è½½ï¼Œè¯¥æ–¹æ³•ä¼šè¿”å›ä¸€ä¸ª Class å¯¹è±¡ã€‚\nåå°„å¯ä»¥æä¾›è¿è¡Œæ—¶çš„ç±»ä¿¡æ¯ï¼Œå¹¶ä¸”è¿™ä¸ªç±»å¯ä»¥åœ¨è¿è¡Œæ—¶æ‰åŠ è½½è¿›æ¥ï¼Œç”šè‡³åœ¨ç¼–è¯‘æ—¶æœŸè¯¥ç±»çš„ .class ä¸å­˜åœ¨ä¹Ÿå¯ä»¥åŠ è½½è¿›æ¥ã€‚\nClass å’Œ java.lang.reflect ä¸€èµ·å¯¹åå°„æä¾›äº†æ”¯æŒï¼Œjava.lang.reflect ç±»åº“ä¸»è¦åŒ…å«äº†ä»¥ä¸‹ä¸‰ä¸ªç±»ï¼š\n Field ï¼šå¯ä»¥ä½¿ç”¨ get() å’Œ set() æ–¹æ³•è¯»å–å’Œä¿®æ”¹ Field å¯¹è±¡å…³è”çš„å­—æ®µï¼› Method ï¼šå¯ä»¥ä½¿ç”¨ invoke() æ–¹æ³•è°ƒç”¨ä¸ Method å¯¹è±¡å…³è”çš„æ–¹æ³•ï¼› Constructor ï¼šå¯ä»¥ç”¨ Constructor çš„ newInstance() åˆ›å»ºæ–°çš„å¯¹è±¡ã€‚  åå°„çš„ä¼˜ç‚¹ï¼š\n å¯æ‰©å±•æ€§ ï¼šåº”ç”¨ç¨‹åºå¯ä»¥åˆ©ç”¨å…¨é™å®šååˆ›å»ºå¯æ‰©å±•å¯¹è±¡çš„å®ä¾‹ï¼Œæ¥ä½¿ç”¨æ¥è‡ªå¤–éƒ¨çš„ç”¨æˆ·è‡ªå®šä¹‰ç±»ã€‚ ç±»æµè§ˆå™¨å’Œå¯è§†åŒ–å¼€å‘ç¯å¢ƒ ï¼šä¸€ä¸ªç±»æµè§ˆå™¨éœ€è¦å¯ä»¥æšä¸¾ç±»çš„æˆå‘˜ã€‚å¯è§†åŒ–å¼€å‘ç¯å¢ƒï¼ˆå¦‚ IDEï¼‰å¯ä»¥ä»åˆ©ç”¨åå°„ä¸­å¯ç”¨çš„ç±»å‹ä¿¡æ¯ä¸­å—ç›Šï¼Œä»¥å¸®åŠ©ç¨‹åºå‘˜ç¼–å†™æ­£ç¡®çš„ä»£ç ã€‚ è°ƒè¯•å™¨å’Œæµ‹è¯•å·¥å…· ï¼š è°ƒè¯•å™¨éœ€è¦èƒ½å¤Ÿæ£€æŸ¥ä¸€ä¸ªç±»é‡Œçš„ç§æœ‰æˆå‘˜ã€‚æµ‹è¯•å·¥å…·å¯ä»¥åˆ©ç”¨åå°„æ¥è‡ªåŠ¨åœ°è°ƒç”¨ç±»é‡Œå®šä¹‰çš„å¯è¢«å‘ç°çš„ API å®šä¹‰ï¼Œä»¥ç¡®ä¿ä¸€ç»„æµ‹è¯•ä¸­æœ‰è¾ƒé«˜çš„ä»£ç è¦†ç›–ç‡ã€‚  åå°„çš„ç¼ºç‚¹ï¼š\nå°½ç®¡åå°„éå¸¸å¼ºå¤§ï¼Œä½†ä¹Ÿä¸èƒ½æ»¥ç”¨ã€‚å¦‚æœä¸€ä¸ªåŠŸèƒ½å¯ä»¥ä¸ç”¨åå°„å®Œæˆï¼Œé‚£ä¹ˆæœ€å¥½å°±ä¸ç”¨ã€‚åœ¨æˆ‘ä»¬ä½¿ç”¨åå°„æŠ€æœ¯æ—¶ï¼Œä¸‹é¢å‡ æ¡å†…å®¹åº”è¯¥ç‰¢è®°äºå¿ƒã€‚\n æ€§èƒ½å¼€é”€ ï¼šåå°„æ¶‰åŠäº†åŠ¨æ€ç±»å‹çš„è§£æï¼Œæ‰€ä»¥ JVM æ— æ³•å¯¹è¿™äº›ä»£ç è¿›è¡Œä¼˜åŒ–ã€‚å› æ­¤ï¼Œåå°„æ“ä½œçš„æ•ˆç‡è¦æ¯”é‚£äº›éåå°„æ“ä½œä½å¾—å¤šã€‚æˆ‘ä»¬åº”è¯¥é¿å…åœ¨ç»å¸¸è¢«æ‰§è¡Œçš„ä»£ç æˆ–å¯¹æ€§èƒ½è¦æ±‚å¾ˆé«˜çš„ç¨‹åºä¸­ä½¿ç”¨åå°„ã€‚ å®‰å…¨é™åˆ¶ ï¼šä½¿ç”¨åå°„æŠ€æœ¯è¦æ±‚ç¨‹åºå¿…é¡»åœ¨ä¸€ä¸ªæ²¡æœ‰å®‰å…¨é™åˆ¶çš„ç¯å¢ƒä¸­è¿è¡Œã€‚å¦‚æœä¸€ä¸ªç¨‹åºå¿…é¡»åœ¨æœ‰å®‰å…¨é™åˆ¶çš„ç¯å¢ƒä¸­è¿è¡Œï¼Œå¦‚ Appletï¼Œé‚£ä¹ˆè¿™å°±æ˜¯ä¸ªé—®é¢˜äº†ã€‚ å†…éƒ¨æš´éœ² ï¼šç”±äºåå°„å…è®¸ä»£ç æ‰§è¡Œä¸€äº›åœ¨æ­£å¸¸æƒ…å†µä¸‹ä¸è¢«å…è®¸çš„æ“ä½œï¼ˆæ¯”å¦‚è®¿é—®ç§æœ‰çš„å±æ€§å’Œæ–¹æ³•ï¼‰ï¼Œæ‰€ä»¥ä½¿ç”¨åå°„å¯èƒ½ä¼šå¯¼è‡´æ„æ–™ä¹‹å¤–çš„å‰¯ä½œç”¨ï¼Œè¿™å¯èƒ½å¯¼è‡´ä»£ç åŠŸèƒ½å¤±è°ƒå¹¶ç ´åå¯ç§»æ¤æ€§ã€‚åå°„ä»£ç ç ´åäº†æŠ½è±¡æ€§ï¼Œå› æ­¤å½“å¹³å°å‘ç”Ÿæ”¹å˜çš„æ—¶å€™ï¼Œä»£ç çš„è¡Œä¸ºå°±æœ‰å¯èƒ½ä¹Ÿéšç€å˜åŒ–ã€‚     åŠ¨æ€ä»£ç†\nJDKè‡ªå¸¦çš„åŠ¨æ€ä»£ç†ï¼Œå®ç°InvocationHandleræ¥å£\nCGLIBï¼Œé€šè¿‡ä¿®æ”¹å­—èŠ‚ç æ–‡ä»¶è¾¾åˆ°ä»£ç†\n  Javaçš„å‡ ç§å¼•ç”¨ï¼Œä½ ç”¨è¿‡å‡ ç§ è¯´è¯´è¿›ç¨‹å’Œçº¿ç¨‹çš„åŒºåˆ« Javaé›†åˆ è®²ä¸€è®²é›†åˆç±»ï¼Œå¸¸ç”¨çš„é›†åˆï¼Œä»¥åŠåœ¨å¤šçº¿ç¨‹ä¸‹ä½ æ˜¯å¦‚ä½•ä¿é›†åˆå®‰å…¨çš„   ArrayList\n/** * é»˜è®¤å®¹é‡ */ private static final int DEFAULT_CAPACITY = 10; /** * ç©ºæ•°ç»„ï¼Œå¦‚æœä¼ å…¥çš„å®¹é‡ä¸º0æ—¶ä½¿ç”¨ */ private static final Object[] EMPTY_ELEMENTDATA = {}; /** * ç©ºæ•°ç»„ï¼Œä¼ ä¼ å…¥å®¹é‡æ—¶ä½¿ç”¨ï¼Œæ·»åŠ ç¬¬ä¸€ä¸ªå…ƒç´ çš„æ—¶å€™ä¼šé‡æ–°åˆå§‹ä¸ºé»˜è®¤å®¹é‡å¤§å° */ private static final Object[] DEFAULTCAPACITY_EMPTY_ELEMENTDATA = {}; /** * å­˜å‚¨å…ƒç´ çš„æ•°ç»„ */ transient Object[] elementData; // non-private to simplify nested class access  /** * é›†åˆä¸­å…ƒç´ çš„ä¸ªæ•° */ private int size; ï¼ˆ1ï¼‰ArrayListå†…éƒ¨ä½¿ç”¨æ•°ç»„å­˜å‚¨å…ƒç´ ï¼Œå½“æ•°ç»„é•¿åº¦ä¸å¤Ÿæ—¶è¿›è¡Œæ‰©å®¹ï¼Œæ¯æ¬¡åŠ ä¸€åŠçš„ç©ºé—´ï¼ŒArrayListä¸ä¼šè¿›è¡Œç¼©å®¹ï¼›\nï¼ˆ2ï¼‰ArrayListæ”¯æŒéšæœºè®¿é—®ï¼Œé€šè¿‡ç´¢å¼•è®¿é—®å…ƒç´ æå¿«ï¼Œæ—¶é—´å¤æ‚åº¦ä¸ºO(1)ï¼›\nï¼ˆ3ï¼‰ArrayListæ·»åŠ å…ƒç´ åˆ°å°¾éƒ¨æå¿«ï¼Œå¹³å‡æ—¶é—´å¤æ‚åº¦ä¸ºO(1)ï¼›\nï¼ˆ4ï¼‰ArrayListæ·»åŠ å…ƒç´ åˆ°ä¸­é—´æ¯”è¾ƒæ…¢ï¼Œå› ä¸ºè¦æ¬ç§»å…ƒç´ ï¼Œå¹³å‡æ—¶é—´å¤æ‚åº¦ä¸ºO(n)ï¼›\nï¼ˆ5ï¼‰ArrayListä»å°¾éƒ¨åˆ é™¤å…ƒç´ æå¿«ï¼Œæ—¶é—´å¤æ‚åº¦ä¸ºO(1)ï¼›\nï¼ˆ6ï¼‰ArrayListä»ä¸­é—´åˆ é™¤å…ƒç´ æ¯”è¾ƒæ…¢ï¼Œå› ä¸ºè¦æ¬ç§»å…ƒç´ ï¼Œå¹³å‡æ—¶é—´å¤æ‚åº¦ä¸ºO(n)ï¼›\nï¼ˆ7ï¼‰ArrayListæ”¯æŒæ±‚å¹¶é›†ï¼Œè°ƒç”¨addAll(Collection\u0026lt;? extends E\u0026gt; c)æ–¹æ³•å³å¯ï¼›\nï¼ˆ8ï¼‰ArrayListæ”¯æŒæ±‚äº¤é›†ï¼Œè°ƒç”¨retainAll(Collection\u0026lt;? extends E\u0026gt; c)æ–¹æ³•å³å¯ï¼›\nï¼ˆ7ï¼‰ArrayListæ”¯æŒæ±‚å•å‘å·®é›†ï¼Œè°ƒç”¨removeAll(Collection\u0026lt;? extends E\u0026gt; c)æ–¹æ³•å³å¯ï¼›\n  CopyOnWriteArrayList\nï¼ˆ1ï¼‰CopyOnWriteArrayListä½¿ç”¨ReentrantLocké‡å…¥é”åŠ é”ï¼Œä¿è¯çº¿ç¨‹å®‰å…¨ï¼›\nï¼ˆ2ï¼‰CopyOnWriteArrayListçš„å†™æ“ä½œéƒ½è¦å…ˆæ‹·è´ä¸€ä»½æ–°æ•°ç»„ï¼Œåœ¨æ–°æ•°ç»„ä¸­åšä¿®æ”¹ï¼Œä¿®æ”¹å®Œäº†å†ç”¨æ–°æ•°ç»„æ›¿æ¢è€æ•°ç»„ï¼Œæ‰€ä»¥ç©ºé—´å¤æ‚åº¦æ˜¯O(n)ï¼Œæ€§èƒ½æ¯”è¾ƒä½ä¸‹ï¼›\nï¼ˆ3ï¼‰CopyOnWriteArrayListçš„è¯»æ“ä½œæ”¯æŒéšæœºè®¿é—®ï¼Œæ—¶é—´å¤æ‚åº¦ä¸ºO(1)ï¼›\nï¼ˆ4ï¼‰CopyOnWriteArrayListé‡‡ç”¨è¯»å†™åˆ†ç¦»çš„æ€æƒ³ï¼Œè¯»æ“ä½œä¸åŠ é”ï¼Œå†™æ“ä½œåŠ é”ï¼Œä¸”å†™æ“ä½œå ç”¨è¾ƒå¤§å†…å­˜ç©ºé—´ï¼Œæ‰€ä»¥é€‚ç”¨äºè¯»å¤šå†™å°‘çš„åœºåˆï¼›\nï¼ˆ5ï¼‰CopyOnWriteArrayListåªä¿è¯æœ€ç»ˆä¸€è‡´æ€§ï¼Œä¸ä¿è¯å®æ—¶ä¸€è‡´æ€§ï¼›\n  HashMap\nåœ¨Javaä¸­ï¼ŒHashMapçš„å®ç°é‡‡ç”¨äº†ï¼ˆæ•°ç»„ + é“¾è¡¨ + çº¢é»‘æ ‘ï¼‰çš„å¤æ‚ç»“æ„ï¼Œæ•°ç»„çš„ä¸€ä¸ªå…ƒç´ åˆç§°ä½œæ¡¶ã€‚\nåœ¨æ·»åŠ å…ƒç´ æ—¶ï¼Œä¼šæ ¹æ®hashå€¼ç®—å‡ºå…ƒç´ åœ¨æ•°ç»„ä¸­çš„ä½ç½®ï¼Œå¦‚æœè¯¥ä½ç½®æ²¡æœ‰å…ƒç´ ï¼Œåˆ™ç›´æ¥æŠŠå…ƒç´ æ”¾ç½®åœ¨æ­¤å¤„ï¼Œå¦‚æœè¯¥ä½ç½®æœ‰å…ƒç´ äº†ï¼Œåˆ™æŠŠå…ƒç´ ä»¥é“¾è¡¨çš„å½¢å¼æ”¾ç½®åœ¨é“¾è¡¨çš„å°¾éƒ¨ã€‚\nå½“ä¸€ä¸ªé“¾è¡¨çš„å…ƒç´ ä¸ªæ•°è¾¾åˆ°ä¸€å®šçš„æ•°é‡ï¼ˆä¸”æ•°ç»„çš„é•¿åº¦è¾¾åˆ°ä¸€å®šçš„é•¿åº¦ï¼‰åï¼Œåˆ™æŠŠé“¾è¡¨è½¬åŒ–ä¸ºçº¢é»‘æ ‘ï¼Œä»è€Œæé«˜æ•ˆç‡ã€‚\næ•°ç»„çš„æŸ¥è¯¢æ•ˆç‡ä¸ºO(1)ï¼Œé“¾è¡¨çš„æŸ¥è¯¢æ•ˆç‡æ˜¯O(k)ï¼Œçº¢é»‘æ ‘çš„æŸ¥è¯¢æ•ˆç‡æ˜¯O(log k)ï¼Œkä¸ºæ¡¶ä¸­çš„å…ƒç´ ä¸ªæ•°ï¼Œæ‰€ä»¥å½“å…ƒç´ æ•°é‡éå¸¸å¤šçš„æ—¶å€™ï¼Œè½¬åŒ–ä¸ºçº¢é»‘æ ‘èƒ½æå¤§åœ°æé«˜æ•ˆç‡ã€‚\nï¼ˆ1ï¼‰å®¹é‡\nå®¹é‡ä¸ºæ•°ç»„çš„é•¿åº¦ï¼Œäº¦å³æ¡¶çš„ä¸ªæ•°ï¼Œé»˜è®¤ä¸º16ï¼Œæœ€å¤§ä¸º2çš„30æ¬¡æ–¹ï¼Œå½“å®¹é‡è¾¾åˆ°64æ—¶æ‰å¯ä»¥æ ‘åŒ–ã€‚\nï¼ˆ2ï¼‰è£…è½½å› å­\nè£…è½½å› å­ç”¨æ¥è®¡ç®—å®¹é‡è¾¾åˆ°å¤šå°‘æ—¶æ‰è¿›è¡Œæ‰©å®¹ï¼Œé»˜è®¤è£…è½½å› å­ä¸º0.75ã€‚\nï¼ˆ3ï¼‰æ ‘åŒ–\næ ‘åŒ–ï¼Œå½“å®¹é‡è¾¾åˆ°64ä¸”é“¾è¡¨çš„é•¿åº¦è¾¾åˆ°8æ—¶è¿›è¡Œæ ‘åŒ–ï¼Œå½“é“¾è¡¨çš„é•¿åº¦å°äº6æ—¶åæ ‘åŒ–ã€‚\næ€»ç»“\nï¼ˆ1ï¼‰HashMapæ˜¯ä¸€ç§æ•£åˆ—è¡¨ï¼Œé‡‡ç”¨ï¼ˆæ•°ç»„ + é“¾è¡¨ + çº¢é»‘æ ‘ï¼‰çš„å­˜å‚¨ç»“æ„ï¼›\nï¼ˆ2ï¼‰HashMapçš„é»˜è®¤åˆå§‹å®¹é‡ä¸º16ï¼ˆ1\u0026laquo;4ï¼‰ï¼Œé»˜è®¤è£…è½½å› å­ä¸º0.75fï¼Œå®¹é‡æ€»æ˜¯2çš„næ¬¡æ–¹ï¼›\nï¼ˆ3ï¼‰HashMapæ‰©å®¹æ—¶æ¯æ¬¡å®¹é‡å˜ä¸ºåŸæ¥çš„ä¸¤å€ï¼›\nï¼ˆ4ï¼‰å½“æ¡¶çš„æ•°é‡å°äº64æ—¶ä¸ä¼šè¿›è¡Œæ ‘åŒ–ï¼Œåªä¼šæ‰©å®¹ï¼›\nï¼ˆ5ï¼‰å½“æ¡¶çš„æ•°é‡å¤§äº64ä¸”å•ä¸ªæ¡¶ä¸­å…ƒç´ çš„æ•°é‡å¤§äº8æ—¶ï¼Œè¿›è¡Œæ ‘åŒ–ï¼›\nï¼ˆ6ï¼‰å½“å•ä¸ªæ¡¶ä¸­å…ƒç´ æ•°é‡å°äº6æ—¶ï¼Œè¿›è¡Œåæ ‘åŒ–ï¼›\nï¼ˆ7ï¼‰HashMapæ˜¯éçº¿ç¨‹å®‰å…¨çš„å®¹å™¨ï¼›\nï¼ˆ8ï¼‰HashMapæŸ¥æ‰¾æ·»åŠ å…ƒç´ çš„æ—¶é—´å¤æ‚åº¦éƒ½ä¸ºO(1)ï¼›\n  JVM JVMæ˜¯ä»€ä¹ˆ javaè™šæ‹Ÿæœº\nJavaå†…å­˜æ¨¡å‹ Javaå†…å­˜æ¨¡å‹æ˜¯è·Ÿã€Œå¹¶å‘ã€ç›¸å…³çš„ï¼Œå®ƒæ˜¯ä¸ºäº†å±è”½åº•å±‚ç»†èŠ‚è€Œæå‡ºçš„è§„èŒƒï¼Œå¸Œæœ›åœ¨ä¸Šå±‚(Javaå±‚é¢ä¸Š)åœ¨æ“ä½œå†…å­˜æ—¶åœ¨ä¸åŒçš„å¹³å°ä¸Šä¹Ÿæœ‰ç›¸åŒçš„æ•ˆæœ\nJavaç¼–è¯‘åˆ°æ‰§è¡Œçš„è¿‡ç¨‹   ç¼–è¯‘\nå°†æºç æ–‡ä»¶ç¼–è¯‘æˆJVMå¯ä»¥è§£é‡Šçš„classæ–‡ä»¶ã€‚\nç¼–è¯‘è¿‡ç¨‹ä¼šå¯¹æºä»£ç ç¨‹åºåš ã€Œè¯­æ³•åˆ†æã€ã€Œè¯­ä¹‰åˆ†æã€ã€Œæ³¨è§£å¤„ç†ã€ç­‰ç­‰å¤„ç†ï¼Œæœ€åæ‰ç”Ÿæˆå­—èŠ‚ç æ–‡ä»¶ã€‚\næ¯”å¦‚å¯¹æ³›å‹çš„æ“¦é™¤å’Œæˆ‘ä»¬ç»å¸¸ç”¨çš„Lombokå°±æ˜¯åœ¨ç¼–è¯‘é˜¶æ®µå¹²çš„ã€‚\n  åŠ è½½\n  è£…è½½\nã€è£…è½½æ—¶æœºã€‘ä¸ºäº†èŠ‚çœå†…å­˜çš„å¼€é”€ï¼Œå¹¶ä¸ä¼šä¸€æ¬¡æ€§æŠŠæ‰€æœ‰çš„ç±»éƒ½è£…è½½è‡³JVMï¼Œè€Œæ˜¯ç­‰åˆ°ã€Œæœ‰éœ€è¦ã€çš„æ—¶å€™æ‰è¿›è¡Œè£…è½½ï¼ˆæ¯”å¦‚newå’Œåå°„ç­‰ç­‰ï¼‰\nã€è£…è½½å‘ç”Ÿã€‘classæ–‡ä»¶æ˜¯é€šè¿‡ã€Œç±»åŠ è½½å™¨ã€è£…è½½åˆ°jvmä¸­çš„ï¼Œä¸ºäº†é˜²æ­¢å†…å­˜ä¸­å‡ºç°å¤šä»½åŒæ ·çš„å­—èŠ‚ç ï¼Œä½¿ç”¨äº†åŒäº²å§”æ´¾æœºåˆ¶ï¼ˆå®ƒä¸ä¼šè‡ªå·±å»å°è¯•åŠ è½½è¿™ä¸ªç±»ï¼Œè€Œæ˜¯æŠŠè¯·æ±‚å§”æ‰˜ç»™çˆ¶åŠ è½½å™¨å»å®Œæˆï¼Œä¾æ¬¡å‘ä¸Šï¼‰\nã€è£…è½½è§„åˆ™ã€‘JDK ä¸­çš„æœ¬åœ°æ–¹æ³•ç±»ä¸€èˆ¬ç”±æ ¹åŠ è½½å™¨ï¼ˆBootstrp loaderï¼‰è£…è½½ï¼ŒJDK ä¸­å†…éƒ¨å®ç°çš„æ‰©å±•ç±»ä¸€èˆ¬ç”±æ‰©å±•åŠ è½½å™¨ï¼ˆExtClassLoader ï¼‰å®ç°è£…è½½ï¼Œè€Œç¨‹åºä¸­çš„ç±»æ–‡ä»¶åˆ™ç”±ç³»ç»ŸåŠ è½½å™¨ï¼ˆAppClassLoader ï¼‰å®ç°è£…è½½ã€‚\nè£…è½½è¿™ä¸ªé˜¶æ®µå®ƒåšçš„äº‹æƒ…å¯ä»¥æ€»ç»“ä¸ºï¼šæŸ¥æ‰¾å¹¶åŠ è½½ç±»çš„äºŒè¿›åˆ¶æ•°æ®ï¼Œåœ¨JVMã€Œå †ã€ä¸­åˆ›å»ºä¸€ä¸ªjava.lang.Classç±»çš„å¯¹è±¡ï¼Œå¹¶å°†ç±»ç›¸å…³çš„ä¿¡æ¯å­˜å‚¨åœ¨JVMã€Œæ–¹æ³•åŒºã€ä¸­ï¼Œ\né€šè¿‡ã€Œè£…è½½ã€è¿™ä¸ªæ­¥éª¤åï¼Œç°åœ¨å·²ç»æŠŠclassæ–‡ä»¶è£…è½½åˆ°JVMä¸­äº†ï¼Œå¹¶åˆ›å»ºå‡ºå¯¹åº”çš„Classå¯¹è±¡ä»¥åŠç±»ä¿¡æ¯å­˜å‚¨è‡³æ–¹æ³•åŒºäº†ã€‚\n  è¿æ¥\n éªŒè¯ï¼šéªŒè¯ç±»æ˜¯å¦ç¬¦åˆ Java è§„èŒƒå’Œ JVM è§„èŒƒ å‡†å¤‡ï¼šä¸ºç±»çš„é™æ€å˜é‡åˆ†é…å†…å­˜ï¼Œåˆå§‹åŒ–ä¸ºç³»ç»Ÿçš„åˆå§‹å€¼ è§£æï¼šå°†ç¬¦å·å¼•ç”¨è½¬ä¸ºç›´æ¥å¼•ç”¨çš„è¿‡ç¨‹  é€šè¿‡ã€Œè¿æ¥ã€è¿™ä¸ªæ­¥éª¤åï¼Œç°åœ¨å·²ç»å¯¹classä¿¡æ¯åšæ ¡éªŒå¹¶åˆ†é…äº†å†…å­˜ç©ºé—´å’Œé»˜è®¤å€¼äº†ã€‚\n  åˆå§‹åŒ–\næ”¶é›†classçš„é™æ€å˜é‡ã€é™æ€ä»£ç å—ã€é™æ€æ–¹æ³•è‡³()æ–¹æ³•ï¼Œéšåä»ä¸Šå¾€ä¸‹å¼€å§‹æ‰§è¡Œã€‚\n    è§£é‡Š\næŠŠå­—èŠ‚ç è½¬æ¢ä¸ºæ“ä½œç³»ç»Ÿè¯†åˆ«çš„æŒ‡ä»¤\n  æ‰§è¡Œ\næ“ä½œç³»ç»ŸæŠŠè§£é‡Šå™¨è§£æå‡ºæ¥çš„æŒ‡ä»¤ç ï¼Œè°ƒç”¨ç³»ç»Ÿçš„ç¡¬ä»¶æ‰§è¡Œæœ€ç»ˆçš„ç¨‹åºæŒ‡ä»¤ã€‚\n  åŒäº²å§”æ´¾æœºåˆ¶æ˜¯å¹²ä»€ä¹ˆçš„   **å‰ç½®çŸ¥è¯†ï¼š**JDKä¸­é»˜è®¤ç±»åŠ è½½å™¨æœ‰ä¸‰ä¸ªï¼šAppClassLoaderã€Ext ClassLoaderã€BootStrap ClassLoaderã€‚AppClassLoaderçš„çˆ¶åŠ è½½å™¨ä¸ºExt ClassLoaderã€Ext ClassLoaderçš„çˆ¶åŠ è½½å™¨ä¸ºBootStrap ClassLoaderã€‚è¿™é‡Œçš„çˆ¶å­å…³ç³»å¹¶ä¸æ˜¯é€šè¿‡ç»§æ‰¿å®ç°çš„ï¼Œè€Œæ˜¯ç»„åˆã€‚\n  **ä»€ä¹ˆæ˜¯åŒäº²å§”æ´¾æœºåˆ¶ï¼š**åŠ è½½å™¨åœ¨åŠ è½½è¿‡ç¨‹ä¸­ï¼Œå…ˆæŠŠç±»äº¤ç”±çˆ¶ç±»åŠ è½½å™¨è¿›è¡ŒåŠ è½½ï¼Œçˆ¶ç±»åŠ è½½å™¨æ²¡æ‰¾åˆ°æ‰ç”±è‡ªèº«åŠ è½½ã€‚\n  **åŒäº²å§”æ´¾æœºåˆ¶ç›®çš„ï¼š**ä¸ºäº†é˜²æ­¢å†…å­˜ä¸­å­˜åœ¨å¤šä»½åŒæ ·çš„å­—èŠ‚ç ï¼ˆå®‰å…¨ï¼‰\n  **ç±»åŠ è½½è§„åˆ™ï¼š**å¦‚æœä¸€ä¸ªç±»ç”±ç±»åŠ è½½å™¨AåŠ è½½ï¼Œé‚£ä¹ˆè¿™ä¸ªç±»çš„ä¾èµ–ç±»ä¹Ÿæ˜¯ç”±ã€Œç›¸åŒçš„ç±»åŠ è½½å™¨ã€åŠ è½½ã€‚\n  **å¦‚ä½•æ‰“ç ´åŒäº²å§”æ´¾æœºåˆ¶ï¼š**è‡ªå®šä¹‰ClassLoaderï¼Œé‡å†™loadClassæ–¹æ³•ï¼ˆåªè¦ä¸ä¾æ¬¡å¾€ä¸Šäº¤ç»™çˆ¶åŠ è½½å™¨è¿›è¡ŒåŠ è½½ï¼Œå°±ç®—æ˜¯æ‰“ç ´åŒäº²å§”æ´¾æœºåˆ¶ï¼‰\n  **æ‰“ç ´åŒäº²å§”æ´¾æœºåˆ¶æ¡ˆä¾‹ï¼š**Tomcat\n ä¸ºäº†Webåº”ç”¨ç¨‹åºç±»ä¹‹é—´éš”ç¦»ï¼Œä¸ºæ¯ä¸ªåº”ç”¨ç¨‹åºåˆ›å»ºWebAppClassLoaderç±»åŠ è½½å™¨ ä¸ºäº†Webåº”ç”¨ç¨‹åºç±»ä¹‹é—´å…±äº«ï¼ŒæŠŠShareClassLoaderä½œä¸ºWebAppClassLoaderçš„çˆ¶ç±»åŠ è½½å™¨ï¼Œå¦‚æœWebAppClassLoaderåŠ è½½å™¨æ‰¾ä¸åˆ°ï¼Œåˆ™å°è¯•ç”¨ShareClassLoaderè¿›è¡ŒåŠ è½½ ä¸ºäº†Tomcatæœ¬èº«ä¸Webåº”ç”¨ç¨‹åºç±»éš”ç¦»ï¼Œç”¨CatalinaClassLoaderç±»åŠ è½½å™¨è¿›è¡Œéš”ç¦»ï¼ŒCatalinaClassLoaderåŠ è½½Tomcatæœ¬èº«çš„ç±» ä¸ºäº†Tomcatä¸Webåº”ç”¨ç¨‹åºç±»å…±äº«ï¼Œç”¨CommonClassLoaderä½œä¸ºCatalinaClassLoaderå’ŒShareClassLoaderçš„çˆ¶ç±»åŠ è½½å™¨ ShareClassLoaderã€CatalinaClassLoaderã€CommonClassLoaderçš„ç›®å½•å¯ä»¥åœ¨Tomcatçš„catalina.propertiesè¿›è¡Œé…ç½®    **çº¿ç¨‹ä¸Šä¸‹æ–‡åŠ è½½å™¨ï¼š**ç”±äºç±»åŠ è½½çš„è§„åˆ™ï¼Œå¾ˆå¯èƒ½å¯¼è‡´çˆ¶åŠ è½½å™¨åŠ è½½æ—¶ä¾èµ–å­åŠ è½½å™¨çš„ç±»ï¼Œå¯¼è‡´æ— æ³•åŠ è½½æˆåŠŸï¼ˆBootStrap ClassLoaderæ— æ³•åŠ è½½ç¬¬ä¸‰æ–¹åº“çš„ç±»ï¼‰ï¼Œæ‰€ä»¥å­˜åœ¨ã€Œçº¿ç¨‹ä¸Šä¸‹æ–‡åŠ è½½å™¨ã€æ¥è¿›è¡ŒåŠ è½½ã€‚\n  JVMå†…å­˜ç»“æ„ å…¶ä¸­ï¼šå †å’Œæ–¹æ³•åŒºæ˜¯çº¿ç¨‹å…±äº«çš„ï¼Œå…¶ä»–åœ°æ–¹æ˜¯çº¿ç¨‹éš”ç¦»çš„\n  å †ï¼š\nå—¯ï¼Œã€Œå †ã€æ˜¯çº¿ç¨‹å…±äº«çš„åŒºåŸŸï¼Œå‡ ä¹ç±»çš„å®ä¾‹å’Œæ•°ç»„åˆ†é…çš„å†…å­˜éƒ½æ¥è‡ªäºå®ƒ\nå †åˆå¯ä»¥ç»†åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªåŒºåŸŸ\n ä¼Šç”¸å›­åŒº ç”Ÿå­˜è€…åŒº1ï¼Œç”Ÿå­˜è€…åŒº2 è€å¹´åŒº    è™šæ‹Ÿæœºæ ˆï¼šæ¯ä¸ªçº¿ç¨‹åœ¨åˆ›å»ºçš„æ—¶å€™éƒ½ä¼šåˆ›å»ºä¸€ä¸ªã€Œè™šæ‹Ÿæœºæ ˆã€ï¼Œæ¯æ¬¡æ–¹æ³•è°ƒç”¨éƒ½ä¼šåˆ›å»ºä¸€ä¸ªã€Œæ ˆå¸§ã€ã€‚æ¯ä¸ªã€Œæ ˆå¸§ã€ä¼šåŒ…å«å‡ å—å†…å®¹ï¼šå±€éƒ¨å˜é‡è¡¨ã€æ“ä½œæ•°æ ˆã€åŠ¨æ€è¿æ¥å’Œè¿”å›åœ°å€ï¼Œäº†è§£äº†ã€Œè™šæ‹Ÿæœºæ ˆã€çš„ç»„æˆåï¼Œä¹Ÿä¸éš¾çŒœå‡ºå®ƒçš„ä½œç”¨äº†ï¼šå®ƒä¿å­˜æ–¹æ³•äº†å±€éƒ¨å˜é‡ã€éƒ¨åˆ†å˜é‡çš„è®¡ç®—å¹¶å‚ä¸äº†æ–¹æ³•çš„è°ƒç”¨å’Œè¿”å›ã€‚\nå°±æ˜¯ä¿å­˜äº†æ–¹æ³•çš„å±€éƒ¨å˜é‡è¡¨ï¼Œæ–¹æ³•çš„è°ƒç”¨å’Œè¿”å›éƒ½åœ¨é‡Œé¢\n  æœ¬åœ°æ–¹æ³•æ ˆï¼šæœ¬åœ°æ–¹æ³•æ ˆè·Ÿè™šæ‹Ÿæœºæ ˆçš„åŠŸèƒ½ç±»ä¼¼ï¼Œè™šæ‹Ÿæœºæ ˆç”¨äºç®¡ç† Java å‡½æ•°çš„è°ƒç”¨ï¼Œè€Œæœ¬åœ°æ–¹æ³•æ ˆåˆ™ç”¨äºç®¡ç†æœ¬åœ°æ–¹æ³•çš„è°ƒç”¨ã€‚è¿™é‡Œçš„ã€Œæœ¬åœ°æ–¹æ³•ã€æŒ‡çš„æ˜¯ã€ŒéJavaæ–¹æ³•ã€ï¼Œä¸€èˆ¬æœ¬åœ°æ–¹æ³•æ˜¯ä½¿ç”¨Cè¯­è¨€å®ç°çš„ã€‚å’Œè™šæ‹Ÿæœºæ ˆä¿å­˜çš„ä¸œè¥¿ä¸€æ ·ï¼Œåªä¸è¿‡ä¸æ˜¯javaæ–¹æ³•\n  æ–¹æ³•åŒºï¼š\nHotSpotè™šæ‹Ÿæœºä¸­ï¼Œåœ¨JDK8ä¸­ï¼Œå·²ç»ç”¨ã€Œå…ƒç©ºé—´ã€æ¥æ›¿ä»£äº†ã€Œæ°¸ä¹…ä»£ã€ä½œä¸ºã€Œæ–¹æ³•åŒºã€çš„å®ç°äº†ã€‚æ–¹æ³•åŒºä¸»è¦æ˜¯ç”¨æ¥å­˜æ”¾å·²è¢«è™šæ‹ŸæœºåŠ è½½çš„ã€Œç±»ç›¸å…³ä¿¡æ¯ã€ï¼šåŒ…æ‹¬ç±»ä¿¡æ¯ã€å¸¸é‡æ± ã€‚\n  ç±»ä¿¡æ¯åˆåŒ…æ‹¬äº†ç±»çš„ç‰ˆæœ¬ã€å­—æ®µã€æ–¹æ³•ã€æ¥å£å’Œçˆ¶ç±»ç­‰ä¿¡æ¯\n  å¸¸é‡æ± åˆå¯ä»¥åˆ†ã€Œé™æ€å¸¸é‡æ± ã€å’Œã€Œè¿è¡Œæ—¶å¸¸é‡æ± ã€\né™æ€å¸¸é‡æ± ä¸»è¦å­˜å‚¨çš„æ˜¯ã€Œå­—é¢é‡ã€ä»¥åŠã€Œç¬¦å·å¼•ç”¨ã€ç­‰ä¿¡æ¯ï¼Œé™æ€å¸¸é‡æ± ä¹ŸåŒ…æ‹¬äº†æˆ‘ä»¬è¯´çš„ã€Œå­—ç¬¦ä¸²å¸¸é‡æ± ã€ã€‚\nã€Œè¿è¡Œæ—¶å¸¸é‡æ± ã€å­˜å‚¨çš„æ˜¯ã€Œç±»åŠ è½½ã€æ—¶ç”Ÿæˆçš„ã€Œç›´æ¥å¼•ç”¨ã€ç­‰ä¿¡æ¯ã€‚\n åˆå€¼å¾—æ³¨æ„çš„æ˜¯ï¼šä»ã€Œé€»è¾‘åˆ†åŒºã€çš„è§’åº¦è€Œè¨€ã€Œå¸¸é‡æ± ã€æ˜¯å±äºã€Œæ–¹æ³•åŒºã€çš„ï¼Œä½†è‡ªä»åœ¨ã€ŒJDK7ã€ä»¥åï¼Œå°±å·²ç»æŠŠã€Œè¿è¡Œæ—¶å¸¸é‡æ± ã€å’Œã€Œé™æ€å¸¸é‡æ± ã€è½¬ç§»åˆ°äº†ã€Œå †ã€å†…å­˜ä¸­è¿›è¡Œå­˜å‚¨ï¼ˆå¯¹äºã€Œç‰©ç†åˆ†åŒºã€æ¥è¯´ã€Œè¿è¡Œæ—¶å¸¸é‡æ± ã€å’Œã€Œé™æ€å¸¸é‡æ± ã€å°±å±äºå †ï¼‰\n å…ƒç©ºé—´å’Œæ°¸ä¹…ä»£æœ€ä¸»è¦çš„åŒºåˆ«å°±æ˜¯ï¼šã€Œå…ƒç©ºé—´ã€å­˜å‚¨ä¸åœ¨è™šæ‹Ÿæœºä¸­ï¼Œè€Œæ˜¯ä½¿ç”¨æœ¬åœ°å†…å­˜ï¼ŒJVM ä¸ä¼šå†å‡ºç°æ–¹æ³•åŒºçš„å†…å­˜æº¢å‡ºï¼Œä»¥å¾€ã€Œæ°¸ä¹…ä»£ã€ç»å¸¸å› ä¸ºå†…å­˜ä¸å¤Ÿç”¨å¯¼è‡´è·‘å‡ºOOMå¼‚å¸¸ã€‚\n    ç¨‹åºè®¡æ•°å™¨ï¼šJavaæ˜¯å¤šçº¿ç¨‹çš„è¯­è¨€ï¼Œæˆ‘ä»¬çŸ¥é“å‡è®¾çº¿ç¨‹æ•°å¤§äºCPUæ•°ï¼Œå°±å¾ˆæœ‰å¯èƒ½æœ‰ã€Œçº¿ç¨‹åˆ‡æ¢ã€ç°è±¡ï¼Œåˆ‡æ¢æ„å‘³ç€ã€Œä¸­æ–­ã€å’Œã€Œæ¢å¤ã€ï¼Œé‚£è‡ªç„¶å°±éœ€è¦æœ‰ä¸€å—åŒºåŸŸæ¥ä¿å­˜ã€Œå½“å‰çº¿ç¨‹çš„æ‰§è¡Œä¿¡æ¯ã€ï¼Œæ‰€ä»¥ï¼Œç¨‹åºè®¡æ•°å™¨å°±æ˜¯ç”¨äºè®°å½•å„ä¸ªçº¿ç¨‹æ‰§è¡Œçš„å­—èŠ‚ç çš„åœ°å€ï¼ˆåˆ†æ”¯ã€å¾ªç¯ã€è·³è½¬ã€å¼‚å¸¸ã€çº¿ç¨‹æ¢å¤ç­‰éƒ½ä¾èµ–äºè®¡æ•°å™¨ï¼‰ï¼Œç®€å•ç‚¹è¯´å°±æ˜¯è®°å½•çº¿ç¨‹ä¸­ä»£ç èµ°åˆ°å“ªäº†\n  åƒåœ¾å›æ”¶   å¦‚ä½•åˆ¤æ–­æ˜¯å¦æ˜¯ä¸€ä¸ªåƒåœ¾å‘¢\n  å¼•ç”¨è®¡æ•°æ³•ï¼š\nå¼•ç”¨è®¡æ•°æ³•æ€è·¯å¾ˆç®€å•ï¼šå½“å¯¹è±¡è¢«å¼•ç”¨åˆ™+1ï¼Œä½†å¯¹è±¡å¼•ç”¨å¤±è´¥åˆ™-1ã€‚å½“è®¡æ•°å™¨ä¸º0æ—¶ï¼Œè¯´æ˜å¯¹è±¡ä¸å†è¢«å¼•ç”¨ï¼Œå¯ä»¥è¢«å¯å›æ”¶ï¼Œ\nå¼•ç”¨è®¡æ•°æ³•æœ€æ˜æ˜¾çš„ç¼ºç‚¹å°±æ˜¯ï¼šå¦‚æœå¯¹è±¡å­˜åœ¨å¾ªç¯ä¾èµ–ï¼Œé‚£å°±æ— æ³•å®šä½è¯¥å¯¹è±¡æ˜¯å¦åº”è¯¥è¢«å›æ”¶ï¼ˆAä¾èµ–Bï¼ŒBä¾èµ–Aï¼‰\n  å¯è¾¾æ€§ç®—æ³•\nåˆ¤æ–­å¯¹è±¡ä¸GCROOTä¹‹é—´æ˜¯å¦å¯è¾¾ï¼Œä¸å¯è¾¾å³æ˜¯åƒåœ¾\nGCROOT\nã€ŒGC Rootsã€æ˜¯ä¸€ç»„å¿…é¡»ã€Œæ´»è·ƒã€çš„å¼•ç”¨ã€‚ä»ã€ŒGC Rootã€å‡ºå‘ï¼Œç¨‹åºé€šè¿‡ç›´æ¥å¼•ç”¨æˆ–è€…é—´æ¥å¼•ç”¨ï¼Œèƒ½å¤Ÿæ‰¾åˆ°å¯èƒ½æ­£åœ¨è¢«ä½¿ç”¨çš„å¯¹è±¡\n  å½“å‰æ´»è·ƒçš„æ ˆå¸§æŒ‡å‘å †é‡Œçš„å¯¹è±¡å¼•ç”¨å°±å¯ä»¥æ˜¯ã€ŒGC Rootsã€\n æ¯”å¦‚æˆ‘ä»¬ä¸Šæ¬¡ä¸æ˜¯èŠåˆ°JVMå†…å­˜ç»“æ„ä¸­çš„è™šæ‹Ÿæœºæ ˆå—ï¼Œè™šæ‹Ÿæœºæ ˆé‡Œä¸æ˜¯æœ‰æ ˆå¸§å—ï¼Œæ ˆå¸§ä¸æ˜¯æœ‰å±€éƒ¨å˜é‡å—ï¼Ÿå±€éƒ¨å˜é‡ä¸å°±å­˜å‚¨ç€å¼•ç”¨å˜›ã€‚\né‚£å¦‚æœæ ˆå¸§ä½äºè™šæ‹Ÿæœºæ ˆçš„æ ˆé¡¶ï¼Œæ˜¯ä¸æ˜¯å°±å¯ä»¥è¯´æ˜è¿™ä¸ªæ ˆå¸§æ˜¯æ´»è·ƒçš„ï¼ˆæ¢è¨€ä¹‹ï¼Œæ˜¯çº¿ç¨‹æ­£åœ¨è¢«è°ƒç”¨çš„ï¼‰\næ—¢ç„¶æ˜¯çº¿ç¨‹æ­£åœ¨è°ƒç”¨çš„ï¼Œé‚£æ ˆå¸§é‡Œçš„æŒ‡å‘ã€Œå †ã€çš„å¯¹è±¡å¼•ç”¨ï¼Œæ˜¯ä¸æ˜¯ä¸€å®šæ˜¯ã€Œæ´»è·ƒã€çš„å¼•ç”¨ï¼Ÿ\næ‰€ä»¥ï¼Œå½“å‰æ´»è·ƒçš„æ ˆå¸§æŒ‡å‘å †é‡Œçš„å¯¹è±¡å¼•ç”¨å°±å¯ä»¥æ˜¯ã€ŒGC Rootsã€\n   æ¯”å¦‚ç±»çš„é™æ€å˜é‡å¼•ç”¨æ˜¯ã€ŒGC Rootsã€ï¼Œè¢«ã€ŒJavaæœ¬åœ°æ–¹æ³•ã€æ‰€å¼•ç”¨çš„å¯¹è±¡ä¹Ÿæ˜¯ã€ŒGC Rootsã€\n      å›æ”¶è¿‡ç¨‹\n  æ ‡è®°\n  æ¸…é™¤\nç›´æ¥æ¸…é™¤ä¼šæœ‰ã€Œå†…å­˜ç¢ç‰‡ã€çš„é—®é¢˜ï¼šå¯èƒ½æˆ‘æœ‰10Mçš„ç©ºä½™å†…å­˜ï¼Œä½†ç¨‹åºç”³è¯·9Må†…å­˜ç©ºé—´å´ç”³è¯·ä¸ä¸‹æ¥ï¼ˆ10Mçš„å†…å­˜ç©ºé—´æ˜¯åƒåœ¾æ¸…é™¤åçš„ï¼Œä¸è¿ç»­çš„ï¼‰\næˆ‘æŠŠã€Œæ ‡è®°ã€å­˜æ´»çš„å¯¹è±¡ã€Œå¤åˆ¶ã€åˆ°å¦ä¸€å—ç©ºé—´ï¼Œå¤åˆ¶å®Œäº†ä¹‹åï¼Œç›´æ¥æŠŠåŸæœ‰çš„æ•´å—ç©ºé—´ç»™å¹²æ‰ï¼è¿™æ ·å°±æ²¡æœ‰å†…å­˜ç¢ç‰‡çš„é—®é¢˜äº†\nè¿™ç§åšæ³•ç¼ºç‚¹åˆå¾ˆæ˜æ˜¾ï¼šå†…å­˜åˆ©ç”¨ç‡ä½ï¼Œå¾—æœ‰ä¸€å—æ–°çš„åŒºåŸŸç»™æˆ‘å¤åˆ¶(ç§»åŠ¨)è¿‡å»\nè¿˜æœ‰ä¸€ç§ã€ŒæŠ˜ä¸­ã€çš„åŠæ³•ï¼Œæˆ‘æœªå¿…è¦æœ‰ä¸€å—ã€Œå¤§çš„å®Œæ•´ç©ºé—´ã€æ‰èƒ½è§£å†³å†…å­˜ç¢ç‰‡çš„é—®é¢˜ï¼Œæˆ‘åªè¦èƒ½åœ¨ã€Œå½“å‰åŒºåŸŸã€å†…è¿›è¡Œç§»åŠ¨\næŠŠå­˜æ´»çš„å¯¹è±¡ç§»åˆ°ä¸€è¾¹ï¼ŒæŠŠåƒåœ¾ç§»åˆ°ä¸€è¾¹ï¼Œé‚£å†å°†åƒåœ¾ä¸€èµ·åˆ é™¤æ‰ï¼Œä¸å°±æ²¡æœ‰å†…å­˜ç¢ç‰‡äº†å˜›\nè¿™ç§ä¸“ä¸šçš„æœ¯è¯­å°±å«åšã€Œæ•´ç†ã€\n    STWï¼šstop the world\nå›æ”¶åƒåœ¾çš„æ—¶å€™ï¼Œç¨‹åºæ˜¯æœ‰çŸ­æš‚çš„æ—¶é—´ä¸èƒ½æ­£å¸¸ç»§ç»­è¿ä½œå•Šã€‚ä¸ç„¶JVMåœ¨å›æ”¶çš„æ—¶å€™ï¼Œç”¨æˆ·çº¿ç¨‹è¿˜ç»§ç»­åˆ†é…ä¿®æ”¹å¼•ç”¨ï¼ŒJVMæ€ä¹ˆæ\n  å¹´è½»ä»£çš„åƒåœ¾æ”¶é›†å™¨ä½¿ç”¨çš„éƒ½æ˜¯ã€Œæ ‡è®°å¤åˆ¶ç®—æ³•ã€\næ‰€ä»¥åœ¨ã€Œå †å†…å­˜ã€åˆ’åˆ†ä¸­ï¼Œå°†å¹´è½»ä»£åˆ’åˆ†å‡ºSurvivoråŒºï¼ˆSurvivor From å’ŒSurvivor Toï¼‰ï¼Œç›®çš„å°±æ˜¯ä¸ºäº†æœ‰ä¸€å—å®Œæ•´çš„å†…å­˜ç©ºé—´ä¾›åƒåœ¾å›æ”¶å™¨è¿›è¡Œæ‹·è´(ç§»åŠ¨)\n  ä»€ä¹ˆæ—¶å€™ä¼šä»æ–°ç”Ÿä»£è¿›å…¥è€å¹´ä»£\n å¦‚æœå¯¹è±¡å¤ªå¤§äº†ï¼Œå°±ä¼šç›´æ¥è¿›å…¥è€å¹´ä»£ï¼ˆå¯¹è±¡åˆ›å»ºæ—¶å°±å¾ˆå¤§ || SurvivoråŒºæ²¡åŠæ³•å­˜ä¸‹è¯¥å¯¹è±¡ï¼‰ å¦‚æœå¯¹è±¡å¤ªè€äº†ï¼Œé‚£å°±ä¼šæ™‹å‡è‡³è€å¹´ä»£ï¼ˆæ¯å‘ç”Ÿä¸€æ¬¡Minor GC ï¼Œå­˜æ´»çš„å¯¹è±¡å¹´é¾„+1ï¼Œè¾¾åˆ°é»˜è®¤å€¼15åˆ™æ™‹å‡è€å¹´ä»£ || åŠ¨æ€å¯¹è±¡å¹´é¾„åˆ¤å®š å¯ä»¥è¿›å…¥è€å¹´ä»£ï¼‰    å½“EdenåŒºç©ºé—´ä¸è¶³æ—¶ï¼Œå°±ä¼šè§¦å‘Minor GC\n  å¹³æ—¶å¦‚ä½•è°ƒä¼˜ ä¸€èˆ¬è°ƒä¼˜JVMæˆ‘ä»¬è®¤ä¸ºä¼šæœ‰å‡ ç§æŒ‡æ ‡å¯ä»¥å‚è€ƒï¼šã€ååé‡ã€ã€ã€åœé¡¿æ—¶é—´ã€å’Œã€åƒåœ¾å›æ”¶é¢‘ç‡ã€\n å†…å­˜åŒºåŸŸå¤§å°ä»¥åŠç›¸å…³ç­–ç•¥ï¼ˆæ¯”å¦‚æ•´å—å †å†…å­˜å å¤šå°‘ã€æ–°ç”Ÿä»£å å¤šå°‘ã€è€å¹´ä»£å å¤šå°‘ã€Survivorå å¤šå°‘ã€æ™‹å‡è€å¹´ä»£çš„æ¡ä»¶ç­‰ç­‰ï¼‰  æ¯”å¦‚ï¼ˆ-Xmxï¼šè®¾ç½®å †çš„æœ€å¤§å€¼ã€-Xmsï¼šè®¾ç½®å †çš„åˆå§‹å€¼ã€-Xmnï¼šè¡¨ç¤ºå¹´è½»ä»£çš„å¤§å°ã€-XX:SurvivorRatioï¼šä¼Šç”¸åŒºå’Œå¹¸å­˜åŒºçš„æ¯”ä¾‹ç­‰ç­‰ï¼‰\nï¼ˆæŒ‰ç»éªŒæ¥è¯´ï¼šIOå¯†é›†å‹çš„å¯ä»¥ç¨å¾®æŠŠã€Œå¹´è½»ä»£ã€ç©ºé—´åŠ å¤§äº›ï¼Œå› ä¸ºå¤§å¤šæ•°å¯¹è±¡éƒ½æ˜¯åœ¨å¹´è½»ä»£å°±ä¼šç­äº¡ã€‚å†…å­˜è®¡ç®—å¯†é›†å‹çš„å¯ä»¥ç¨å¾®æŠŠã€Œè€å¹´ä»£ã€ç©ºé—´åŠ å¤§äº›ï¼Œå¯¹è±¡å­˜æ´»æ—¶é—´ä¼šæ›´é•¿äº›ï¼‰\n  é€šè¿‡jpså‘½ä»¤æŸ¥çœ‹Javaè¿›ç¨‹ã€ŒåŸºç¡€ã€ä¿¡æ¯ï¼ˆè¿›ç¨‹å·ã€ä¸»ç±»ï¼‰ã€‚è¿™ä¸ªå‘½ä»¤å¾ˆå¸¸ç”¨çš„å°±æ˜¯ç”¨æ¥çœ‹å½“å‰æœåŠ¡å™¨æœ‰å¤šå°‘Javaè¿›ç¨‹åœ¨è¿è¡Œï¼Œå®ƒä»¬çš„è¿›ç¨‹å·å’ŒåŠ è½½ä¸»ç±»æ˜¯å•¥\n  jps -l æŸ¥çœ‹ä¸»ç±»ï¼Œè¿›ç¨‹\n  jps -v æŸ¥çœ‹jvmå‚æ•°\n  é€šè¿‡jstatå‘½ä»¤æŸ¥çœ‹Javaè¿›ç¨‹ã€Œç»Ÿè®¡ç±»ã€ç›¸å…³çš„ä¿¡æ¯ï¼ˆç±»åŠ è½½ã€ç¼–è¯‘ç›¸å…³ä¿¡æ¯ç»Ÿè®¡ï¼Œå„ä¸ªå†…å­˜åŒºåŸŸGCæ¦‚å†µå’Œç»Ÿè®¡ï¼‰ã€‚è¿™ä¸ªå‘½ä»¤å¾ˆå¸¸ç”¨äºçœ‹GCçš„æƒ…å†µ\n  gcå›æ”¶ç»Ÿè®¡ jstat -gc pid\n  å †å†…å­˜ç»Ÿè®¡ jstat -gccapacity pid\n  jmap -dump:live,format=b,file=/home/tess.dump\näº§ç”Ÿä¸€ä¸ªHeapDumpæ–‡ä»¶\n  XX:+HeapDumpOnOutOfMemoryError -XX:HeapDumpPath=/tmp/heapdump.hprof\nå¢åŠ oomçš„æ—¶å€™ï¼Œè‡ªåŠ¨å¯¼å‡ºå½“å‰å †çš„dump\nè¿™ä¸ªå‘½ä»¤å¾ˆå¸¸ç”¨äºæŠŠJVMå†…å­˜ä¿¡æ¯dumpåˆ°æ–‡ä»¶ï¼Œç„¶åå†ç”¨MAT( Memory Analyzer tool å†…å­˜è§£æå·¥å…·)æŠŠæ–‡ä»¶è¿›è¡Œåˆ†æ\n  é€šè¿‡jinfoå‘½ä»¤æ¥æŸ¥çœ‹å’Œè°ƒæ•´Javaè¿›ç¨‹çš„ã€Œè¿è¡Œå‚æ•°ã€ã€‚\n  é€šè¿‡jstackå‘½ä»¤æ¥æŸ¥çœ‹JVMã€Œçº¿ç¨‹ä¿¡æ¯ã€ã€‚è¿™ä¸ªå‘½ä»¤ç”¨å¸¸ç”¨è¯­æ’æŸ¥æ­»é”ç›¸å…³çš„é—®é¢˜\n  ä¸€ä¸ªå¯¹è±¡åˆ°åº•æœ‰å¤šå¤§ï¼Œâ€œå¯¹è±¡åœ¨å†…å­˜ä¸­é•¿ä»€ä¹ˆæ ·å­â€ 1.å¯¹è±¡å¤´ä¸­çš„Mark Wordï¼ˆæ ‡è®°å­—ï¼‰ä¸»è¦ç”¨æ¥è¡¨ç¤ºå¯¹è±¡çš„çº¿ç¨‹é”çŠ¶æ€ï¼Œå¦å¤–è¿˜å¯ä»¥ç”¨æ¥é…åˆGCã€å­˜æ”¾è¯¥å¯¹è±¡çš„hashCodeï¼›\n2.Klass Wordæ˜¯ä¸€ä¸ªæŒ‡å‘æ–¹æ³•åŒºä¸­Classä¿¡æ¯çš„æŒ‡é’ˆï¼Œæ„å‘³ç€è¯¥å¯¹è±¡å¯éšæ—¶çŸ¥é“è‡ªå·±æ˜¯å“ªä¸ªClassçš„å®ä¾‹ï¼›\n3.æ•°ç»„é•¿åº¦ä¹Ÿæ˜¯å ç”¨64ä½ï¼ˆ8å­—èŠ‚ï¼‰çš„ç©ºé—´ï¼Œè¿™æ˜¯å¯é€‰çš„ï¼Œåªæœ‰å½“æœ¬å¯¹è±¡æ˜¯ä¸€ä¸ªæ•°ç»„å¯¹è±¡æ—¶æ‰ä¼šæœ‰è¿™ä¸ªéƒ¨åˆ†ï¼›\n4.å¯¹è±¡ä½“æ˜¯ç”¨äºä¿å­˜å¯¹è±¡å±æ€§å’Œå€¼çš„ä¸»ä½“éƒ¨åˆ†ï¼Œå ç”¨å†…å­˜ç©ºé—´å–å†³äºå¯¹è±¡çš„å±æ€§æ•°é‡å’Œç±»å‹ï¼›\n5.å¯¹é½å­—æ˜¯ä¸ºäº†å‡å°‘å †å†…å­˜çš„ç¢ç‰‡ç©ºé—´ï¼ˆä¸ä¸€å®šå‡†ç¡®ï¼‰ã€‚\nç½‘ç»œ äº¤æ¢æœºå’Œè·¯ç”±å™¨åŒºåˆ« NasçŸ¥é“å— ä»€ä¹ˆé•¿é“¾æ¥ï¼Œä»€ä¹ˆæ—¶å€™è¯¥ç”¨é•¿é“¾æ¥ï¼Œä»€ä¹ˆåˆæ˜¯é•¿è½®è®­ï¼ŒçŸ­è½®è®­ã€‚javaæ€ä¹ˆå®ç° javaæ€ä¹ˆå†™UDPï¼Ÿä¸ºä»€ä¹ˆè¦ç”¨UDP å¼‚æ­¥è¯·æ±‚çŸ¥é“å—ï¼Ÿæœ‰ä»€ä¹ˆåœºæ™¯å¯ä»¥ç”¨åˆ°å—ï¼Œjavaæ€ä¹ˆå†™ï¼Ÿ è®²ä¸€ä¸‹TCP/IPï¼Œå®ƒå’ŒHTTPçš„å…³ç³» ä»€ä¹ˆæ˜¯WebSocketï¼ŒWSæ˜¯é•¿é“¾æ¥å—ï¼ŒWSSåˆæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ TCPé•¿é“¾æ¥å’ŒHTTPé•¿é“¾æ¥æœ‰ä»€ä¹ˆåŒºåˆ« Nettyå¹²ä»€ä¹ˆçš„ï¼Œç”¨è¿‡å— ä½ çŸ¥é“å“ªäº›ç½‘ç»œæ¨¡å‹ï¼Ÿ   OSIç½‘ç»œ7å±‚æ¨¡å‹\n åº”ç”¨å±‚ï¼šå„ç§webåº”ç”¨ è¡¨ç¤ºå±‚ï¼šæ•°æ®æ ¼å¼æ ‡è¯†ï¼ŒåŸºæœ¬åŠ è§£å¯† ä¼šè¯å±‚ï¼šæ§åˆ¶å„ä¸ªç¨‹åºä¹‹é—´çš„ä¼šè¯èƒ½åŠ›ï¼Œè½¯ä»¶æ•°æ®åˆ†å‘ç»™å…¶ä»–ä¸åŒçš„è½¯ä»¶ ä¼ è¾“å±‚ï¼šTCP UDPåè®® ç½‘ç»œå±‚ï¼šå®šä¹‰IPåœ°å€ï¼Œå®šä¹‰è·¯ç”±çš„åŸºæœ¬åŠŸèƒ½ï¼Œå®ç°è®¾å¤‡ä¹‹é—´çš„æ•°æ®è½¬å‘ æ•°æ®é“¾è·¯å±‚ï¼šå®šä¹‰æ•°æ®çš„åŸºæœ¬æ ¼å¼ï¼Œå¦‚ä½•ä¼ è¾“ã€å¦‚ä½•æ ‡è¯†ï¼Œä¾‹å¦‚ç½‘å¡çš„MACåœ°å€ ç‰©ç†å±‚ï¼šç‰©ç†è®¾å¤‡çš„ä¼ è¾“ï¼Œä¾‹å¦‚ç½‘å¡æ ‡å‡†ã€ç½‘çº¿æ ‡å‡†    TCP/IPæ¨¡å‹\n åº”ç”¨å±‚ï¼šå„ç§åŸºäºTCP/IPçš„åè®®ï¼Œä¾‹å¦‚HTTPã€FTPã€SMTP ä¼ è¾“å±‚ï¼šTCPæˆ–è€…UDPåè®® ç½‘ç»œå±‚ï¼šå®ƒè´Ÿè´£ä¸ºä¸¤å°ä¸»æœºæä¾›é€šä¿¡æœåŠ¡ï¼Œå¹¶é€šè¿‡é€‰æ‹©åˆé€‚çš„è·¯ç”±å°†æ•°æ®ä¼ é€’åˆ°ç›®æ ‡ä¸»æœºã€‚ ç½‘ç»œæ¥å£å±‚ï¼šç‰©ç†è®¾å¤‡çš„ç¯å¢ƒ    äº”å±‚ç½‘ç»œæ¨¡å‹\nç”±OSI7å±‚æ¨¡å‹æ¼”å˜è€Œæ¥\n  ä½ çŸ¥é“å“ªäº›IOæ¨¡å‹ï¼ŒBIOã€NIOã€AIOéƒ½æ˜¯ä»€ä¹ˆï¼Œä»–ä»¬çš„ä½¿ç”¨åœºæ™¯æ˜¯ä»€ä¹ˆ   javaä¸­çš„IOæ¨¡å‹\n  BIO\nBlocking IOï¼Œä¼ ç»Ÿçš„åŒæ­¥é˜»å¡IOï¼Œå¯¹åº”ç€java.ioï¼Œä¾‹å¦‚æ–‡ä»¶çš„è¯»å–ï¼Œè¾“å…¥è¾“å‡ºæµï¼ŒSocketçš„ç½‘ç»œç¼–ç¨‹\n  NIO\nNo Blocking IO/New IOï¼ŒåŒæ­¥éé˜»å¡IOï¼Œå¯¹åº”ç€jdk1.4ä¹‹åè¿›å…¥çš„nioï¼Œå¯¹äºjava.nioï¼Œæä¾›äº†Channelï¼ŒBufferï¼ŒSelectorç­‰æŠ½è±¡\n  AIO\nAsync IO ï¼Œå¼‚æ­¥éé˜»å¡IOï¼Œåœ¨ Java 7 ä¸­å¼•å…¥äº† NIO çš„æ”¹è¿›ç‰ˆ NIO 2,å®ƒæ˜¯å¼‚æ­¥éé˜»å¡çš„IOæ¨¡å‹\n    javaä¸­çš„ioæ“ä½œæœ€ç»ˆè¿˜æ˜¯ä¾èµ–äºæ“ä½œç³»ç»Ÿçš„ioå®ç°çš„ï¼Œå¦‚åœ¨Linux 2.6ä»¥åï¼ŒJavaä¸­çš„NIOå’ŒAIOéƒ½æ˜¯é€šè¿‡ epoll\n  Linuxä¸­çš„IOæ¨¡å‹\n  BIO\n ä¸€ä¸ªè¾“å…¥æ“ä½œé€šå¸¸åŒ…æ‹¬ä¸¤ä¸ªä¸åŒçš„é˜¶æ®µ:\n ç­‰å¾…æ•°æ®å‡†å¤‡å¥½ ä»å†…æ ¸å‘è¿›ç¨‹å¤åˆ¶æ•°æ®  å¯¹äºä¸€ä¸ªå¥—æ¥å­—ä¸Šçš„è¾“å…¥æ“ä½œï¼Œç¬¬ä¸€æ­¥é€šå¸¸æ¶‰åŠç­‰å¾…æ•°æ®ä»ç½‘ç»œä¸­åˆ°è¾¾ï¼Œå½“æ‰€ç­‰å¾…åˆ†ç»„åˆ°è¾¾æ—¶ï¼Œå®ƒè¢«å¤åˆ¶åˆ°å†…æ ¸ä¸­çš„æŸä¸ªç¼“å†²åŒºï¼Œç¬¬äºŒæ­¥å°±æ˜¯æŠŠæ•°æ®ä»å†…æ ¸ç¼“å†²åŒºå¤åˆ¶åˆ°åº”ç”¨è¿›ç¨‹ç¼“å†²åŒºã€‚\nä»ä¸Šå›¾å¯ä»¥çœ‹å‡ºï¼Œåº”ç”¨è¿›ç¨‹é€šè¿‡ ç³»ç»Ÿè°ƒç”¨ recvfrom å»æ¥æ”¶æ•°æ®ï¼Œè€Œç”±äºå†…æ ¸æ•°æ®æ²¡æœ‰å‡†å¤‡å¥½ï¼Œåº”ç”¨è¿›ç¨‹å°±ä¼šé˜»å¡ï¼Œç›´åˆ°å†…æ ¸å‡†å¤‡å¥½æ•°æ®å¹¶å°†å…¶ä»å†…æ ¸å¤åˆ¶åˆ°åº”ç”¨è¿›ç¨‹çš„ç¼“å†²åŒºä¸­æˆ–è€…å‘ç”Ÿé”™è¯¯æ‰è¿”å›ã€‚æœ€å¸¸è§çš„é”™è¯¯å°±æ˜¯ç³»ç»Ÿè°ƒç”¨è¢«ä¿¡å·ä¸­æ–­ã€‚è¿›ç¨‹ä»è°ƒç”¨recvfromå¼€å§‹åˆ°å®ƒè¿”å›çš„æ•´æ®µæ—¶é—´å†…æ˜¯è¢«é˜»å¡çš„ã€‚\nLinuxä¸‹çš„é˜»å¡å¼I/Oæ¨¡å‹å°±å¯¹åº”äº†Javaä¸‹çš„BIOæ¨¡å‹ï¼ŒBIOçš„åº•å±‚å®ç°æ˜¯è°ƒç”¨æ“ä½œç³»ç»Ÿçš„APIå»æ‰§è¡Œçš„ï¼Œä¹Ÿå°±æ˜¯è°ƒç”¨æ“ä½œç³»ç»Ÿçš„Socketå¥—æ¥å­—ã€‚\n   NIO\n åº”ç”¨è¿›ç¨‹é€šè¿‡ç³»ç»Ÿè°ƒç”¨ recvfrom ä¸æ–­çš„å»å’Œå†…æ ¸äº¤äº’ï¼Œç›´åˆ°å†…æ ¸æ•°æ®æŠ¥å‡†å¤‡å¥½ï¼Œè€Œå¦‚æœå†…æ ¸æ— æ•°æ®å‡†å¤‡å¥½ï¼Œè½¬è€Œç«‹å³è¿”å›ä¸€ä¸ª EWOULDBLOCKçš„é”™è¯¯ï¼Œè¿‡ä¸€æ®µæ—¶é—´å†æ¬¡å‘é€ recvfromè¯·æ±‚ï¼Œåœ¨æ­¤æœŸé—´è¿›ç¨‹å¯ä»¥åšå…¶ä»–äº‹æƒ…ï¼Œä¸ç”¨ä¸€ç›´ç­‰å¾…ï¼Œè¿™å°±æ˜¯éé˜»å¡ã€‚\nå½“ä¸€ä¸ªåº”ç”¨è¿›ç¨‹å¾ªç¯è°ƒç”¨ recvfromæ—¶ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºè½®è¯¢(polling)ï¼Œåº”ç”¨è¿›ç¨‹æŒç»­è½®è¯¢å†…æ ¸ï¼Œä»¥æŸ¥çœ‹æŸä¸ªæ“ä½œæ˜¯å¦å°±ç»ªã€‚Javaçš„NIOæ˜ å°„åˆ°Linuxæ“ä½œç³»ç»Ÿå°±æ˜¯å¦‚ä¸Šå›¾æ‰€ç¤ºçš„éé˜»å¡I/Oæ¨¡å‹\n   I/Oå¤ç”¨æ¨¡å‹\n IOå¤šè·¯å¤ç”¨ä½¿ç”¨select/poll/epollå‡½æ•°ï¼Œå¤šä¸ªè¿›ç¨‹çš„IOéƒ½å¯ä»¥æ³¨å†Œåœ¨åŒä¸€ä¸ª select ä¸Šï¼Œå½“ç”¨æˆ·è¿›ç¨‹è°ƒç”¨è¯¥ selectæ—¶ï¼Œselectå»ç›‘å¬æ‰€æœ‰æ³¨å†Œå¥½çš„IO,å¦‚æœæ‰€æœ‰è¢«ç›‘å¬çš„IOéœ€è¦çš„æ•°æ®éƒ½æ²¡æœ‰å‡†å¤‡å¥½ï¼Œé‚£ä¹ˆ selectè°ƒç”¨è¿›ç¨‹ä¼šè¢«é˜»å¡ï¼Œåªè¦ä»»æ„ä¸€ä¸ªIOçš„æ•°æ®æŠ¥å¥—æ¥å­—å˜ä¸ºå¯è¯»ï¼Œå³æ•°æ®æŠ¥å·²ç»å‡†å¤‡å¥½ï¼Œselect å°±è¿”å›å¥—æ¥å­—å¯è¯»è¿™ä¸€æ¡ä»¶ï¼Œç„¶åè°ƒç”¨ recvfromæŠŠæ‰€è¯»æ•°æ®æŠ¥å¤åˆ¶åˆ°åº”ç”¨è¿›ç¨‹ç¼“å†²åŒºã€‚\nå¼ºè°ƒä¸€ç‚¹å°±æ˜¯ï¼ŒIOå¤šè·¯å¤ç”¨æ¨¡å‹å¹¶æ²¡æœ‰æ¶‰åŠåˆ°éé˜»å¡ï¼Œè¿›ç¨‹åœ¨å‘å‡ºselectåï¼Œè¦ä¸€ç›´é˜»å¡ç­‰å¾…å…¶ç›‘å¬çš„æ‰€æœ‰IOæ“ä½œè‡³å°‘æœ‰ä¸€ä¸ªæ•°æ®å‡†å¤‡å¥½æ‰è¿”å›ï¼Œå¼ºè°ƒé˜»å¡çŠ¶æ€ï¼Œä¸å­˜åœ¨éé˜»å¡ã€‚\nè€Œåœ¨ Java NIOä¸­ä¹Ÿå¯ä»¥å®ç°å¤šè·¯å¤ç”¨ï¼Œä¸»è¦æ˜¯åˆ©ç”¨å¤šè·¯å¤ç”¨å™¨ Selectorï¼Œä¸è¿™é‡Œçš„ selectå‡½æ•°ç±»å‹ï¼ŒSelectorä¼šä¸æ–­è½®è¯¢æ³¨å†Œåœ¨å…¶ä¸Šçš„é€šé“Channelï¼Œå¦‚æœæœ‰æŸä¸€ä¸ªChannelä¸Šé¢å‘ç”Ÿè¯»æˆ–å†™äº‹ä»¶ï¼Œè¿™ä¸ªChannelå¤„äºå°±ç»ªçŠ¶æ€ï¼Œå°±ä¼šè¢«Selectorè½®è¯¢å‡ºæ¥ã€‚\n   ä¿¡å·é©±åŠ¨å¼/ioæ¨¡å‹\n åº”ç”¨è¿›ç¨‹é¢„å…ˆå‘å†…æ ¸å®‰è£…ä¸€ä¸ªä¿¡å·å¤„ç†å‡½æ•°ï¼Œç„¶åç«‹å³è¿”å›ï¼Œè¿›ç¨‹ç»§ç»­å·¥ä½œï¼Œä¸é˜»å¡ï¼Œå½“æ•°æ®æŠ¥å‡†å¤‡å¥½è¯»å–æ—¶ï¼Œå†…æ ¸å°±ä¸ºè¯¥è¿›ç¨‹äº§ç”Ÿä¸€ä¸ªä¿¡å·é€šçŸ¥è¿›ç¨‹ï¼Œç„¶åè¿›ç¨‹å†è°ƒç”¨recvfromè¯»å–æ•°æ®æŠ¥ã€‚\nä¿¡å·é©±åŠ¨å¼IOåœ¨æ•°æ®å‡†å¤‡é˜¶æ®µæ˜¯å¼‚æ­¥çš„ï¼Œå½“å†…æ ¸ä¸­æœ‰æ•°æ®æŠ¥å‡†å¤‡åå†é€šçŸ¥è¿›ç¨‹ï¼Œä½†æ˜¯åœ¨è°ƒç”¨ recvfromæ“ä½œè¿›è¡Œæ•°æ®æ‹·è´æ—¶æ˜¯åŒæ­¥çš„ï¼Œæ‰€ä»¥æ€»ä½“æ¥è¯´ï¼Œæ•´ä¸ªIOè¿‡ç¨‹ä¸èƒ½æ˜¯å¼‚æ­¥çš„ã€‚\n   å¼‚æ­¥IOæ¨¡å‹ï¼ŒAIO\n åº”ç”¨è¿›ç¨‹è°ƒç”¨aio_readå‡½æ•°ï¼Œç»™å†…æ ¸ä¼ é€’æè¿°ç¬¦ï¼Œç¼“å­˜åŒºæŒ‡é’ˆï¼Œç¼“å­˜åŒºå¤§å°å’Œæ–‡ä»¶åç§»ï¼Œå¹¶å‘Šè¯‰å†…æ ¸å½“æ•´ä¸ªæ“ä½œå®Œæˆæ—¶å¦‚ä½•é€šçŸ¥è¿›ç¨‹ï¼Œç„¶åè¯¥ç³»ç»Ÿè°ƒç”¨ç«‹å³è¿”å›ï¼Œè€Œä¸”åœ¨ç­‰å¾…I/Oå®ŒæˆæœŸé—´ï¼Œæˆ‘ä»¬çš„è¿›ç¨‹ä¸è¢«é˜»å¡ï¼Œè¿›ç¨‹å¯ä»¥å»å¹²å…¶ä»–äº‹æƒ…ï¼Œç„¶åå†…æ ¸å¼€å§‹ç­‰å¾…æ•°æ®å‡†å¤‡ï¼Œæ•°æ®å‡†å¤‡å¥½ä»¥åå†æ‹·è´æ•°æ®åˆ°è¿›ç¨‹ç¼“å†²åŒºï¼Œæœ€åé€šçŸ¥æ•´ä¸ªIOæ“ä½œå·²å®Œæˆã€‚\nJavaçš„AIOæä¾›äº†å¼‚æ­¥é€šé“APIï¼Œå…¶æ“ä½œç³»ç»Ÿåº•å±‚å®ç°å°±æ˜¯è¿™ä¸ªå¼‚æ­¥I/Oæ¨¡å‹\n     ä½¿ç”¨åœºæ™¯\n BIOæ–¹å¼é€‚ç”¨äºè¿æ¥æ•°ç›®æ¯”è¾ƒå°ä¸”å›ºå®šçš„æ¶æ„ï¼Œè¿™ç§æ–¹å¼å¯¹æœåŠ¡å™¨èµ„æºè¦æ±‚æ¯”è¾ƒé«˜ï¼Œå¹¶å‘å±€é™äºåº”ç”¨ä¸­ï¼ŒJDK1.4ä»¥å‰çš„å”¯ä¸€é€‰æ‹©ï¼Œä½†ç¨‹åºç›´è§‚ç®€å•æ˜“ç†è§£ã€‚\nNIOæ–¹å¼é€‚ç”¨äºè¿æ¥æ•°ç›®å¤šä¸”è¿æ¥æ¯”è¾ƒçŸ­ï¼ˆè½»æ“ä½œï¼‰çš„æ¶æ„ï¼Œæ¯”å¦‚èŠå¤©æœåŠ¡å™¨ï¼Œå¹¶å‘å±€é™äºåº”ç”¨ä¸­ï¼Œç¼–ç¨‹æ¯”è¾ƒå¤æ‚ï¼ŒJDK1.4å¼€å§‹æ”¯æŒã€‚\nAIOæ–¹å¼é€‚ç”¨äºè¿æ¥æ•°ç›®å¤šä¸”è¿æ¥æ¯”è¾ƒé•¿ï¼ˆé‡æ“ä½œï¼‰çš„æ¶æ„ï¼Œæ¯”å¦‚ç›¸å†ŒæœåŠ¡å™¨ï¼Œå……åˆ†è°ƒç”¨OSå‚ä¸å¹¶å‘æ“ä½œï¼Œç¼–ç¨‹æ¯”è¾ƒå¤æ‚ï¼ŒJDK7å¼€å§‹æ”¯æŒã€‚\n   è®²ä¸€ä¸‹Httpsã€Httpã€Http1.0ã€Http1.1ã€Http2 ä»€ä¹ˆæ˜¯å¤šè·¯å¤ç”¨   IOå¤šè·¯å¤ç”¨æ˜¯ä¸€ç§åŒæ­¥IOæ¨¡å‹ï¼Œå®ç°ä¸€ä¸ªçº¿ç¨‹å¯ä»¥ç›‘è§†å¤šä¸ªæ–‡ä»¶å¥æŸ„ï¼›ä¸€æ—¦æŸä¸ªæ–‡ä»¶å¥æŸ„å°±ç»ªï¼Œå°±èƒ½å¤Ÿé€šçŸ¥åº”ç”¨ç¨‹åºè¿›è¡Œç›¸åº”çš„è¯»å†™æ“ä½œï¼›æ²¡æœ‰æ–‡ä»¶å¥æŸ„å°±ç»ªæ—¶ä¼šé˜»å¡åº”ç”¨ç¨‹åºï¼Œäº¤å‡ºcpuã€‚å¤šè·¯æ˜¯æŒ‡å¤šä¸ªç½‘ç»œè¿æ¥å¤šä¸ªå¥æŸ„ï¼Œå¤ç”¨æŒ‡çš„æ˜¯åŒä¸€ä¸ªçº¿ç¨‹ï¼ˆç»“åˆä¸Šå›¾ï¼‰ï¼Œå®é™…ä¸Šåœ¨ä»£ç ä¸­ï¼Œä¸€ä¸ªçº¿ç¨‹å»è°ƒç”¨selectæ–¹æ³•ï¼Œå½“æ²¡æœ‰è¿æ¥å‡†å¤‡å¥½çš„æ—¶å€™ï¼Œselecté˜»å¡ã€‚selectè¿”å›è¿æ¥åˆ—è¡¨ï¼Œè¿›è¡Œå¤„ç†\nfds = [listen_fd] // ä¼ªä»£ç æè¿° while(1) { // é€šè¿‡å†…æ ¸è·å–æœ‰è¯»å†™äº‹ä»¶å‘ç”Ÿçš„fdï¼Œåªè¦æœ‰ä¸€ä¸ªåˆ™è¿”å›ï¼Œæ— åˆ™é˜»å¡ // æ•´ä¸ªè¿‡ç¨‹åªåœ¨è°ƒç”¨selectã€pollã€epollè¿™äº›è°ƒç”¨çš„æ—¶å€™æ‰ä¼šé˜»å¡ï¼Œaccept/recvæ˜¯ä¸ä¼šé˜»å¡ for (fd in select(fds)) { if (fd == listen_fd) { client_fd = accept(listen_fd) fds.append(client_fd) } elseif (len = recv(fd) \u0026amp;\u0026amp; len != -1) { // logic } } }   linuxå®ç°å¤šè·¯å¤ç”¨çš„æ–¹å¼\n  epollçš„etå’Œltçš„åŒºåˆ«\nepoll LT ä¸ ETæ¨¡å¼çš„åŒºåˆ«\n epollæœ‰EPOLLLTå’ŒEPOLLETä¸¤ç§è§¦å‘æ¨¡å¼ï¼ŒLTæ˜¯é»˜è®¤çš„æ¨¡å¼ï¼ŒETæ˜¯â€œé«˜é€Ÿâ€æ¨¡å¼ã€‚ LTæ¨¡å¼ä¸‹ï¼Œåªè¦è¿™ä¸ªfdè¿˜æœ‰æ•°æ®å¯è¯»ï¼Œæ¯æ¬¡ epoll_waitéƒ½ä¼šè¿”å›å®ƒçš„äº‹ä»¶ï¼Œæé†’ç”¨æˆ·ç¨‹åºå»æ“ä½œ ETæ¨¡å¼ä¸‹ï¼Œå®ƒåªä¼šæç¤ºä¸€æ¬¡ï¼Œç›´åˆ°ä¸‹æ¬¡å†æœ‰æ•°æ®æµå…¥ä¹‹å‰éƒ½ä¸ä¼šå†æç¤ºäº†ï¼Œæ— è®ºfdä¸­æ˜¯å¦è¿˜æœ‰æ•°æ®å¯è¯»ã€‚æ‰€ä»¥åœ¨ETæ¨¡å¼ä¸‹ï¼Œreadä¸€ä¸ªfdçš„æ—¶å€™ä¸€å®šè¦æŠŠå®ƒçš„bufferè¯»å®Œï¼Œæˆ–è€…é‡åˆ°EAGAINé”™è¯¯    ä»£ç ä¹¦å†™ èŠèŠè®¾è®¡æ¨¡å¼ï¼Œä½ çŸ¥é“å“ªäº›ï¼Œç”¨è¿‡å“ªäº›ï¼Œä¸ºä»€ä¹ˆè¦ç”¨è®¾è®¡æ¨¡å¼ æ•°æ®ç»“æ„ ä½ çŸ¥é“å“ªäº›æ•°æ®ç»“æ„  æ ‘ çº¿æ€§è¡¨ï¼ˆæ•°ç»„å’Œé“¾è¡¨å®ç°ï¼‰ å † å›¾ å­—å…¸ï¼ˆhashMapï¼‰  çº¢é»‘æ ‘ã€Bæ ‘ã€B+æ ‘ã€äºŒå‰æ ‘ã€å®Œå…¨å¹³è¡¡äºŒå‰æ ‘   æ ‘\nä¸€ç§æ•°æ®ç»“æ„ï¼Œæ¯ä¸ªå…ƒç´ å¯ä»¥æœ‰å­æ ‘\n  äºŒå‰æ ‘\nä¸€ç§â€œæ ‘â€æ•°æ®ç»“æ„ï¼Œæ»¡è¶³æ¯ä¸ªå…ƒç´ æœ€å¤šåªæœ‰2ä¸ªå­æ ‘ã€‚\n  éå†æ–¹å¼\n å‰åºéå†ï¼šä¸­å·¦å³é€æ¸éå†ï¼Œå¯ä»¥å¾—åˆ°ä¸€æ¡æœç´¢è·¯å¾„ï¼Œç”¨äºæœç´¢ã€‚ ä¸­åºéå†ï¼šå·¦ä¸­å³ï¼Œå¯ä»¥å¾—åˆ°ä¸€ä¸ªæœ‰åºåˆ—è¡¨ã€‚ ååºéå†ï¼šç”¨æ¥è®¡ç®—ä¸€é¢—æ ‘ç®—æœ¯è¡¨è¾¾å¼    æ»¡äºŒå‰æ ‘ï¼Œæ‰€æœ‰é™¤äº†å¶å­ç»“ç‚¹çš„èŠ‚ç‚¹éƒ½æœ‰2ä¸ªèŠ‚ç‚¹\n  å®Œå…¨äºŒå‰æ ‘ï¼Œå¶å­ç»“ç‚¹åªä¼šå­˜åœ¨äºå€’æ•°ç¬¬ä¸€å’Œå€’æ•°ç¬¬äºŒå±‚ï¼Œå¹¶ä¸”å¶å­ç»“ç‚¹éƒ½éƒ½åå·¦\nå®Œå…¨äºŒå‰æ ‘ç”±äºä»–çš„å®šä¹‰ï¼Œå¯ä»¥ä½¿ç”¨æ•°ç»„æ¥å­˜æ”¾ï¼Œè€Œä¸ç”¨é“¾è¡¨æ¥å­˜å‚¨ï¼Œå¯ä»¥èŠ‚çœå·¦å³ä¸¤ä¸ªæŒ‡é’ˆçš„å¤§å°ç©ºé—´ã€‚ä¾‹å¦‚æ ¹èŠ‚ç‚¹æ˜¯ä¸‹æ ‡iï¼Œå·¦èŠ‚ç‚¹ä¸‹æ ‡å°±æ˜¯2iï¼Œå³èŠ‚ç‚¹ä¸‹æ ‡å°±æ˜¯2i+1\n  äºŒå‰æœç´¢æ ‘(BST)\næ ¹èŠ‚ç‚¹çš„å€¼å¤§äºå…¶å·¦å­æ ‘ä¸­ä»»æ„ä¸€ä¸ªèŠ‚ç‚¹çš„å€¼ï¼Œå°äºå…¶å³èŠ‚ç‚¹ä¸­ä»»æ„ä¸€èŠ‚ç‚¹çš„å€¼ï¼Œè¿™ä¸€è§„åˆ™é€‚ç”¨äºäºŒå‰æŸ¥æ‰¾æ ‘ä¸­çš„æ¯ä¸€ä¸ªèŠ‚ç‚¹ã€‚\næœ€å¥½çš„æ—¶é—´å¤æ‚åº¦æ˜¯O(logn)ï¼Œæœ€å¿«çš„æƒ…å†µä¼šé€€åŒ–ä¸ºé“¾è¡¨\n  å¹³è¡¡äºŒå‰æ ‘(AVL)\né€šè¿‡å¹³è¡¡çš„åŠ¨ä½œå·¦æ—‹å’Œå³æ—‹ï¼Œè§£å†³äºŒå‰æœç´¢æ ‘é€€åŒ–ä¸ºé“¾è¡¨çš„é—®é¢˜ã€‚å®Œå…¨å¹³è¡¡äºŒå‰æ ‘æ˜¯åªä¿è¯å·¦å³å­æ ‘çš„æ·±åº¦ä¸ä¼šè¶…è¿‡1\n  çº¢é»‘æ ‘\nç”±äºå®Œå…¨å¹³è¡¡äºŒå‰æ ‘è¦æ±‚å·¦å³å­æ ‘æ·±åº¦ä¸èƒ½è¶…è¿‡1ï¼Œå¯¼è‡´æ¯æ¬¡æ’å…¥ä¸€ä¸ªæ–°èŠ‚ç‚¹æ—¶éƒ½ä¼šå¸¦æ¥å¹³è¡¡çš„åŠ¨ä½œã€‚å› ä¸º1ç‰¹åˆ«è‹›åˆ»ï¼Œå‡ ä¹æ¯æ¬¡éƒ½è¦å¹³è¡¡ã€‚æœ€åå¹³è¡¡æ‰€èŠ±è´¹çš„æ—¶é—´ä»£ä»·è¿‡é«˜ã€‚\nè§£å†³ï¼Œå®Œå…¨å¹³è¡¡äºŒå‰æ ‘å¹³è¡¡é¢‘ç‡è¿‡äºé¢‘ç¹ã€‚\nèƒ½å¤Ÿä¿è¯å·¦å³å­æ ‘çš„é«˜åº¦ä¸è¶…è¿‡2å€æ—¶é—´å¤æ‚åº¦log(n)\n äºŒå‰æœç´¢æ ‘ï¼šä¹Ÿç§°äºŒå‰æŸ¥æ‰¾æ ‘ï¼Œæˆ–äºŒå‰æ’åºæ ‘ã€‚å®šä¹‰ä¹Ÿæ¯”è¾ƒç®€å•ï¼Œè¦ä¹ˆæ˜¯ä¸€é¢—ç©ºæ ‘ï¼Œè¦ä¹ˆå°±æ˜¯å…·æœ‰å¦‚ä¸‹æ€§è´¨çš„äºŒå‰æ ‘ï¼š ï¼ˆ1ï¼‰è‹¥ä»»æ„èŠ‚ç‚¹çš„å·¦å­æ ‘ä¸ç©ºï¼Œåˆ™å·¦å­æ ‘ä¸Šæ‰€æœ‰ç»“ç‚¹çš„å€¼å‡å°äºå®ƒçš„æ ¹ç»“ç‚¹çš„ å€¼ï¼› ï¼ˆ2ï¼‰è‹¥ä»»æ„èŠ‚ç‚¹çš„å³å­æ ‘ä¸ç©ºï¼Œåˆ™å³å­æ ‘ä¸Šæ‰€æœ‰ç»“ç‚¹çš„å€¼å‡å¤§äºå®ƒçš„æ ¹ç»“ç‚¹çš„ å€¼ï¼› ï¼ˆ3ï¼‰ä»»æ„èŠ‚ç‚¹çš„å·¦ã€å³å­æ ‘ä¹Ÿåˆ†åˆ«ä¸ºäºŒå‰æŸ¥æ‰¾æ ‘ï¼› ï¼ˆ4ï¼‰æ²¡æœ‰é”®å€¼ç›¸ç­‰çš„èŠ‚ç‚¹ã€‚\nå¹³è¡¡äºŒå‰æ ‘ï¼šåœ¨äºŒå‰æœç´¢æ ‘çš„åŸºç¡€ä¸Šå¤šäº†ä¸¤ä¸ªé‡è¦çš„ç‰¹ç‚¹ï¼š ï¼ˆ1ï¼‰å·¦å³ä¸¤å­æ ‘çš„é«˜åº¦å·®çš„ç»å¯¹å€¼ä¸èƒ½è¶…è¿‡ 1ï¼› ï¼ˆ2ï¼‰å·¦å³ä¸¤å­æ ‘ä¹Ÿæ˜¯ä¸€é¢—å¹³è¡¡äºŒå‰æ ‘ã€‚\nçº¢é»‘æ ‘ï¼šçº¢é»‘æ ‘æ˜¯åœ¨æ™®é€šäºŒå‰æ ‘ä¸Šï¼Œå¯¹æ¯ä¸ªèŠ‚ç‚¹æ·»åŠ ä¸€ä¸ªé¢œè‰²å±æ€§å½¢æˆçš„ï¼Œéœ€è¦åŒæ—¶æ»¡è¶³ä¸€ä¸‹äº”æ¡æ€§è´¨ï¼š ï¼ˆ1ï¼‰èŠ‚ç‚¹æ˜¯çº¢è‰²æˆ–è€…æ˜¯é»‘è‰²ï¼› ï¼ˆ2ï¼‰æ ¹èŠ‚ç‚¹æ˜¯é»‘è‰²ï¼› ï¼ˆ3ï¼‰æ¯ä¸ªå¶èŠ‚ç‚¹ï¼ˆNIL æˆ–ç©ºèŠ‚ç‚¹ï¼‰æ˜¯é»‘è‰²ï¼› ï¼ˆ4ï¼‰æ¯ä¸ªçº¢è‰²èŠ‚ç‚¹çš„ä¸¤ä¸ªå­èŠ‚ç‚¹éƒ½æ˜¯é»‘è‰²çš„ï¼ˆä¹Ÿå°±æ˜¯è¯´ä¸å­˜åœ¨ä¸¤ä¸ªè¿ç»­çš„çº¢è‰²èŠ‚ ç‚¹ï¼‰ï¼› ï¼ˆ5ï¼‰ä»ä»»ä¸€èŠ‚ç‚¹åˆ°å…¶æ²¡ä¸ªå¶èŠ‚ç‚¹çš„æ‰€æœ‰è·¯å¾„éƒ½åŒ…å«ç›¸åŒæ•°ç›®çš„é»‘è‰²èŠ‚ç‚¹ã€‚\nåŒºåˆ«ï¼šAVL æ ‘éœ€è¦ä¿æŒå¹³è¡¡ï¼Œä½†å®ƒçš„æ—‹è½¬å¤ªè€—æ—¶ï¼Œè€Œçº¢é»‘æ ‘å°±æ˜¯ä¸€ä¸ªæ²¡æœ‰ AVL æ ‘ é‚£æ ·å¹³è¡¡ï¼Œå› æ­¤æ’å…¥ã€åˆ é™¤æ•ˆç‡ä¼šé«˜äº AVL æ ‘ï¼Œè€Œ AVL æ ‘çš„æŸ¥æ‰¾æ•ˆç‡æ˜¾ç„¶é«˜äºçº¢é»‘æ ‘ã€‚\n   å¦‚æœæ’å…¥ä¸€ä¸ªnodeå¼•èµ·äº†æ ‘çš„ä¸å¹³è¡¡ï¼ŒAVLå’ŒRB-Tree(çº¢é»‘æ ‘)éƒ½æ˜¯æœ€å¤šåªéœ€è¦2æ¬¡æ—‹è½¬æ“ä½œï¼Œå³ä¸¤è€…éƒ½æ˜¯O(1)ï¼›ä½†æ˜¯åœ¨åˆ é™¤nodeå¼•èµ·æ ‘çš„ä¸å¹³è¡¡æ—¶ï¼Œæœ€åæƒ…å†µä¸‹ï¼ŒAVLéœ€è¦ç»´æŠ¤ä»è¢«åˆ nodeåˆ°rootè¿™æ¡è·¯å¾„ä¸Šæ‰€æœ‰nodeçš„å¹³è¡¡æ€§ï¼Œå› æ­¤éœ€è¦æ—‹è½¬çš„é‡çº§O(logN)ï¼Œè€ŒRB-Treeæœ€å¤šåªéœ€3æ¬¡(å› ä¸ºä¸éœ€è¦ä¸¥æ ¼çš„å¹³è¡¡ï¼Œä»æ ¹åˆ°å¶å­çš„æœ€é•¿çš„å¯èƒ½è·¯å¾„ä¸å¤šäºæœ€çŸ­çš„å¯èƒ½è·¯å¾„çš„ä¸¤å€é•¿)æ—‹è½¬ä»¥åŠä¿®æ”¹èŠ‚ç‚¹çš„é¢œè‰²ï¼Œåªéœ€è¦O(1)çš„å¤æ‚åº¦ã€‚\n  å…¶æ¬¡ï¼ŒAVLçš„ç»“æ„ç›¸è¾ƒRB-Treeæ¥è¯´æ›´ä¸ºå¹³è¡¡ï¼Œåœ¨æ’å…¥å’Œåˆ é™¤nodeæ›´å®¹æ˜“å¼•èµ·Treeçš„unbalanceï¼Œå› æ­¤åœ¨å¤§é‡æ•°æ®éœ€è¦æ’å…¥æˆ–è€…åˆ é™¤æ—¶ï¼ŒAVLéœ€è¦rebalanceçš„é¢‘ç‡ä¼šæ›´é«˜ã€‚å› æ­¤ï¼ŒRB-Treeåœ¨éœ€è¦å¤§é‡æ’å…¥å’Œåˆ é™¤nodeçš„åœºæ™¯ä¸‹ï¼Œæ•ˆç‡æ›´é«˜ã€‚è‡ªç„¶ï¼Œç”±äºAVLé«˜åº¦å¹³è¡¡ï¼Œå› æ­¤AVLçš„searchæ•ˆç‡æ›´é«˜ã€‚\n  ä½¿ç”¨åœºæ™¯ï¼šIOå¤šè·¯å¤ç”¨epollçš„å®ç°é‡‡ç”¨çº¢é»‘æ ‘ç»„ç»‡ç®¡ç†sockfdï¼Œä»¥æ”¯æŒå¿«é€Ÿçš„å¢åˆ æ”¹æŸ¥. ngnixä¸­,ç”¨çº¢é»‘æ ‘ç®¡ç†timer,å› ä¸ºçº¢é»‘æ ‘æ˜¯æœ‰åºçš„,å¯ä»¥å¾ˆå¿«çš„å¾—åˆ°è·ç¦»å½“å‰æœ€å°çš„å®šæ—¶å™¨. javaä¸­TreeMapï¼Œjdk1.8çš„hashmapçš„å®ç°.\n      Bæ ‘å’ŒB+æ ‘\nBæ ‘ä¹Ÿæ˜¯å¹³æ—¶è¯´çš„â€œB-â€æ ‘ï¼Œåˆå«å¹³è¡¡å¤šè·¯æ ‘ã€‚å’ŒäºŒå‰æ ‘ä¸åŒï¼ŒäºŒå‰æ ‘æ¯ä¸ªèŠ‚ç‚¹åªä¼šæœ‰2ä¸ªå­æ ‘ã€‚è€ŒBæ ‘æœ‰å¤šä¸ªå­æ ‘ã€‚Mé˜¶çš„Bæ ‘æ˜¯åªæœ€å¤šå­æ ‘æ˜¯Mä¸ªçš„Bæ ‘ã€‚\nå’ŒäºŒå‰æ ‘ä¸€æ ·ï¼Œä¹Ÿæ˜¯å·¦å°å³å¤§ã€‚\n Bæ ‘èŠ‚ç‚¹å­˜æ”¾æ•°æ®ï¼Œå¹¶ä¸”å¶å­èŠ‚ç‚¹ä¸éœ€è¦ä½¿ç”¨é“¾è¡¨ä¸²è”    æ‰‹å†™ä¸€ä¸ªé“¾è¡¨ï¼Œå®ç°æ­£å‘è¾“å‡ºï¼Œåå‘è¾“å‡ºï¼Œæ‰¾åˆ°æœ€ä¸­é—´çš„å…ƒç´  ä»€ä¹ˆæ˜¯å † å †æ˜¯ä¸€ç§éçº¿æ€§ç»“æ„ï¼Œå¯ä»¥æŠŠå †çœ‹ä½œä¸€ä¸ªæ•°ç»„ï¼Œä¹Ÿå¯ä»¥è¢«çœ‹ä½œä¸€ä¸ªå®Œå…¨äºŒå‰æ ‘ï¼Œé€šä¿—æ¥è®²å †å…¶å®å°±æ˜¯åˆ©ç”¨å®Œå…¨äºŒå‰æ ‘çš„ç»“æ„æ¥ç»´æŠ¤çš„ä¸€ç»´æ•°ç»„ä½†å †å¹¶ä¸ä¸€å®šæ˜¯å®Œå…¨äºŒå‰æ ‘\næŒ‰ç…§å †çš„ç‰¹ç‚¹å¯ä»¥æŠŠå †åˆ†ä¸ºå¤§é¡¶å †å’Œå°é¡¶å † å¤§é¡¶å †ï¼šæ¯ä¸ªç»“ç‚¹çš„å€¼éƒ½å¤§äºæˆ–ç­‰äºå…¶å·¦å³å­©å­ç»“ç‚¹çš„å€¼ å°é¡¶å †ï¼šæ¯ä¸ªç»“ç‚¹çš„å€¼éƒ½å°äºæˆ–ç­‰äºå…¶å·¦å³å­©å­ç»“ç‚¹çš„å€¼\nä½¿ç”¨å †çš„åŸå› ï¼Ÿ å¦‚æœä»…ä»…æ˜¯éœ€è¦å¾—åˆ°ä¸€ä¸ªæœ‰åºçš„åºåˆ—ï¼Œä½¿ç”¨æ’åºå°±å¯ä»¥å¾ˆå¿«å®Œæˆï¼Œå¹¶ä¸éœ€è¦å»ç»„ç»‡ä¸€ä¸ªæ–°çš„æ•°æ®ç»“æ„ã€‚ä½†æ˜¯å¦‚æœæˆ‘ä»¬çš„éœ€æ±‚æ˜¯å¯¹äºä¸€ä¸ªéšæ—¶ä¼šæœ‰æ›´æ–°çš„åºåˆ—ï¼Œæˆ‘è¦éšæ—¶çŸ¥é“è¿™ä¸ªåºåˆ—çš„æœ€å°å€¼æˆ–æœ€å¤§å€¼æ˜¯ä»€ä¹ˆã€‚æ˜¾ç„¶å¦‚æœæ˜¯çº¿æ€§ç»“æ„ï¼Œæ¯æ¬¡æ’å…¥ä¹‹åï¼Œå‡è®¾åŸæ•°ç»„æ˜¯æœ‰åºçš„ï¼Œé‚£ä½¿ç”¨äºŒåˆ†æŠŠå®ƒæ”¾åœ¨æ­£ç¡®çš„ä½ç½®ä¹Ÿæœªå°ä¸å¯ï¼Œä½†æ˜¯æ’å…¥çš„æ—¶å€™ä»æ•°ç»„ä¸­ç•™å‡ºç©ºä½å°±éœ€è¦O(n)çš„æ—¶é—´å¤æ‚åº¦ï¼Œåˆ é™¤çš„æ—¶å€™äº¦ç„¶ã€‚\næ—¶é—´å¤æ‚åº¦\næ’å…¥å’Œåˆ é™¤çš„æ—¶é—´å¤æ‚åº¦æ˜¯O(logn)\nåœºæ™¯ï¼š\njavaä¸­çš„Timerï¼Œå°±æ˜¯é€šè¿‡å †æ¥æ‰¾åˆ°å½“å‰æœ€å°çš„æ—¶é—´æˆ³ï¼Œè¿›è¡Œä»»åŠ¡æ‰§è¡Œçš„\nç¯å½¢é˜Ÿåˆ—   æ™®é€šé˜Ÿåˆ—\næ™®é€šé˜Ÿåˆ—ï¼Œæ•°ç»„å®ç°æ—¶ï¼Œå‡ºé˜Ÿåï¼ŒåŸæ¥çš„ç©ºé—´å°±æµªè´¹äº†ã€‚\nâ€‹\tç¯å½¢é˜Ÿåˆ—ï¼Œæ•°ç»„å®ç°æ—¶ï¼Œä¸‹æ ‡ç”¨æ¨¡å–è¿ç®—ï¼Œä¾‹å¦‚æœ€å¤§ç©ºé—´ä¸º5ï¼Œæ¨¡å–ååªä¼šæœ‰0ï¼Œ1ï¼Œ2ï¼Œ3ï¼Œ4ä¸‹æ ‡ï¼Œç»„æˆäº†å¾ªç¯ã€‚\n front å˜é‡çš„å«ä¹‰åšä¸€ä¸ªè°ƒæ•´ï¼š front å°±æŒ‡å‘é˜Ÿåˆ—çš„ç¬¬ä¸€ä¸ªå…ƒç´ , ä¹Ÿå°±æ˜¯è¯´ arr[front] å°±æ˜¯é˜Ÿåˆ—çš„ç¬¬ä¸€ä¸ªå…ƒç´  front çš„åˆå§‹å€¼ = 0 rear å˜é‡çš„å«ä¹‰åšä¸€ä¸ªè°ƒæ•´ï¼šrear æŒ‡å‘é˜Ÿåˆ—çš„æœ€åä¸€ä¸ªå…ƒç´ çš„åä¸€ä¸ªä½ç½®. å› ä¸ºå¸Œæœ›ç©ºå‡ºä¸€ä¸ªç©ºé—´åšä¸ºçº¦å®š. rear çš„åˆå§‹å€¼ = 0 å½“é˜Ÿåˆ—æ»¡æ—¶ï¼Œæ¡ä»¶æ˜¯ (rear + 1) % maxSize == front ã€æ»¡ã€‘ å¯¹é˜Ÿåˆ—ä¸ºç©ºçš„æ¡ä»¶ï¼Œ rear == front ç©º å½“æˆ‘ä»¬è¿™æ ·åˆ†æï¼Œ é˜Ÿåˆ—ä¸­æœ‰æ•ˆçš„æ•°æ®çš„ä¸ªæ•° (rear + maxSize - front) % maxSize // rear = 1 front = 0    æ—¶é—´è½®\nä½¿ç”¨åœºæ™¯ï¼Œå¤„ç†å¤§æ‰¹é‡çš„å®šæ—¶ä»»åŠ¡\nåˆ©ç”¨ç¯å½¢é˜Ÿåˆ—ï¼Œé˜Ÿåˆ—çš„æ¯ä¸ªç©ºé—´é‡Œå­˜æ”¾çš„æ˜¯ä»»åŠ¡çš„é›†åˆã€‚\nä¾‹å¦‚ä»¥60ç§’ä¸ºä¸€ä¸ªè½®ï¼Œ70ç§’åæ‰§è¡Œä¸€ä¸ªä»»åŠ¡ã€‚åªéœ€è¦ä¸€ä¸ªtimeræŒ‰ç§’å»æ—‹è½¬æ—¶é—´è½®ï¼Œ70%60=10ï¼Œåˆ°è¾¾ç¬¬10ä¸ªæ§½çš„æ—¶å€™ï¼Œæ‰§è¡Œå†…éƒ¨çš„æ‰€æœ‰ä»»åŠ¡å³å¯ã€‚\nä¸ºäº†è§£å†³10ç§’å’Œ70ç§’è½åœ¨åŒä¸€ä¸ªæ§½ä¸Šï¼Œå¯ä»¥åœ¨ä»»åŠ¡èº«ä¸ŠåŠ ä¸€ä¸ªå±æ€§ï¼Œåœˆæ•°ï¼Œä¾‹å¦‚10ç§’çš„ä»»åŠ¡åœˆæ•°æ˜¯0ï¼Œ70ç§’çš„ä»»åŠ¡æ˜¯1ï¼Œåªæœ‰è¾¾åˆ°æ§½ä½ç½®ï¼Œå¹¶ä¸”åœˆæ•°ä¸º0çš„ä»»åŠ¡æ‰ä¼šè¢«æ‰§è¡Œã€‚\nkafakaçš„åšæ³•æ˜¯ï¼Œå†åšä¸€ä¸ªåˆ†é’Ÿè½®ï¼Œå…ˆè½¬åˆ†é’Ÿè½®ã€‚å†è½¬ç§’çš„è½®ã€‚\n  ç®—æ³• ä½ èƒ½å†™å‡ºå‡ ä¸ªæ’åºç®—æ³•   å†’æ³¡\n æ¯”è¾ƒç›¸é‚»çš„å…ƒç´ ã€‚å¦‚æœç¬¬ä¸€ä¸ªæ¯”ç¬¬äºŒä¸ªå¤§ï¼Œå°±äº¤æ¢å®ƒä»¬ä¸¤ä¸ªï¼› å¯¹æ¯ä¸€å¯¹ç›¸é‚»å…ƒç´ ä½œåŒæ ·çš„å·¥ä½œï¼Œä»å¼€å§‹ç¬¬ä¸€å¯¹åˆ°ç»“å°¾çš„æœ€åä¸€å¯¹ï¼Œè¿™æ ·åœ¨æœ€åçš„å…ƒç´ åº”è¯¥ä¼šæ˜¯æœ€å¤§çš„æ•°ï¼› é’ˆå¯¹æ‰€æœ‰çš„å…ƒç´ é‡å¤ä»¥ä¸Šçš„æ­¥éª¤ï¼Œé™¤äº†æœ€åä¸€ä¸ªï¼› é‡å¤æ­¥éª¤1~3ï¼Œç›´åˆ°æ’åºå®Œæˆã€‚  int[] array=new int[]{2,4,62,6,457,2,3,5,7,8,9}; for (int i=0;i\u0026lt;array.length-1;i++){ for (int j = i+1; j \u0026lt; array.length; j++) { if(array[i]\u0026gt;array[j]){ int tmp=array[i]; array[i]=array[j]; array[j]=tmp; } } } System.out.println(Arrays.toString(array));   é€‰æ‹©æ’åº\n åˆå§‹çŠ¶æ€ï¼šæ— åºåŒºä¸ºR[1..n]ï¼Œæœ‰åºåŒºä¸ºç©ºï¼› ç¬¬iè¶Ÿæ’åº(i=1,2,3â€¦n-1)å¼€å§‹æ—¶ï¼Œå½“å‰æœ‰åºåŒºå’Œæ— åºåŒºåˆ†åˆ«ä¸ºR[1..i-1]å’ŒR(i..nï¼‰ã€‚è¯¥è¶Ÿæ’åºä»å½“å‰æ— åºåŒºä¸­-é€‰å‡ºå…³é”®å­—æœ€å°çš„è®°å½• R[k]ï¼Œå°†å®ƒä¸æ— åºåŒºçš„ç¬¬1ä¸ªè®°å½•Räº¤æ¢ï¼Œä½¿R[1..i]å’ŒR[i+1..n)åˆ†åˆ«å˜ä¸ºè®°å½•ä¸ªæ•°å¢åŠ 1ä¸ªçš„æ–°æœ‰åºåŒºå’Œè®°å½•ä¸ªæ•°å‡å°‘1ä¸ªçš„æ–°æ— åºåŒºï¼› n-1è¶Ÿç»“æŸï¼Œæ•°ç»„æœ‰åºåŒ–äº†ã€‚  int[] array=new int[]{2,4,62,6,457,2,3,5,7,8,9}; for (int i = 0; i \u0026lt; array.length; i++) { int minIndex=i; for (int j = i; j \u0026lt; array.length; j++) { if(array[j]\u0026lt;=array[minIndex]){ minIndex=j; } } int tmp=array[i]; array[i]=array[minIndex]; array[minIndex]=tmp; } System.out.println(Arrays.toString(array));   æ’å…¥æ’åº\n ä»ç¬¬ä¸€ä¸ªå…ƒç´ å¼€å§‹ï¼Œè¯¥å…ƒç´ å¯ä»¥è®¤ä¸ºå·²ç»è¢«æ’åºï¼› å–å‡ºä¸‹ä¸€ä¸ªå…ƒç´ ï¼Œåœ¨å·²ç»æ’åºçš„å…ƒç´ åºåˆ—ä¸­ä»åå‘å‰æ‰«æï¼› å¦‚æœè¯¥å…ƒç´ ï¼ˆå·²æ’åºï¼‰å¤§äºæ–°å…ƒç´ ï¼Œå°†è¯¥å…ƒç´ ç§»åˆ°ä¸‹ä¸€ä½ç½®ï¼› é‡å¤æ­¥éª¤3ï¼Œç›´åˆ°æ‰¾åˆ°å·²æ’åºçš„å…ƒç´ å°äºæˆ–è€…ç­‰äºæ–°å…ƒç´ çš„ä½ç½®ï¼› å°†æ–°å…ƒç´ æ’å…¥åˆ°è¯¥ä½ç½®åï¼› é‡å¤æ­¥éª¤2~5ã€‚  int[] array=new int[]{2,4,62,6,457,2,3,5,7,8,9}; for (int i = 0; i \u0026lt; array.length; i++) { int cur=array[i]; for (int j = i-1; j \u0026gt;= 0; j--) { if(array[j]\u0026gt;cur){ array[j+1]=array[j]; }else { array[j+1]=cur; break; } } } System.out.println(Arrays.toString(array));   å¿«æ’\nå‚è€ƒ\npublic static void main(String[] args) { int[] array=new int[]{2,4,62,6,457,2,3,5,7,8,9}; sort(array,0,array.length-1); System.out.println(Arrays.toString(array)); } public static void sort(int[] arrays,int startIndex,int endIndex){ if(startIndex\u0026gt;=endIndex) return; int right=-1; int left=-1; for (int j = endIndex; j \u0026gt;=startIndex; j--) { if(arrays[j]\u0026lt;arrays[startIndex]){ right=j; break; } } if(right==-1){ //è¯´æ˜å·²ç»æ’åºå¥½äº†  //é€’å½’  sort(arrays,startIndex+1,endIndex); }else { for (int i = startIndex; i \u0026lt;= endIndex; i++) { //ç›¸äº¤äº†ï¼Œç›´æ¥ä¸åŸºæ•°äº’æ¢  if(right==i){ int tmp=arrays[startIndex]; arrays[startIndex]=arrays[i]; arrays[i]=tmp; //å½“å‰è½®èµ°å®Œï¼Œèµ°å­è½®ï¼Œ  sort(arrays,startIndex,i-1); sort(arrays,i+1,endIndex); break; } if(arrays[i]\u0026gt;arrays[startIndex]){ left=i; break; } } if(left!=-1){ //äº¤æ¢  int tmp=arrays[left]; arrays[left]=arrays[right]; arrays[right]=tmp; //ç»§ç»­  sort(arrays,startIndex,endIndex); } } }   å¹¶å½’æ’åº\npublic static void main(String[] args) { int[] array=new int[]{2,55,62,6,45,2,3,5,7,8,9,1,2,14,6,67,34,5,7,8,95,312,68,0,457,0}; array=mergeSort(array,0,array.length-1); System.out.println(Arrays.toString(array)); int[] ints = {1,2,3,0,0,0}; System.out.println(Arrays.toString(ints)); } public static int[] mergeSort(int[] array,int startIndex,int endIndex){ //æ•°ç»„é•¿åº¦  int length=endIndex-startIndex+1; if(length==1){ //åªæœ‰ä¸€ä¸ªï¼Œè¿”å›æœ¬èº«  return new int[]{array[startIndex]}; }else if(length==2){ //ç­‰äº2,çœ‹æ˜¯å¦éœ€è¦äº¤æ¢  int left=array[startIndex]; int right=array[endIndex]; if(left\u0026gt;right){ //äº¤æ¢  int tmp=left; left=right; right=tmp; } return new int[]{left,right}; } else { int m = startIndex+length / 2; //åˆå¹¶  int[] left = mergeSort(array, startIndex, m-1); int[] right = mergeSort(array, m , endIndex); //å·¦è¾¹ä¸€å®š\u0026lt;=å³è¾¹  int[] r = new int[left.length + right.length]; int leftIndex=0; int rightIndex=0; while (leftIndex\u0026lt;left.length \u0026amp;\u0026amp; rightIndex\u0026lt;right.length){ if(left[leftIndex]\u0026lt;right[rightIndex]){ r[leftIndex+rightIndex]=left[leftIndex]; leftIndex++; }else { r[leftIndex+rightIndex]=right[rightIndex]; rightIndex++; } } while (leftIndex\u0026lt;left.length){ r[leftIndex+rightIndex]=left[leftIndex]; leftIndex++; } while (rightIndex\u0026lt;right.length){ r[leftIndex+rightIndex]=right[rightIndex]; rightIndex++; } return r; } }   æ¡¶æ’åº\nint[] array=new int[]{2,4,62,6,457,2,3,5,7,8,9}; int[] ints = new int[500]; for (int i = 0; i \u0026lt; array.length; i++) { ints[array[i]]+=1; } for (int i = 0; i \u0026lt; ints.length; i++) { if(ints[i]!=0) for (int j = 0; j \u0026lt; ints[i]; j++) { System.out.print(i+\u0026#34;,\u0026#34;); } } }   ä½ èƒ½å†™å‡ºå‡ ä¸ªæŸ¥æ‰¾ç®—æ³• ä½ èƒ½å†™å‡ºå‡ ä¸ªå»é‡ç®—æ³• LeetCodeç»å…¸é¢˜ç›®   å›æ–‡ä¸²\nç”¨æ•°æ®ç»“æ„æ ˆå»è§£å†³\nchar[] target=new char[]{\u0026#39;a\u0026#39;,\u0026#39;b\u0026#39;,\u0026#39;b\u0026#39;,\u0026#39;b\u0026#39;,\u0026#39;a\u0026#39;,\u0026#39;c\u0026#39;}; boolean jishu=target.length%2!=0; int middle=jishu?target.length/2-1:target.length/2; //å‰ä¸€åŠå’Œåä¸€åŠæ˜¯å¦ç›¸åŒ  for (int i = 0,j=target.length-1; i \u0026lt; middle; i++,j--) { if(target[i]!=target[j]){ System.out.println(\u0026#34;ä¸æ˜¯\u0026#34;); return; } } System.out.println(\u0026#34;æ˜¯çš„\u0026#34;);   æ»‘åŠ¨çª—å£\n  LRU æ“ä½œç³»ç»Ÿ é›¶æ‹·è´æ˜¯ä»€ä¹ˆ ç®€å•ç‚¹è¯´å°±æ˜¯ï¼Œä¼ ç»Ÿçš„ä»ç£ç›˜è¯»å–æ–‡ä»¶ï¼Œå†ä»ç½‘å¡å‘å‡ºå»ã€‚éƒ½æ˜¯é€šè¿‡CPUæ¥å®Œæˆçš„\nå› ä¸ºç”¨æˆ·è¿›ç¨‹æ˜¯æ— æ³•æ“ä½œç¡¬ä»¶çš„ï¼Œå¿…é¡»åˆ‡æ¢åˆ°å†…æ ¸æ€ã€‚å› æ­¤linuxæä¾›äº†readå’Œwriteï¼Œ2ä¸ªå‡½æ•°ã€‚readï¼Œç”¨æˆ·æ€åˆ‡æ¢åˆ°å†…æ ¸æ€ï¼ŒCPUå‘èµ·IOè¯·æ±‚ï¼Œç£ç›˜å‡†å¤‡æ•°æ®\nï¼Œå‡†å¤‡å¥½äº†é€šçŸ¥CPUï¼ŒCPUå°†æ•°æ®æ”¾åˆ°PageCacheï¼Œå†ä»PageCacheæ‹·è´åˆ°ç”¨æˆ·ç¼“å†²åŒºã€‚è¿™ä¸ªè¿‡ç¨‹CPUï¼Œå…¨ç¨‹å‚ä¸ï¼Œè¿™ä¸ªæ—¶å€™CPUä¸èƒ½åšå…¶ä»–äº‹æƒ…ã€‚\nä¸ºäº†è§£å†³CPUåœ¨å¤åˆ¶æ–‡ä»¶çš„æ—¶å€™ï¼Œä¸èƒ½åšäº‹æƒ…ã€‚å‡ºç°äº†DMA(Direct Memory Access)ï¼Œå°†å¤åˆ¶çš„è¿‡ç¨‹äº¤ç»™DMAå¤„ç†ï¼ŒCPUåªéœ€è¦ç­‰å¾…ç»“æœå°±å¯ä»¥äº†ï¼ŒæœŸé—´å¯ä»¥æ‰§è¡Œå…¶ä»–äº‹æƒ…ã€‚\næ—©æœŸçš„è¯»å–æ–‡ä»¶ï¼Œå¹¶ä¼ é€åˆ°ç½‘å¡æµç¨‹\né¦–å…ˆï¼ŒæœŸé—´å…±å‘ç”Ÿäº† 4 æ¬¡ç”¨æˆ·æ€ä¸å†…æ ¸æ€çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œå› ä¸ºå‘ç”Ÿäº†ä¸¤æ¬¡ç³»ç»Ÿè°ƒç”¨ï¼Œä¸€æ¬¡æ˜¯ read() ï¼Œä¸€æ¬¡æ˜¯ write()ï¼Œæ¯æ¬¡ç³»ç»Ÿè°ƒç”¨éƒ½å¾—å…ˆä»ç”¨æˆ·æ€åˆ‡æ¢åˆ°å†…æ ¸æ€ï¼Œç­‰å†…æ ¸å®Œæˆä»»åŠ¡åï¼Œå†ä»å†…æ ¸æ€åˆ‡æ¢å›ç”¨æˆ·æ€ã€‚\nä¸Šä¸‹æ–‡åˆ‡æ¢åˆ°æˆæœ¬å¹¶ä¸å°ï¼Œä¸€æ¬¡åˆ‡æ¢éœ€è¦è€—æ—¶å‡ åçº³ç§’åˆ°å‡ å¾®ç§’ï¼Œè™½ç„¶æ—¶é—´çœ‹ä¸Šå»å¾ˆçŸ­ï¼Œä½†æ˜¯åœ¨é«˜å¹¶å‘çš„åœºæ™¯ä¸‹ï¼Œè¿™ç±»æ—¶é—´å®¹æ˜“è¢«ç´¯ç§¯å’Œæ”¾å¤§ï¼Œä»è€Œå½±å“ç³»ç»Ÿçš„æ€§èƒ½ã€‚\nå…¶æ¬¡ï¼Œè¿˜å‘ç”Ÿäº† 4 æ¬¡æ•°æ®æ‹·è´ï¼Œå…¶ä¸­ä¸¤æ¬¡æ˜¯ DMA çš„æ‹·è´ï¼Œå¦å¤–ä¸¤æ¬¡åˆ™æ˜¯é€šè¿‡ CPU æ‹·è´çš„ï¼Œä¸‹é¢è¯´ä¸€ä¸‹è¿™ä¸ªè¿‡ç¨‹ï¼š\n ç¬¬ä¸€æ¬¡æ‹·è´ï¼ŒæŠŠç£ç›˜ä¸Šçš„æ•°æ®æ‹·è´åˆ°æ“ä½œç³»ç»Ÿå†…æ ¸çš„ç¼“å†²åŒºé‡Œï¼Œè¿™ä¸ªæ‹·è´çš„è¿‡ç¨‹æ˜¯é€šè¿‡ DMA æ¬è¿çš„ã€‚ ç¬¬äºŒæ¬¡æ‹·è´ï¼ŒæŠŠå†…æ ¸ç¼“å†²åŒºçš„æ•°æ®æ‹·è´åˆ°ç”¨æˆ·çš„ç¼“å†²åŒºé‡Œï¼Œäºæ˜¯æˆ‘ä»¬åº”ç”¨ç¨‹åºå°±å¯ä»¥ä½¿ç”¨è¿™éƒ¨åˆ†æ•°æ®äº†ï¼Œè¿™ä¸ªæ‹·è´åˆ°è¿‡ç¨‹æ˜¯ç”± CPU å®Œæˆçš„ã€‚ ç¬¬ä¸‰æ¬¡æ‹·è´ï¼ŒæŠŠåˆšæ‰æ‹·è´åˆ°ç”¨æˆ·çš„ç¼“å†²åŒºé‡Œçš„æ•°æ®ï¼Œå†æ‹·è´åˆ°å†…æ ¸çš„ socket çš„ç¼“å†²åŒºé‡Œï¼Œè¿™ä¸ªè¿‡ç¨‹ä¾ç„¶è¿˜æ˜¯ç”± CPU æ¬è¿çš„ã€‚ ç¬¬å››æ¬¡æ‹·è´ï¼ŒæŠŠå†…æ ¸çš„ socket ç¼“å†²åŒºé‡Œçš„æ•°æ®ï¼Œæ‹·è´åˆ°ç½‘å¡çš„ç¼“å†²åŒºé‡Œï¼Œè¿™ä¸ªè¿‡ç¨‹åˆæ˜¯ç”± DMA æ¬è¿çš„ã€‚  å®ç°é›¶æ‹·è´çš„æ–¹å¼\n  mmap + write\nmmap() ç³»ç»Ÿè°ƒç”¨å‡½æ•°ä¼šç›´æ¥æŠŠå†…æ ¸ç¼“å†²åŒºé‡Œçš„æ•°æ®ã€Œæ˜ å°„ã€åˆ°ç”¨æˆ·ç©ºé—´ï¼Œè¿™æ ·ï¼Œæ“ä½œç³»ç»Ÿå†…æ ¸ä¸ç”¨æˆ·ç©ºé—´å°±ä¸éœ€è¦å†è¿›è¡Œä»»ä½•çš„æ•°æ®æ‹·è´æ“ä½œã€‚\n  sendfile\nåœ¨ Linux å†…æ ¸ç‰ˆæœ¬ 2.1 ä¸­ï¼Œæä¾›äº†ä¸€ä¸ªä¸“é—¨å‘é€æ–‡ä»¶çš„ç³»ç»Ÿè°ƒç”¨å‡½æ•° sendfile()ï¼Œå‡½æ•°å½¢å¼å¦‚ä¸‹ï¼š\n#include \u0026lt;sys/socket.h\u0026gt;ssize_t sendfile(int out_fd, int in_fd, off_t *offset, size_t count); å®ƒçš„å‰ä¸¤ä¸ªå‚æ•°åˆ†åˆ«æ˜¯ç›®çš„ç«¯å’Œæºç«¯çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œåé¢ä¸¤ä¸ªå‚æ•°æ˜¯æºç«¯çš„åç§»é‡å’Œå¤åˆ¶æ•°æ®çš„é•¿åº¦ï¼Œè¿”å›å€¼æ˜¯å®é™…å¤åˆ¶æ•°æ®çš„é•¿åº¦ã€‚\né¦–å…ˆï¼Œå®ƒå¯ä»¥æ›¿ä»£å‰é¢çš„ read() å’Œ write() è¿™ä¸¤ä¸ªç³»ç»Ÿè°ƒç”¨ï¼Œè¿™æ ·å°±å¯ä»¥å‡å°‘ä¸€æ¬¡ç³»ç»Ÿè°ƒç”¨ï¼Œä¹Ÿå°±å‡å°‘äº† 2 æ¬¡ä¸Šä¸‹æ–‡åˆ‡æ¢çš„å¼€é”€ã€‚\nå…¶æ¬¡ï¼Œè¯¥ç³»ç»Ÿè°ƒç”¨ï¼Œå¯ä»¥ç›´æ¥æŠŠå†…æ ¸ç¼“å†²åŒºé‡Œçš„æ•°æ®æ‹·è´åˆ° socket ç¼“å†²åŒºé‡Œï¼Œä¸å†æ‹·è´åˆ°ç”¨æˆ·æ€ï¼Œè¿™æ ·å°±åªæœ‰ 2 æ¬¡ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œå’Œ 3 æ¬¡æ•°æ®æ‹·è´ã€‚å¦‚ä¸‹å›¾ï¼š\n  å‚è€ƒ\né¡ºåºè¯»å†™å’Œéšæœºè¯»å†™ å¸¸è§çš„è§£é‡Šåœ¨æ—¥å¿—æ–‡ä»¶å’Œinnodbçš„ç´¢å¼•æ–‡ä»¶ã€‚\næˆ‘ä»¬æ¯æ¬¡æ“ä½œæ•°æ®çš„å¢åˆ æ”¹æŸ¥çš„æ—¥å¿—ï¼Œéƒ½æ˜¯é€šè¿‡é¡ºåºè¯»å†™ã€‚\nå› ä¸ºç´¢å¼•æ˜¯ä¸€ç§æœ‰åºçš„æ•°æ®ç»“æ„B+æ ‘ï¼Œæ¯æ¬¡æœ‰æ–°æ•°æ®æ¥çš„æ—¶å€™ï¼Œéƒ½ä¼šæ›´æ–°ç´¢å¼•ä¿¡æ¯ã€‚é€šè¿‡è®¡ç®—æ‰¾åˆ°ç´¢å¼•åº”è¯¥åœ¨çš„åœ°æ–¹ã€‚è¿™ä¸ªå°±æ˜¯å¯»å€ã€‚\né¡ºåºè¯»å†™å°±æ˜¯åªç¬¬ä¸€æ¬¡å¯»å€ï¼Œç„¶ååç»­å†™çš„åŠ¨ä½œéƒ½æ˜¯åœ¨ç¬¬ä¸€æ¬¡å¯»å€å®Œåçš„åœ°å€ä¸Šç»§ç»­å·¥ä½œï¼Œä¸éœ€è¦å†å¯»å€äº†ã€‚\nè€Œéšæœºè¯»å†™æ˜¯æ¯æ¬¡éƒ½è¦å¯»å€çš„\nå‚è€ƒ\nå…¶ä»–é—®é¢˜ OLAPå’ŒOLTPæœ‰ä»€ä¹ˆåŒºåˆ« å‚è€ƒ\næ²¡æœ‰ä¸€çº¿çš„æµé‡å¹¶å‘å·¥ä½œç»éªŒï¼Œä½ æ˜¯æ€ä¹ˆè€ƒè™‘ä½ çš„ç³»ç»Ÿçš„ æ ¹æ®æˆ‘çš„ç»éªŒæ€»ç»“ï¼Œåªéœ€è¦ç‰¢è®°ä¸€äº›å¸¸è¯†å°±è¡Œï¼š\n mysql çš„ tps ä½ å°±æŒ‰ 5000 ç®—ï¼Œæ¯ç§’è¶…è¿‡ 5000 è¯·æ±‚ï¼Œç›´æ¥ç”¨ myql è‚¯å®šä¸è¡Œ å•æœº redis çš„ qps å¯ä»¥åˆ° 100k ï¼ŒæŠŠä¸€äº›æ•°æ® /ç¼“å­˜ï¼Œå­˜åˆ° redis ï¼Œèƒ½æœ‰æ•ˆæé«˜å¹¶å‘ åˆ©ç”¨æ¶ˆæ¯é˜Ÿåˆ—å®ç°å‰Šå³°ï¼Œå®ç°ç”Ÿäº§ä¸æ¶ˆè´¹çš„è§£è€¦ ä¿è¯å¤„ç†é€»è¾‘å¯ä»¥å¹¶è¡Œï¼Œå¯ä»¥æ‰©å±•ï¼Œè°¨æ…ä½¿ç”¨é” å°½é‡å°†æœåŠ¡åšæˆæ— çŠ¶æ€å¯æ‰©å±•çš„ï¼ŒæŠŠçŠ¶æ€æ‰”ç»™ redis æˆ–è€…å…¶ä»–é«˜æ•ˆçš„å­˜å‚¨ å¯¹äºé¢‘ç¹è®¿é—®çš„æ•°æ®ä¸€å®šè¦åšç¼“å­˜ï¼Œç„¶åå»è§£å†³ç¼“å­˜çš„é›ªå´©ï¼Œç©¿é€ï¼Œå¤±æ•ˆç­‰é—®é¢˜  ","permalink":"https://sunhao1256.github.io/posts/%E5%B8%B8%E8%A7%81%E9%A2%98%E7%9B%AE/","summary":"Redis redisæœ‰å“ªäº›æ•°æ®ç»“æ„ï¼Œä½ ç”¨è¿‡å“ªäº›ï¼Œåšè¿‡ä»€ä¹ˆäº‹æƒ…   String\næœ€ç®€å•çš„æ•°æ®ç»“æ„ï¼Œç”¨äºå­˜æ”¾å­—ç¬¦ä¸²ï¼Œå®é™…ä¸Šåœ¨redisä¸­å­˜æ”¾çš„æ˜¯å­—ç¬¦æ•°ç»„ï¼Œç±»ä¼¼javaä¸­çš„arrayListï¼Œ**Redis ä¸ºäº†å¯¹å†…å­˜åšæè‡´çš„ä¼˜åŒ–ï¼Œä¸åŒé•¿åº¦çš„å­—ç¬¦ä¸²ä½¿ç”¨ä¸åŒçš„ç»“æ„ä½“æ¥è¡¨ç¤ºã€‚**Redis è§„å®šäº†å­—ç¬¦ä¸²çš„é•¿åº¦ä¸å¾—è¶…è¿‡ 512 MB\n  List\nåº•å±‚ç”¨çš„åŒå‘åˆ—è¡¨ï¼Œç±»ä¼¼javaä¸­çš„LinkedListï¼Œå› ä¸ºæ˜¯é“¾è¡¨æ‰€æœ‰ï¼Œæ’å…¥åˆ é™¤éƒ½æ˜¯O(1)ï¼ŒæŸ¥è¯¢æ˜¯O(n)\nå¸¸è§çš„å‘½ä»¤\n  lpushä»å¤´æ·»åŠ å…ƒç´ ï¼Œrpushä»å°¾æ·»åŠ \n  lpopæ‹¿å‡ºå¤´éƒ¨çš„å…ƒç´ ï¼Œrpopä»å°¾éƒ¨æ‹¿å…ƒç´ \nç´¢å¼•ï¼Œlpush+lpopå³å¯å®ç°æ ˆï¼Œrpush+lpopå¯ä»¥å®ç°é˜Ÿåˆ—\n    Hash\nå¯¹åº”ç€javaä¸­çš„hashMap\n  Set\nRedis çš„é›†åˆç›¸å½“äº Java è¯­è¨€ä¸­çš„ HashSetï¼Œå®ƒå†…éƒ¨çš„é”®å€¼å¯¹æ˜¯æ— åºã€å”¯ä¸€çš„ã€‚å®ƒçš„å†…éƒ¨å®ç°ç›¸å½“äºä¸€ä¸ªç‰¹æ®Šçš„å­—å…¸ï¼Œå­—å…¸ä¸­æ‰€æœ‰çš„ value éƒ½æ˜¯ä¸€ä¸ªå€¼ NULLã€‚\n  Zset\nå®ƒç±»ä¼¼äº Java ä¸­ SortedSet å’Œ HashMap çš„ç»“åˆä½“ï¼Œä¸€æ–¹é¢å®ƒæ˜¯ä¸€ä¸ª setï¼Œä¿è¯äº†å†…éƒ¨ value çš„å”¯ä¸€æ€§ï¼Œå¦ä¸€æ–¹é¢å®ƒå¯ä»¥ä¸ºæ¯ä¸ª value èµ‹äºˆä¸€ä¸ª score å€¼ï¼Œç”¨æ¥ä»£è¡¨æ’åºçš„æƒé‡ã€‚\nä½¿ç”¨åœºæ™¯ï¼š\n æ’è¡Œæ¦œï¼Œkeyæ˜¯ç”¨æˆ·idï¼Œvalueæ˜¯è®¿é—®æ¬¡æ•°ã€‚ é™æµï¼Œkeyæ˜¯ç”¨æˆ·id+æ¥å£idï¼Œvalueæ˜¯æ—¶é—´æˆ³ï¼Œæ¯æ¬¡è¿›æ–¹æ³•ä¹‹å‰ï¼Œæ‹¿å½“å‰æ—¶é—´æˆ³-intervalï¼Œåˆ é™¤å°äºnow-intervalçš„å…ƒç´ ï¼Œç®—å‡ºåŠ å…¥å½“å‰è¿™æ¬¡è¯·æ±‚setä¸­çš„ä¸ªæ•°æ˜¯å¦å¤§äºmaxï¼Œå¤§äºåˆ™é™æµã€‚    BloomFilter\nä½¿ç”¨é«˜æ•ˆçš„æ•°æ®ç»“æ„è§£å†³æ˜¯å¦å­˜åœ¨çš„é—®é¢˜ï¼Œå¯ä»¥è§£å†³ç©¿é€çš„é—®é¢˜\n  HyperLogLog\nå¯ä»¥ç”¨äºåŸºæ•°çš„ç»Ÿè®¡ï¼Œä¾‹å¦‚UVç»Ÿè®¡\n  rediså¦‚ä½•åšåˆ°é™æµçš„ é™æµçš„å‡ ä¸ªæ–¹å¼","title":"å…«è‚¡æ–‡"},{"content":"å¹³æ—¶ç–‘é—®   æµè§ˆå™¨è¾“å…¥ä¸€ä¸ªåœ°å€ï¼Œæ•´ä¸ªæµç¨‹\n  å¦‚æœçº¿ä¸Šæµé‡æš´å¢ï¼Œå…¨éƒ½æ‰“åˆ°ä¸€ä¸ª upstream ä¸Šäº†ï¼Œæ€ä¹ˆæ’æŸ¥\n  å¦‚ä½•åœ¨ nginx çš„ access log ä¸­æŸ¥å‡ºè¯·æ±‚å‰ 10 çš„ ip\n  å°é˜¶é—®é¢˜ï¼Œå‡å¦‚å¯¹äºä¸Šå°é˜¶ï¼Œå¯ä»¥ä¸€æ¬¡ä¸Šä¸€é˜¶ï¼Œä¹Ÿå¯ä»¥ä¸€æ¬¡ä¸Šä¸¤é˜¶ï¼Œå†™ä¸€ä¸ªæ–¹æ³•ï¼Œå®ç°è¾“å…¥å°é˜¶æ•°ï¼Œè¾“å‡ºå¯ä»¥æœ‰å¤šå°‘ç§ä¸Šæ³•ã€‚\n  å¹¿åº¦ä¼˜å…ˆå’Œæ·±åº¦ä¼˜å…ˆ\n  spring reactiveï¼Œå“åº”å¼èŠä¸‹ï¼Œä»€ä¹ˆæ—¶å€™é€‚åˆç”¨ï¼ŸèƒŒå‹æ˜¯ä»€ä¹ˆä¸œè¥¿ï¼Œbackpress\n  å‹ç¼©ç®—æ³•ï¼Œæ€ä¹ˆå°±â€œå‹ç¼©â€äº†ï¼Ÿå¦‚ä½•å‡å°‘ä½“ç§¯çš„ï¼Ÿ\n  å®æ—¶ä¸€è‡´æ€§ï¼Œæœ€ç»ˆä¸€è‡´æ€§æ˜¯ä»€ä¹ˆï¼Ÿä»€ä¹ˆåœºæ™¯ä¸‹ç”¨é‚£ç§ï¼Œå¦‚ä½•å®ç°çš„ï¼Ÿ\n  å®æ—¶ä¸€è‡´æ€§:\nå¾®æœåŠ¡ä¸­ï¼Œåœºæ™¯ç”¨æˆ·ä½¿ç”¨ç§¯åˆ†å…‘æ¢ä¼˜æƒ åˆ¸ï¼Œç§¯åˆ†serviceå…ˆæ‰£é™¤ç§¯åˆ†ï¼Œä¼˜æƒ åˆ¸serviceå†è¿›è¡Œå‘åˆ¸åŠ¨ä½œï¼Œå¦‚æœç½‘ç»œé—®é¢˜ï¼Œç§¯åˆ†æ‰£æˆåŠŸäº†ï¼Œä½†æ˜¯ä¼˜æƒ åˆ¸å‘å¤±è´¥äº†ã€‚ç”¨æˆ·ä¼šæŠ•è¯‰ï¼Œå¿…é¡»è¦è¯ä¼˜æƒ åˆ¸å’Œç§¯åˆ†è¦åœ¨åŒä¸€ä¸ªåˆ†å¸ƒå¼äº‹åŠ¡ä¸­.\nè§£å†³æ–¹æ¡ˆï¼šå¸‚é¢ä¸Šçš„åˆ†å¸ƒå¼äº‹åŠ¡ï¼Œé˜¿é‡Œçš„seata\n  æœ€ç»ˆä¸€è‡´æ€§:\nå¾®æœåŠ¡ä¸­ï¼Œç”¨æˆ·é€‰æ‹©å•†å“ä¸‹å•ï¼Œå•†å“serviceè¿›è¡Œåº“å­˜æ‰£ä»¶ï¼Œè®¢å•serviceç”Ÿæˆè®¢å•ï¼Œäº¤æ˜“serviceç”Ÿæˆäº¤æ˜“è®¢å•ã€‚å¦‚æœç½‘ç»œåŸå› å¯¼è‡´ï¼Œäº¤æ˜“serviceç”Ÿæˆäº¤æ˜“è®¢å•å¤±è´¥äº†ã€‚å¹¶æ²¡æœ‰å½±å“ï¼Œåªéœ€è¦é€šè¿‡æªæ–½é‡æ–°å¼¥è¡¥äº¤æ˜“serviceå»ç”Ÿæˆäº¤æ˜“è®¢å•å³å¯ã€‚\nè§£å†³æ–¹æ³•ï¼šmqï¼Œé€šè¿‡mqçš„é‡è¯•æœºåˆ¶ä»¥åŠæŒä¹…åŒ–ç­‰ç‰¹æ€§ï¼Œæ¯ä¸€ä¸ªå¾®æœåŠ¡ä¸ä¸‹æ¸¸å¾®æœåŠ¡è¿›è¡Œäº¤äº’åŠ¨ä½œéƒ½æ˜¯é€šè¿‡mqçš„æ¶ˆæ¯ã€‚ä¿è¯æ¶ˆæ¯èƒ½å¤Ÿè¢«æ¶ˆè´¹ï¼Œé•¿æ—¶é—´æœªæ¶ˆè´¹å¯ä»¥å‘Šè­¦ã€‚\n    æ¶ˆæ¯å †ç§¯å¦‚ä½•å¤„ç†ï¼Ÿä»¥åŠäº§ç”Ÿçš„å±å®³ã€‚\n  æ€ä¹ˆä¿è¯æ¥å£å¹‚ç­‰\n  å¦‚ä½•è¯„åˆ¤ä¸€ä¸ªæœåŠ¡çš„å¥½åï¼Ÿä½ æ˜¯å¦‚ä½•è¿›è¡Œå‹æµ‹çš„ï¼ŸæŸ¥çœ‹äº†å“ªäº›æŒ‡æ ‡\n  å¯¹è±¡å­˜å‚¨ï¼Œæ–‡ä»¶å­˜å‚¨ï¼Œå—å­˜å‚¨ã€‚åŒºåˆ«\n  æœåŠ¡å™¨å¡äº†ï¼Œå­—éƒ½å¿«æ‰“ä¸åŠ¨äº†ï¼Œå’‹å›äº‹ï¼Œæ€ä¹ˆæ’æŸ¥\n  ç”¨è¿‡mysqlè¡Œé”å—\nç”¨è¿‡ï¼Œåœ¨ä¸€äº›æ¯”è¾ƒç®€å•çš„å¾®æœåŠ¡åœºæ™¯ï¼Œæˆ–è€…æ— æ³•ä½¿ç”¨å…¶ä»–ä¸­é—´ä»¶çš„å‰æä¸‹ã€‚å¦‚æœéœ€è¦éƒ¨ç½²å¤šèŠ‚ç‚¹çš„è¯ï¼Œæœ€æ–¹ä¾¿çš„åˆ†å¸ƒå¼é”å°±æ˜¯mysqlï¼Œå› ä¸ºæˆ‘ä»¬çš„dbåº“åŸºæœ¬éƒ½æ˜¯å•èŠ‚ç‚¹çš„mysqlæˆ–è€…mariadbã€‚ä½¿ç”¨èµ·æ¥å…¶å®å¾ˆç®€å•ï¼Œå°±æ˜¯ä¸€ä¸ªupdateè¯­å¥ï¼Œæ›´æ–°versionå­—æ®µã€‚ä¹Ÿå°±æ˜¯æ‰€è°“çš„ä¹è§‚é”ã€‚å¼€å¯ä¸€ä¸ªäº‹åŠ¡ï¼Œå…ˆselecté”ï¼Œç„¶åå°è¯•æ›´æ–°é”ï¼Œåœ¨æ²¡å®Œæˆä¸šåŠ¡çš„ä¹‹å‰æ˜¯ä¸æäº¤é”çš„ï¼Œæ‰€ä»¥ï¼Œå…¶ä»–çº¿ç¨‹ä¼šåœ¨è·å–é”çš„æ—¶å€™å°±åœä¸‹æ¥ã€‚å› ä¸ºupdateï¼Œdeleteï¼Œinserté»˜è®¤éƒ½æ˜¯å¸¦for updateï¼Œå³è¡Œé”çš„ã€‚å½“ç„¶selectä¸ä¼šé˜»å¡ï¼Œé™¤éä¸»åŠ¨çš„è®¾ç½®for updateã€‚è¿™æ ·å°±æ˜¯æœ€åŸºç¡€çš„ä¸€ä¸ªåˆ†å¸ƒå¼é”äº†ã€‚åˆ‡è®°é”å­—æ®µå¿…é¡»è¦æœ‰ç´¢å¼•ï¼Œå¦åˆ™é”æ•´ä¸ªè¡¨ã€‚å°±Gäº†\n  nettyç©è¿‡å—ï¼Œç©è¿‡å“ªäº›ä¸œè¥¿ï¼Œèƒ½å¹²å•¥\n  ä½ çœ‹è¿‡ä¸€ä¸ªspringbootçš„å¯åŠ¨å†…å­˜å—ï¼Ÿå¤§å—ï¼Ÿä¸ºå•¥è¿™ä¹ˆå¤§ï¼Œæ€ä¹ˆç˜¦èº«å‘¢ï¼Œä¸ºä»€ä¹ˆä¸€ä¸ªgoå°±åªè¦å‡ åM\n  activity7äº†è§£è¿‡å—\n  è§„åˆ™å¼•æ“äº†è§£äº†è§£ï¼Ÿ\n  git cherry-pickæ˜¯å•¥\n  ä½ ä»¬å¹³æ—¶æ˜¯å¦‚ä½•å¼€å‘çš„ï¼Œç”¨jiraï¼Œè¯´è¯´jiraçš„å‡ ä¸ªé—®é¢˜ç±»å‹ï¼Œepicï¼Œä¹‹ç±»çš„ã€‚\n  å¤§é‡sqléƒ½è¶…è¿‡äº†200msã€‚æ€ä¹ˆæ’æŸ¥\n  ä½ å†™äº†ä¸€ä¸ªæœåŠ¡ï¼Œæ€ä¹ˆå‹æµ‹çš„ï¼Ÿæ€ä¹ˆå¾—åˆ°qps,qpsçš„è®¡ç®—å…¬å¼\n  ä¸ºä»€ä¹ˆmainçº¿ç¨‹æ‰§è¡Œç»“æŸäº†ï¼Œjvmè™šæ‹Ÿæœºè¿˜ä¸é€€å‡ºã€‚\njvmé€€å‡ºçš„æ¡ä»¶æ˜¯ï¼Œå½“å‰è™šæ‹Ÿæœºä¸­åªå­˜åœ¨å®ˆæŠ¤çº¿ç¨‹äº†ï¼Œåªè¦å­˜æ´»éå®ˆæŠ¤çº¿ç¨‹ï¼Œåˆ™jvmä¸ä¼šé€€å‡ºç›´åˆ°çº¿ç¨‹æ‰§è¡Œå®Œæ¯•ã€‚æ‰€ä»¥ï¼Œå¦‚æœä½ ç”¨äº†ä¸€ä¸ªæœ‰å¤šçº¿ç¨‹åŠŸèƒ½çš„åŒ…ï¼Œä½†æ˜¯æµ‹è¯•çš„æ—¶å€™ï¼Œmainçº¿ç¨‹ç»“æŸçš„ï¼Œæ•´ä¸ªjvméƒ½é€€å‡ºäº†ï¼ŒåŸå› å°±æ˜¯è¿™ä¸ªåŒ…ï¼Œåˆ›å»ºçº¿ç¨‹çš„æ—¶å€™æ˜¯å®ˆæŠ¤çº¿ç¨‹ã€‚å½“ç„¶mainçº¿ç¨‹æ˜¯ä¸å¯ä»¥è®¾ä¸ºå®ˆæŠ¤çº¿ç¨‹çš„ã€‚\n  å­—å…¸æ ‘æœ‰ä»€ä¹ˆåœºæ™¯å¯ä»¥ä½¿ç”¨ï¼Ÿ\n  amd64,arm64,x86_64,aarch,éƒ½æ˜¯å•¥\n  èƒŒå‹ç†è§£å—ï¼Œå¾®æœåŠ¡ä¸­ä¸‹æ¸¸æœåŠ¡æ‰›ä¸ä½å¹¶å‘ä¼šå´©äº†ã€‚æœ‰å®æˆ˜è¿‡å—\nåœºæ™¯ï¼šAæœåŠ¡è°ƒç”¨BæœåŠ¡æŸä¸ªæ¥å£ã€‚è€—æ—¶ï¼Œå¹¶ä¸”éœ€è¦èµ„æºå·¨å¤§çš„æ¥å£ã€‚Bä¸ä¸€å®šæ˜¯ä½ è‡ªå·±çš„å¾®æœåŠ¡ï¼Œå¯èƒ½æ˜¯åˆ«äººæä¾›çš„éƒ¨ç½²åœ¨å…¬ç½‘ç¯å¢ƒçš„æœåŠ¡ã€‚å®¢æˆ·ç«¯é€šè¿‡Aæ¥å£è°ƒç”¨Bï¼Œç°åœ¨è¦æ±‚Bä¸èƒ½å´©ï¼Œè€Œä¸”Açš„æ¥å£éœ€è¦å…¨éƒ¨è¯·æ±‚ä¸‹æ¥ï¼Œä¸èƒ½ä¸¢ï¼Œå¯ä»¥å¼‚æ­¥ã€‚ æ–¹æ¡ˆï¼šmq\n  GRPCæ˜¯ä»€ä¹ˆï¼Œç”¨è¿‡å—\n  è„‘è£‚\n  rabbitmqæ€ä¹ˆä¿è¯é¡ºåºæ¶ˆè´¹\n  laasã€paasã€saas\nIaaSï¼ˆInfrastructure as a Serviceï¼ŒåŸºç¡€æ¶æ„å³æœåŠ¡ï¼‰æ˜¯åŸºç¡€å±‚ã€‚\nåœ¨è¿™ä¸€å±‚ï¼Œé€šè¿‡è™šæ‹ŸåŒ–ã€åŠ¨æ€åŒ–å°†ITåŸºç¡€èµ„æºï¼ˆè®¡ç®—ã€ç½‘ç»œã€å­˜å‚¨ï¼‰èšåˆå½¢æˆèµ„æºæ± ã€‚\nèµ„æºæ± å³è®¡ç®—èƒ½åŠ›çš„é›†åˆï¼Œç»ˆç«¯ç”¨æˆ·ï¼ˆä¼ä¸šï¼‰å¯ä»¥é€šè¿‡ç½‘ç»œè·å¾—è‡ªå·±éœ€è¦çš„è®¡ç®—èµ„æºï¼Œè¿è¡Œè‡ªå·±çš„ä¸šåŠ¡ç³»ç»Ÿã€‚\nè¿™ç§æ–¹å¼ä½¿ç”¨æˆ·ä¸å¿…è‡ªå·±å»ºè®¾è¿™äº›åŸºç¡€è®¾æ–½ï¼Œè€Œæ˜¯é€šè¿‡ä»˜è´¹å³å¯ä½¿ç”¨è¿™äº›èµ„æºã€‚\nåœ¨IaaSå±‚ä¹‹ä¸Šçš„æ˜¯PaaSï¼ˆPlatform as a Serviceï¼Œå¹³å°å³æœåŠ¡ï¼‰å±‚ã€‚\nè¿™ä¸€å±‚é™¤äº†æä¾›åŸºç¡€è®¡ç®—èƒ½åŠ›ï¼Œè¿˜å…·å¤‡äº†ä¸šåŠ¡çš„å¼€å‘è¿è¡Œç¯å¢ƒï¼Œæä¾›åŒ…æ‹¬åº”ç”¨ä»£ç ã€SDKã€æ“ä½œç³»ç»Ÿä»¥åŠAPIåœ¨å†…çš„ITç»„ä»¶ï¼Œä¾›ä¸ªäººå¼€å‘è€…å’Œä¼ä¸šå°†ç›¸åº”åŠŸèƒ½æ¨¡å—åµŒå…¥è½¯ä»¶æˆ–ç¡¬ä»¶ï¼Œä»¥æé«˜å¼€å‘æ•ˆç‡ã€‚\nå¯¹äºä¼ä¸šæˆ–ç»ˆç«¯ç”¨æˆ·è€Œè¨€ï¼Œè¿™ä¸€å±‚çš„æœåŠ¡å¯ä»¥ä¸ºä¸šåŠ¡åˆ›æ–°æä¾›å¿«é€Ÿã€ä½æˆæœ¬çš„ç¯å¢ƒã€‚\næœ€ä¸Šå±‚æ˜¯SaaSï¼ˆSoftware as a Serviceï¼Œè½¯ä»¶å³æœåŠ¡ï¼‰ã€‚\nå®é™…ä¸Šï¼ŒSaaSåœ¨äº‘è®¡ç®—æ¦‚å¿µå‡ºç°ä¹‹å‰å°±å·²ç»å­˜åœ¨ï¼Œå¹¶éšç€äº‘è®¡ç®—æŠ€æœ¯çš„å‘å±•å¾—åˆ°äº†æ›´å¥½çš„å‘å±•ã€‚\nSaaSçš„è½¯ä»¶æ˜¯**â€œæ‹¿æ¥å³ç”¨â€**çš„ï¼Œä¸éœ€è¦ç”¨æˆ·å®‰è£…ï¼Œè½¯ä»¶å‡çº§ä¸ç»´æŠ¤ä¹Ÿæ— é¡»ç»ˆç«¯ç”¨æˆ·å‚ä¸ã€‚\nåŒæ—¶ï¼Œå®ƒè¿˜æ˜¯æŒ‰éœ€ä½¿ç”¨çš„è½¯ä»¶ï¼Œä¸ä¼ ç»Ÿè½¯ä»¶è´­ä¹°åå°±æ— æ³•é€€è´§ç›¸è¾ƒå…·æœ‰æ— å¯æ¯”æ‹Ÿçš„ä¼˜åŠ¿ã€‚\n  k8sä¸ºä»€ä¹ˆè¦æœ‰podè¿™ä¸€å±‚æ¦‚å¿µ\n  tcpåè®®å’Œupdåè®®çš„åŒºåˆ«ï¼Œå„è‡ªçš„ç‰¹æ€§ï¼Œæ€ä¹ˆå®ç°çš„ï¼Œä¾‹å¦‚tcpçš„é¡ºåºæ˜¯å¦‚ä½•ä¿è¯çš„\n  redisæ˜¯å¦‚ä½•åšé«˜å¯ç”¨çš„\n  ä»€ä¹ˆæ˜¯ACIDï¼Œredisçš„äº‹åŠ¡æ€ä¹ˆä¿è¯\n  mysqlæ˜¯æ€ä¹ˆå®ç°å¯é‡å¤åº¦çš„ï¼Œåˆæ˜¯æ€ä¹ˆè§£å†³å¹»è¯»çš„\n  ä»€ä¹ˆæ˜¯xssæ”»å‡»ï¼Œå¦‚ä½•é¿å…\n  ddosæ€ä¹ˆé¿å…\n  redisçš„æ•°æ®ç»“æ„ï¼Œä½ ç”¨è¿‡å“ªäº›\n  æ€ä¹ˆé™æµ\n  hashmapçš„å®ç°ï¼Œçº¢é»‘æ ‘å˜é“¾è¡¨ï¼Œç­‰æ“ä½œå…·ä½“\n  jvmä½ èƒ½è¯´å‡ºå¤šå°‘ï¼Œç”Ÿäº§ä¸Šé‡åˆ°è¿‡ä»€ä¹ˆé—®é¢˜å—ï¼Ÿæ€ä¹ˆæ’æŸ¥çš„\n  http1.0ï¼Œhttp1.1ï¼Œhttp2.0çš„åŒºåˆ«ï¼Œhttpsçš„äº¤äº’æµç¨‹\n  ä»€ä¹ˆæ˜¯é•¿é“¾æ¥ï¼Œhttpçš„keepAliveå’Œtcpçš„keepAliveåŒºåˆ«ï¼Ÿ\n  rpcæ˜¯ä»€ä¹ˆï¼Œä½ ç”¨è¿‡ä»€ä¹ˆrpcæ¡†æ¶ï¼Œä»–ä»¬æœ‰ä»€ä¹ˆåŒºåˆ«ã€‚thriftï¼Œgprcï¼Ÿ\n  èŠèŠè®¾è®¡æ¨¡å¼ã€‚\n  newä¸€ä¸ªå¯¹è±¡ï¼Œjvmé‡Œé¢åšäº†å“ªäº›äº‹æƒ…\n  voliateå…³é”®å­—\n  javaé”ç›¸å…³çŸ¥è¯†\n  classæ˜¯å¦‚ä½•åŠ è½½çš„ï¼›\n  å¯¹jvmçš„äº†è§£ï¼Œå‚æ•°çš„ç›¸å…³è®¾ç½®ï¼Œå¦‚ä½•è°ƒä¼˜ï¼›\n  å†…å­˜çªç„¶è¾¾åˆ°100%ï¼Œå†è„±ç¦»æŸ¥çœ‹æ—¥å¿—çš„æƒ…å†µä¸‹ï¼Œå¦‚ä½•å®šä½ç³»ç»Ÿçš„é—®é¢˜ï¼Œå¿«é€Ÿæ‰¾åˆ°ç›¸åº”ä»£ç é—®é¢˜ï¼›\n  çº¿ç¨‹çš„æ‰§è¡Œè¿‡ç¨‹ï¼Œçº¿ç¨‹æ˜¯å¦‚ä½•åˆ¤å®šæ­»äº¡çš„ï¼Œå¦‚ä½•å›æ”¶çš„ï¼›\n  çº¿ç¨‹æ± çš„ç§ç±»æœ‰å¤šå°‘ç§ï¼Œç›¸å…³å‚æ•°çš„äº†è§£ï¼›\n  mysqlç´¢å¼•çš„å®ç°åŸç†ï¼Œå»ºç«‹ç´¢å¼•çš„åŸåˆ™ï¼Œå¯¹æ’åºçš„è®¤è¯†ï¼›\n  åŠ¨æ€sqlçš„äº†è§£ï¼Œå¯¹#å’Œ$çš„äº†è§£ï¼Œæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Œä¸ºä»€ä¹ˆ#ä¼šé˜²æ­¢sqlæ³¨å…¥ï¼Œæ˜¯å¦‚ä½•å®ç°çš„ï¼›\n  mybatisçš„å®ç°åŸç†ï¼Œsqlå¦‚ä½•æ‰§è¡Œçš„ï¼Œæ‰§è¡Œå™¨æœ‰å¤šå°‘ç§ï¼›\n  å¯¹é›†åˆçš„äº†è§£ï¼Œå¦‚ä½•è€ƒè™‘çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼›\n  è°ˆè°ˆå¯¹è®¾è®¡æ¨¡å¼çš„äº†è§£ï¼›\n  è¿‡æ»¤å™¨é‡‡ç”¨äº†ä»€ä¹ˆè®¾è®¡æ¨¡å¼ï¼›\n  æ•°æ®æ¶ˆè´¹å¦‚ä½•ä¿è¯æ•°æ®é¡ºåºï¼Œérabbitmqï¼Œkafkaå¦‚ä½•ä¿è¯é¡ºåºï¼›\n  æ¥å£è®¾è®¡å¦‚ä½•ç¡®ä¿å®‰å…¨ï¼Œè°ˆè°ˆå¯¹apiå®‰å…¨è®¾è®¡ï¼›\n  redisä¸é‡‡ç”¨é›†ç¾¤æ¨¡å¼ä¸‹ï¼Œå¦‚ä½•è€ƒè™‘å•ç‚¹é—®é¢˜ï¼›\n  redisä¹è§‚é”çš„å®ç°ï¼Œè°ƒç”¨ä»€ä¹ˆæ–¹æ³•ï¼›\n  redisçš„æ•°æ®æ ¼å¼æœ‰å¤šå°‘ç§ï¼Œå¸¸ç”¨æ–¹æ³•æœ‰\n  å¦‚ä½•å¤„ç†ä¾èµ–å†²çª\n  nginxæƒé‡ç­–ç•¥æœ‰å¤šå°‘ç§ï¼Œåˆ†é…æƒé‡ä½¿ç”¨ä»€ä¹ˆæ¨¡å—\n  å¤šå°æœåŠ¡ä¸‹å¦‚ä½•æŒ‡å®šç›¸åº”è¯·æ±‚åªä¼šè¯·æ±‚åˆ°å›ºå®šæœåŠ¡\n  nginxé™æµå¦‚ä½•å®ç°çš„\n  springbootå¦‚ä½•å¦‚ä½•æ§åˆ¶åŠ è½½ä¸åŒç¯å¢ƒçš„é…ç½®çš„\n  å¸¸ç”¨ä¾èµ–æ³¨å…¥ç”¨ä»€ä¹ˆæ³¨è§£ï¼›\n  springå®¹å™¨æœ‰å¤šå°‘ç§ï¼›\n  å·¥å‚æ¨¡å¼äº§å‡ºç‰©æ˜¯ä»€ä¹ˆï¼›\n  mysqlæœ‰å“ªäº›æƒ…å†µæ˜¯ä¸èµ°ç´¢å¼•çš„ï¼›\n  msqlä¸ºä»€ä¹ˆé€šé…ç¬¦ä¸èµ°ç´¢å¼•ï¼Ÿæ€ä¹ˆä½¿ç”¨æ‰èµ°ç´¢å¼•ï¼Ÿ\né€šé…ç¬¦å³%ï¼Œ\næ­£ç¡®ç”¨æ³•æ˜¯WHERE Title LIKE \u0026lsquo;cake%';ä¸èƒ½æ˜¯WHERE Title LIKE \u0026lsquo;%cake%';\nå¦‚æœæˆ‘éè¦%cake%æŸ¥è¯¢å‘¢ï¼Œæ€ä¹ˆåšï¼Ÿ\n  åˆ†æ•£æ€§å¤§çš„æ•°æ®å»ºç´¢å¼•è¿˜æ˜¯å°çš„ï¼Ÿ\nå¤§çš„ï¼Œå¦‚æœæ˜¯å°çš„ï¼Œä½ æƒ³ä¸€ä¸‹ç´¢å¼•çš„æ•°æ®ç»“æ„ã€‚B+treeï¼Œ\n  graphqlçŸ¥é“æ˜¯å•¥å—\n  ä¸€ä¸ªç±»æ˜¯æ€ä¹ˆåŠ è½½è¿›jvmçš„\nåŒæ ·çš„é—®é¢˜ï¼Œ.javaæ–‡ä»¶æ˜¯æ€ä¹ˆåŠ è½½è¿›jvmçš„ï¼Ÿ\n.javaæ–‡ä»¶é€šè¿‡4ä¸ªæ­¥éª¤\n  ç¼–è¯‘\nå°†.javaæºæ–‡ä»¶,ç¼–è¯‘æˆJVMå¯ä»¥è§£é‡Šçš„classæ–‡ä»¶, ç¼–è¯‘è¿‡ç¨‹åŒ…æ‹¬è¯­æ³•åˆ†æ,è¯­ä¹‰åˆ†æ,æ³¨è§£å¤„ç†. ç„¶åæ‰ç”Ÿæˆå­—èŠ‚ç æ–‡ä»¶(.classæ–‡ä»¶). æˆ‘ä»¬å¸¸ç”¨çš„lombokå°±æ˜¯åœ¨è¿™ä¸ªç¯èŠ‚ç”Ÿæˆå­—èŠ‚ç æ–‡ä»¶çš„.\n  åŠ è½½\n  è§£é‡Š\n  æ‰§è¡Œ\n    gcçš„å›æ”¶è¿‡ç¨‹\n  jvmçš„å„ä¸ªåŒºä½œç”¨\n  ä½ å¹³æ—¶ç”¨@Autowiredè¿˜æ˜¯æ„é€ æ–¹æ³•æ³¨å…¥beanï¼Œæœ‰ä»€ä¹ˆåŒºåˆ«\néƒ½å¯ä»¥ä½¿ç”¨, ä½†æ˜¯æ„é€ æ–¹æ³•æ¯”å±æ€§æ³¨å…¥æ¥è¯´åˆä¸€ä¸‹å‡ ä¸ªå¥½å¤„,è€Œå®˜æ–¹ä¹Ÿæ›´æ¨èç”¨æ„é€ å‡½æ•°æ³¨å…¥\n ä½¿ç”¨æ„é€ å‡½æ•°èƒ½å¤Ÿæ¸…æ™°è¡¨æ˜,å½“å‰è¿™ä¸ªbeançš„ä¾èµ–å…³ç³»,æ›´å¥½çš„æ’æŸ¥. å½“åœ¨configç±»ä¸‹æ³¨å…¥beançš„æ—¶å€™,æ˜¯æ²¡æœ‰åŠæ³•ä¸¢æ˜¯æ„é€ å‚æ•°çš„ æ‰€æœ‰çš„ä¾èµ–å¯ä»¥å†™æˆfinal, è¿™æé«˜äº†ç¨‹åºçš„å¥å£®æ€§å¹¶ä¸”çº¿ç¨‹å®‰å…¨.  æé—®finalä¿®é¥°æœ‰ä»€ä¹ˆä¸ä¸€æ ·çš„? åœ¨å¤šçº¿ç¨‹çš„æƒ…å†µä¸‹å¦‚æœä¸é€šè¿‡å…¶ä»–ä¾‹å¦‚Synchronizedæˆ–è€…Volatileçš„æ–¹å¼, ä¸€ä¸ªçº¿ç¨‹åˆ›å»ºçš„å¯¹è±¡,å¦ä¸€ä¸ªçº¿ç¨‹æ¥çœ‹çš„è¯å¯èƒ½æ˜¯ä¸å¯ç”¨,æˆ–è€…çœ‹ä¸åˆ°çš„, ä¸»è¦åŸå› æ˜¯è¯­æ„é‡æ’äº†.   ä½ ä¸éœ€è¦åå°„å»åˆ›å»ºè¿™äº›ä¾èµ–äº†,å¯ä»¥ç›´æ¥é€šè¿‡æ„é€ å‡½æ•°åˆ›å»º.    ä¸ºä»€ä¹ˆspringè¿˜è¦prototype?\n é¦–å…ˆä½¿ç”¨prototypeçš„å¸¸ç”¨æ–¹å¼æ˜¯æ³¨è§£@scope, valueæ˜¯â€prototypeâ€œ. æˆ‘ä»¬ç”¨spring çš„ç›®çš„æ˜¯ä»€ä¹ˆ? ä½¿ç”¨spring æä¾›çš„AOPå’ŒIOCåŠŸèƒ½, é‚£è¿™ä¸ªå‰æå°±å¿…é¡»æ˜¯ä½ çš„beanå¾—æ˜¯springæ‰˜ç®¡çš„, å› æ­¤å½“æˆ‘ä»¬ä½¿ç”¨å¤šä¾‹çš„æ—¶å€™,å¦‚æœç›´æ¥newå…³é”®å­—, é‚£å°±ä¸èƒ½èµ°springäº†, é‚£ä½ çš„@autowiredæ³¨è§£å°±éƒ½å®æ•ˆäº† æˆ‘ä»¬ä¸€ä¸ªjavaé¡¹ç›®ä¸å¯èƒ½å…¨éƒ¨éƒ½æ˜¯å•ä¾‹çš„bean, æˆ‘ä¹‹å‰åšè¿‡éœ€è¦åŠ¨æ€åˆ›å»ºtaskä»»åŠ¡, å†…éƒ¨éœ€è¦å¼•ç”¨åˆ°redistemplateæˆ–è€…å…¶ä»–Springå®¹å™¨é‡Œçš„bean, æˆ‘å¦‚æœç”¨newå…³é”®å­—, æˆ‘å¾—ä¸€ä¸ªä¸€ä¸ªä¼ , é‚£ä¸å°±æ˜¯æ‰‹å†™äº†. æ‰€ä»¥springæä¾›äº†prototypeå°±æ˜¯ä¸ºäº†è®©æˆ‘ä»¬éœ€è¦åˆ›å»ºå¤šä¾‹beançš„æ—¶å€™,ä¾ç„¶å¯ä»¥ä½¿ç”¨åˆ°springçš„æ•´ä¸ªåŠŸèƒ½.    è®²ä¸€ä¸‹javaçš„æ³¨è§£\næ³¨è§£å®é™…ä¸Šæ˜¯å¯¹ä»£ç çš„ä¸€ç§æ ‡è®°. æˆ‘ä»¬æœ€å¸¸ç”¨çš„Springæ¡†æ¶é‡Œå°±åŒ…å«å¾ˆå¤šæ³¨è§£,ä¾‹å¦‚@Autowired,@Controllerç­‰. è€ŒJavaåŸç”Ÿçš„æ³¨è§£æœ‰@Overried,@Deprecated,@FunctionalInterface. è¿™äº›åŸç”Ÿæ³¨è§£å¤šç”¨äºæ£€æŸ¥å’Œæ ‡è®°.\nJavaè¿˜æä¾›ç»™äº†å…ƒæ³¨è§£.@Retention,@Target,@Retentionæ³¨è§£å¯ä»¥ç®€å•ç†è§£ä¸ºè®¾ç½®æ³¨è§£çš„ç”Ÿå‘½å‘¨æœŸï¼Œè€Œ**@Target**è¡¨ç¤ºè¿™ä¸ªæ³¨è§£å¯ä»¥ä¿®é¥°å“ªäº›åœ°æ–¹ï¼ˆæ¯”å¦‚æ–¹æ³•ã€è¿˜æ˜¯æˆå‘˜å˜é‡ã€è¿˜æ˜¯åŒ…ç­‰ç­‰ï¼‰\n@Retentionå¯ä»¥æœ‰SOURCE,CLASSå’ŒRUNNTIME3çš„æšä¸¾å¯é€‰,è€Œæˆ‘ä»¬å¸¸ç”¨çš„lombokæä¾›çš„å„ç§æ³¨è§£,éƒ½æ˜¯SOURCE\n SOURCEä»£è¡¨æ³¨è§£ä»…ä¿ç•™åœ¨æºç çº§åˆ«,å¹¶ç”±ç¼–è¯‘å™¨å¿½ç•¥. CLASSä»£è¡¨ç€æ³¨è§£åœ¨ç¼–è¯‘æ—¶ä¿ç•™,ä½†æ˜¯åœ¨JVMä¸­ä¼šå¿½ç•¥, è€Œ RUNNTIMEå°±æ˜¯æ ‡è®°æ³¨è§£ç”±JVMä¿ç•™,æ‰€ä»¥æˆ‘ä»¬èƒ½åœ¨è¿è¡Œæ—¶é€šè¿‡åå°„è·å–åˆ°å®ƒ,å¦‚æœæˆ‘ä»¬æƒ³è¦åœ¨ç¼–è¯‘æœŸé—´å¤„ç†ç›¸å…³é€»è¾‘çš„è¯,å°±å¾—ç»§æ‰¿AbstractProcessor,è€ŒLombokå°±æ˜¯å®ç°äº†ä»–è‡ªå·±çš„AnnotationProcessor,è¿™é‡Œå¯ä»¥çœ‹åˆ°å†…éƒ¨çš„é€»è¾‘\n è¿™ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬å†™ä¸€ä¸ª@Dataå°±èƒ½å¤Ÿæœ‰set/getæ–¹æ³•äº†.è€Œå¹³æ—¶æˆ‘ä»¬,ç”¨çš„æœ€å¤šçš„å°±æ˜¯RUNNTIMEçš„æ³¨è§£,é…åˆä¸ŠSpringAOP,å¯ä»¥åšå¾ˆå¤šäº‹æƒ…,ä¾‹å¦‚æ—¥å¿—çš„é‡‡é›†,å¼‚å¸¸çš„å¤„ç†ç­‰ç­‰\n  è¯´ä¸€ä¸‹HashMapå§\né¦–å…ˆHashMapé‡‡ç”¨çš„æ˜¯key/valueçš„ç»“æ„,é€šè¿‡ä¸€ä¸ªkeyè·å–ä¸€ä¸ªvalueçš„æ—¶å€™,æ—¶é—´å¤æ‚åº¦å¯ä»¥è¾¾åˆ°O(1),èµ‹å€¼çš„æ—¶å€™ä¹Ÿæ˜¯ä¸€æ ·å¿«,ä½†æ˜¯å®ƒæ˜¯ä¸å®‰å…¨çš„,ä¸”æ˜¯æ— åºçš„.\n ä¸ºä»€ä¹ˆæ˜¯æ— åºå‘¢?\nHashMapä¸­å…ƒç´ çš„éå†æ˜¯æŒ‰ç…§ä»æ•°ç»„èµ·å§‹ä½ç½®å¼€å§‹,é¦–å…ˆå°†å½“å‰bucketä¸‹çš„æ‰€æœ‰å…ƒç´ éå†å®Œæˆ,ç„¶ååˆ°ä¸‹ä¸€ä¸ªbucket,bucketä¸bucketä¹‹é—´å¦‚æœä¸ºç©ºå°±è·³åˆ°ä¸‹ä¸€ä¸ªbucket,ç›´åˆ°å°†æ‰€æœ‰çš„å…ƒç´ éå†å‡ºæ¥.æ˜¾è€Œæ˜“è§,å…ƒç´ æ’å…¥çš„ä½ç½®å¹¶ä¸æ˜¯è¿™æ ·çš„é¡ºåº,å› æ­¤æ‰è¯´HashMapæ˜¯æ— åºçš„\n HashMapä¸­,é‡‡ç”¨çš„çš„æ•°æ®ç»“æ„æ˜¯æ•°ç»„+é“¾è¡¨+çº¢é»‘æ ‘,æ’å…¥çš„ä¸€ä¸ªé€»è¾‘æ˜¯,ç®—å‡ºKeyçš„hashå€¼,åœ¨æ•°ç»„ä¸­æ‰¾åˆ°hashå€¼å¯¹åº”çš„ä½ç½®,è¿™ä¸ªä½ç½®ç§°ä¸ºæ¡¶,å¦‚æœè¿™ä¸ªä½ç½®æœ‰æ•°æ®äº†,åˆ™é€šè¿‡é“¾è¡¨çš„æ–¹å¼é“¾æ¥åœ¨è¿™ä¸ªæ•°æ®ä¹‹å.å½“å•ä¸ªæ¡¶é“¾è¡¨çš„é•¿åº¦å¤§äºç­‰äº8ä¸ªå¹¶ä¸”æ¡¶çš„æ•°é‡å¤§äº64çš„æ—¶å€™,ä¼šè¿›åŒ–æˆçº¢é»‘æ ‘.å½“çº¢é»‘æ ‘çš„ä¸ªæ•°å°äºç­‰äº6çš„æ—¶å€™,åˆ™é€€åŒ–ä¸ºé“¾è¡¨.\n æ•°ç»„çš„æŸ¥è¯¢æ•ˆç‡ä¸ºO(1)ï¼Œé“¾è¡¨çš„æŸ¥è¯¢æ•ˆç‡æ˜¯O(k)ï¼Œçº¢é»‘æ ‘çš„æŸ¥è¯¢æ•ˆç‡æ˜¯O(log k)ï¼Œkä¸ºæ¡¶ä¸­çš„å…ƒç´ ä¸ªæ•°ï¼Œæ‰€ä»¥å½“å…ƒç´ æ•°é‡éå¸¸å¤šçš„æ—¶å€™ï¼Œè½¬åŒ–ä¸ºçº¢é»‘æ ‘èƒ½æå¤§åœ°æé«˜æ•ˆç‡ã€‚\n è‡³äºä¸ºä»€ä¹ˆ6é€€åŒ–,è€Œ8è¿›åŒ–,æˆ‘ä¹Ÿä¸æ˜¯å¾ˆæ¸…æ¥š\u0026hellip;.\n  è¯´ä¸€ä¸‹javaçš„æ³›å‹\næ³›å‹å…¶å®å°±æ˜¯åœ¨åˆ›å»ºå¯¹è±¡æˆ–è€…è°ƒç”¨æ–¹æ³•çš„æ—¶å€™,æ‰ä¼šå…·ä½“æ˜ç¡®å…·ä½“çš„ç±»å‹,å…·ä½“åˆ°ä»£ç é‡Œå°±æ˜¯ä¸éœ€è¦å¼ºåˆ¶è½¬æ¢,ä»£ç æ›´åŠ ç®€æ´. ç¨‹åºä¼šæ›´åŠ å¥å£®,åœ¨ç¼–è¯‘å™¨æ²¡æœ‰è­¦å‘Š,è¿è¡Œçš„æ—¶å€™å°±ä¸ä¼šå‡ºç°ClassCastExceptionçš„å¼‚å¸¸äº†\nå¹³æ—¶ä¹Ÿæœ‰ç”¨è¿‡,æœ€å¸¸è§çš„Springçš„JPA,æˆ–è€…Mybatis Plusé‡Œä¹Ÿæœ‰BaseMapper. å¹³æ—¶è‡ªå·±å†™çš„æ—¶å€™,ç”¨åˆ°æ³›å‹ç¦»ä¸å¼€åå°„(èƒ½åœ¨è¿è¡Œæ—¶è·å–ä¿¡æ¯),ä¸€èˆ¬éƒ½ä¼šé€šè¿‡åå°„å»åˆ¤æ–­ç±»å‹,è·å–å±æ€§å€¼,å†è¿›è¡Œä¸šåŠ¡é€»è¾‘æ“ä½œçš„\n  ä¸å’Œä½ å¤šé€¼é€¼,å…ˆè¯´è¯´å„ç§IOå§\n  gcè¯´è¯´å§,CMSæ˜¯ä»€ä¹ˆ\né¦–å…ˆè¯´ä¸‹CMS,CMSæ˜¯ä¸€ç§GCç®—æ³•,å…¨ç§°æ˜¯Concurrent-Mark-Sweep.æ˜¯æˆ‘ä»¬æœ€å¸¸ç”¨çš„åƒåœ¾å›æ”¶ç®—æ³•\n CMS æ˜¯ä¸€ç§åŸºäºå¹¶å‘ã€ä½¿ç”¨æ ‡è®°æ¸…é™¤ç®—æ³•çš„åƒåœ¾å›æ”¶å™¨ã€‚CMS ä¼šå°½å¯èƒ½è®© GC çº¿ç¨‹ä¸ç”¨æˆ·çº¿ç¨‹å¹¶å‘æ‰§è¡Œï¼Œå¯ä»¥æ¶ˆé™¤é•¿æ—¶é—´çš„ GC åœé¡¿ï¼ˆSTWï¼‰ã€‚\n   ä½ èƒ½å†™å‡ºå¤šå°‘ç§æ’åºç®—æ³•?äºŒåˆ†å†™ä¸‹å§\n å†’æ³¡    TCPå’ŒUDP?\n  UDP\n  UDPé¦–å…ˆä»–ä¸æ˜¯é¢å‘è¿æ¥çš„, å› æ­¤ä»–ä¸éœ€è¦åƒTCPä¸€æ ·éœ€è¦é€šè¿‡ä¸‰æ¬¡æ¡æ‰‹å»ºç«‹è¿æ¥, æƒ³å‘æ•°æ®å°±ç›´æ¥å‘äº†, å¹¶ä¸å…³å¿ƒå¯¹æ–¹æ˜¯å¦æ”¶åˆ°, ä¹Ÿä¸å…³å¿ƒæ˜¯å¦å®Œæ•´.UDP ä¸æ­¢æ”¯æŒä¸€å¯¹ä¸€çš„ä¼ è¾“æ–¹å¼ï¼ŒåŒæ ·æ”¯æŒä¸€å¯¹å¤šï¼Œå¤šå¯¹å¤šï¼Œå¤šå¯¹ä¸€çš„æ–¹å¼ï¼Œä¹Ÿå°±æ˜¯è¯´ UDP æä¾›äº†å•æ’­ï¼Œå¤šæ’­ï¼Œå¹¿æ’­çš„åŠŸèƒ½ã€‚\n   é¦–å…ˆä¸å¯é æ€§ä½“ç°åœ¨æ— è¿æ¥ä¸Šï¼Œé€šä¿¡éƒ½ä¸éœ€è¦å»ºç«‹è¿æ¥ï¼Œæƒ³å‘å°±å‘ï¼Œè¿™æ ·çš„æƒ…å†µè‚¯å®šä¸å¯é ã€‚\nå¹¶ä¸”æ”¶åˆ°ä»€ä¹ˆæ•°æ®å°±ä¼ é€’ä»€ä¹ˆæ•°æ®ï¼Œå¹¶ä¸”ä¹Ÿä¸ä¼šå¤‡ä»½æ•°æ®ï¼Œå‘é€æ•°æ®ä¹Ÿä¸ä¼šå…³å¿ƒå¯¹æ–¹æ˜¯å¦å·²ç»æ­£ç¡®æ¥æ”¶åˆ°æ•°æ®äº†ã€‚\nå†è€…ç½‘ç»œç¯å¢ƒæ—¶å¥½æ—¶åï¼Œä½†æ˜¯ UDP å› ä¸ºæ²¡æœ‰æ‹¥å¡æ§åˆ¶ï¼Œä¸€ç›´ä¼šä»¥æ’å®šçš„é€Ÿåº¦å‘é€æ•°æ®ã€‚å³ä½¿ç½‘ç»œæ¡ä»¶ä¸å¥½ï¼Œä¹Ÿä¸ä¼šå¯¹å‘é€é€Ÿç‡è¿›è¡Œè°ƒæ•´ã€‚è¿™æ ·å®ç°çš„å¼Šç«¯å°±æ˜¯åœ¨ç½‘ç»œæ¡ä»¶ä¸å¥½çš„æƒ…å†µä¸‹å¯èƒ½ä¼šå¯¼è‡´ä¸¢åŒ…ï¼Œä½†æ˜¯ä¼˜ç‚¹ä¹Ÿå¾ˆæ˜æ˜¾ï¼Œåœ¨æŸäº›å®æ—¶æ€§è¦æ±‚é«˜çš„åœºæ™¯ï¼ˆæ¯”å¦‚ç”µè¯ä¼šè®®ï¼‰å°±éœ€è¦ä½¿ç”¨ UDP è€Œä¸æ˜¯ TCPã€‚\n   UDPæ˜¯é¢å‘æŠ¥æ–‡çš„, å‘é€æ–¹çš„UDPå¯¹åº”ç”¨ç¨‹åºäº¤ä¸‹æ¥çš„æŠ¥æ–‡ï¼Œåœ¨æ·»åŠ é¦–éƒ¨åå°±å‘ä¸‹äº¤ä»˜IPå±‚ã€‚UDPå¯¹åº”ç”¨å±‚äº¤ä¸‹æ¥çš„æŠ¥æ–‡ï¼Œæ—¢ä¸åˆå¹¶ï¼Œä¹Ÿä¸æ‹†åˆ†ï¼Œè€Œæ˜¯ä¿ç•™è¿™äº›æŠ¥æ–‡çš„è¾¹ç•Œã€‚å› æ­¤ï¼Œåº”ç”¨ç¨‹åºå¿…é¡»é€‰æ‹©åˆé€‚å¤§å°çš„æŠ¥æ–‡\n  UDP å¤´éƒ¨åŒ…å«äº†ä»¥ä¸‹å‡ ä¸ªæ•°æ®ï¼š\n ä¸¤ä¸ªåå…­ä½çš„ç«¯å£å·ï¼Œåˆ†åˆ«ä¸ºæºç«¯å£ï¼ˆå¯é€‰å­—æ®µï¼‰å’Œç›®æ ‡ç«¯å£ æ•´ä¸ªæ•°æ®æŠ¥æ–‡çš„é•¿åº¦ æ•´ä¸ªæ•°æ®æŠ¥æ–‡çš„æ£€éªŒå’Œï¼ˆIPv4 å¯é€‰ å­—æ®µï¼‰ï¼Œè¯¥å­—æ®µç”¨äºå‘ç°å¤´éƒ¨ä¿¡æ¯å’Œæ•°æ®ä¸­çš„é”™è¯¯  å› æ­¤ UDP çš„å¤´éƒ¨å¼€é”€å°ï¼Œåªæœ‰å…«å­—èŠ‚ï¼Œç›¸æ¯” TCP çš„è‡³å°‘äºŒåå­—èŠ‚è¦å°‘å¾—å¤šï¼Œåœ¨ä¼ è¾“æ•°æ®æŠ¥æ–‡æ—¶æ˜¯å¾ˆé«˜æ•ˆçš„\n    TCP\n  é¢å‘è¿æ¥\né¢å‘è¿æ¥ï¼Œæ˜¯æŒ‡å‘é€æ•°æ®ä¹‹å‰å¿…é¡»åœ¨ä¸¤ç«¯å»ºç«‹è¿æ¥ã€‚å»ºç«‹è¿æ¥çš„æ–¹æ³•æ˜¯â€œä¸‰æ¬¡æ¡æ‰‹â€ï¼Œè¿™æ ·èƒ½å»ºç«‹å¯é çš„è¿æ¥ã€‚å»ºç«‹è¿æ¥ï¼Œæ˜¯ä¸ºæ•°æ®çš„å¯é ä¼ è¾“æ‰“ä¸‹äº†åŸºç¡€ã€‚\n  ä»…æ”¯æŒå•æ’­ä¼ è¾“\n  æ¯æ¡TCPä¼ è¾“è¿æ¥åªèƒ½æœ‰ä¸¤ä¸ªç«¯ç‚¹ï¼Œåªèƒ½è¿›è¡Œç‚¹å¯¹ç‚¹çš„æ•°æ®ä¼ è¾“ï¼Œä¸æ”¯æŒå¤šæ’­å’Œå¹¿æ’­ä¼ è¾“æ–¹å¼ã€‚\n é¢å‘å­—èŠ‚æµ  TCPä¸åƒUDPä¸€æ ·é‚£æ ·ä¸€ä¸ªä¸ªæŠ¥æ–‡ç‹¬ç«‹åœ°ä¼ è¾“ï¼Œè€Œæ˜¯åœ¨ä¸ä¿ç•™æŠ¥æ–‡è¾¹ç•Œçš„æƒ…å†µä¸‹ä»¥å­—èŠ‚æµæ–¹å¼è¿›è¡Œä¼ è¾“ã€‚\n  å¯é ä¼ è¾“\nå¯¹äºå¯é ä¼ è¾“ï¼Œåˆ¤æ–­ä¸¢åŒ…ï¼Œè¯¯ç é çš„æ˜¯TCPçš„æ®µç¼–å·ä»¥åŠç¡®è®¤å·ã€‚TCPä¸ºäº†ä¿è¯æŠ¥æ–‡ä¼ è¾“çš„å¯é ï¼Œå°±ç»™æ¯ä¸ªåŒ…ä¸€ä¸ªåºå·ï¼ŒåŒæ—¶åºå·ä¹Ÿä¿è¯äº†ä¼ é€åˆ°æ¥æ”¶ç«¯å®ä½“çš„åŒ…çš„æŒ‰åºæ¥æ”¶ã€‚ç„¶åæ¥æ”¶ç«¯å®ä½“å¯¹å·²æˆåŠŸæ”¶åˆ°çš„å­—èŠ‚å‘å›ä¸€ä¸ªç›¸åº”çš„ç¡®è®¤(ACK)ï¼›å¦‚æœå‘é€ç«¯å®ä½“åœ¨åˆç†çš„å¾€è¿”æ—¶å»¶(RTT)å†…æœªæ”¶åˆ°ç¡®è®¤ï¼Œé‚£ä¹ˆå¯¹åº”çš„æ•°æ®ï¼ˆå‡è®¾ä¸¢å¤±äº†ï¼‰å°†ä¼šè¢«é‡ä¼ ã€‚\n  æä¾›æ‹¥å¡æ§åˆ¶\n  å½“ç½‘ç»œå‡ºç°æ‹¥å¡çš„æ—¶å€™ï¼ŒTCPèƒ½å¤Ÿå‡å°å‘ç½‘ç»œæ³¨å…¥æ•°æ®çš„é€Ÿç‡å’Œæ•°é‡ï¼Œç¼“è§£æ‹¥å¡\n TCPæä¾›å…¨åŒå·¥é€šä¿¡  TCPå…è®¸é€šä¿¡åŒæ–¹çš„åº”ç”¨ç¨‹åºåœ¨ä»»ä½•æ—¶å€™éƒ½èƒ½å‘é€æ•°æ®ï¼Œå› ä¸ºTCPè¿æ¥çš„ä¸¤ç«¯éƒ½è®¾æœ‰ç¼“å­˜ï¼Œç”¨æ¥ä¸´æ—¶å­˜æ”¾åŒå‘é€šä¿¡çš„æ•°æ®ã€‚å½“ç„¶ï¼ŒTCPå¯ä»¥ç«‹å³å‘é€ä¸€ä¸ªæ•°æ®æ®µï¼Œä¹Ÿå¯ä»¥ç¼“å­˜ä¸€æ®µæ—¶é—´ä»¥ä¾¿ä¸€æ¬¡å‘é€æ›´å¤šçš„æ•°æ®æ®µï¼ˆæœ€å¤§çš„æ•°æ®æ®µå¤§å°å–å†³äºMSSï¼‰\n    å†è¯´ä¸€æ¬¡ä¸‰æ¬¡æ¡æ‰‹å§\n3æ¬¡æ¡æ‰‹\n clientå‘serverå‘é€æŠ¥æ–‡,tcpçš„æŠ¥æ–‡å¤´å›ºå®š20å­—èŠ‚ä¸­çš„, æ ‡è¯†ä½ä¼šè®¾ç½®ä¸ºSYN, å‘é€å®Œæ¯•åclientä¼šè¿›å…¥ SYN-SENTçŠ¶æ€, ç­‰å¾…ä¸€ä¸ªACKçš„æŠ¥æ–‡, è¿™æ˜¯ç¬¬ä¸€æ¬¡æ¡æ‰‹ serveræ”¶åˆ°SYNå, å‘é€SYN+ACKç»™client, serverè¿›å…¥SYN-RECEIVEDçŠ¶æ€, è¿™æ˜¯ç¬¬äºŒæ¬¡æ¡æ‰‹ clientæ¥æ”¶åˆ°serverå‘é€çš„SYN+ACKçš„æ—¶å€™,å‘é€ACKç¡®è®¤æ”¶åˆ°, è¿›å…¥ESTABLISHEDçŠ¶æ€, è¿™æ˜¯ç¬¬ä¸‰æ¬¡æ¡æ‰‹ serveræ¥æ”¶åˆ°ACK, è¿›å…¥ ESTABLSHEDçŠ¶æ€. ä¸‰æ¬¡æ¡æ‰‹ç»“æŸ  ä¸ºä»€ä¹ˆä¸€å®šæ˜¯3æ¬¡,ä¸èƒ½2æ¬¡å—,å¦‚æœæ˜¯2æ¬¡,æ²¡æœ‰ç¬¬ä¸‰æ¬¡clientå‘ç»™serverçš„è¯,ä¹Ÿè®¸ç¬¬äºŒæ¬¡æ¡æ‰‹å®Œ,serverå°±è¿›å…¥establishedçŠ¶æ€,ä½†æ˜¯æ­¤æ—¶å®¢æˆ·ç«¯å¯èƒ½è¿æ¥å¤±æ•ˆäº†,æ˜¯ä¸ºäº†é˜²æ­¢å¤±æ•ˆçš„æŠ¥æ–‡ä¹Ÿè¢«serveræ¥æ”¶å¯¼è‡´é”™è¯¯.\n4æ¬¡æŒ¥æ‰‹\n clientå‘serverå‘é€æŠ¥æ–‡,æ ‡è¯†ä½ä¸ºFIN, è¡¨ç¤ºè¦å…³é—­è¿æ¥, è¿™æ˜¯ç¬¬ä¸€æ¬¡æŒ¥æ‰‹ serveræ”¶åˆ°FIN, è¿›å…¥CLOSE_AWAITçŠ¶æ€, ä¸å†æ¥å—clientçš„æ•°æ®, ä½†æ­¤æ—¶clientä¾ç„¶å¯ä»¥ç»§ç»­å‘é€, å¹¶ä¸”å‘é€ACKç»™Client.è¿™æ˜¯ç¬¬äºŒæ¬¡æŒ¥æ‰‹ å¦‚æœserverè¿˜æœ‰æ²¡å‘é€å®Œçš„æ•°æ®,ä¼šç»§ç»­å‘é€,æœ€åå‘é€FINç»™client, è¿›å…¥ last_ackçŠ¶æ€è¿™æ˜¯ç¬¬ä¸‰æ¬¡æŒ¥æ‰‹ clientæ”¶åˆ°FINå, ä¼šè¿›å…¥time-waitçŠ¶æ€, ç­‰å¾…2MSL, å¦‚æœè¿™ä¸ªæ—¶é—´å†… serveræ²¡æœ‰å†å‘é€è¯·æ±‚, å°±è¿›å…¥closeçŠ¶æ€,å¹¶ä¸”å‘é€ACKåˆ°server, serveræ¥æ”¶åˆ°ackä¹Ÿè¿›å…¥close, è¿™æ˜¯ç¬¬å››æ¬¡æŒ¥æ‰‹    NIOæ˜¯ä»€ä¹ˆ,JavaNIOåˆæœ‰ä»€ä¹ˆåŒºåˆ«,å†™ç‚¹demoå§\n  mapä¸flatMapçš„åŒºåˆ«\nmapä¼šä½œç”¨äºæ•´ä¸ªstreamçš„åºåˆ—ä¸Š, flatMapä¼šé¿å…å‡ºç°åµŒå¥—å¼çš„stream\u0026lt;stream\u0026gt;, æ‰å¹³åŒ–å¤„ç†, ç›¸å½“äºä¸ç ´åæœ€å¤–å±‚çš„ç»“æ„, ç»™å†…éƒ¨çš„æ¯ä¸ªå…ƒç´ å†ä¸€æ¬¡ streamçš„æœºä¼š. è¾¾åˆ°avoid nested stream structure\n  java1.8 11 åŒºåˆ«ï¼Œä½ å¹³æ—¶äº†è§£javaæ–°ç‰ˆæœ¬çš„ç‰¹æ€§å—ï¼Ÿåç¨‹çŸ¥é“ä¹ˆ\n  mysqlä¸ºä»€ä¹ˆä¸€å®šè¦æœ‰èšç°‡ç´¢å¼•å‘¢\n  ","permalink":"https://sunhao1256.github.io/posts/%E5%B9%B3%E6%97%B6%E7%96%91%E9%97%AE/","summary":"å¹³æ—¶ç–‘é—®   æµè§ˆå™¨è¾“å…¥ä¸€ä¸ªåœ°å€ï¼Œæ•´ä¸ªæµç¨‹\n  å¦‚æœçº¿ä¸Šæµé‡æš´å¢ï¼Œå…¨éƒ½æ‰“åˆ°ä¸€ä¸ª upstream ä¸Šäº†ï¼Œæ€ä¹ˆæ’æŸ¥\n  å¦‚ä½•åœ¨ nginx çš„ access log ä¸­æŸ¥å‡ºè¯·æ±‚å‰ 10 çš„ ip\n  å°é˜¶é—®é¢˜ï¼Œå‡å¦‚å¯¹äºä¸Šå°é˜¶ï¼Œå¯ä»¥ä¸€æ¬¡ä¸Šä¸€é˜¶ï¼Œä¹Ÿå¯ä»¥ä¸€æ¬¡ä¸Šä¸¤é˜¶ï¼Œå†™ä¸€ä¸ªæ–¹æ³•ï¼Œå®ç°è¾“å…¥å°é˜¶æ•°ï¼Œè¾“å‡ºå¯ä»¥æœ‰å¤šå°‘ç§ä¸Šæ³•ã€‚\n  å¹¿åº¦ä¼˜å…ˆå’Œæ·±åº¦ä¼˜å…ˆ\n  spring reactiveï¼Œå“åº”å¼èŠä¸‹ï¼Œä»€ä¹ˆæ—¶å€™é€‚åˆç”¨ï¼ŸèƒŒå‹æ˜¯ä»€ä¹ˆä¸œè¥¿ï¼Œbackpress\n  å‹ç¼©ç®—æ³•ï¼Œæ€ä¹ˆå°±â€œå‹ç¼©â€äº†ï¼Ÿå¦‚ä½•å‡å°‘ä½“ç§¯çš„ï¼Ÿ\n  å®æ—¶ä¸€è‡´æ€§ï¼Œæœ€ç»ˆä¸€è‡´æ€§æ˜¯ä»€ä¹ˆï¼Ÿä»€ä¹ˆåœºæ™¯ä¸‹ç”¨é‚£ç§ï¼Œå¦‚ä½•å®ç°çš„ï¼Ÿ\n  å®æ—¶ä¸€è‡´æ€§:\nå¾®æœåŠ¡ä¸­ï¼Œåœºæ™¯ç”¨æˆ·ä½¿ç”¨ç§¯åˆ†å…‘æ¢ä¼˜æƒ åˆ¸ï¼Œç§¯åˆ†serviceå…ˆæ‰£é™¤ç§¯åˆ†ï¼Œä¼˜æƒ åˆ¸serviceå†è¿›è¡Œå‘åˆ¸åŠ¨ä½œï¼Œå¦‚æœç½‘ç»œé—®é¢˜ï¼Œç§¯åˆ†æ‰£æˆåŠŸäº†ï¼Œä½†æ˜¯ä¼˜æƒ åˆ¸å‘å¤±è´¥äº†ã€‚ç”¨æˆ·ä¼šæŠ•è¯‰ï¼Œå¿…é¡»è¦è¯ä¼˜æƒ åˆ¸å’Œç§¯åˆ†è¦åœ¨åŒä¸€ä¸ªåˆ†å¸ƒå¼äº‹åŠ¡ä¸­.\nè§£å†³æ–¹æ¡ˆï¼šå¸‚é¢ä¸Šçš„åˆ†å¸ƒå¼äº‹åŠ¡ï¼Œé˜¿é‡Œçš„seata\n  æœ€ç»ˆä¸€è‡´æ€§:\nå¾®æœåŠ¡ä¸­ï¼Œç”¨æˆ·é€‰æ‹©å•†å“ä¸‹å•ï¼Œå•†å“serviceè¿›è¡Œåº“å­˜æ‰£ä»¶ï¼Œè®¢å•serviceç”Ÿæˆè®¢å•ï¼Œäº¤æ˜“serviceç”Ÿæˆäº¤æ˜“è®¢å•ã€‚å¦‚æœç½‘ç»œåŸå› å¯¼è‡´ï¼Œäº¤æ˜“serviceç”Ÿæˆäº¤æ˜“è®¢å•å¤±è´¥äº†ã€‚å¹¶æ²¡æœ‰å½±å“ï¼Œåªéœ€è¦é€šè¿‡æªæ–½é‡æ–°å¼¥è¡¥äº¤æ˜“serviceå»ç”Ÿæˆäº¤æ˜“è®¢å•å³å¯ã€‚\nè§£å†³æ–¹æ³•ï¼šmqï¼Œé€šè¿‡mqçš„é‡è¯•æœºåˆ¶ä»¥åŠæŒä¹…åŒ–ç­‰ç‰¹æ€§ï¼Œæ¯ä¸€ä¸ªå¾®æœåŠ¡ä¸ä¸‹æ¸¸å¾®æœåŠ¡è¿›è¡Œäº¤äº’åŠ¨ä½œéƒ½æ˜¯é€šè¿‡mqçš„æ¶ˆæ¯ã€‚ä¿è¯æ¶ˆæ¯èƒ½å¤Ÿè¢«æ¶ˆè´¹ï¼Œé•¿æ—¶é—´æœªæ¶ˆè´¹å¯ä»¥å‘Šè­¦ã€‚\n    æ¶ˆæ¯å †ç§¯å¦‚ä½•å¤„ç†ï¼Ÿä»¥åŠäº§ç”Ÿçš„å±å®³ã€‚\n  æ€ä¹ˆä¿è¯æ¥å£å¹‚ç­‰\n  å¦‚ä½•è¯„åˆ¤ä¸€ä¸ªæœåŠ¡çš„å¥½åï¼Ÿä½ æ˜¯å¦‚ä½•è¿›è¡Œå‹æµ‹çš„ï¼ŸæŸ¥çœ‹äº†å“ªäº›æŒ‡æ ‡\n  å¯¹è±¡å­˜å‚¨ï¼Œæ–‡ä»¶å­˜å‚¨ï¼Œå—å­˜å‚¨ã€‚åŒºåˆ«\n  æœåŠ¡å™¨å¡äº†ï¼Œå­—éƒ½å¿«æ‰“ä¸åŠ¨äº†ï¼Œå’‹å›äº‹ï¼Œæ€ä¹ˆæ’æŸ¥\n  ç”¨è¿‡mysqlè¡Œé”å—\nç”¨è¿‡ï¼Œåœ¨ä¸€äº›æ¯”è¾ƒç®€å•çš„å¾®æœåŠ¡åœºæ™¯ï¼Œæˆ–è€…æ— æ³•ä½¿ç”¨å…¶ä»–ä¸­é—´ä»¶çš„å‰æä¸‹ã€‚å¦‚æœéœ€è¦éƒ¨ç½²å¤šèŠ‚ç‚¹çš„è¯ï¼Œæœ€æ–¹ä¾¿çš„åˆ†å¸ƒå¼é”å°±æ˜¯mysqlï¼Œå› ä¸ºæˆ‘ä»¬çš„dbåº“åŸºæœ¬éƒ½æ˜¯å•èŠ‚ç‚¹çš„mysqlæˆ–è€…mariadbã€‚ä½¿ç”¨èµ·æ¥å…¶å®å¾ˆç®€å•ï¼Œå°±æ˜¯ä¸€ä¸ªupdateè¯­å¥ï¼Œæ›´æ–°versionå­—æ®µã€‚ä¹Ÿå°±æ˜¯æ‰€è°“çš„ä¹è§‚é”ã€‚å¼€å¯ä¸€ä¸ªäº‹åŠ¡ï¼Œå…ˆselecté”ï¼Œç„¶åå°è¯•æ›´æ–°é”ï¼Œåœ¨æ²¡å®Œæˆä¸šåŠ¡çš„ä¹‹å‰æ˜¯ä¸æäº¤é”çš„ï¼Œæ‰€ä»¥ï¼Œå…¶ä»–çº¿ç¨‹ä¼šåœ¨è·å–é”çš„æ—¶å€™å°±åœä¸‹æ¥ã€‚å› ä¸ºupdateï¼Œdeleteï¼Œinserté»˜è®¤éƒ½æ˜¯å¸¦for updateï¼Œå³è¡Œé”çš„ã€‚å½“ç„¶selectä¸ä¼šé˜»å¡ï¼Œé™¤éä¸»åŠ¨çš„è®¾ç½®for updateã€‚è¿™æ ·å°±æ˜¯æœ€åŸºç¡€çš„ä¸€ä¸ªåˆ†å¸ƒå¼é”äº†ã€‚åˆ‡è®°é”å­—æ®µå¿…é¡»è¦æœ‰ç´¢å¼•ï¼Œå¦åˆ™é”æ•´ä¸ªè¡¨ã€‚å°±Gäº†\n  nettyç©è¿‡å—ï¼Œç©è¿‡å“ªäº›ä¸œè¥¿ï¼Œèƒ½å¹²å•¥","title":"å¹³æ—¶ç–‘é—®"},{"content":"å † å †æ˜¯ä¸€ç§éçº¿æ€§ç»“æ„ï¼Œå¯ä»¥æŠŠå †çœ‹ä½œä¸€ä¸ªæ•°ç»„ï¼Œä¹Ÿå¯ä»¥è¢«çœ‹ä½œä¸€ä¸ªå®Œå…¨äºŒå‰æ ‘ï¼Œé€šä¿—æ¥è®²å †å…¶å®å°±æ˜¯åˆ©ç”¨å®Œå…¨äºŒå‰æ ‘çš„ç»“æ„æ¥ç»´æŠ¤çš„ä¸€ç»´æ•°ç»„ä½†å †å¹¶ä¸ä¸€å®šæ˜¯å®Œå…¨äºŒå‰æ ‘\næŒ‰ç…§å †çš„ç‰¹ç‚¹å¯ä»¥æŠŠå †åˆ†ä¸ºå¤§é¡¶å †å’Œå°é¡¶å † å¤§é¡¶å †ï¼šæ¯ä¸ªç»“ç‚¹çš„å€¼éƒ½å¤§äºæˆ–ç­‰äºå…¶å·¦å³å­©å­ç»“ç‚¹çš„å€¼ å°é¡¶å †ï¼šæ¯ä¸ªç»“ç‚¹çš„å€¼éƒ½å°äºæˆ–ç­‰äºå…¶å·¦å³å­©å­ç»“ç‚¹çš„å€¼\nä½¿ç”¨å †çš„åŸå› ï¼Ÿ å¦‚æœä»…ä»…æ˜¯éœ€è¦å¾—åˆ°ä¸€ä¸ªæœ‰åºçš„åºåˆ—ï¼Œä½¿ç”¨æ’åºå°±å¯ä»¥å¾ˆå¿«å®Œæˆï¼Œå¹¶ä¸éœ€è¦å»ç»„ç»‡ä¸€ä¸ªæ–°çš„æ•°æ®ç»“æ„ã€‚ä½†æ˜¯å¦‚æœæˆ‘ä»¬çš„éœ€æ±‚æ˜¯å¯¹äºä¸€ä¸ªéšæ—¶ä¼šæœ‰æ›´æ–°çš„åºåˆ—ï¼Œæˆ‘è¦éšæ—¶çŸ¥é“è¿™ä¸ªåºåˆ—çš„æœ€å°å€¼æˆ–æœ€å¤§å€¼æ˜¯ä»€ä¹ˆã€‚æ˜¾ç„¶å¦‚æœæ˜¯çº¿æ€§ç»“æ„ï¼Œæ¯æ¬¡æ’å…¥ä¹‹åï¼Œå‡è®¾åŸæ•°ç»„æ˜¯æœ‰åºçš„ï¼Œé‚£ä½¿ç”¨äºŒåˆ†æŠŠå®ƒæ”¾åœ¨æ­£ç¡®çš„ä½ç½®ä¹Ÿæœªå°ä¸å¯ï¼Œä½†æ˜¯æ’å…¥çš„æ—¶å€™ä»æ•°ç»„ä¸­ç•™å‡ºç©ºä½å°±éœ€è¦O(n)çš„æ—¶é—´å¤æ‚åº¦ï¼Œåˆ é™¤çš„æ—¶å€™äº¦ç„¶ã€‚\næ—¶é—´å¤æ‚åº¦ æ’å…¥å’Œåˆ é™¤çš„æ—¶é—´å¤æ‚åº¦æ˜¯O(logn)\nç¯å½¢é˜Ÿåˆ—(æ•°ç»„) æ™®é€šé˜Ÿåˆ— æ™®é€šé˜Ÿåˆ—ï¼Œæ•°ç»„å®ç°æ—¶ï¼Œå‡ºé˜Ÿåï¼ŒåŸæ¥çš„ç©ºé—´å°±æµªè´¹äº†ã€‚\nç¯å½¢é˜Ÿåˆ— ç¯å½¢é˜Ÿåˆ—ï¼Œæ•°ç»„å®ç°æ—¶ï¼Œä¸‹æ ‡ç”¨æ¨¡å–è¿ç®—ï¼Œä¾‹å¦‚æœ€å¤§ç©ºé—´ä¸º5ï¼Œæ¨¡å–ååªä¼šæœ‰0ï¼Œ1ï¼Œ2ï¼Œ3ï¼Œ4ä¸‹æ ‡ï¼Œç»„æˆäº†å¾ªç¯ã€‚\n front å˜é‡çš„å«ä¹‰åšä¸€ä¸ªè°ƒæ•´ï¼š front å°±æŒ‡å‘é˜Ÿåˆ—çš„ç¬¬ä¸€ä¸ªå…ƒç´ , ä¹Ÿå°±æ˜¯è¯´ arr[front] å°±æ˜¯é˜Ÿåˆ—çš„ç¬¬ä¸€ä¸ªå…ƒç´  front çš„åˆå§‹å€¼ = 0 rear å˜é‡çš„å«ä¹‰åšä¸€ä¸ªè°ƒæ•´ï¼šrear æŒ‡å‘é˜Ÿåˆ—çš„æœ€åä¸€ä¸ªå…ƒç´ çš„åä¸€ä¸ªä½ç½®. å› ä¸ºå¸Œæœ›ç©ºå‡ºä¸€ä¸ªç©ºé—´åšä¸ºçº¦å®š. rear çš„åˆå§‹å€¼ = 0 å½“é˜Ÿåˆ—æ»¡æ—¶ï¼Œæ¡ä»¶æ˜¯ (rear + 1) % maxSize == front ã€æ»¡ã€‘ å¯¹é˜Ÿåˆ—ä¸ºç©ºçš„æ¡ä»¶ï¼Œ rear == front ç©º å½“æˆ‘ä»¬è¿™æ ·åˆ†æï¼Œ é˜Ÿåˆ—ä¸­æœ‰æ•ˆçš„æ•°æ®çš„ä¸ªæ•° (rear + maxSize - front) % maxSize // rear = 1 front = 0  æ—¶é—´è½® ä½¿ç”¨åœºæ™¯ï¼Œå¤„ç†å¤§æ‰¹é‡çš„å®šæ—¶ä»»åŠ¡\nåˆ©ç”¨ç¯å½¢é˜Ÿåˆ—ï¼Œé˜Ÿåˆ—çš„æ¯ä¸ªç©ºé—´é‡Œå­˜æ”¾çš„æ˜¯ä»»åŠ¡çš„é›†åˆã€‚\nä¾‹å¦‚ä»¥60ç§’ä¸ºä¸€ä¸ªè½®ï¼Œ70ç§’åæ‰§è¡Œä¸€ä¸ªä»»åŠ¡ã€‚åªéœ€è¦ä¸€ä¸ªtimeræŒ‰ç§’å»æ—‹è½¬æ—¶é—´è½®ï¼Œ70%60=10ï¼Œåˆ°è¾¾ç¬¬10ä¸ªæ§½çš„æ—¶å€™ï¼Œæ‰§è¡Œå†…éƒ¨çš„æ‰€æœ‰ä»»åŠ¡å³å¯ã€‚\nä¸ºäº†è§£å†³10ç§’å’Œ70ç§’è½åœ¨åŒä¸€ä¸ªæ§½ä¸Šï¼Œå¯ä»¥åœ¨ä»»åŠ¡èº«ä¸ŠåŠ ä¸€ä¸ªå±æ€§ï¼Œåœˆæ•°ï¼Œä¾‹å¦‚10ç§’çš„ä»»åŠ¡åœˆæ•°æ˜¯0ï¼Œ70ç§’çš„ä»»åŠ¡æ˜¯1ï¼Œåªæœ‰è¾¾åˆ°æ§½ä½ç½®ï¼Œå¹¶ä¸”åœˆæ•°ä¸º0çš„ä»»åŠ¡æ‰ä¼šè¢«æ‰§è¡Œã€‚\nkafakaçš„åšæ³•æ˜¯ï¼Œå†åšä¸€ä¸ªåˆ†é’Ÿè½®ï¼Œå…ˆè½¬åˆ†é’Ÿè½®ã€‚å†è½¬ç§’çš„è½®ã€‚\næ ‘ äºŒå‰æœç´¢æ ‘(BST) æ ¹èŠ‚ç‚¹çš„å€¼å¤§äºå…¶å·¦å­æ ‘ä¸­ä»»æ„ä¸€ä¸ªèŠ‚ç‚¹çš„å€¼ï¼Œå°äºå…¶å³èŠ‚ç‚¹ä¸­ä»»æ„ä¸€èŠ‚ç‚¹çš„å€¼ï¼Œè¿™ä¸€è§„åˆ™é€‚ç”¨äºäºŒå‰æŸ¥æ‰¾æ ‘ä¸­çš„æ¯ä¸€ä¸ªèŠ‚ç‚¹ã€‚\nå®Œå…¨å¹³è¡¡äºŒå‰æ ‘(AVL) è§£å†³äºŒå‰æ ‘æç«¯ä¸‹å˜æˆé“¾è¡¨\nçº¢é»‘æ ‘ è§£å†³ï¼Œå®Œå…¨å¹³è¡¡äºŒå‰æ ‘å¹³è¡¡é¢‘ç‡è¿‡äºé¢‘ç¹ã€‚\næ—¶é—´å¤æ‚åº¦log(n)\n äºŒå‰æœç´¢æ ‘ï¼šä¹Ÿç§°äºŒå‰æŸ¥æ‰¾æ ‘ï¼Œæˆ–äºŒå‰æ’åºæ ‘ã€‚å®šä¹‰ä¹Ÿæ¯”è¾ƒç®€å•ï¼Œè¦ä¹ˆæ˜¯ä¸€é¢—ç©ºæ ‘ï¼Œè¦ä¹ˆå°±æ˜¯å…·æœ‰å¦‚ä¸‹æ€§è´¨çš„äºŒå‰æ ‘ï¼š ï¼ˆ1ï¼‰è‹¥ä»»æ„èŠ‚ç‚¹çš„å·¦å­æ ‘ä¸ç©ºï¼Œåˆ™å·¦å­æ ‘ä¸Šæ‰€æœ‰ç»“ç‚¹çš„å€¼å‡å°äºå®ƒçš„æ ¹ç»“ç‚¹çš„ å€¼ï¼› ï¼ˆ2ï¼‰è‹¥ä»»æ„èŠ‚ç‚¹çš„å³å­æ ‘ä¸ç©ºï¼Œåˆ™å³å­æ ‘ä¸Šæ‰€æœ‰ç»“ç‚¹çš„å€¼å‡å¤§äºå®ƒçš„æ ¹ç»“ç‚¹çš„ å€¼ï¼› ï¼ˆ3ï¼‰ä»»æ„èŠ‚ç‚¹çš„å·¦ã€å³å­æ ‘ä¹Ÿåˆ†åˆ«ä¸ºäºŒå‰æŸ¥æ‰¾æ ‘ï¼› ï¼ˆ4ï¼‰æ²¡æœ‰é”®å€¼ç›¸ç­‰çš„èŠ‚ç‚¹ã€‚\nå¹³è¡¡äºŒå‰æ ‘ï¼šåœ¨äºŒå‰æœç´¢æ ‘çš„åŸºç¡€ä¸Šå¤šäº†ä¸¤ä¸ªé‡è¦çš„ç‰¹ç‚¹ï¼š ï¼ˆ1ï¼‰å·¦å³ä¸¤å­æ ‘çš„é«˜åº¦å·®çš„ç»å¯¹å€¼ä¸èƒ½è¶…è¿‡ 1ï¼› ï¼ˆ2ï¼‰å·¦å³ä¸¤å­æ ‘ä¹Ÿæ˜¯ä¸€é¢—å¹³è¡¡äºŒå‰æ ‘ã€‚\nçº¢é»‘æ ‘ï¼šçº¢é»‘æ ‘æ˜¯åœ¨æ™®é€šäºŒå‰æ ‘ä¸Šï¼Œå¯¹æ¯ä¸ªèŠ‚ç‚¹æ·»åŠ ä¸€ä¸ªé¢œè‰²å±æ€§å½¢æˆçš„ï¼Œéœ€è¦åŒæ—¶æ»¡è¶³ä¸€ä¸‹äº”æ¡æ€§è´¨ï¼š ï¼ˆ1ï¼‰èŠ‚ç‚¹æ˜¯çº¢è‰²æˆ–è€…æ˜¯é»‘è‰²ï¼› ï¼ˆ2ï¼‰æ ¹èŠ‚ç‚¹æ˜¯é»‘è‰²ï¼› ï¼ˆ3ï¼‰æ¯ä¸ªå¶èŠ‚ç‚¹ï¼ˆNIL æˆ–ç©ºèŠ‚ç‚¹ï¼‰æ˜¯é»‘è‰²ï¼› ï¼ˆ4ï¼‰æ¯ä¸ªçº¢è‰²èŠ‚ç‚¹çš„ä¸¤ä¸ªå­èŠ‚ç‚¹éƒ½æ˜¯é»‘è‰²çš„ï¼ˆä¹Ÿå°±æ˜¯è¯´ä¸å­˜åœ¨ä¸¤ä¸ªè¿ç»­çš„çº¢è‰²èŠ‚ ç‚¹ï¼‰ï¼› ï¼ˆ5ï¼‰ä»ä»»ä¸€èŠ‚ç‚¹åˆ°å…¶æ²¡ä¸ªå¶èŠ‚ç‚¹çš„æ‰€æœ‰è·¯å¾„éƒ½åŒ…å«ç›¸åŒæ•°ç›®çš„é»‘è‰²èŠ‚ç‚¹ã€‚\nåŒºåˆ«ï¼šAVL æ ‘éœ€è¦ä¿æŒå¹³è¡¡ï¼Œä½†å®ƒçš„æ—‹è½¬å¤ªè€—æ—¶ï¼Œè€Œçº¢é»‘æ ‘å°±æ˜¯ä¸€ä¸ªæ²¡æœ‰ AVL æ ‘ é‚£æ ·å¹³è¡¡ï¼Œå› æ­¤æ’å…¥ã€åˆ é™¤æ•ˆç‡ä¼šé«˜äº AVL æ ‘ï¼Œè€Œ AVL æ ‘çš„æŸ¥æ‰¾æ•ˆç‡æ˜¾ç„¶é«˜äºçº¢é»‘æ ‘ã€‚\n   å¦‚æœæ’å…¥ä¸€ä¸ªnodeå¼•èµ·äº†æ ‘çš„ä¸å¹³è¡¡ï¼ŒAVLå’ŒRB-Tree(çº¢é»‘æ ‘)éƒ½æ˜¯æœ€å¤šåªéœ€è¦2æ¬¡æ—‹è½¬æ“ä½œï¼Œå³ä¸¤è€…éƒ½æ˜¯O(1)ï¼›ä½†æ˜¯åœ¨åˆ é™¤nodeå¼•èµ·æ ‘çš„ä¸å¹³è¡¡æ—¶ï¼Œæœ€åæƒ…å†µä¸‹ï¼ŒAVLéœ€è¦ç»´æŠ¤ä»è¢«åˆ nodeåˆ°rootè¿™æ¡è·¯å¾„ä¸Šæ‰€æœ‰nodeçš„å¹³è¡¡æ€§ï¼Œå› æ­¤éœ€è¦æ—‹è½¬çš„é‡çº§O(logN)ï¼Œè€ŒRB-Treeæœ€å¤šåªéœ€3æ¬¡(å› ä¸ºä¸éœ€è¦ä¸¥æ ¼çš„å¹³è¡¡ï¼Œä»æ ¹åˆ°å¶å­çš„æœ€é•¿çš„å¯èƒ½è·¯å¾„ä¸å¤šäºæœ€çŸ­çš„å¯èƒ½è·¯å¾„çš„ä¸¤å€é•¿)æ—‹è½¬ä»¥åŠä¿®æ”¹èŠ‚ç‚¹çš„é¢œè‰²ï¼Œåªéœ€è¦O(1)çš„å¤æ‚åº¦ã€‚\n  å…¶æ¬¡ï¼ŒAVLçš„ç»“æ„ç›¸è¾ƒRB-Treeæ¥è¯´æ›´ä¸ºå¹³è¡¡ï¼Œåœ¨æ’å…¥å’Œåˆ é™¤nodeæ›´å®¹æ˜“å¼•èµ·Treeçš„unbalanceï¼Œå› æ­¤åœ¨å¤§é‡æ•°æ®éœ€è¦æ’å…¥æˆ–è€…åˆ é™¤æ—¶ï¼ŒAVLéœ€è¦rebalanceçš„é¢‘ç‡ä¼šæ›´é«˜ã€‚å› æ­¤ï¼ŒRB-Treeåœ¨éœ€è¦å¤§é‡æ’å…¥å’Œåˆ é™¤nodeçš„åœºæ™¯ä¸‹ï¼Œæ•ˆç‡æ›´é«˜ã€‚è‡ªç„¶ï¼Œç”±äºAVLé«˜åº¦å¹³è¡¡ï¼Œå› æ­¤AVLçš„searchæ•ˆç‡æ›´é«˜ã€‚\n  IOå¤šè·¯å¤ç”¨epollçš„å®ç°é‡‡ç”¨çº¢é»‘æ ‘ç»„ç»‡ç®¡ç†sockfdï¼Œä»¥æ”¯æŒå¿«é€Ÿçš„å¢åˆ æ”¹æŸ¥. ngnixä¸­,ç”¨çº¢é»‘æ ‘ç®¡ç†timer,å› ä¸ºçº¢é»‘æ ‘æ˜¯æœ‰åºçš„,å¯ä»¥å¾ˆå¿«çš„å¾—åˆ°è·ç¦»å½“å‰æœ€å°çš„å®šæ—¶å™¨. javaä¸­TreeMapï¼Œjdk1.8çš„hashmapçš„å®ç°.\n","permalink":"https://sunhao1256.github.io/posts/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/","summary":"å † å †æ˜¯ä¸€ç§éçº¿æ€§ç»“æ„ï¼Œå¯ä»¥æŠŠå †çœ‹ä½œä¸€ä¸ªæ•°ç»„ï¼Œä¹Ÿå¯ä»¥è¢«çœ‹ä½œä¸€ä¸ªå®Œå…¨äºŒå‰æ ‘ï¼Œé€šä¿—æ¥è®²å †å…¶å®å°±æ˜¯åˆ©ç”¨å®Œå…¨äºŒå‰æ ‘çš„ç»“æ„æ¥ç»´æŠ¤çš„ä¸€ç»´æ•°ç»„ä½†å †å¹¶ä¸ä¸€å®šæ˜¯å®Œå…¨äºŒå‰æ ‘\næŒ‰ç…§å †çš„ç‰¹ç‚¹å¯ä»¥æŠŠå †åˆ†ä¸ºå¤§é¡¶å †å’Œå°é¡¶å † å¤§é¡¶å †ï¼šæ¯ä¸ªç»“ç‚¹çš„å€¼éƒ½å¤§äºæˆ–ç­‰äºå…¶å·¦å³å­©å­ç»“ç‚¹çš„å€¼ å°é¡¶å †ï¼šæ¯ä¸ªç»“ç‚¹çš„å€¼éƒ½å°äºæˆ–ç­‰äºå…¶å·¦å³å­©å­ç»“ç‚¹çš„å€¼\nä½¿ç”¨å †çš„åŸå› ï¼Ÿ å¦‚æœä»…ä»…æ˜¯éœ€è¦å¾—åˆ°ä¸€ä¸ªæœ‰åºçš„åºåˆ—ï¼Œä½¿ç”¨æ’åºå°±å¯ä»¥å¾ˆå¿«å®Œæˆï¼Œå¹¶ä¸éœ€è¦å»ç»„ç»‡ä¸€ä¸ªæ–°çš„æ•°æ®ç»“æ„ã€‚ä½†æ˜¯å¦‚æœæˆ‘ä»¬çš„éœ€æ±‚æ˜¯å¯¹äºä¸€ä¸ªéšæ—¶ä¼šæœ‰æ›´æ–°çš„åºåˆ—ï¼Œæˆ‘è¦éšæ—¶çŸ¥é“è¿™ä¸ªåºåˆ—çš„æœ€å°å€¼æˆ–æœ€å¤§å€¼æ˜¯ä»€ä¹ˆã€‚æ˜¾ç„¶å¦‚æœæ˜¯çº¿æ€§ç»“æ„ï¼Œæ¯æ¬¡æ’å…¥ä¹‹åï¼Œå‡è®¾åŸæ•°ç»„æ˜¯æœ‰åºçš„ï¼Œé‚£ä½¿ç”¨äºŒåˆ†æŠŠå®ƒæ”¾åœ¨æ­£ç¡®çš„ä½ç½®ä¹Ÿæœªå°ä¸å¯ï¼Œä½†æ˜¯æ’å…¥çš„æ—¶å€™ä»æ•°ç»„ä¸­ç•™å‡ºç©ºä½å°±éœ€è¦O(n)çš„æ—¶é—´å¤æ‚åº¦ï¼Œåˆ é™¤çš„æ—¶å€™äº¦ç„¶ã€‚\næ—¶é—´å¤æ‚åº¦ æ’å…¥å’Œåˆ é™¤çš„æ—¶é—´å¤æ‚åº¦æ˜¯O(logn)\nç¯å½¢é˜Ÿåˆ—(æ•°ç»„) æ™®é€šé˜Ÿåˆ— æ™®é€šé˜Ÿåˆ—ï¼Œæ•°ç»„å®ç°æ—¶ï¼Œå‡ºé˜Ÿåï¼ŒåŸæ¥çš„ç©ºé—´å°±æµªè´¹äº†ã€‚\nç¯å½¢é˜Ÿåˆ— ç¯å½¢é˜Ÿåˆ—ï¼Œæ•°ç»„å®ç°æ—¶ï¼Œä¸‹æ ‡ç”¨æ¨¡å–è¿ç®—ï¼Œä¾‹å¦‚æœ€å¤§ç©ºé—´ä¸º5ï¼Œæ¨¡å–ååªä¼šæœ‰0ï¼Œ1ï¼Œ2ï¼Œ3ï¼Œ4ä¸‹æ ‡ï¼Œç»„æˆäº†å¾ªç¯ã€‚\n front å˜é‡çš„å«ä¹‰åšä¸€ä¸ªè°ƒæ•´ï¼š front å°±æŒ‡å‘é˜Ÿåˆ—çš„ç¬¬ä¸€ä¸ªå…ƒç´ , ä¹Ÿå°±æ˜¯è¯´ arr[front] å°±æ˜¯é˜Ÿåˆ—çš„ç¬¬ä¸€ä¸ªå…ƒç´  front çš„åˆå§‹å€¼ = 0 rear å˜é‡çš„å«ä¹‰åšä¸€ä¸ªè°ƒæ•´ï¼šrear æŒ‡å‘é˜Ÿåˆ—çš„æœ€åä¸€ä¸ªå…ƒç´ çš„åä¸€ä¸ªä½ç½®. å› ä¸ºå¸Œæœ›ç©ºå‡ºä¸€ä¸ªç©ºé—´åšä¸ºçº¦å®š. rear çš„åˆå§‹å€¼ = 0 å½“é˜Ÿåˆ—æ»¡æ—¶ï¼Œæ¡ä»¶æ˜¯ (rear + 1) % maxSize == front ã€æ»¡ã€‘ å¯¹é˜Ÿåˆ—ä¸ºç©ºçš„æ¡ä»¶ï¼Œ rear == front ç©º å½“æˆ‘ä»¬è¿™æ ·åˆ†æï¼Œ é˜Ÿåˆ—ä¸­æœ‰æ•ˆçš„æ•°æ®çš„ä¸ªæ•° (rear + maxSize - front) % maxSize // rear = 1 front = 0  æ—¶é—´è½® ä½¿ç”¨åœºæ™¯ï¼Œå¤„ç†å¤§æ‰¹é‡çš„å®šæ—¶ä»»åŠ¡\nåˆ©ç”¨ç¯å½¢é˜Ÿåˆ—ï¼Œé˜Ÿåˆ—çš„æ¯ä¸ªç©ºé—´é‡Œå­˜æ”¾çš„æ˜¯ä»»åŠ¡çš„é›†åˆã€‚\nä¾‹å¦‚ä»¥60ç§’ä¸ºä¸€ä¸ªè½®ï¼Œ70ç§’åæ‰§è¡Œä¸€ä¸ªä»»åŠ¡ã€‚åªéœ€è¦ä¸€ä¸ªtimeræŒ‰ç§’å»æ—‹è½¬æ—¶é—´è½®ï¼Œ70%60=10ï¼Œåˆ°è¾¾ç¬¬10ä¸ªæ§½çš„æ—¶å€™ï¼Œæ‰§è¡Œå†…éƒ¨çš„æ‰€æœ‰ä»»åŠ¡å³å¯ã€‚\nä¸ºäº†è§£å†³10ç§’å’Œ70ç§’è½åœ¨åŒä¸€ä¸ªæ§½ä¸Šï¼Œå¯ä»¥åœ¨ä»»åŠ¡èº«ä¸ŠåŠ ä¸€ä¸ªå±æ€§ï¼Œåœˆæ•°ï¼Œä¾‹å¦‚10ç§’çš„ä»»åŠ¡åœˆæ•°æ˜¯0ï¼Œ70ç§’çš„ä»»åŠ¡æ˜¯1ï¼Œåªæœ‰è¾¾åˆ°æ§½ä½ç½®ï¼Œå¹¶ä¸”åœˆæ•°ä¸º0çš„ä»»åŠ¡æ‰ä¼šè¢«æ‰§è¡Œã€‚","title":"æ•°æ®ç»“æ„"},{"content":"ç»ˆç«¯ [root@LocalHost æ¡Œé¢]# l\n rootè¡¨ç¤ºå½“å‰ç™»å½•ç”¨æˆ·å locahostè¡¨ç¤ºå½“å‰ç™»å½•çš„ä¸»æœºå æ¡Œé¢ è¡¨ç¤ºå½“å‰çš„å·¥ä½œç›®å½• # èº«ä»½æ ‡è¯†ç¬¦ #è¡¨ç¤ºä¸ºè¶…çº§ç®¡ç†å‘˜ $è¡¨ç¤ºä¸ºæ™®é€šç”¨æˆ·  ç›®å½•ç»“æ„  Binï¼šå…¨ç§°Binaryï¼Œå­˜æ”¾çš„éƒ½æ˜¯ä¸€äº›äºŒè¿›åˆ¶æ–‡ä»¶ Devï¼šä¸»è¦å­˜æ”¾ä¸€äº›å¤–æ¥è®¾å¤‡ï¼Œä¾‹å¦‚Uç›˜ç­‰ï¼Œåœ¨å…¶ä¸­çš„è®¾å¤‡æ˜¯ä¸èƒ½ç›´æ¥ä½¿ç”¨çš„ï¼Œéœ€è¦æŒ‚è½½ï¼ˆç±»ä¼¼windowsä¸‹çš„åˆ†ç›˜ï¼‰ Etcï¼šä¸»è¦å­˜æ”¾ä¸€äº›é…ç½®æ–‡ä»¶ Homeï¼šè¡¨ç¤ºé™¤äº†rootç”¨æˆ·ä»¥å¤–çš„å…¶ä»–çš„å®¶ç›®å½•ï¼Œç±»ä¼¼windowsä¸‹çš„userç”¨æˆ·ç›®å½• Procï¼šè¯¥ç›®å½•å­˜æ”¾è¿è¡Œçš„è¿›ç¨‹æ–‡ä»¶ Rootï¼šè¯¥ç›®å½•æ˜¯rootç”¨æˆ·çš„å®¶ç›®å½• SBinï¼šè¯¥ç›®å½•ä¹Ÿæ˜¯å­˜æ”¾äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä½†æ˜¯å¿…é¡»å¾—æœ‰superæƒé™çš„ç”¨æˆ·æ‰èƒ½æ‰§è¡Œ Usrï¼šç”¨æˆ·çš„åº”ç”¨ç¨‹åºå’Œæ–‡ä»¶éƒ½æ”¾åœ¨è¿™ä¸ªç›®å½•ä¸‹ç±»ä¼¼äºwindowsä¸‹çš„program filesç›®å½• Mntï¼šè®©ç”¨æˆ·ä¸´æ—¶æŒ‚åœ¨åˆ«çš„æ–‡ä»¶ç³»ç»Ÿ Optï¼šä¸€èˆ¬å­˜æ”¾å®‰è£…è½¯ä»¶åŒ… Usr/localï¼šå­˜æ”¾å®‰è£…è½¯ä»¶åå­˜åœ¨çš„è½¯ä»¶ç›®å½• Varï¼šå­˜æ”¾ä¸æ–­å˜åŒ–çš„æ–‡ä»¶ï¼Œä¾‹å¦‚æ—¥å¿—æ–‡ä»¶  VIå’ŒVIMç¼–è¾‘å™¨ æ‰€æœ‰çš„Linuxç³»ç»Ÿéƒ½ä¼šå†…å»ºVIæ–‡æœ¬ç¼–è¾‘å™¨ï¼ŒVIMå…·æœ‰ç¨‹åºç¼–è¾‘çš„èƒ½åŠ›ï¼Œå¯ä»¥çœ‹æˆæ˜¯VIçš„å¢å¼ºç‰ˆ\nVIå’ŒVIMçš„3ç§å¸¸è§æ¨¡å¼   æ­£å¸¸æ¨¡å¼\nåœ¨æ­£å¸¸æ˜¯æ¨¡å¼ä¸‹ï¼Œå¯ä»¥ä½¿ç”¨å¿«æ·é”®æ¥å¤„ç†å†…å®¹\n  æ’å…¥/ç¼–è¾‘æ¨¡å¼\nåœ¨æ­¤æ¨¡å¼ä¸‹ï¼Œå¯ä»¥è¾“å…¥å†…å®¹ï¼ŒæŒ‰iï¼ŒIï¼Œoï¼ŒOï¼Œaï¼ŒAï¼Œrï¼ŒRç­‰ä»»ä½•ä¸€ä¸ªå­—æ¯å°±å¯ä»¥è¿›å…¥ç¼–è¾‘æ¨¡å¼ï¼Œä¸€èˆ¬ç”¨i\n  å‘½ä»¤è¡Œæ¨¡å¼\nå¯ä»¥ä½¿ç”¨æŒ‡ä»¤å®Œæˆï¼Œè¯»å–ï¼Œå­˜ç›˜ï¼Œæ›¿æ¢ï¼Œç¦»å¼€ï¼Œæ˜¾ç¤ºè¡Œå·ç­‰åŠ¨ä½œ\n  æ³¨é‡Š å•è¡Œæ³¨é‡Šï¼š#\nå¤šè¡Œæ³¨é‡Šï¼š:\u0026laquo;!å†…å®¹!\nå¿«æ·é”®çš„ä½¿ç”¨   è¡Œé¦–0ï¼Œè¡Œå°¾$\n  æ‹·è´å½“å‰è¡Œï¼šyyï¼Œæ‹·è´å½“å‰å‘ä¸‹nè¡Œï¼šnyyï¼Œä¾‹å¦‚ï¼š5yy\n  ç²˜è´´ï¼šp\n  åˆ é™¤å½“å‰è¡Œï¼šddï¼Œåˆ é™¤å½“å‰è¡Œä¸‹nè¡Œï¼šnddï¼Œä¾‹å¦‚ï¼š5dd\n  æŸ¥æ‰¾ï¼šå‘½ä»¤è¡Œæ¨¡å¼ä¸‹ / å…³é”®å­—ï¼Œä¾‹å¦‚ï¼š/helloï¼Œä¸‹ä¸€ä¸ªn\n  è®¾ç½®æ–‡ä»¶è¡Œå·ï¼šå‘½ä»¤è¡Œæ¨¡å¼ä¸‹ ï¼šset nuï¼Œå…³é—­è¡Œå·ï¼šset nonu\n  å¿«é€Ÿåˆ°é¡¶è¡Œï¼šæ­£å¸¸æ¨¡å¼ä¸‹ gg\n  å¿«é€Ÿåˆ°åº•è¡Œï¼šæ­£å¸¸æ¨¡å¼ä¸‹G\n  æ’¤é”€ï¼šæ­£å¸¸æ¨¡å¼ä¸‹u\n  æŒ‡å®šåˆ°è¡Œå·ï¼šå…ˆæ˜¾ç¤ºè¡Œå·ï¼Œåœ¨æ­£å¸¸æ¨¡å¼ä¸‹å…ˆè¾“å…¥è¡Œæ•°ï¼Œå†æŒ‰shift+g\n  oï¼šè¿›å…¥è¾“å…¥æ¨¡å¼ï¼Œä¸”è¿›å…¥ä¸‹ä¸€è¡Œ\n  å¤åˆ¶ï¼Œåˆ é™¤/å‰ªåˆ‡ yyï¼šå¤åˆ¶å…‰æ ‡æ‰€åœ¨ä¸€è¡Œ 3yyï¼šå¤åˆ¶å…‰æ ‡æ‰€åœ¨è¡ŒåŠå‘ä¸‹2è¡Œ pï¼šç²˜è´´ ddï¼šå‰ªåˆ‡/åˆ é™¤å…‰æ ‡æ‰€åœ¨ä¸€è¡Œ 3ddï¼šå‰ªåˆ‡/åˆ é™¤å…‰æ ‡æ‰€åœ¨è¡ŒåŠå‘ä¸‹ä¸¤è¡Œ Dï¼šä»å½“å‰çš„å…‰æ ‡å¼€å§‹å‰ªåˆ‡ä¸€ç›´åˆ°è¡Œæœ« d0ï¼šä»å½“å‰å…‰æ ‡å¼€å§‹å‰ªåˆ‡ä¸€ç›´åˆ°è¡Œé¦– xï¼šåˆ é™¤å½“å‰çš„å…‰æ ‡ï¼Œæ¯æ¬¡åªä¼šåˆ é™¤ä¸€ä¸ª Xï¼šåˆ é™¤å½“å‰å…‰æ ‡å‰é¢çš„é‚£ä¸ªï¼Œæ¯æ¬¡åªä¼šåˆ é™¤ä¸€ä¸ª æ§åˆ¶å…‰æ ‡ä¸Šä¸‹å·¦å³èµ°ï¼šhå·¦jä¸‹kä¸Šlå³\n  å®šä½ï¼š Hï¼šå½“å‰å±å¹•çš„ä¸Šæ–¹ Mï¼šå½“å‰å±å¹•çš„ä¸­é—´ Lï¼šå½“å‰å±å¹•çš„ä¸‹æ–¹ Ctrl+fï¼šå‘ä¸‹ç¿»ä¸€é¡µä»£ç  Ctrl+bï¼šå‘ä¸Šç¿»ä¸€é¡µä»£ç  Ctrl+dï¼šå‘ä¸‹ç¿»åŠé¡µä»£ç  Ctrl+uï¼šå‘ä¸Šç¿»åŠé¡µä»£ç  20Gï¼šå¿«é€Ÿçš„å®šä½åˆ°ç¬¬20è¡Œï¼Œå®šä½åˆ°ç¬¬1è¡Œå°±æ˜¯1Gï¼Œä»¥æ­¤ç±»æ¨ Gï¼šå¿«é€Ÿçš„å›åˆ°æ•´ä¸ªä»£ç çš„æœ€åä¸€è¡Œ ggï¼šå¿«é€Ÿå›åˆ°æ•´ä¸ªä»£ç çš„ç¬¬ä¸€è¡Œ wï¼šå‘åè·³ä¸€ä¸ªå•è¯çš„é•¿åº¦ï¼Œå³è°ƒåˆ°ä¸‹ä¸€ä¸ªå•è¯çš„å¼€å§‹å¤„ bï¼šå‘åè·³ä¸€ä¸ªå•è¯çš„é•¿åº¦ï¼Œå³è°ƒåˆ°ä¸Šä¸€ä¸ªå•è¯çš„å¼€å§‹å¤„\n  æ’¤é”€ uï¼šæ’¤é”€åˆšåˆšçš„åŠ¨ä½œ Ctrl+rï¼šåæ’¤é”€\n  é€‰ä¸­ä¸€ç‰‡ä»£ç  vï¼šé€‰ä¸­ä¸€ç‰‡ä»£ç  Vï¼šé€‰ä¸­ä¸€ç‰‡ä»£ç \nï¼šå‘å³ç§»åŠ¨ä»£ç \n\u0026laquo;ï¼šå‘å·¦ç§»åŠ¨ä»£ç \n. ï¼šé‡å¤æ‰§è¡Œä¸Šä¸€æ¬¡çš„å‘½ä»¤\n  æ›¿æ¢ rï¼šæ›¿æ¢ä¸€ä¸ªå­—ç¬¦ Rï¼šæ›¿æ¢å…‰æ ‡ä»¥åŠåé¢çš„å­—ç¬¦ shift+zzï¼šä¿å­˜å¹¶é€€å‡º\n  æœ«è¡Œæ¨¡å¼ä¸‹ æ›¿æ¢ å°†å½“å‰æ–‡ä»¶ä¸­çš„æ‰€æœ‰abcæ›¿æ¢æˆ123 :%s/abc/123/g å°†ç¬¬ä¸€è¡Œåˆ°ç¬¬åè¡Œä¹‹é—´çš„abcæ›¿æ¢æˆ123 :1, 10s/abc/123/g** æŸ¥æ‰¾ æŸ¥æ‰¾æ•´ä¸ªä»£ç ä¸­çš„hello ï¼š/hello nï¼šä¸‹ä¸€ä¸ª Nï¼šä¸Šä¸€ä¸ª ä¿å­˜å’Œé€€å‡º :q é€€å‡ºä¸ä¿å­˜ :wq ä¿å­˜å¹¶é€€å‡º :q ! å¼ºåˆ¶é€€å‡ºä¸ä¿å­˜ :wq! å¼ºåˆ¶ä¿å­˜å¹¶é€€å‡º\n  å…³æœºå’Œé‡å¯  shutdown -h now ï¼šè¡¨ç¤ºç«‹å³å…³æœº shutdown -h 1ï¼šè¡¨ç¤º1åˆ†é’Ÿåå…³æœº shutdown -r nowï¼šè¡¨ç¤ºç«‹å³é‡å¯ haltï¼šç›´æ¥å…³æœº rebootï¼šé‡å¯ç³»ç»Ÿ syncï¼šæŠŠå†…å­˜æ•°æ®åŒæ­¥åˆ°ç£ç›˜ä¸Šï¼Œé˜²æ­¢æ•°æ®ä¸¢å¤±  ç™»å½•å’Œæ³¨é”€  ä¸€èˆ¬æ˜¯ä½¿ç”¨æ™®é€šè´¦å·è¿›è¡Œç™»å½•ï¼Œå½“æƒé™ä¸å¤Ÿçš„æ—¶å€™åœ¨ç”¨\u0026quot;su - ç”¨æˆ·å\u0026quot;åˆ‡æ¢åˆ°ç³»ç»Ÿç®¡ç†å‘˜èº«ä»½ logoutæ³¨é”€ç”¨æˆ·  ç”¨æˆ·ç®¡ç† æ¯ä¸ªç”¨æˆ·è‡³å°‘å­˜åœ¨ä¸€ä¸ªç”¨æˆ·ç»„ä¸­ã€‚\n  æ·»åŠ ç”¨æˆ·ï¼š useradd [é€‰é¡¹] ç”¨æˆ·åï¼Œå¦‚æœä¸æŒ‡å®šç”¨æˆ·ç»„ä¼šç»™ç”¨æˆ·åˆ›å»ºä¸€ä¸ªåŒåçš„ç”¨æˆ·ç»„ï¼Œå¹¶å­˜æ”¾åœ¨å…¶ä¸­ã€‚\nuseradd -d è·¯å¾„ ç”¨æˆ·åï¼ŒæŒ‡å®šç”¨æˆ·çš„è®¿é—®è·¯å¾„\nuseradd -g ç»„å ç”¨æˆ·åï¼ŒæŒ‡å®šç”¨æˆ·çš„ç”¨æˆ·ç»„\n  è®¾ç½®å¯†ç ï¼š passwd ç”¨æˆ·å\n  æŸ¥çœ‹å½“å‰ç›®å½•è·¯å¾„ï¼š pwd\n  åˆ é™¤ç”¨æˆ·ï¼š userdel ç”¨æˆ·åï¼Œuserdel -r ç”¨æˆ·åï¼Œåˆ é™¤ç”¨æˆ·ä¸”åˆ é™¤å®¶ç›®å½•ï¼Œï¼ˆä¸€èˆ¬ä¸åˆ é™¤å®¶ç›®å½•ï¼‰\n  æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯ï¼š id ç”¨æˆ·å\n  åˆ‡æ¢åˆ°å…¶ä»–ç”¨æˆ·ï¼š su -ç”¨æˆ·å\n  * `/etc/passwd`ï¼š ç”¨æˆ·è´¦æˆ·çš„è¯¦ç»†ä¿¡æ¯åœ¨æ­¤æ–‡ä»¶ä¸­æ›´æ–°ã€‚ * `/etc/shadow`ï¼š ç”¨æˆ·è´¦æˆ·å¯†ç åœ¨æ­¤æ–‡ä»¶ä¸­æ›´æ–°ã€‚ * `/etc/group`ï¼š æ–°ç”¨æˆ·ç¾¤ç»„çš„è¯¦ç»†ä¿¡æ¯åœ¨æ­¤æ–‡ä»¶ä¸­æ›´æ–°ã€‚ * `/etc/gshadow`ï¼š æ–°ç”¨æˆ·ç¾¤ç»„å¯†ç åœ¨æ­¤æ–‡ä»¶ä¸­æ›´æ–°ã€‚   ç”¨æˆ·ç»„ç®¡ç†  æ–°å¢ï¼šgroupadd ç»„å åˆ é™¤ï¼šgroupdel ç»„å ä¿®æ”¹ç”¨æˆ·çš„ç”¨æˆ·ç»„ï¼šusermod -g ç»„å ç”¨æˆ·åï¼Œä¿®æ”¹ç”¨æˆ·çš„ç”¨æˆ·ç»„ ä¿®æ”¹ç”¨æˆ·çš„ç™»å½•ç›®å½•ï¼šusermod -d è·¯å¾„å ç”¨æˆ·å  æŒ‡å®šè¿è¡Œçº§åˆ« ç³»ç»Ÿçš„è¿è¡Œçº§åˆ«æ–‡ä»¶åœ¨/etc/inittabï¼Œå¯ä»¥è®¾ç½®é»˜è®¤çš„è¿è¡Œçº§åˆ«\n  0ï¼šå…³æœº\n  1ï¼šå•ç”¨æˆ·\n  2ï¼šå¤šç”¨æˆ·æ— ç½‘ç»œæœåŠ¡\n  3ï¼šå¤šç”¨æˆ·æœ‰ç½‘ç»œæœåŠ¡\n  4ï¼šä¿ç•™\n  5ï¼šå›¾å½¢åŒ–ç•Œé¢\n  6ï¼šé‡å¯\nåˆ‡æ¢åˆ°æŒ‡å®šè¿è¡Œçº§åˆ«å‘½ä»¤ï¼šinit(çº§åˆ«)\næ³¨æ„ç‚¹ï¼šå¦‚æœrootå¯†ç ä¸¢å¤±çš„è¯ï¼Œå¯ä»¥æŒ‡å®šè¿è¡Œçº§åˆ«ä¸º1ï¼Œå•ç”¨æˆ·çº§åˆ«ï¼Œç›´æ¥å…å¯†ç ç™»å½•rootï¼Œç„¶åä¿®æ”¹å¯†ç ã€‚\n  å¸®åŠ©æŒ‡ä»¤ man å‘½ä»¤\næ–‡ä»¶ç›®å½•ç±»æŒ‡ä»¤   pwdï¼š æ˜¾ç¤ºå½“å‰å·¥ä½œçš„ç»å¯¹è·¯å¾„\n  lsï¼š æŸ¥çœ‹å½“å‰ç›®å½•ç»“æ„\nls -[é€‰é¡¹]\n-aï¼šæŸ¥å‡ºæ‰€æœ‰åŠ ä¸Šéšè—æ–‡ä»¶\n-lï¼šæ¨ªå‘å±•ç¤ºæ–‡ä»¶ä¿¡æ¯\n-hï¼šä»¥äººç±»çš„æ–¹å¼æŸ¥çœ‹ï¼Œå¯ä»¥æ˜¾ç¤ºæ–‡ä»¶å…·ä½“å¤§å°å•ä½\n  cdï¼š åˆ‡æ¢åˆ°å…¶ä»–ç›®å½•\n  mkdirï¼š åˆ›å»ºç›®å½• mkdir[é€‰é¡¹] ç›®å½•å\nmkdir -p ç›®å½•åï¼Œåˆ›å»ºå¤šçº§ç›®å½•\n  rmdirï¼šåˆ é™¤ä¸€ä¸ªç©ºç›®å½•ï¼ˆæ— æ³•åˆ é™¤éç©ºç›®å½•ï¼Œéœ€è¦ä½¿ç”¨rm -rf ç›®å½•åï¼Œæ‰å¯ä»¥è¿›è¡Œåˆ é™¤ï¼‰\n  touchï¼šåˆ›å»ºä¸€ä¸ªæˆ–å¤šä¸ªç©ºæ–‡ä»¶\n  cpï¼šæ‹·è´æ–‡ä»¶åˆ°æŒ‡å®šç›®å½•\ncp æ–‡ä»¶å ç›®æ ‡è·¯å¾„\n\\cp ï¼šå¦‚æœæœ‰å­˜åœ¨æ–‡ä»¶ï¼Œå¼ºåˆ¶è¦†ç›–\ncp -r ç›®å½•å ç›®æ ‡è·¯å¾„ ï¼šé€’å½’æ‹·è´æ•´ä¸ªæ–‡ä»¶å¤¹\n  rmï¼šç§»é™¤æ–‡ä»¶æˆ–ç›®å½•\nrm -rï¼šé€’å½’åˆ é™¤æ•´ä¸ªæ–‡ä»¶å¤¹\nrm -fï¼šå¼ºåˆ¶åˆ é™¤ä¸æç¤º\n  mvï¼šç§»åŠ¨æ–‡ä»¶ä¸é‡å‘½å\nmv a.txt b.txt é‡å‘½å\nmv /a /b ç§»åŠ¨æ–‡ä»¶\n  catï¼šæµè§ˆæ–‡ä»¶ï¼Œåªè¯»ï¼Œä¸èƒ½ä¿®æ”¹ï¼Œä¸€èˆ¬é…åˆ |moreåˆ†é¡µæ˜¾ç¤º\ncat -n æ–‡ä»¶å |more åˆ†é¡µæ˜¾ç¤ºè¡Œå·æµè§ˆæ–‡ä»¶\n  moreï¼šä»¥å…¨å±æ–¹å¼å»æ˜¾ç¤ºæ–‡ä»¶å†…å®¹ï¼Œç©ºæ ¼ä¸‹ä¸€é¡µï¼Œenterä¸‹ä¸€è¡Œï¼Œctrl+fä¸‹ä¸€é¡µï¼Œctrl+bä¸Šä¸€é¡µ\n  lessï¼šä¸Moreä¸åŒçš„æ˜¯ï¼Œlessä¸æ˜¯ä¸€æ¬¡å°†æ–‡ä»¶åŠ è½½å®Œæ‰æ˜¾ç¤ºï¼Œæ‰€ä»¥å¯¹å¤§å‹æ–‡ä»¶æ•ˆç‡é«˜ï¼Œæ¨èæŸ¥çœ‹æ—¥å¿—æ–‡ä»¶\n  \u0026gt; ï¼šè¾“å‡ºé‡å®šå‘ï¼Œè¦†ç›–åŸå…ˆå†…å®¹ï¼ˆæ–‡ä»¶ä¸å­˜åœ¨å°±åˆ›å»ºï¼‰\necho \u0026lsquo;test\u0026rsquo; test.txt\n  \u0026gt;\u0026gt;ï¼šè¿½åŠ æŒ‡ä»¤\n  cal ï¼šæ˜¾ç¤ºå½“å‰æ—¥å†\n  echoï¼šè¾“å…¥å†…å®¹åˆ°æ§åˆ¶å°ï¼Œç»å¸¸è¾“å‡ºç¯å¢ƒå˜é‡\necho $PATH\n  headï¼šç”¨äºæ˜¾ç¤ºæ–‡ä»¶çš„å¼€å¤´éƒ¨åˆ†\nhead -n 5 æ–‡ä»¶åï¼šæŸ¥çœ‹æ–‡ä»¶çš„å‰5è¡Œï¼Œé»˜è®¤10è¡Œ\n  tailï¼šæŸ¥çœ‹æ–‡ä»¶å°¾éƒ¨è¾“å‡ºå†…å®¹\ntail æ–‡ä»¶ æŸ¥çœ‹æ–‡ä»¶æœ€å10è¡Œ\ntail -n 100 æŸ¥çœ‹æ–‡ä»¶æœ€å100è¡Œ\ntail -f å®æ—¶è¾“å‡ºæ–‡ä»¶\n  lnï¼šè½¯è¿æ¥ï¼Œç±»ä¼¼windowsçš„å¿«æ·æ–¹å¼\nln -s [åŸæ–‡ä»¶æˆ–è€…ç›®å½•] [è½¯è¿æ¥å]ï¼ˆç”¨pwdæŸ¥çœ‹çš„æ—¶å€™ï¼Œä¾ç„¶æ˜¯è½¯è¿æ¥çš„æ‰€åœ¨çš„ç›®å½•ï¼‰\n  historyï¼šæŸ¥çœ‹å†å²ä½¿ç”¨è¿‡çš„æŒ‡ä»¤\nhistory nï¼šæŸ¥çœ‹æœ€åçš„næ¡\n!188ï¼šæ‰§è¡Œå†å²çš„188å·æŒ‡ä»¤\n  æ—¶é—´æ—¥æœŸç±»æŒ‡ä»¤   dateï¼šæ˜¾ç¤ºå½“å‰æ—¥æœŸæ—¶é—´\ndateï¼šæ˜¾ç¤ºå½“å‰æ—¶é—´\ndate +%Yï¼šæ˜¾ç¤ºå½“å‰å¹´ä»½\ndate +%mï¼šæ˜¾ç¤ºæœˆä»½\ndate +%Mï¼šæ˜¾ç¤ºåˆ†\ndate +â€˜%Y/%Mâ€™ï¼šæ˜¾ç¤º2020/*\ndate -s å­—ç¬¦ä¸²æ—¶é—´ï¼šè®¾ç½®ç³»ç»Ÿå®é™…\n  calï¼šä»¥æ—¥å†çš„æ–¹å¼æ˜¾ç¤ºæ—¶é—´\n  æœç´¢æŸ¥æ‰¾ç±»æŒ‡ä»¤   findï¼šä»æŒ‡å®šç›®å½•å‘ä¸‹é€’å½’éå†å„ä¸ªå­ç›®å½•ï¼Œå°†æ»¡è¶³æ¡ä»¶çš„æ–‡ä»¶æˆ–è€…ç›®å½•æ˜¾ç¤ºåœ¨ç»ˆç«¯\nfind [æœç´¢èŒƒå›´] [é€‰é¡¹]\nfind /root -name test.txtï¼šåœ¨rootä¸‹æŸ¥æ‰¾test.txtæ–‡ä»¶ï¼Œå¯ä»¥ä½¿ç”¨*åšæ¨¡ç³ŠæŸ¥è¯¢\nfind /root -user rootï¼šåœ¨rootä¸‹æŸ¥æ‰¾æ˜¯rootç”¨æˆ·åˆ›å»ºçš„æ–‡ä»¶\nfind /root -size +20Mï¼šåœ¨rootä¸‹æŸ¥æ‰¾å¤§äº20Mçš„æ–‡ä»¶ ï¼Œ +å¤§äºï¼Œ-å°äºï¼Œä¸å†™æ˜¯ç­‰äº\n  locateï¼šå¯ä»¥å¿«é€Ÿå®šä½æ–‡ä»¶è·¯å¾„ï¼Œlocateæ— éœ€éå†æ•´ä¸ªæ–‡ä»¶ç³»ç»Ÿï¼Œä½†å¿…é¡»å®šæœŸæ›´æ–°locateæ•°æ®åº“\nä½¿ç”¨updatedb\n  grep å’Œ | ç®¡é“æŒ‡ä»¤\ngrepè¿‡æ»¤æŸ¥æ‰¾ï¼Œç®¡é“ç¬¦ | è¡¨ç¤ºå°†å‰é¢ä¸€ä¸ªå‘½ä»¤çš„å¤„ç†ç»“æœäº¤ç»™åé¢çš„å‘½ä»¤å¤„ç†\ngrepåŸºæœ¬ç”¨æ³•ï¼šgrep[é€‰é¡¹] æŸ¥æ‰¾å†…å®¹ åŸæ–‡ä»¶\ngrepå¸¸ç”¨é€‰é¡¹ï¼š-n æ˜¾ç¤ºåŒ¹é…è¡Œä»¥åŠè¡Œå· -i å¿½ç•¥å¤§å°å†™\nä¾‹å¦‚ï¼š cat /root/testLog.log | grep -ni 300465\n  å‹ç¼©å’Œè§£å‹ç¼©   gzipå’Œgunzip\ngizp æ–‡ä»¶ï¼ˆåªèƒ½å°†æ–‡ä»¶å‹ç¼©ä¸º*.gzæ–‡ä»¶ï¼Œä¸”ä¸ä¿ç•™åŸæ–‡ä»¶ï¼‰\ngunzip æ–‡ä»¶.gzï¼ˆè§£å‹æ–‡ä»¶ï¼Œä¹Ÿä¸ä¿ç•™å‹ç¼©æ–‡ä»¶ï¼‰\n  zipå’Œunzip\nzip [é€‰é¡¹] xxx.zip è¦å‹ç¼©çš„å†…å®¹ï¼ˆå‹ç¼©æ–‡ä»¶ï¼Œä¿ç•™åŸæ–‡ä»¶ï¼‰\n -r é€’å½’å‹ç¼©ï¼Œå‹ç¼©æ•´ä¸ªç›®å½•  unzip [é€‰é¡¹] xxx.zip ï¼ˆè§£å‹æ–‡ä»¶ï¼Œä¿ç•™å‹ç¼©æ–‡ä»¶ï¼‰\n -d ç›®å½•åœ°å€ ï¼Œå…·ä½“è§£å‹åˆ°å“ª    tar\ntaræ˜¯æŒ‡æ‰“åŒ…æŒ‡ä»¤ï¼Œæœ€åæ‰“åŒ…çš„æŒ‡ä»¤æ˜¯.tar.gzæ–‡ä»¶\ntar [é€‰é¡¹] xxx.tar.gz å‹ç¼©å†…å®¹\n -c äº§ç”Ÿ.taræ‰“åŒ…æ–‡ä»¶ -v æ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯ -f æŒ‡å®šå‹ç¼©åçš„æ–‡ä»¶å -z æ‰“åŒ…åŒæ—¶å‹ç¼© -x è§£å‹.taræ–‡ä»¶ -C è§£å‹åˆ°æŒ‡å®šç›®å½•ä¸‹    -P taré»˜è®¤æ˜¯ç›¸å¯¹è·¯å¾„ï¼Œå¯ä»¥ä½¿ç”¨Pè®¾ç½®ä¸ºç»å¯¹è·¯å¾„\n  å‹ç¼©ä¾‹å¦‚ï¼štar -zcvf a.tar.gz test.txt test1.txt ï¼›tar -zcvf a.tar.gz /home/\nè§£å‹ä¾‹å¦‚ï¼štar -zxvf a.tar.gz -C /\n è§£å‹raråŒ… è§£å‹taråŒ…  ç»„ç®¡ç†å’Œæƒé™ç®¡ç† åœ¨Linuxä¸­çš„æ¯ä¸€ä¸ªç”¨æˆ·éƒ½å¿…é¡»å±äºä¸€ä¸ªç»„ï¼Œä¸èƒ½ç‹¬ç«‹äºç»„å¤–ï¼Œåœ¨linuxä¸­æ¯ä¸ªæ–‡ä»¶éƒ½æœ‰æ‰€æœ‰è€…ã€æ‰€åœ¨ç»„ã€å…¶ä»–ç»„çš„æ¦‚å¿µ\n  æ–‡ä»¶/ç›®å½•çš„æ‰€æœ‰è€…ï¼ˆè°åˆ›å»ºäº†æ–‡ä»¶ï¼Œå°±æˆä¸ºè¯¥æ–‡ä»¶çš„æ‰€æœ‰è€…ï¼‰\næŸ¥çœ‹æ‰€æœ‰è€… ls -ahl\n  ä¿®æ”¹æ–‡ä»¶æ‰€æœ‰è€…\nchown ç”¨æˆ·å æ–‡ä»¶å\n  ä¿®æ”¹æ–‡ä»¶æ‰€åœ¨ç»„\nchgrp ç»„å æ–‡ä»¶å\n  æƒé™åŸºæœ¬ä»‹ç» ä¸€ä¸ªæ–‡ä»¶æˆ–ç›®å½•çš„è¯¦ç»†æè¿°\nä¾‹å¦‚ï¼š\n-rw-r--r-- 1 root root 0 Feb 1 18:39 a.txt 0-10ä½è¯´æ˜ï¼š\n  0ä½è¡¨ç¤ºæ–‡ä»¶ç±»å‹\n  - ï¼šæ™®é€šæ–‡ä»¶\n  dï¼šç›®å½•\n  lï¼šé“¾æ¥æ–‡ä»¶ï¼Œè½¯è¿æ¥ï¼ˆå¿«æ·æ–¹å¼ï¼‰\n  cï¼šå­—ç¬¦è®¾å¤‡ï¼ˆé”®ç›˜ï¼Œé¼ æ ‡ï¼‰\n  bï¼šå—æ–‡ä»¶ï¼ˆç¡¬ç›˜ï¼‰\n    1-3ä½è¡¨ç¤ºæ–‡ä»¶æ‰€æœ‰è€…æ‹¥æœ‰çš„æƒé™\n  -6ä½è¡¨ç¤ºæ–‡ä»¶æ‰€åœ¨ç»„æ‹¥æœ‰çš„æƒé™\n  7-9ä½è¡¨ç¤ºæ–‡ä»¶å…¶ä»–ç»„ç”¨æˆ·æ‹¥æœ‰çš„æƒé™\n  10ä½è¡¨ç¤º å¦‚æœæ˜¯æ–‡ä»¶ï¼Œåˆ™è¡¨ç¤ºæ–‡ä»¶çš„ç¡¬è¿æ¥æ•°ï¼Œå¦‚æœæ˜¯ç›®å½•è¡¨ç¤ºå­ç›®å½•ä¸ªæ•°\n  rwxæƒé™è¯¦è§£\n  rwxä½œç”¨åœ¨æ–‡ä»¶ä¸Š\n rï¼šè¡¨ç¤ºå¯è¯»ï¼Œå¯ä»¥æŸ¥çœ‹ wï¼šè¡¨ç¤ºä¿®æ”¹ï¼Œå¯ä»¥ä¿®æ”¹ï¼Œä½†ä¸ä»£è¡¨å¯ä»¥åˆ é™¤è¯¥æ–‡ä»¶ï¼Œåˆ é™¤çš„å‰ææ¡ä»¶æ˜¯æ‹¥æœ‰æ–‡ä»¶æ‰€åœ¨ç›®å½•å†™çš„æƒé™ï¼Œæ‰å¯ä»¥åˆ é™¤ xï¼šè¡¨ç¤ºå¯ä»¥æ‰§è¡Œï¼Œè¡¨ç¤ºå¯æ‰§è¡Œ    rwxä½œç”¨åœ¨ç›®å½•ä¸Š\n rï¼šè¡¨ç¤ºå¯è¯»å–ï¼ŒlsæŸ¥çœ‹ç›®å½•å†…å®¹ wï¼šè¡¨ç¤ºå¯å†™ï¼Œå¯ä»¥ä¿®æ”¹ï¼Œç›®å½•å†…åˆ›å»º+åˆ é™¤+é‡å‘½åç›®å½• xï¼šè¡¨ç¤ºå¯æ‰§è¡Œï¼Œå¯ä»¥è¿›å…¥è¯¥ç›®å½•    rwxç”¨æ•°å­—è¡¨ç¤º\n rï¼š4 wï¼š2 xï¼š1  å› æ­¤rwx=7\n   æƒé™ä¿®æ”¹chmod å¯ä»¥é€šè¿‡chmodä¿®æ”¹æ–‡ä»¶æˆ–ç›®å½•çš„æƒé™\n  é€šè¿‡+ ã€- ã€= æ¥ä¿®æ”¹æƒé™\n  uï¼šè¡¨ç¤ºæ‰€æœ‰è€…\n  gï¼šè¡¨ç¤ºæ‰€åœ¨ç»„\n  oï¼šè¡¨ç¤ºå…¶ä»–äºº\n  aï¼šè¡¨ç¤ºæ‰€æœ‰äººï¼ˆoï¼Œgï¼Œuçš„å’Œï¼‰\nä¾‹å¦‚ï¼šchmod u=rwx,g=rx,o=x æ–‡ä»¶ç›®å½•åï¼Œchmod u-x æ–‡ä»¶ç›®å½•åï¼ˆè®©æ‰€æœ‰è€…å¤±å»xæ‰§è¡Œæƒé™ï¼‰,chmod u+xï¼ˆè®©æ‰€æœ‰è€…åŠ ä¸Šxæ‰§è¡Œæƒé™ï¼‰\n    é€šè¿‡æ•°å­—å˜æ›´æƒé™\n  rï¼š4\n  wï¼š2\n  xï¼š1\nä¾‹å¦‚ï¼šchmod u=rwx,g=rx,o=x æ–‡ä»¶å ç›¸å½“äº chmod 751 æ–‡ä»¶å\n    ä¿®æ”¹æ–‡ä»¶æ‰€æœ‰è€…-chown\n chown æ–°ç”¨æˆ· æ–‡ä»¶åï¼ˆä¿®æ”¹æ–‡ä»¶çš„æ‰€æœ‰è€…ï¼‰ chown æ–°ç”¨æˆ·:æ–°ç»„ æ–‡ä»¶åï¼ˆä¿®æ”¹æ–‡ä»¶çš„æ‰€æœ‰ç»„å’Œæ‰€æœ‰è€…ï¼‰ -R å¦‚æœæ˜¯ç›®å½•ï¼Œåˆ™ä½¿å…¶ä¸‹æ‰€æœ‰çš„å­æ–‡ä»¶æˆ–è€…ç›®å½•é€’å½’ç”Ÿæ•ˆ    crondä»»åŠ¡è°ƒåº¦ å‘½ä»¤ï¼šcrontab[é€‰é¡¹]\n  -eï¼šç¼–è¾‘crontab å®šæ—¶ä»»åŠ¡\n  -lï¼šæŸ¥è¯¢crontab ä»»åŠ¡\n  -rï¼šåˆ é™¤å½“å‰ç”¨æˆ·çš„æ‰€æœ‰crontab ä»»åŠ¡\n  service crond restart ï¼š(é‡å¯ä»»åŠ¡è°ƒåº¦)\nå¯ä»¥å†™ä¸€ä¸ªsheelè„šæœ¬ï¼Œç„¶åå»æ‰§è¡Œ\n  åˆ†åŒºä¸æŒ‚è½½ åˆ†åŒºçš„æ–¹å¼  mbråˆ†åŒº  æœ€å¤šæ”¯æŒ4ä¸ªä¸»åˆ†åŒº ç³»ç»Ÿåªèƒ½å®‰è£…åœ¨ä¸»åˆ†åŒº æ‰©å±•åˆ†åŒºå ç”¨ä¸€ä¸ªä¸»åˆ†åŒº mbræœ€å¤§åªæ”¯æŒ2TBï¼Œä½†æœ‰æœ€å¥½çš„å…¼å®¹æ€§   gtpåˆ†åŒº  æ”¯æŒæ— é™å¤šä¸ªä¸»åˆ†åŒºï¼ˆä½†æ“ä½œç³»ç»Ÿä¸‹å¯èƒ½ä¼šé™åˆ¶ï¼Œä¾‹å¦‚windowsä¸‹æœ€å¤šæ”¯æŒ128ä¸ªåˆ†åŒºï¼‰ æœ€å¤§æ”¯æŒ18EBçš„å®¹é‡ï¼ˆEB=1024PBï¼ŒPB=1024TBï¼‰ windows7 64ä½ä»¥åæ”¯æŒgtp   lsblk å¯ä»¥æŸ¥çœ‹å½“å‰åˆ†åŒºæƒ…å†µ  æŒ‚è½½   å¢åŠ ä¸€å—æ–°ç¡¬ç›˜\n  åˆ†åŒº fdisk /dev/ç¡¬ç›˜å\n  æ ¼å¼åŒ– mkfs -t æ–‡ä»¶ç±»å‹ åˆ†åŒºè·¯å¾„ã€‚ä¾‹å¦‚ï¼šmkfs -t ext4 /dev/sdb1\n  æŒ‚è½½ mount åˆ†åŒºè·¯å¾„ ç›®æ ‡ç›®å½•ï¼ˆåªæ˜¯ä¸´æ—¶æŒ‚è½½ï¼‰\n  è®¾ç½®è‡ªåŠ¨æŒ‚è½½ï¼šä¿®æ”¹ /etc/fstabæ–‡ä»¶ï¼Œå¢åŠ è‡ªå·±çš„åˆ†åŒºæŒ‚è½½åˆ°ç›®æ ‡ç›®å½•ä¸Šï¼Œå†ä½¿ç”¨mount -a è‡ªåŠ¨æŒ‚è½½\n  å¸è½½ umount åˆ†åŒºè·¯å¾„\n  ç£ç›˜æƒ…å†µæŸ¥è¯¢   df -hï¼Œdf -l\n  du æŸ¥çœ‹æŸä¸ªç›®å½•ä¸‹çš„ç£ç›˜ä½¿ç”¨æƒ…å†µ\nå¯å¸¦å‚æ•°\n -c åˆ—å‡ºæ˜ç»†åŒæ—¶æä¾›æ€»æ•° \u0026ndash;max-depth=n å­ç›®å½•æ·±åº¦ä¸ºn -a æŸ¥æ‰€æœ‰åŒ…å«æ–‡ä»¶ -h å¸¦å•ä½  ä¾‹å¦‚ï¼šdu -cha \u0026ndash;max-depth=1 /root\n  å¸¸ç”¨å‘½ä»¤  ç»Ÿè®¡ç›®å½•ä¸‹æ–‡ä»¶çš„ä¸ªæ•° ls -al |grep \u0026lsquo;^-\u0026rsquo; | wc -l ç»Ÿè®¡ç›®å½•ä¸‹ç›®å½•çš„ä¸ªæ•° ls -al |grep \u0026lsquo;^d\u0026rsquo; | wc -l ç»Ÿè®¡ç›®å½•ä¸‹åŒ…å«å­ç›®å½•æ–‡ä»¶çš„ä¸ªæ•° ls -alR |grep \u0026lsquo;^-\u0026rsquo; | wc -l æŸ¥çœ‹ç›®å½•æ ‘ tree  ç½‘ç»œé…ç½®   ä¿®æ”¹linux ipåœ°å€ä¸ºæŒ‡å®šåœ°å€\nä¿®æ”¹/etc/sysconfig/network-scripts/ifcfg-eth0\n   è¿›ç¨‹ç®¡ç†   åŸºæœ¬ä»‹ç»\npså‘½ä»¤æ˜¯ç”¨æ¥æŸ¥çœ‹ç›®å‰ç³»ç»Ÿä¸­æœ‰å“ªäº›æ­£åœ¨æ‰§è¡Œï¼Œä»¥åŠä»–ä»¬çš„æ‰§è¡ŒçŠ¶å†µ\nå¯ä»¥é…åˆgrepä½¿ç”¨\nå¸¸ç”¨é€‰é¡¹\n -a æŸ¥çœ‹å½“å‰ç»ˆç«¯æ‰€æœ‰çš„è¿›ç¨‹ä¿¡æ¯ -u ä»¥ç”¨æˆ·çš„æ ¼å¼æ˜¾ç¤ºè¿›ç¨‹ä¿¡æ¯ -x æ˜¾ç¤ºåå°è¿›ç¨‹è¿è¡Œçš„å‚æ•° -ef å±•ç¤ºçˆ¶è¿›ç¨‹  æ˜¾ç¤ºå­—æ®µ\n  USER ç”¨æˆ·åç§°\n  PID è¿›ç¨‹è¯†åˆ«å·\n  %CPU è¿›ç¨‹å ç”¨CPUç™¾åˆ†æ¯”\n  %MEMè¿›ç¨‹å ç”¨å†…å­˜ç™¾åˆ†æ¯”\n  VSZ è¿›ç¨‹å ç”¨è™šæ‹Ÿå†…å­˜å¤§å° ï¼ˆkbï¼‰\n  RSS è¿›ç¨‹å ç”¨ç‰©ç†å†…å­˜å¤§å° ï¼ˆkbï¼‰\n  TTY ç»ˆç«¯æœºå·\n  STAT è¿›è¡ŒçŠ¶æ€ï¼Œsè¡¨ç¤ºè¿›ç¨‹æ˜¯ç»˜ç”»çš„å…ˆå¯¼è¿›ç¨‹ï¼ŒNè¡¨ç¤ºè¿›ç¨‹æ‹¥æœ‰æ¯”æ™®é€šè¿›ç¨‹ä¼˜å…ˆçº§æ›´ä½çš„ä¼˜å…ˆçº§ï¼ŒRè¡¨ç¤ºæ­£åœ¨è¿è¡Œï¼ŒDè¡¨ç¤ºçŸ­æœŸç­‰å¾…ï¼ŒZè¡¨ç¤ºåƒµå°¸è¿›ç¨‹ï¼ŒTè¡¨ç¤ºè¢«è¿½è¸ªæˆ–è€…è¢«åœæ­¢\n  TIME æ­¤è¿›ç¨‹æ‰€æ¶ˆè€—CPUæ—¶é—´\n  CMD æ­£åœ¨æ‰§è¡Œçš„å‘½ä»¤æˆ–è¿›ç¨‹å\n    ç»ˆæ­¢è¿›ç¨‹killå’ŒkillAll\n  kill [é€‰é¡¹] è¿›ç¨‹å·\nå¸¸ç”¨é€‰é¡¹\n -9 è¡¨ç¤ºå¼ºè¿«è¿›ç¨‹ç»ˆæ­¢         kill è¿›ç¨‹å(é€šè¿‡åç§°ç»ˆæ­¢è¿›ç¨‹ï¼Œå¯ä»¥ä½¿ç”¨é€šé…ç¬¦)\n  æŸ¥çœ‹è¿›ç¨‹æ ‘ pstree\n-pæ˜¾ç¤ºè¿›ç¨‹IDï¼Œ-uæ˜¾ç¤ºè¿›ç¨‹æ‰€åœ¨ç”¨æˆ·\n   æœåŠ¡ç®¡ç† æœåŠ¡ï¼ˆServiceï¼‰æœ¬è´¨ä¸Šå°±æ˜¯ä¸€ä¸ªè¿›ç¨‹ï¼Œé€šå¸¸è¿è¡Œåœ¨åå°ï¼Œä¼šç›‘å¬ä¸€ä¸ªç«¯å£ï¼Œç­‰å¾…å…¶ä»–ç¨‹åºçš„è¯·æ±‚ï¼Œä¾‹å¦‚mysqld,sshd,é˜²ç«å¢™ç­‰ï¼Œå› æ­¤æˆ‘ä»¬åˆç§°ä¸ºå®ˆæŠ¤è¿›ç¨‹\nserviceç®¡ç†å‘½ä»¤ service æœåŠ¡å start|stop|restart|reload|status\nåœ¨Centos7.0ä»¥åä½¿ç”¨systemctl\n  ls -l /etc/init.d/ æŸ¥çœ‹ç³»ç»Ÿæœ‰å“ªäº›æœåŠ¡\n  chkconfigå¯ä»¥ç»™æ¯ä¸ªæœåŠ¡è®¾ç½®å„ä¸ªè¿è¡Œçº§åˆ«è‡ªå¯åŠ¨/å…³é—­\n å¼€å¯æˆ–å…³é—­ï¼šchkconfig \u0026ndash;level 5 æœåŠ¡å on/off    è¿›ç¨‹ç›‘æ§ topå‘½ä»¤ä¸psä¸åŒä¹‹å¤„åœ¨äºï¼Œtopä¼šä¸åœçš„æ›´æ–°æ•°æ®\nå¸¸ç”¨é€‰é¡¹\n -d ç§’æ•° ï¼šå‡ ç§’åæ›´æ–° é»˜è®¤3ç§’ -i ï¼šä¸æ˜¾ç¤ºé—²ç½®æˆ–åƒµå°¸è¿›ç¨‹ -p è¿›ç¨‹å·ï¼šæ˜¾ç¤ºè¿›ç¨‹å· -u ç”¨æˆ·åï¼šç›‘æ§æŒ‡å®šçš„ç”¨æˆ·  äº¤äº’æ“ä½œ\n  Pï¼šæŒ‰cpuä½¿ç”¨ç‡æ’åº\n  Mï¼šæŒ‰å†…å­˜ä½¿ç”¨æ’åº\n  Nï¼šæŒ‰PIDæ’åº\n  qï¼šé€€å‡ºtop\n  ç½‘ç»œç›‘æ§ netstatç”¨æ¥ç›‘æ§ç½‘ç»œ\nå¸¸ç”¨é€‰é¡¹\n -an ï¼šæŒ‰ç…§ä¸€å®šé¡ºåºæ’åˆ— -pï¼šæ˜¾ç¤ºé‚£ä¸ªè¿›ç¨‹åœ¨ä½¿ç”¨  Lsofç®¡ç† lsofæ˜¯ç³»ç»Ÿç®¡ç†çš„å·¥å…·ï¼Œlsofå¯ä»¥ä»£æ›¿pså’Œnetstatçš„å‡ ä¹å…¨éƒ¨å·¥ä½œ\nå…³é”®é€‰é¡¹   é»˜è®¤ : æ²¡æœ‰é€‰é¡¹ï¼Œlsofåˆ—å‡ºæ´»è·ƒè¿›ç¨‹çš„æ‰€æœ‰æ‰“å¼€æ–‡ä»¶\n  ç»„åˆ : å¯ä»¥å°†é€‰é¡¹ç»„åˆåˆ°ä¸€èµ·ï¼Œå¦‚-abcï¼Œä½†è¦å½“å¿ƒå“ªäº›é€‰é¡¹éœ€è¦å‚æ•°\n  -a : ç»“æœè¿›è¡Œâ€œä¸â€è¿ç®—ï¼ˆè€Œä¸æ˜¯â€œæˆ–â€ï¼‰\n  -l : åœ¨è¾“å‡ºæ˜¾ç¤ºç”¨æˆ·IDè€Œä¸æ˜¯ç”¨æˆ·å\n  -h : è·å¾—å¸®åŠ©\n  -t : ä»…è·å–è¿›ç¨‹ID\n  -U : è·å–UNIXå¥—æ¥å£åœ°å€\n  -F : æ ¼å¼åŒ–è¾“å‡ºç»“æœï¼Œç”¨äºå…¶å®ƒå‘½ä»¤ã€‚å¯ä»¥é€šè¿‡å¤šç§æ–¹å¼æ ¼å¼åŒ–ï¼Œå¦‚-F pcfnï¼ˆç”¨äºè¿›ç¨‹idã€å‘½ä»¤åã€æ–‡ä»¶æè¿°ç¬¦ã€æ–‡ä»¶åï¼Œå¹¶ä»¥ç©ºç»ˆæ­¢ï¼‰\n  -iï¼šæ˜¾ç¤ºæ‰€æœ‰è¿æ¥ï¼ˆè¯­æ³•ï¼šlsof -i[46] [protocol][@hostname|hostaddr][:service|port]ï¼‰\nä¾‹å¦‚ï¼š\n lsof -i 6ï¼šè·å–IPV6æµé‡ lsof -i :3306ï¼šæŸ¥çœ‹3306ç«¯å£ä½¿ç”¨çŠ¶æ€    å‚è€ƒè¿æ¥ https://www.jianshu.com/p/a3aa6b01b2e1\nRPMåŒ…ç®¡ç† rpm -ql |grep æŸ¥è¯¢å†…å®¹\nå¸¸ç”¨é€‰é¡¹\n -i ï¼šå®‰è£… -vï¼šæç¤º -hï¼šè¿›åº¦æ¡ -eï¼šå¸è½½RPMåŒ…ï¼ˆåŠ ä¸Š\u0026ndash;nodepså¼ºåˆ¶åˆ é™¤ï¼‰ -qï¼šæŸ¥è¯¢åŒ…  rpm -ivh RPMåŒ…å…¨è·¯å¾„åç§°\nrpm -ivh â€“relocate = è·¯å¾„\nYum Yumå¯ä»¥è‡ªåŠ¨å¤„ç†RPMä¾èµ–å…³ç³»\nåŸºæœ¬æŒ‡ä»¤\n listï¼šæŸ¥çœ‹ installï¼šå®‰è£…  Shellè„šæœ¬ èµ·æ­¥  æ–°å»ºä¸€ä¸ªshellè„šæœ¬ï¼Œä¸€èˆ¬ä»¥.shç»“å°¾ å†™å…¥å†…å®¹ï¼Œä¿å­˜ æˆäºˆxæƒé™ æ‰§è¡Œ  shellå˜é‡ ä»‹ç» shellå˜é‡åˆ†ä¸ºç³»ç»Ÿå˜é‡å’Œç”¨æˆ·è‡ªå®šä¹‰å˜é‡\n ç³»ç»Ÿå˜é‡ï¼š$HOME,$PWD,$SHELL,$USER,\u0026quot;$PATH\u0026quot;ç­‰ç­‰ï¼Œæ¯”å¦‚echo $HOME æ˜¾ç¤ºå½“å‰shellä¸­æ‰€æœ‰çš„å˜é‡ï¼šset  å®šä¹‰å˜é‡ åŸºæœ¬è¯­æ³•  å®šä¹‰å˜é‡ï¼šå˜é‡=å€¼ æ’¤é”€å˜é‡ï¼šunset å˜é‡ å£°æ˜é™æ€å˜é‡ï¼šreadonly å˜é‡ï¼Œæ³¨æ„ï¼šä¸èƒ½unset  å®šä¹‰è§„åˆ™  å˜é‡åç§°å¯ä»¥ç”±å­—æ¯ï¼Œæ•°å­—å’Œä¸‹åˆ’çº¿ç»„æˆï¼Œä½†æ˜¯ä¸èƒ½ä»¥æ•°å­—å¼€å¤´ ç­‰å·ä¸¤ä¾§ä¸èƒ½æœ‰ç©ºæ ¼ å˜é‡åç§°ä¹ æƒ¯æ€§æ˜¯å¤§å†™  å°†å‘½ä»¤çš„è¿”å›å€¼èµ‹å€¼ç»™å˜é‡  A=$(ls -la) A=`ls -la` ä½¿ç”¨åå¼•å·ï¼ˆæ•°å­—é”®å·¦è¾¹çš„é”®ï¼‰  è®¾ç½®ç¯å¢ƒå˜é‡  export å˜é‡å=å˜é‡å€¼ï¼ˆåŠŸèƒ½æè¿°ï¼šå°†shellå˜é‡è¾“å‡ºä¸ºç¯å¢ƒå˜é‡ï¼‰ source é…ç½®æ–‡ä»¶ ï¼ˆè®©ä¿®æ”¹åçš„é…ç½®æ–‡ä»¶ç«‹å³ç”Ÿæ•ˆï¼‰ echo $å˜é‡å ï¼ˆæŸ¥è¯¢ç¯å¢ƒå˜é‡çš„å€¼ï¼‰  è®¾ç½®ä½ç½®å‚æ•°å˜é‡ ä¾‹å¦‚ ./myshell.sh 100 200 æˆ‘ä»¬å¯ä»¥åœ¨myshellè„šæœ¬ä¸­è·å–åˆ°100,200çš„å‚æ•°ä¿¡æ¯\nåŸºæœ¬è¯­æ³•ï¼š\n $nï¼šnä¸ºæ•°å­—ï¼Œ$0è¡¨ç¤ºå‘½ä»¤æœ¬èº«ï¼Œ$(1-9)ä»£è¡¨ç¬¬ä¸€åˆ°ç¬¬ä¹ä¸ªå‚æ•°ï¼Œåä»¥ä¸Šçš„å‚æ•°éœ€è¦ç”¨å¤§æ‹¬å· ${10} $*ï¼šè¿™ä¸ªå˜é‡å‘½ä»¤è¡¨ç¤ºæ‰€æœ‰å‚æ•°ï¼Œå°†æ‰€æœ‰å‚æ•°çœ‹æˆä¸€ä¸ªæ•´ä½“ $@ï¼šä¹Ÿæ˜¯è¡¨ç¤ºæ‰€æœ‰å‚æ•°ï¼Œä½†æŠŠå‚æ•°åŒºåˆ†å¼€æ¥ $#ï¼šè¡¨ç¤ºæ‰€æœ‰å‚æ•°çš„ä¸ªæ•°  é¢„å®šä¹‰å˜é‡  $$ï¼šå½“å‰è¿›ç¨‹çš„PID $!ï¼šåå°è¿è¡Œçš„æœ€åä¸€ä¸ªè¿›ç¨‹çš„è¿›ç¨‹å· $?ï¼šæœ€åä¸€æ¬¡æ‰§è¡Œå‘½ä»¤çš„çŠ¶æ€ï¼Œå¦‚æœæˆåŠŸä¸º0ï¼Œå¦‚æœä¸æˆåŠŸä¸ºå¼€å‘è€…æŒ‡å®šçš„ä¸€ä¸ªå€¼ ä»¥åå°æ–¹å¼è¿è¡Œï¼šåœ¨å‘½ä»¤æœ€åä½¿ç”¨ä¸€ä¸ª\u0026amp;  è¿ç®—ç¬¦ åŸºæœ¬è¯­æ³•ï¼š\n  $((è¿ç®—å¼))æˆ–$[è¿ç®—å¼]\n  expr m + nï¼ˆæ³¨æ„è¿ç®—ç¬¦é—´æœ‰ç©ºæ ¼ï¼‰\n  expr m - n\n  expr \\*ï¼Œ/ï¼Œ%ï¼šä¹˜é™¤å–ä½™\nexpréœ€è¦ç”¨åå¼•å·\n  æ¡ä»¶åˆ¤æ–­   åŸºæœ¬è¯­æ³•\n[ condition ] ï¼ˆæ³¨æ„conditionå‰åè¦æœ‰ç©ºæ ¼ï¼‰\néç©ºè¿”å›true ï¼Œå¯ä»¥ä½¿ç”¨$?éªŒè¯ï¼ˆ0trueï¼Œ\u0026gt;1falseï¼‰\n  å¸¸ç”¨åˆ¤æ–­\n ä¸¤ä¸ªæ•´æ•°æ¯”è¾ƒ  =å­—ç¬¦ä¸²æ¯”è¾ƒ -ltå°äº -leå°äºç­‰äº -eqç­‰äº -gtå¤§äº -geå¤§äºç­‰äº -neä¸ç­‰äº   æŒ‰ç…§æ–‡ä»¶è¯»å†™æƒé™åˆ¤æ–­  -ræœ‰è¯» -wæœ‰å†™ -xæœ‰æ‰§è¡Œ   æŒ‰ç…§æ–‡ä»¶ç±»å‹åˆ¤æ–­  -fæ–‡ä»¶å­˜åœ¨ä¸”æ˜¯ä¸€ä¸ªå¸¸è§„æ–‡ä»¶ -eæ–‡ä»¶å­˜åœ¨ -dæ–‡ä»¶å­˜åœ¨ä¸”æ˜¯ä¸€ä¸ªç›®å½•    ç¤ºä¾‹ï¼š\n#!/bin/bash if [ $1 -ge 60 ] then echo \u0026#34;åŠæ ¼å•¦\u0026#34; elif [ $1 -ge 40 ] then echo \u0026#34;ä½ åºŸç‰©\u0026#34; fi   caseè¯­å¥ åŸºæœ¬è¯­æ³•ç¤ºä¾‹ï¼š\n#!/bin/bash case $1 in \u0026#34;1\u0026#34;) echo \u0026#34;å‘¨ä¸€\u0026#34; ;; \u0026#34;2\u0026#34;) echo \u0026#34;å‘¨äºŒ\u0026#34;;; *) echo \u0026#34;other\u0026#34;;; esac forè¯­å¥   for å˜é‡ in å€¼1 å€¼2 å€¼3\u0026hellip;\ndo\nâ€‹\tç¨‹åº\ndone\nç¤ºä¾‹ï¼š\n#!/bin/bash # ä½¿ç”¨$* for i in \u0026#34;$*\u0026#34; do echo \u0026#34;$i\u0026#34; done #ä½¿ç”¨$@ for i in $@ do echo \u0026#34;param=$i\u0026#34; done   for((åˆå§‹å€¼ï¼›å¾ªç¯æ§åˆ¶æ¡ä»¶ï¼›å˜é‡å˜åŒ–))\ndo\nâ€‹\tç¨‹åº\ndone\nç¤ºä¾‹ï¼š\n#!/bin/bash SUM=0 for ((i=1;i\u0026lt;=100;i++)) do SUM=$[$SUM + $i ] done echo $SUM   whileå¾ªç¯ while [ condition ]\ndo\nâ€‹\tç¨‹åº\ndone\nç¤ºä¾‹ï¼š\n#!/bin/bash RESULT=0 I=0 while [ $I -le $1 ] do RESULT=$[ $RESULT + $I ] I=$[ $I + 1 ] done echo $RESULT readè¯»å–æ§åˆ¶å°è¾“å…¥ åŸºæœ¬è¯­æ³•\nread [é€‰é¡¹] å‚æ•°\n -pï¼šæŒ‡å®šè¯»å–æ—¶çš„æç¤ºç¬¦ï¼› -tï¼šæŒ‡å®šè¯»å–å€¼æ—¶çš„ç­‰å¾…æ—¶é—´  ç¤ºä¾‹ï¼š\nread -p \u0026#34;è¯·è¾“å…¥ä¸€ä¸ªæ•°å­—\u0026#34; NUM echo $NUM å‡½æ•°   ç³»ç»Ÿå‡½æ•°\n basename [pathname][suffix] (å¸¸ç”¨äºè·å–æ–‡ä»¶å) dirname ï¼ˆå¸¸ç”¨äºè¿”å›è·¯å¾„åç§°ï¼‰    è‡ªå®šä¹‰å‡½æ•°\nåŸºæœ¬è¯­æ³•\n[ function ] functionname [()]{\nâ€‹\tAction;\nâ€‹\t[return int]\n}\nç¤ºä¾‹ï¼š\n#!/bin/bash # è®¡ç®—è¾“å…¥çš„2ä¸ªæ•°å­—å’Œ read -p \u0026#34;è¯·è¾“å…¥ç¬¬ä¸€ä¸ªæ•°å­—\u0026#34; NUM1 read -p \u0026#34;è¯·è¾“å…¥ç¬¬äºŒä¸ªæ•°å­—\u0026#34; NUM2 function getSum(){ SUM=$[ $NUM1 + $NUM2 ] echo \u0026#34;å’Œæ˜¯:$SUM\u0026#34; } getSum $NUM1 $NUM2   ç»¼åˆæ¡ˆä¾‹ éœ€æ±‚ï¼š  æ¯å¤©å‡Œæ™¨2ç‚¹10åˆ†ï¼Œå¤‡ä»½æ—¥å¿—æ–‡ä»¶a.logåˆ°/data/backup/log å¤‡ä»½å¼€å§‹å’Œå¤‡ä»½ç»“æŸæœ‰æç¤º å¤‡ä»½åçš„æ–‡ä»¶ä»¥æ—¶é—´å‘½åä¸ºæ–‡ä»¶åï¼Œå¹¶æ‰“åŒ…æˆå‹ç¼©åŒ….tar.gzä¿å­˜ åœ¨å¤‡ä»½çš„æ—¶å€™æ£€æŸ¥æ˜¯å¦æœ‰10å¤©å‰å¤‡ä»½è¿‡çš„æ—¥å¿—æ–‡ä»¶ï¼Œæœ‰çš„è¯å°±å°†å®ƒåˆ é™¤  ç¤ºä¾‹ï¼š #!/bin/bash # å®šæ—¶å¤‡ä»½æ—¥å¿—æ–‡ä»¶ # å®šä¹‰å¤‡ä»½çš„è·¯å¾„ BACKUP=/data/backup/log # è·å–å½“å‰æ—¶é—´ä½œä¸ºæ–‡ä»¶å DATETIME=`date +%Y_%m_%d_%H:%M:%S` echo \u0026#34;=====å¼€å§‹å¤‡ä»½=====\u0026#34; echo \u0026#34;=====å¤‡ä»½çš„ç›®æ ‡è·¯å¾„ä¸º$BACKUP=====\u0026#34; echo \u0026#34;=====æ–‡ä»¶å$DATETIME.tar.gz=====\u0026#34; #æ£€æŸ¥ç›®æ ‡è·¯å¾„æ˜¯å¦å­˜åœ¨å¦‚æœä¸å­˜åœ¨å°±åˆ›å»º [ ! -d $BACKUP ] \u0026amp;\u0026amp; mkdir -p $BACKUP DESTINFLOG=/root/a.log # æ£€æŸ¥ç›®æ ‡æ–‡ä»¶æ˜¯å¦å­˜åœ¨ if [ ! -f $DESTINFLOG ] then echo \u0026#34;$DESTINFLOGæ–‡ä»¶ä¸å­˜åœ¨ï¼\u0026#34; exit fi # å¼€å§‹å¤‡ä»½ cp $DESTINFLOG $BACKUP/$DATETIME.log #æ‰“åŒ… (:ä¼šè¢«è¯†åˆ«ä¸ºåœ°å€ éœ€è¦--force-local) cd $BACKUP tar -zcvf $DATETIME.tar.gz $DATETIME.log --force-local #åˆ é™¤ä¸´æ—¶æ–‡ä»¶ rm -rf $DATETIME.log #æ£€æŸ¥æ˜¯å¦æœ‰10å¤©å‰çš„æ–‡ä»¶,å…¨éƒ¨åˆ é™¤ find $BACKUP -mtime +10 -name \u0026#34;*.tar.gz\u0026#34; -exec rm -rf {} \\; #ç»“æŸ echo \u0026#34;=====å¤‡ä»½ç»“æŸ=====\u0026#34; é˜²ç«å¢™ æŸ¥çœ‹é˜²ç«å¢™æƒ…å†µ firewall-cmd \u0026ndash;list -all\nå¢åŠ TCPç«¯å£ firewall-cmd \u0026ndash;add-port=80/tcp \u0026ndash;permanent\né‡æ–°åŠ è½½é˜²ç«å¢™ firewall-cmd reload\nå¸¸ç”¨å‘½ä»¤ firewall-cmd [é€‰é¡¹]\n -h, \u0026ndash;help\tæ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯ï¼› -V, \u0026ndash;version\tæ˜¾ç¤ºç‰ˆæœ¬ä¿¡æ¯. ï¼ˆè¿™ä¸ªé€‰é¡¹ä¸èƒ½ä¸å…¶ä»–é€‰é¡¹ç»„åˆï¼‰ï¼› -q, \u0026ndash;quiet\tä¸æ‰“å°çŠ¶æ€æ¶ˆæ¯ï¼› â€“state\tæ˜¾ç¤ºfirewalldçš„çŠ¶æ€ï¼› â€“reload\tä¸ä¸­æ–­æœåŠ¡çš„é‡æ–°åŠ è½½ï¼› â€“complete-reload\tä¸­æ–­æ‰€æœ‰è¿æ¥çš„é‡æ–°åŠ è½½ï¼› â€“runtime-to-permanent\tå°†å½“å‰é˜²ç«å¢™çš„è§„åˆ™æ°¸ä¹…ä¿å­˜ï¼› â€“check-config\tæ£€æŸ¥é…ç½®æ­£ç¡®æ€§ï¼› â€“get-log-denied\tè·å–è®°å½•è¢«æ‹’ç»çš„æ—¥å¿—ï¼› â€“set-log-denied=\tè®¾ç½®è®°å½•è¢«æ‹’ç»çš„æ—¥å¿—ï¼Œåªèƒ½ä¸º â€˜allâ€™,â€˜unicastâ€™,â€˜broadcastâ€™,â€˜multicastâ€™,â€˜offâ€™ å…¶ä¸­çš„ä¸€ä¸ªï¼›\n é…ç½®firewalld firewall-cmd --version # æŸ¥çœ‹ç‰ˆæœ¬ firewall-cmd --help # æŸ¥çœ‹å¸®åŠ© # æŸ¥çœ‹è®¾ç½®ï¼š firewall-cmd --state # æ˜¾ç¤ºçŠ¶æ€ firewall-cmd --get-active-zones # æŸ¥çœ‹åŒºåŸŸä¿¡æ¯ firewall-cmd --get-zone-of-interface=eth0 # æŸ¥çœ‹æŒ‡å®šæ¥å£æ‰€å±åŒºåŸŸ firewall-cmd --panic-on # æ‹’ç»æ‰€æœ‰åŒ… firewall-cmd --panic-off # å–æ¶ˆæ‹’ç»çŠ¶æ€ firewall-cmd --query-panic # æŸ¥çœ‹æ˜¯å¦æ‹’ç» firewall-cmd --reload # æ›´æ–°é˜²ç«å¢™è§„åˆ™ firewall-cmd --complete-reload # ä¸¤è€…çš„åŒºåˆ«å°±æ˜¯ç¬¬ä¸€ä¸ªæ— éœ€æ–­å¼€è¿æ¥ï¼Œå°±æ˜¯firewalldç‰¹æ€§ä¹‹ä¸€åŠ¨æ€æ·»åŠ è§„åˆ™ï¼Œç¬¬äºŒä¸ªéœ€è¦æ–­å¼€è¿æ¥ï¼Œç±»ä¼¼é‡å¯æœåŠ¡ # å°†æ¥å£æ·»åŠ åˆ°åŒºåŸŸï¼Œé»˜è®¤æ¥å£éƒ½åœ¨public firewall-cmd --zone=public --add-interface=eth0 # æ°¸ä¹…ç”Ÿæ•ˆå†åŠ ä¸Š --permanent ç„¶åreloadé˜²ç«å¢™ # è®¾ç½®é»˜è®¤æ¥å£åŒºåŸŸï¼Œç«‹å³ç”Ÿæ•ˆæ— éœ€é‡å¯ firewall-cmd --set-default-zone=public # æŸ¥çœ‹æ‰€æœ‰æ‰“å¼€çš„ç«¯å£ï¼š firewall-cmd --zone=dmz --list-ports # åŠ å…¥ä¸€ä¸ªç«¯å£åˆ°åŒºåŸŸï¼š firewall-cmd --zone=dmz --add-port=8080/tcp # è‹¥è¦æ°¸ä¹…ç”Ÿæ•ˆæ–¹æ³•åŒä¸Š # æ‰“å¼€ä¸€ä¸ªæœåŠ¡ï¼Œç±»ä¼¼äºå°†ç«¯å£å¯è§†åŒ–ï¼ŒæœåŠ¡éœ€è¦åœ¨é…ç½®æ–‡ä»¶ä¸­æ·»åŠ ï¼Œ/etc/firewalld ç›®å½•ä¸‹æœ‰servicesæ–‡ä»¶å¤¹ï¼Œè¿™ä¸ªä¸è¯¦ç»†è¯´äº†ï¼Œè¯¦æƒ…å‚è€ƒæ–‡æ¡£ firewall-cmd --zone=work --add-service=smtp # ç§»é™¤æœåŠ¡ firewall-cmd --zone=work --remove-service=smtp # æ˜¾ç¤ºæ”¯æŒçš„åŒºåŸŸåˆ—è¡¨ firewall-cmd --get-zones # è®¾ç½®ä¸ºå®¶åº­åŒºåŸŸ firewall-cmd --set-default-zone=home # æŸ¥çœ‹å½“å‰åŒºåŸŸ firewall-cmd --get-active-zones # è®¾ç½®å½“å‰åŒºåŸŸçš„æ¥å£ firewall-cmd --get-zone-of-interface=enp03s # æ˜¾ç¤ºæ‰€æœ‰å…¬å…±åŒºåŸŸï¼ˆpublicï¼‰ firewall-cmd --zone=public --list-all # ä¸´æ—¶ä¿®æ”¹ç½‘ç»œæ¥å£ï¼ˆenp0s3ï¼‰ä¸ºå†…éƒ¨åŒºåŸŸï¼ˆinternalï¼‰ firewall-cmd --zone=internal --change-interface=enp03s # æ°¸ä¹…ä¿®æ”¹ç½‘ç»œæ¥å£enp03sä¸ºå†…éƒ¨åŒºåŸŸï¼ˆinternalï¼‰ firewall-cmd --permanent --zone=internal --change-interface=enp03s æœåŠ¡ç®¡ç† # æ˜¾ç¤ºæœåŠ¡åˆ—è¡¨ Amanda, ftp, Sambaå’Œtftpç­‰æœ€é‡è¦çš„æœåŠ¡å·²ç»è¢«FirewallDæä¾›ç›¸åº”çš„æœåŠ¡ï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤æŸ¥çœ‹ï¼š firewall-cmd --get-services # å…è®¸sshæœåŠ¡é€šè¿‡ firewall-cmd --enable service=ssh # ç¦æ­¢SSHæœåŠ¡é€šè¿‡ firewall-cmd --disable service=ssh # æ‰“å¼€TCPçš„8080ç«¯å£ firewall-cmd --enable ports=8080/tcp # ä¸´æ—¶å…è®¸SambaæœåŠ¡é€šè¿‡600ç§’ firewall-cmd --enable service=samba --timeout=600 # æ˜¾ç¤ºå½“å‰æœåŠ¡ firewall-cmd --list-services # æ·»åŠ HTTPæœåŠ¡åˆ°å†…éƒ¨åŒºåŸŸï¼ˆinternalï¼‰ firewall-cmd --permanent --zone=internal --add-service=http firewall-cmd --reload # åœ¨ä¸æ”¹å˜çŠ¶æ€çš„æ¡ä»¶ä¸‹é‡æ–°åŠ è½½é˜²ç«å¢™ ç«¯å£ç®¡ç† # æ‰“å¼€443/TCPç«¯å£ firewall-cmd --add-port=443/tcp # æ°¸ä¹…æ‰“å¼€3690/TCPç«¯å£ firewall-cmd --permanent --add-port=3690/tcp # æ°¸ä¹…æ‰“å¼€ç«¯å£å¥½åƒéœ€è¦reloadä¸€ä¸‹ï¼Œä¸´æ—¶æ‰“å¼€å¥½åƒä¸ç”¨ï¼Œå¦‚æœç”¨äº†reloadä¸´æ—¶æ‰“å¼€çš„ç«¯å£å°±å¤±æ•ˆäº† # å…¶å®ƒæœåŠ¡ä¹Ÿå¯èƒ½æ˜¯è¿™æ ·çš„ï¼Œè¿™ä¸ªæ²¡æœ‰æµ‹è¯• firewall-cmd --reload # æŸ¥çœ‹é˜²ç«å¢™ï¼Œæ·»åŠ çš„ç«¯å£ä¹Ÿå¯ä»¥çœ‹åˆ° firewall-cmd --list-all ç›´æ¥æ¨¡å¼ # FirewallDåŒ…æ‹¬ä¸€ç§ç›´æ¥æ¨¡å¼ï¼Œä½¿ç”¨å®ƒå¯ä»¥å®Œæˆä¸€äº›å·¥ä½œï¼Œä¾‹å¦‚æ‰“å¼€TCPåè®®çš„9999ç«¯å£ firewall-cmd --direct -add-rule ipv4 filter INPUT 0 -p tcp --dport 9000 -j accept firewall-cmd --reload è‡ªå®šä¹‰æœåŠ¡ç®¡ç† ï¼ˆæœ«å°¾å¸¦æœ‰ [P only] çš„è¯è¡¨ç¤ºè¯¥é€‰é¡¹é™¤äº†ä¸ï¼ˆ--permanentï¼‰ä¹‹å¤–ï¼Œä¸èƒ½ä¸å…¶ä»–é€‰é¡¹ä¸€åŒä½¿ç”¨ï¼ï¼‰ --new-service=\u0026lt;æœåŠ¡å\u0026gt; æ–°å»ºä¸€ä¸ªè‡ªå®šä¹‰æœåŠ¡ [P only] --new-service-from-file=\u0026lt;æ–‡ä»¶å\u0026gt; [--name=\u0026lt;æœåŠ¡å\u0026gt;] ä»æ–‡ä»¶ä¸­è¯»å–é…ç½®ç”¨ä»¥æ–°å»ºä¸€ä¸ªè‡ªå®šä¹‰æœåŠ¡ [P only] --delete-service=\u0026lt;æœåŠ¡å\u0026gt; åˆ é™¤ä¸€ä¸ªå·²å­˜åœ¨çš„æœåŠ¡ [P only] --load-service-defaults=\u0026lt;æœåŠ¡å\u0026gt; Load icmptype default settings [P only] --info-service=\u0026lt;æœåŠ¡å\u0026gt; æ˜¾ç¤ºè¯¥æœåŠ¡çš„ç›¸å…³ä¿¡æ¯ --path-service=\u0026lt;æœåŠ¡å\u0026gt; æ˜¾ç¤ºè¯¥æœåŠ¡çš„æ–‡ä»¶çš„ç›¸å…³è·¯å¾„ [P only] --service=\u0026lt;æœåŠ¡å\u0026gt; --set-description=\u0026lt;æè¿°\u0026gt; ç»™è¯¥æœåŠ¡è®¾ç½®æè¿°ä¿¡æ¯ [P only] --service=\u0026lt;æœåŠ¡å\u0026gt; --get-description æ˜¾ç¤ºè¯¥æœåŠ¡çš„æè¿°ä¿¡æ¯ [P only] --service=\u0026lt;æœåŠ¡å\u0026gt; --set-short=\u0026lt;æè¿°\u0026gt; ç»™è¯¥æœåŠ¡è®¾ç½®ä¸€ä¸ªç®€çŸ­çš„æè¿° [P only] --service=\u0026lt;æœåŠ¡å\u0026gt; --get-short æ˜¾ç¤ºè¯¥æœåŠ¡çš„ç®€çŸ­æè¿° [P only] --service=\u0026lt;æœåŠ¡å\u0026gt; --add-port=\u0026lt;ç«¯å£å·\u0026gt;[-\u0026lt;ç«¯å£å·\u0026gt;]/\u0026lt;protocol\u0026gt; ç»™è¯¥æœåŠ¡æ·»åŠ ä¸€ä¸ªæ–°çš„ç«¯å£(ç«¯å£æ®µ) [P only] --service=\u0026lt;æœåŠ¡å\u0026gt; --remove-port=\u0026lt;ç«¯å£å·\u0026gt;[-\u0026lt;ç«¯å£å·\u0026gt;]/\u0026lt;protocol\u0026gt; ä»è¯¥æœåŠ¡ä¸Šç§»é™¤ä¸€ä¸ªç«¯å£(ç«¯å£æ®µ) [P only] --service=\u0026lt;æœåŠ¡å\u0026gt; --query-port=\u0026lt;ç«¯å£å·\u0026gt;[-\u0026lt;ç«¯å£å·\u0026gt;]/\u0026lt;protocol\u0026gt; æŸ¥è¯¢è¯¥æœåŠ¡æ˜¯å¦æ·»åŠ äº†æŸä¸ªç«¯å£(ç«¯å£æ®µ) [P only] --service=\u0026lt;æœåŠ¡å\u0026gt; --get-ports æ˜¾ç¤ºè¯¥æœåŠ¡æ·»åŠ çš„æ‰€æœ‰ç«¯å£ [P only] --service=\u0026lt;æœåŠ¡å\u0026gt; --add-protocol=\u0026lt;protocol\u0026gt; ä¸ºè¯¥æœåŠ¡æ·»åŠ ä¸€ä¸ªåè®® [P only] --service=\u0026lt;æœåŠ¡å\u0026gt; --remove-protocol=\u0026lt;protocol\u0026gt; ä»è¯¥æœåŠ¡ä¸Šç§»é™¤ä¸€ä¸ªåè®® [P only] --service=\u0026lt;æœåŠ¡å\u0026gt; --query-protocol=\u0026lt;protocol\u0026gt; æŸ¥è¯¢è¯¥æœåŠ¡æ˜¯å¦æ·»åŠ äº†æŸä¸ªåè®® [P only] --service=\u0026lt;æœåŠ¡å\u0026gt; --get-protocols æ˜¾ç¤ºè¯¥æœåŠ¡æ·»åŠ çš„æ‰€æœ‰åè®® [P only] --service=\u0026lt;æœåŠ¡å\u0026gt; --add-source-port=\u0026lt;ç«¯å£å·\u0026gt;[-\u0026lt;ç«¯å£å·\u0026gt;]/\u0026lt;protocol\u0026gt; æ·»åŠ æ–°çš„æºç«¯å£(ç«¯å£æ®µ)åˆ°è¯¥æœåŠ¡ [P only] --service=\u0026lt;æœåŠ¡å\u0026gt; --remove-source-port=\u0026lt;ç«¯å£å·\u0026gt;[-\u0026lt;ç«¯å£å·\u0026gt;]/\u0026lt;protocol\u0026gt; ä»è¯¥æœåŠ¡ä¸­åˆ é™¤æºç«¯å£(ç«¯å£æ®µ) [P only] --service=\u0026lt;æœåŠ¡å\u0026gt; --query-source-port=\u0026lt;ç«¯å£å·\u0026gt;[-\u0026lt;ç«¯å£å·\u0026gt;]/\u0026lt;protocol\u0026gt; æŸ¥è¯¢è¯¥æœåŠ¡æ˜¯å¦æ·»åŠ äº†æŸä¸ªæºç«¯å£(ç«¯å£æ®µ) [P only] --service=\u0026lt;æœåŠ¡å\u0026gt; --get-source-ports æ˜¾ç¤ºè¯¥æœåŠ¡æ‰€æœ‰æºç«¯å£ [P only] --service=\u0026lt;æœåŠ¡å\u0026gt; --add-module=\u0026lt;module\u0026gt; ä¸ºè¯¥æœåŠ¡æ·»åŠ ä¸€ä¸ªæ¨¡å— [P only] --service=\u0026lt;æœåŠ¡å\u0026gt; --remove-module=\u0026lt;module\u0026gt; ä¸ºè¯¥æœåŠ¡ç§»é™¤ä¸€ä¸ªæ¨¡å— [P only] --service=\u0026lt;æœåŠ¡å\u0026gt; --query-module=\u0026lt;module\u0026gt; æŸ¥è¯¢è¯¥æœåŠ¡æ˜¯å¦æ·»åŠ äº†æŸä¸ªæ¨¡å— [P only] --service=\u0026lt;æœåŠ¡å\u0026gt; --get-modules æ˜¾ç¤ºè¯¥æœåŠ¡æ·»åŠ çš„æ‰€æœ‰æ¨¡å— [P only] --service=\u0026lt;æœåŠ¡å\u0026gt; --set-destination=\u0026lt;ipv\u0026gt;:\u0026lt;address\u0026gt;[/] Set destination for ipv to address in service [P only] --service=\u0026lt;æœåŠ¡å\u0026gt; --remove-destination=\u0026lt;ipv\u0026gt; Disable destination for ipv i service [P only] --service=\u0026lt;æœåŠ¡å\u0026gt; --query-destination=\u0026lt;ipv\u0026gt;:\u0026lt;address\u0026gt;[/] Return whether destination ipv is set for service [P only] --service=\u0026lt;æœåŠ¡å\u0026gt; --get-destinations List destinations in service [P only] æ§åˆ¶ç«¯å£/æœåŠ¡  å¯ä»¥é€šè¿‡ä¸¤ç§æ–¹å¼æ§åˆ¶ç«¯å£çš„å¼€æ”¾ï¼Œä¸€ç§æ˜¯æŒ‡å®šç«¯å£å·å¦ä¸€ç§æ˜¯æŒ‡å®šæœåŠ¡åã€‚è™½ç„¶å¼€æ”¾ http æœåŠ¡å°±æ˜¯å¼€æ”¾äº† 80 ç«¯å£ï¼Œä½†æ˜¯è¿˜æ˜¯ä¸èƒ½é€šè¿‡ç«¯å£å·æ¥å…³é—­ï¼Œä¹Ÿå°±æ˜¯è¯´é€šè¿‡æŒ‡å®šæœåŠ¡åå¼€æ”¾çš„å°±è¦é€šè¿‡æŒ‡å®šæœåŠ¡åå…³é—­ï¼›é€šè¿‡æŒ‡å®šç«¯å£å·å¼€æ”¾çš„å°±è¦é€šè¿‡æŒ‡å®šç«¯å£å·å…³é—­ã€‚è¿˜æœ‰ä¸€ä¸ªè¦æ³¨æ„çš„å°±æ˜¯æŒ‡å®šç«¯å£çš„æ—¶å€™ä¸€å®šè¦æŒ‡å®šæ˜¯ä»€ä¹ˆåè®®ï¼Œtcp è¿˜æ˜¯ udpã€‚çŸ¥é“è¿™ä¸ªä¹‹åä»¥åå°±ä¸ç”¨æ¯æ¬¡å…ˆå…³é˜²ç«å¢™äº†ï¼Œå¯ä»¥è®©é˜²ç«å¢™çœŸæ­£çš„ç”Ÿæ•ˆã€‚\n firewall-cmd --add-service=mysql # å¼€æ”¾mysqlç«¯å£ firewall-cmd --remove-service=http # é˜»æ­¢httpç«¯å£ firewall-cmd --list-services # æŸ¥çœ‹å¼€æ”¾çš„æœåŠ¡ firewall-cmd --add-port=3306/tcp # å¼€æ”¾é€šè¿‡tcpè®¿é—®3306 firewall-cmd --remove-port=80tcp # é˜»æ­¢é€šè¿‡tcpè®¿é—®3306 firewall-cmd --add-port=233/udp # å¼€æ”¾é€šè¿‡udpè®¿é—®233 firewall-cmd --list-ports # æŸ¥çœ‹å¼€æ”¾çš„ç«¯å£ ä¼ªè£…IP firewall-cmd --query-masquerade # æ£€æŸ¥æ˜¯å¦å…è®¸ä¼ªè£…IP firewall-cmd --add-masquerade # å…è®¸é˜²ç«å¢™ä¼ªè£…IP firewall-cmd --remove-masquerade# ç¦æ­¢é˜²ç«å¢™ä¼ªè£…IP ç«¯å£è½¬å‘  ç«¯å£è½¬å‘å¯ä»¥å°†æŒ‡å®šåœ°å€è®¿é—®æŒ‡å®šçš„ç«¯å£æ—¶ï¼Œå°†æµé‡è½¬å‘è‡³æŒ‡å®šåœ°å€çš„æŒ‡å®šç«¯å£ã€‚è½¬å‘çš„ç›®çš„å¦‚æœä¸æŒ‡å®š ip çš„è¯å°±é»˜è®¤ä¸ºæœ¬æœºï¼Œå¦‚æœæŒ‡å®šäº† ip å´æ²¡æŒ‡å®šç«¯å£ï¼Œåˆ™é»˜è®¤ä½¿ç”¨æ¥æºç«¯å£ã€‚ å¦‚æœé…ç½®å¥½ç«¯å£è½¬å‘ä¹‹åä¸èƒ½ç”¨ï¼Œå¯ä»¥æ£€æŸ¥ä¸‹é¢ä¸¤ä¸ªé—®é¢˜ï¼š\næ¯”å¦‚æˆ‘å°† 80 ç«¯å£è½¬å‘è‡³ 8080 ç«¯å£ï¼Œé¦–å…ˆæ£€æŸ¥æœ¬åœ°çš„ 80 ç«¯å£å’Œç›®æ ‡çš„ 8080 ç«¯å£æ˜¯å¦å¼€æ”¾ç›‘å¬äº† å…¶æ¬¡æ£€æŸ¥æ˜¯å¦å…è®¸ä¼ªè£… IPï¼Œæ²¡å…è®¸çš„è¯è¦å¼€å¯ä¼ªè£… IP\n firewall-cmd --add-forward-port=port=80:proto=tcp:toport=8080 # å°†80ç«¯å£çš„æµé‡è½¬å‘è‡³8080 firewall-cmd --add-forward-port=port=80:proto=tcp:toaddr=192.168.0.1 # å°†80ç«¯å£çš„æµé‡è½¬å‘è‡³192.168.0.1 firewall-cmd --add-forward-port=port=80:proto=tcp:toaddr=192.168.0.1:toport=8080 # å°†80ç«¯å£çš„æµé‡è½¬å‘è‡³192.168.0.1çš„8080ç«¯å£   1)å½“æˆ‘ä»¬æƒ³æŠŠæŸä¸ªç«¯å£éšè—èµ·æ¥çš„æ—¶å€™ï¼Œå°±å¯ä»¥åœ¨é˜²ç«å¢™ä¸Šé˜»æ­¢é‚£ä¸ªç«¯å£è®¿é—®ï¼Œç„¶åå†å¼€ä¸€ä¸ªä¸è§„åˆ™çš„ç«¯å£ï¼Œä¹‹åé…ç½®é˜²ç« å¢™çš„ç«¯å£è½¬å‘ï¼Œå°†æµé‡è½¬å‘è¿‡å»ã€‚ 2)ç«¯å£è½¬å‘è¿˜å¯ä»¥åšæµé‡åˆ†å‘ï¼Œä¸€ä¸ªé˜²ç«å¢™æ‹–ç€å¥½å¤šå°è¿è¡Œç€ä¸åŒæœåŠ¡çš„æœºå™¨ï¼Œç„¶åç”¨é˜²ç«å¢™å°†ä¸åŒç«¯å£çš„æµé‡è½¬å‘è‡³ä¸åŒæœºå™¨ã€‚   å¼€æœºå¯åŠ¨æœåŠ¡ åœ¨linuxä¸‹ï¼Œæœ‰ä¸€ä¸ªç›®å½•ä¸“é—¨ç”¨ä»¥ç®¡ç†æ‰€æœ‰çš„æœåŠ¡çš„å¯åŠ¨è„šæœ¬çš„ï¼Œå³/etc/rc.d/init.dä¸‹ã€‚\nè¿™æ—¶å€™ï¼Œæˆ‘ä»¬æ¥è¯•ä¸€ä¸‹ä½¿ç”¨serviceçš„å‘½ä»¤è¿›è¡Œå¯åŠ¨ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œè¿™æ—¶å€™å°±å¯ä»¥é€šè¿‡serviceçš„æ–¹å¼è¿›è¡Œå¯åŠ¨äº†ï¼ŒçœŸå®è¿ç»´ä¸­ä¹Ÿæ˜¯å¦‚æ­¤ï¼Œæˆ‘ä»¬åªéœ€è¦æŠŠæœåŠ¡çš„å¯åŠ¨è„šæœ¬æ–‡ä»¶æ”¾åœ¨æ­¤å¤„ï¼Œå°±å¯ä»¥ä»¥serviceçš„æ–¹å¼å¯åŠ¨äº†\nReidsç¤ºä¾‹ï¼š\næ¯ä¸ªæœåŠ¡éƒ½ä¼šé…ç½®ä¸€ä¸ªinitçš„è„šæœ¬ã€‚ä¾‹å¦‚redisåœ¨unitsä¸‹çš„ï¼Œredis_init_scriptï¼Œå°±å¯ä»¥æ”¾åœ¨/etc/rc.d/init.dä¸­\né€šè¿‡chkconfig æœåŠ¡å onå°±å¯ä»¥å¼€æœºå¯åŠ¨\n# chkconfig: 2345 15 95 å…¶ä¸­2345æ˜¯é»˜è®¤å¯åŠ¨çº§åˆ«ï¼Œçº§åˆ«æœ‰0-6å…±7ä¸ªçº§åˆ«ã€‚15æ˜¯å¯åŠ¨ä¼˜å…ˆçº§ï¼Œ95æ˜¯åœæ­¢ä¼˜å…ˆçº§ï¼Œä¼˜å…ˆçº§èŒƒå›´æ˜¯0ï¼100ï¼Œæ•°å­—è¶Šå¤§ï¼Œä¼˜å…ˆçº§è¶Šä½ã€‚\nJmap jmap -dump:format=b,file=æ–‡ä»¶å [pid]\njmap -dump:format=b,file=/usr/local/base/02.hprof 12942 -XX:+HeapDumpOnOutOfMemoryError -XX:HeapDumpPath=/usr/local/base\nMemoryAnalyzer -vmargs -Xmx5g ä¿¡æ¯æŸ¥çœ‹ æœºå™¨å†…æ ¸ /proc/version\nuname -a\næŸ¥çœ‹æ ¸å¿ƒæ•° # æ€»æ ¸æ•° = ç‰©ç†CPUä¸ªæ•° X æ¯é¢—ç‰©ç†CPUçš„æ ¸æ•°  # æ€»é€»è¾‘CPUæ•° = ç‰©ç†CPUä¸ªæ•° X æ¯é¢—ç‰©ç†CPUçš„æ ¸æ•° X è¶…çº¿ç¨‹æ•° # æŸ¥çœ‹ç‰©ç†CPUä¸ªæ•° cat /proc/cpuinfo| grep \u0026#34;physical id\u0026#34;| sort| uniq| wc -l # æŸ¥çœ‹æ¯ä¸ªç‰©ç†CPUä¸­coreçš„ä¸ªæ•°(å³æ ¸æ•°) cat /proc/cpuinfo| grep \u0026#34;cpu cores\u0026#34;| uniq # æŸ¥çœ‹é€»è¾‘CPUçš„ä¸ªæ•° cat /proc/cpuinfo| grep \u0026#34;processor\u0026#34;| wc -l sshç™»é™† ç”Ÿæˆå…¬ç§é’¥\nssh-keygen -t rsa -C \u0026ldquo;email\u0026rdquo;\nä¸Šä¼ å…¬é’¥åˆ°ç›®æ ‡æœåŠ¡å™¨\nscp -p ~/.ssh/id_rsa.pub root@\u0026lt;remote_ip\u0026gt;:/root/.ssh/authorized_keys\nscpä¸Šä¼ ä¸‹è½½ -o PubkeyAuthentication=no # ä¸å®ç”¨pkä¸‹è½½ å…‰æ ‡å¿«æ·é”® å…‰æ ‡æ“ä½œå¿«æ·é”®ï¼Œå…‰æ ‡å¿«æ·é”® è¿™äº›å…‰æ ‡æ“ä½œå¿«æ·é”®é€‚ç”¨mac/linuxç»ˆç«¯å’Œchromeæ§åˆ¶å°ï¼Œè¿™äº›å¿«æ·é”®éƒ½æ˜¯emacsçš„å¿«æ·é”®ï¼Œ å¸¸ç”¨çš„å¿«æ·é”®ï¼š Ctrl + d åˆ é™¤ä¸€ä¸ªå­—ç¬¦ï¼Œç›¸å½“äºé€šå¸¸çš„Deleteé”®(å‘½ä»¤è¡Œè‹¥æ— æ‰€æœ‰å­—ç¬¦ï¼Œåˆ™ç›¸å½“äºexitï¼›å¤„ç†å¤šè¡Œæ ‡å‡†è¾“å…¥æ—¶ä¹Ÿè¡¨ç¤ºeof) Ctrl + h é€€æ ¼åˆ é™¤ä¸€ä¸ªå­—ç¬¦ï¼Œç›¸å½“äºé€šå¸¸çš„Backspaceé”® Ctrl + u åˆ é™¤å…‰æ ‡ä¹‹å‰åˆ°è¡Œé¦–çš„å­—ç¬¦ Ctrl + k åˆ é™¤å…‰æ ‡ä¹‹å‰åˆ°è¡Œå°¾çš„å­—ç¬¦ Ctrl + c å–æ¶ˆå½“å‰è¡Œè¾“å…¥çš„å‘½ä»¤ï¼Œç›¸å½“äºCtrl + Break Ctrl + a å…‰æ ‡ç§»åŠ¨åˆ°è¡Œé¦–(Ahead of line)ï¼Œç›¸å½“äºé€šå¸¸çš„Homeé”® Ctrl + e å…‰æ ‡ç§»åŠ¨åˆ°è¡Œå°¾(End of line) Ctrl + f å…‰æ ‡å‘å‰(Forward)ç§»åŠ¨ä¸€ä¸ªå­—ç¬¦ä½ç½® Ctrl + b å…‰æ ‡å¾€å›(Backward)ç§»åŠ¨ä¸€ä¸ªå­—ç¬¦ä½ç½® Ctrl + l æ¸…å±ï¼Œç›¸å½“äºæ‰§è¡Œclearå‘½ä»¤ Ctrl + p è°ƒå‡ºå‘½ä»¤å†å²ä¸­çš„å‰ä¸€æ¡(Previous)å‘½ä»¤ï¼Œç›¸å½“äºé€šå¸¸çš„ä¸Šç®­å¤´ Ctrl + n è°ƒå‡ºå‘½ä»¤å†å²ä¸­çš„ä¸‹ä¸€æ¡(Next)å‘½ä»¤ï¼Œç›¸å½“äºé€šå¸¸çš„ä¸Šç®­å¤´ Ctrl + r æ˜¾ç¤ºï¼šå·æç¤ºï¼Œæ ¹æ®ç”¨æˆ·è¾“å…¥æŸ¥æ‰¾ç›¸å…³å†å²å‘½ä»¤(reverse-i-search) æ¬¡å¸¸ç”¨å¿«æ·é”®ï¼š Alt + f å…‰æ ‡å‘å‰(Forward)ç§»åŠ¨åˆ°ä¸‹ä¸€ä¸ªå•è¯ Alt + b å…‰æ ‡å¾€å›(Backward)ç§»åŠ¨åˆ°å‰ä¸€ä¸ªå•è¯ Ctrl + w åˆ é™¤ä»å…‰æ ‡ä½ç½®å‰åˆ°å½“å‰æ‰€å¤„å•è¯(Word)çš„å¼€å¤´ Alt + d åˆ é™¤ä»å…‰æ ‡ä½ç½®åˆ°å½“å‰æ‰€å¤„å•è¯çš„æœ«å°¾ Ctrl + y ç²˜è´´æœ€åä¸€æ¬¡è¢«åˆ é™¤çš„å•è¯    COMMAND ACTION     Shortcuts    Tab Auto-complete file and folder names   Ctrl + A Go to the beginning of the line you\u0026rsquo;re currently typing on   Ctrl + E Go to the end of the line you\u0026rsquo;re currently typing on   Ctrl + U Clear the line before the cursor   Ctrl + K Clear the line after the cursor   Ctrl + W Delete the word before the cursor   Ctrl + T Swap the last two characters before the cursor   Esc + T Swap the last two words before the cursor   Ctrl + L Clear the screen   Ctrl + C Kill whatever you\u0026rsquo;re running   Ctrl + D Exit the current shell   Option + â†’ Move cursor one word forward   Option + â† Move cursor one word backward   Ctrl + F Move cursor one character forward   Ctrl + B Move cursor one character backward   Ctrl + Y Paste whatever was cut by the last command   Ctrl + Z Puts whatever you\u0026rsquo;re running into a suspended background process   Ctrl + _ Undo the last command   Option + Shift + Cmd + C Copy plain text   Shift + Cmd + V Paste the selection   exit End a shell session    æŸ¥çœ‹cpuæ¶æ„ arch\nè®¾ç½®ç½‘å¡é™æ€ip BOOTPROTO=static IPADDR=128.83.155.1 NETMASK=255.255.255.0 GATEWAY=128.83.155.250 DNS1=114.114.114.114 service network restart rpmå’Œyum https://www.cnblogs.com/LiuChunfu/p/8 052890.html\naarch64 x86_64 arm64 amd64 https://www.jianshu.com/p/2753c45af9bf\naarch64==arm64 æ˜¯armæ¶æ„çš„\nx86_64=amd64 æ˜¯x86æ¶æ„çš„\nmanè¯¦è§£ https://www.geek-share.com/detail/2728370984.html\nè®¾ç½®hostname ","permalink":"https://sunhao1256.github.io/posts/linux/","summary":"ç»ˆç«¯ [root@LocalHost æ¡Œé¢]# l\n rootè¡¨ç¤ºå½“å‰ç™»å½•ç”¨æˆ·å locahostè¡¨ç¤ºå½“å‰ç™»å½•çš„ä¸»æœºå æ¡Œé¢ è¡¨ç¤ºå½“å‰çš„å·¥ä½œç›®å½• # èº«ä»½æ ‡è¯†ç¬¦ #è¡¨ç¤ºä¸ºè¶…çº§ç®¡ç†å‘˜ $è¡¨ç¤ºä¸ºæ™®é€šç”¨æˆ·  ç›®å½•ç»“æ„  Binï¼šå…¨ç§°Binaryï¼Œå­˜æ”¾çš„éƒ½æ˜¯ä¸€äº›äºŒè¿›åˆ¶æ–‡ä»¶ Devï¼šä¸»è¦å­˜æ”¾ä¸€äº›å¤–æ¥è®¾å¤‡ï¼Œä¾‹å¦‚Uç›˜ç­‰ï¼Œåœ¨å…¶ä¸­çš„è®¾å¤‡æ˜¯ä¸èƒ½ç›´æ¥ä½¿ç”¨çš„ï¼Œéœ€è¦æŒ‚è½½ï¼ˆç±»ä¼¼windowsä¸‹çš„åˆ†ç›˜ï¼‰ Etcï¼šä¸»è¦å­˜æ”¾ä¸€äº›é…ç½®æ–‡ä»¶ Homeï¼šè¡¨ç¤ºé™¤äº†rootç”¨æˆ·ä»¥å¤–çš„å…¶ä»–çš„å®¶ç›®å½•ï¼Œç±»ä¼¼windowsä¸‹çš„userç”¨æˆ·ç›®å½• Procï¼šè¯¥ç›®å½•å­˜æ”¾è¿è¡Œçš„è¿›ç¨‹æ–‡ä»¶ Rootï¼šè¯¥ç›®å½•æ˜¯rootç”¨æˆ·çš„å®¶ç›®å½• SBinï¼šè¯¥ç›®å½•ä¹Ÿæ˜¯å­˜æ”¾äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä½†æ˜¯å¿…é¡»å¾—æœ‰superæƒé™çš„ç”¨æˆ·æ‰èƒ½æ‰§è¡Œ Usrï¼šç”¨æˆ·çš„åº”ç”¨ç¨‹åºå’Œæ–‡ä»¶éƒ½æ”¾åœ¨è¿™ä¸ªç›®å½•ä¸‹ç±»ä¼¼äºwindowsä¸‹çš„program filesç›®å½• Mntï¼šè®©ç”¨æˆ·ä¸´æ—¶æŒ‚åœ¨åˆ«çš„æ–‡ä»¶ç³»ç»Ÿ Optï¼šä¸€èˆ¬å­˜æ”¾å®‰è£…è½¯ä»¶åŒ… Usr/localï¼šå­˜æ”¾å®‰è£…è½¯ä»¶åå­˜åœ¨çš„è½¯ä»¶ç›®å½• Varï¼šå­˜æ”¾ä¸æ–­å˜åŒ–çš„æ–‡ä»¶ï¼Œä¾‹å¦‚æ—¥å¿—æ–‡ä»¶  VIå’ŒVIMç¼–è¾‘å™¨ æ‰€æœ‰çš„Linuxç³»ç»Ÿéƒ½ä¼šå†…å»ºVIæ–‡æœ¬ç¼–è¾‘å™¨ï¼ŒVIMå…·æœ‰ç¨‹åºç¼–è¾‘çš„èƒ½åŠ›ï¼Œå¯ä»¥çœ‹æˆæ˜¯VIçš„å¢å¼ºç‰ˆ\nVIå’ŒVIMçš„3ç§å¸¸è§æ¨¡å¼   æ­£å¸¸æ¨¡å¼\nåœ¨æ­£å¸¸æ˜¯æ¨¡å¼ä¸‹ï¼Œå¯ä»¥ä½¿ç”¨å¿«æ·é”®æ¥å¤„ç†å†…å®¹\n  æ’å…¥/ç¼–è¾‘æ¨¡å¼\nåœ¨æ­¤æ¨¡å¼ä¸‹ï¼Œå¯ä»¥è¾“å…¥å†…å®¹ï¼ŒæŒ‰iï¼ŒIï¼Œoï¼ŒOï¼Œaï¼ŒAï¼Œrï¼ŒRç­‰ä»»ä½•ä¸€ä¸ªå­—æ¯å°±å¯ä»¥è¿›å…¥ç¼–è¾‘æ¨¡å¼ï¼Œä¸€èˆ¬ç”¨i\n  å‘½ä»¤è¡Œæ¨¡å¼\nå¯ä»¥ä½¿ç”¨æŒ‡ä»¤å®Œæˆï¼Œè¯»å–ï¼Œå­˜ç›˜ï¼Œæ›¿æ¢ï¼Œç¦»å¼€ï¼Œæ˜¾ç¤ºè¡Œå·ç­‰åŠ¨ä½œ\n  æ³¨é‡Š å•è¡Œæ³¨é‡Šï¼š#\nå¤šè¡Œæ³¨é‡Šï¼š:\u0026laquo;!å†…å®¹!\nå¿«æ·é”®çš„ä½¿ç”¨   è¡Œé¦–0ï¼Œè¡Œå°¾$\n  æ‹·è´å½“å‰è¡Œï¼šyyï¼Œæ‹·è´å½“å‰å‘ä¸‹nè¡Œï¼šnyyï¼Œä¾‹å¦‚ï¼š5yy\n  ç²˜è´´ï¼šp\n  åˆ é™¤å½“å‰è¡Œï¼šddï¼Œåˆ é™¤å½“å‰è¡Œä¸‹nè¡Œï¼šnddï¼Œä¾‹å¦‚ï¼š5dd\n  æŸ¥æ‰¾ï¼šå‘½ä»¤è¡Œæ¨¡å¼ä¸‹ / å…³é”®å­—ï¼Œä¾‹å¦‚ï¼š/helloï¼Œä¸‹ä¸€ä¸ªn\n  è®¾ç½®æ–‡ä»¶è¡Œå·ï¼šå‘½ä»¤è¡Œæ¨¡å¼ä¸‹ ï¼šset nuï¼Œå…³é—­è¡Œå·ï¼šset nonu","title":"linux"}]